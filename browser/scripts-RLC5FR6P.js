var FamilyTree=function(t,e){var i=this;if((typeof t=="string"||t instanceof String)&&(t=document.querySelector(t)),this.element=t,this.config=FamilyTree.mergeDeep(FamilyTree._defaultConfig(e),e),this._layoutConfigs={base:{orientation:this.config.orientation,levelSeparation:this.config.levelSeparation,mixedHierarchyNodesSeparation:this.config.mixedHierarchyNodesSeparation,assistantSeparation:this.config.assistantSeparation,subtreeSeparation:this.config.subtreeSeparation,siblingSeparation:this.config.siblingSeparation,layout:this.config.layout,columns:this.config.columns,collapse:this.config.collapse,partnerNodeSeparation:this.config.partnerNodeSeparation}},this.config.tags)for(var n in this.config.tags){var r=this.config.tags[n];r.subTreeConfig!=null&&(this._layoutConfigs[n]={orientation:r.subTreeConfig.orientation!=null?r.subTreeConfig.orientation:this.config.orientation,levelSeparation:r.subTreeConfig.levelSeparation!=null?r.subTreeConfig.levelSeparation:this.config.levelSeparation,mixedHierarchyNodesSeparation:r.subTreeConfig.mixedHierarchyNodesSeparation!=null?r.subTreeConfig.mixedHierarchyNodesSeparation:this.config.mixedHierarchyNodesSeparation,assistantSeparation:r.subTreeConfig.assistantSeparation!=null?r.subTreeConfig.assistantSeparation:this.config.assistantSeparation,subtreeSeparation:r.subTreeConfig.subtreeSeparation!=null?r.subTreeConfig.subtreeSeparation:this.config.subtreeSeparation,siblingSeparation:r.subTreeConfig.siblingSeparation!=null?r.subTreeConfig.siblingSeparation:this.config.siblingSeparation,layout:r.subTreeConfig.layout!=null?r.subTreeConfig.layout:this.config.layout,columns:r.subTreeConfig.columns!=null?r.subTreeConfig.columns:this.config.columns,collapse:r.subTreeConfig.collapse!=null?r.subTreeConfig.collapse:this.config.collapse,partnerNodeSeparation:r.subTreeConfig.partnerNodeSeparation!=null?r.subTreeConfig.partnerNodeSeparation:this.config.partnerNodeSeparation})}this._event_id=FamilyTree._guid(),FamilyTree._validateConfig(this.config)&&(this._vScroll={},this.config.ui||(this.ui=FamilyTree.ui),this.config.editUI?this.editUI=this.config.editUI:this.editUI=new FamilyTree.editUI,this.editUI.init(this),this.config.filterUI?this.filterUI=this.config.filterUI:this.filterUI=new FamilyTree.filterUI,this.filterUI.init(this),this.manager=new FamilyTree.manager(this),this.config.searchUI?this.searchUI=this.config.searchUI:this.searchUI=new FamilyTree.searchUI,this.config.nodeMenuUI?this.nodeMenuUI=this.config.nodeMenuUI:this.nodeMenuUI=new FamilyTree.menuUI,this.nodeMenuUI.init(this,this.config.nodeMenu),this.config.nodeCircleMenuUI?this.nodeCircleMenuUI=this.config.nodeCircleMenuUI:this.nodeCircleMenuUI=new FamilyTree.circleMenuUI,this.nodeCircleMenuUI.init(this,this.config.nodeCircleMenu),this.config.nodeContextMenuUI?this.nodeContextMenuUI=this.config.nodeContextMenuUI:this.nodeContextMenuUI=new FamilyTree.menuUI,this.nodeContextMenuUI.init(this,this.config.nodeContextMenu),this.config.toolbarUI?this.toolbarUI=this.config.toolbarUI:this.toolbarUI=new FamilyTree.toolbarUI,this.config.notifierUI?this.notifierUI=this.config.notifierUI:this.notifierUI=new FamilyTree.notifierUI,this.notifierUI.init(this),this.config.menuUI?this.menuUI=this.config.menuUI:this.menuUI=new FamilyTree.menuUI,this.menuUI.init(this,this.config.menu),this.config.xScrollUI||(this.xScrollUI=new FamilyTree.xScrollUI(this.element,this.config,function(){return{boundary:i.response.boundary,scale:i.getScale(),viewBox:i.getViewBox(),padding:i.config.padding}},function(o){i.setViewBox(o)},function(){i._draw(!0,FamilyTree.action.xScroll)})),this.config.yScrollUI||(this.yScrollUI=new FamilyTree.yScrollUI(this.element,this.config,function(){return{boundary:i.response.boundary,scale:i.getScale(),viewBox:i.getViewBox(),padding:i.config.padding}},function(o){i.setViewBox(o)},function(){i._draw(!0,FamilyTree.action.xScroll)})),this.config.undoRedoUI?this.undoRedoUI=this.config.undoRedoUI:this.undoRedoUI=new FamilyTree.undoRedoUI,this.element.classList.add("bft-"+this.config.mode),this._gragStartedId=null,this._timeout=null,this._touch=null,this._initialized=!1,this._loaded=!1,this._moveInterval=null,this._movePosition=null,this.response=null,this.nodes=null,this.isVisible=null,FamilyTree._intersectionObserver(this.element,function(o){i.isVisible=o,FamilyTree.events.publish("visibility-change",[i])!==!1&&FamilyTree.LAZY_LOADING&&i.isVisible&&(i._loaded?i._draw(!1,FamilyTree.action.update):(i._setInitialSizeIfNotSet(),i._draw(!1,FamilyTree.action.init)))}))};FamilyTree._defaultConfig=function(t){return{interactive:!0,mode:"light",lazyLoading:!0,enableDragDrop:!1,enableSearch:!0,enableTouch:!1,enablePan:!0,keyNavigation:!1,miniMap:!1,nodeMenu:null,nodeCircleMenu:null,nodeContextMenu:null,menu:null,toolbar:!1,sticky:!0,nodeMouseClick:FamilyTree.action.details,nodeMouseDbClick:FamilyTree.none,mouseScrool:FamilyTree.action.zoom,showXScroll:FamilyTree.none,showYScroll:FamilyTree.none,template:"ana",tags:{},min:!1,nodeBinding:{},linkBinding:{},searchFields:null,searchDisplayField:null,searchFieldsWeight:null,searchFieldsAbbreviation:null,nodes:[],clinks:[],slinks:[],backdrops:[],groupDottedLines:[],dottedLines:[],undoRedoStorageName:null,levelSeparation:60,siblingSeparation:20,subtreeSeparation:40,backdropSeparation:15,mixedHierarchyNodesSeparation:15,assistantSeparation:100,minPartnerSeparation:50,partnerChildrenSplitSeparation:20,partnerNodeSeparation:15,columns:10,padding:30,orientation:FamilyTree.orientation.top,layout:FamilyTree.layout.normal,layoutGridColumns:"dynamic",scaleInitial:1,movable:null,scaleMin:.1,scaleMax:5,orderBy:null,editUI:null,filterUI:null,searchUI:null,xScrollUI:null,yScrollUI:null,nodeMenuUI:null,nodeCircleMenuUI:null,nodeContextMenuUI:null,toolbarUI:null,notifierUI:null,menuUI:null,undoRedoUI:null,exportUrl:"https://balkan.app/export",collapse:{},expand:{},align:FamilyTree.CENTER,UI:null,anim:{func:FamilyTree.anim.outPow,duration:200},zoom:{speed:120,smooth:12},roots:null,state:null,editForm:{readOnly:!1,titleBinding:"name",photoBinding:"img",addMore:"Add more fields",addMoreBtn:"Add",addMoreFieldName:"Field name",saveAndCloseBtn:"Save and close",cancelBtn:"Cancel",generateElementsFromFields:!0,focusBinding:null,buttons:{edit:{icon:FamilyTree.icon.edit(24,24,"#fff"),text:"Edit",hideIfEditMode:!0,hideIfDetailsMode:!1},share:{icon:FamilyTree.icon.share(24,24,"#fff"),text:"Share"},pdf:{icon:FamilyTree.icon.pdf(24,24,"#fff"),text:"Save as PDF"},remove:{icon:FamilyTree.icon.remove(24,24,"#fff"),text:"Remove",hideIfDetailsMode:!0}},elements:[]}}},FamilyTree.prototype.load=function(t,e){var i=this;return this.config.nodes=t,this._draw(!1,FamilyTree.action.init,void 0,function(){i.filterUI.update(),e&&e()}),this},FamilyTree.prototype.loadXML=function(t,e){var i=FamilyTree._xml2json(t);return this.load(i,e)},FamilyTree.prototype.getXML=function(){return FamilyTree._json2xml(this.config.nodes)},FamilyTree.prototype.on=function(t,e){return FamilyTree.events.on(t,e,this._event_id),this},FamilyTree.prototype.removeListener=function(t,e){return FamilyTree.events.remove(t,e,this._event_id)},FamilyTree.prototype.draw=function(t,e,i){t==null&&(t=FamilyTree.action.update),this._draw(!1,t,e,i)},FamilyTree.prototype._draw=function(t,e,i,n){var r=this;if(!FamilyTree.LAZY_LOADING||this.isVisible)if(FamilyTree.LAZY_LOADING||this._initialized||(this._setInitialSizeIfNotSet(),this.width()!=0&&this.height()!=0)){this._hideBeforeAnimationCompleted=!1;var o=e==FamilyTree.action.init?null:this.getViewBox();this.manager.read(t,this.width(),this.height(),o,e,i,function(a){if(!r.notifierUI.show(a.notif)){e!=FamilyTree.action.exporting&&(r.nodes=a.nodes,r.visibleNodeIds=a.visibleNodeIds,r.roots=a.roots),r.editUI.fields=a.allFields;var l={defs:""};FamilyTree.events.publish("renderdefs",[r,l]);var s=r.ui.defs(l.defs),c=r.getScale(a.viewBox);s+=r.ui.pointer(r.config,e,c);var d=r.getViewBox(),p=a.viewBox;l={content:s,res:a},FamilyTree.events.publish("prerender",[r,l]),s=l.content;var h=[];if(FamilyTree.RENDER_LINKS_BEFORE_NODES)for(var f=0;f<a.visibleNodeIds.length;f++){var m=a.nodes[a.visibleNodeIds[f]];FamilyTree.getRootOf(m).stParent?h.push(m.id):s+=r.ui.link(m,r,c,a.bordersByRootIdAndLevel,a.nodes,e)}for(f=0;f<a.visibleNodeIds.length;f++){m=a.nodes[a.visibleNodeIds[f]];var y=r._get(m.id);FamilyTree.RENDER_LINKS_BEFORE_NODES&&h.includes(m.id)&&(s+=r.ui.link(m,r,c,a.bordersByRootIdAndLevel,a.nodes,e)),s+=r.ui.node(m,y,a.animations,r.config,void 0,void 0,void 0,e,c,r)}for(f=0;f<a.visibleNodeIds.length;f++)m=a.nodes[a.visibleNodeIds[f]],FamilyTree.RENDER_LINKS_BEFORE_NODES||(s+=r.ui.link(m,r,c,a.bordersByRootIdAndLevel,a.nodes,e)),s+=r.ui.expandCollapseBtn(r,m,r._layoutConfigs,e,c);if(l={content:s,res:a},FamilyTree.events.publish("render",[r,l]),s=l.content,a=l.res,s+=r.ui.lonely(r.config),e!==FamilyTree.action.exporting){if(e!==FamilyTree.action.centernode&&e!==FamilyTree.action.insert&&e!==FamilyTree.action.expand&&e!==FamilyTree.action.collapse&&e!==FamilyTree.action.update||(p=d),e===FamilyTree.action.init&&d!=null&&(p=d),r.response=a,w=r.ui.svg(r.width(),r.height(),p,r.config,s),r._initialized){var x=r.getSvg(),u=x.parentNode;u.removeChild(x),u.insertAdjacentHTML("afterbegin",w),r._attachEventHandlers(),r.xScrollUI.addListener(r.getSvg()),r.yScrollUI.addListener(r.getSvg()),r.xScrollUI.setPosition(),r.yScrollUI.setPosition()}else r.element.innerHTML=r.ui.css()+w+r.ui.menuButton(r.config),r._attachInitEventHandlers(),r._attachEventHandlers(),r.xScrollUI.create(r.width(),r.config.padding),r.xScrollUI.setPosition(),r.xScrollUI.addListener(r.getSvg()),r.yScrollUI.create(r.height(),r.config.padding),r.yScrollUI.setPosition(),r.yScrollUI.addListener(r.getSvg()),r.config.enableSearch&&r.searchUI.init(r),r.toolbarUI.init(r,r.config.toolbar),r.undoRedoUI.init(r);var b=!1,v=r.response.animations;if(v[0].length>0){for(r._hideBeforeAnimation(v[0].length),f=0;f<v[0].length;f++)v[0][f]=r.getNodeElement(v[0][f]);FamilyTree.animate(v[0],v[1],v[2],r.config.anim.duration,r.config.anim.func,function(){b||(n&&n(),FamilyTree.events.publish("redraw",[r]),r._showAfterAnimation(),b=!0)})}e===FamilyTree.action.centerNode?FamilyTree.animate(r.getSvg(),{viewbox:d},{viewbox:r.response.viewBox},r.config.anim.duration,r.config.anim.func,function(){r.ripple(i.options.rippleId),b||(n&&n(),FamilyTree.events.publish("redraw",[r]),r._showAfterAnimation(),b=!0)},function(){r.xScrollUI.setPosition(),r.yScrollUI.setPosition()}):!d||!r.response||d[0]==r.response.viewBox[0]&&d[1]==r.response.viewBox[1]&&d[2]==r.response.viewBox[2]&&d[3]==r.response.viewBox[3]||e!==FamilyTree.action.insert&&e!==FamilyTree.action.expand&&e!==FamilyTree.action.collapse&&e!==FamilyTree.action.update&&e!==FamilyTree.action.init?v[0].length==0&&(b||(n&&n(),FamilyTree.events.publish("redraw",[r]),b=!0)):FamilyTree.animate(r.getSvg(),{viewbox:d},{viewbox:r.response.viewBox},2*r.config.anim.duration,r.config.anim.func,function(){r.xScrollUI.setPosition(),r.yScrollUI.setPosition(),b||(n&&n(),FamilyTree.events.publish("redraw",[r]),b=!0)}),r._initialized||(r._initialized=!0,r.filterUI.update(),FamilyTree.events.publish("init",[r])),!r._loaded&&a&&a.nodes&&Object.keys(a.nodes).length&&(r._loaded=!0)}else{var g=a.boundary,_=g.maxX-g.minX,k=g.maxY-g.minY,w=r.ui.svg(_,k,[g.minX,g.minY,_,k],r.config,s,c);n(w,a)}}},function(a){FamilyTree.events.publish("ready",[r,a])})}else console.error("Cannot load the family with size 0! If you are using the FamilyTree within tabs set FamilyTree.LAZY_LOADING to true! ")},FamilyTree.prototype._setInitialSizeIfNotSet=function(){this.element.style.overflow="hidden",this.element.style.position="relative",this.element.offsetHeight==0&&(this.element.style.height="100%",this.element.offsetHeight==0&&(this.element.style.height="700px")),this.element.offsetWidth==0&&(this.element.style.width="100%",this.element.offsetWidth==0&&(this.element.style.width="700px"))},FamilyTree.prototype.width=function(){return this.element.offsetWidth},FamilyTree.prototype.height=function(){return this.element.offsetHeight},FamilyTree.prototype.getViewBox=function(){var t=this.getSvg();return FamilyTree._getViewBox(t)},FamilyTree.prototype.setViewBox=function(t){this.getSvg().setAttribute("viewBox",t.toString())},FamilyTree.prototype.getScale=function(t){return t||(t=this.getViewBox()),FamilyTree.getScale(t,this.width(),this.height(),this.config.scaleInitial,this.config.scaleMax,this.config.scaleMin)},FamilyTree.prototype.setScale=function(t){t>this.config.scaleMax&&(t=this.config.scaleMax),t<this.config.scaleMin&&(t=this.config.scaleMin);var e=this.getViewBox().slice(0),i=this.width(),n=this.height(),r=i/e[2],o=n/e[3],a=r>o?o:r,l=e,s=e[2],c=e[3];return e[2]=e[2]/(t/a),e[3]=e[3]/(t/a),e[0]=l[0]-(e[2]-s)/2,e[1]=l[1]-(e[3]-c)/2,this.setViewBox(e),FamilyTree.events.publish("redraw",[this]),t},FamilyTree.prototype.ripple=function(t,e,i){var n=this.getNode(t);if(n!=null){var r=this.getNodeElement(t);if(r!=null){var o=this.getScale(),a=n.w/2,l=n.h/2;if(e!==void 0&&i!==void 0){var s=r.getBoundingClientRect();a=e/o-s.left/o,l=i/o-s.top/o}var c=n.w,d=n.h,p=c-a>a?c-a:a,h=d-l>l?d-l:l,f=p>h?p:h,m=document.createElementNS("http://www.w3.org/2000/svg","g"),y=document.createElementNS("http://www.w3.org/2000/svg","clipPath"),x=document.createElementNS("http://www.w3.org/2000/svg","rect"),u=document.createElementNS("http://www.w3.org/2000/svg","circle"),b=FamilyTree.randomId();y.setAttribute("id",b);var v={ripple:FamilyTree.t(n.templateName,n.min,this.getScale()).ripple,node:n};FamilyTree.events.publish("ripple",[this,v]),x.setAttribute("x",v.ripple.rect?v.ripple.rect.x:0),x.setAttribute("y",v.ripple.rect?v.ripple.rect.y:0),x.setAttribute("width",v.ripple.rect?v.ripple.rect.width:n.w),x.setAttribute("height",v.ripple.rect?v.ripple.rect.height:n.h),x.setAttribute("rx",v.ripple.radius),x.setAttribute("ry",v.ripple.radius),u.setAttribute("clip-path","url(#"+b+")"),u.setAttribute("cx",a),u.setAttribute("cy",l),u.setAttribute("r",0),u.setAttribute("fill",v.ripple.color),u.setAttribute("class","bft-ripple"),y.appendChild(x),m.appendChild(y),m.appendChild(u),r.appendChild(m),FamilyTree.animate(u,{r:0,opacity:1},{r:f,opacity:0},500,FamilyTree.anim.outPow,function(){r.removeChild(m)})}}},FamilyTree.prototype.center=function(t,e,i){var n,r,o=t,a=!0,l=!0;e&&e.parentState!=null&&(n=e.parentState),e&&e.childrenState!=null&&(r=e.childrenState),e&&e.rippleId!=null&&(o=e.rippleId),e&&e.vertical!=null&&(a=e.vertical),e&&e.horizontal!=null&&(l=e.horizontal);var s={parentState:n,childrenState:r,rippleId:o,vertical:a,horizontal:l};this._draw(!1,FamilyTree.action.centerNode,{id:t,options:s},i)},FamilyTree.prototype.fit=function(t){this.config.scaleInitial=FamilyTree.match.boundary,this._draw(!0,FamilyTree.action.init,{method:"fit"},t)},FamilyTree.prototype.toggleFullScreen=function(){var t=document.querySelector("["+FamilyTree.attr.tlbr+"r='fullScreen']");document.fullscreenElement==this.element||document.webkitFullscreenElement==this.element||document.mozFullScreenElement==this.element||document.msFullscreenElement==this.element?(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),t&&(t.innerHTML=FamilyTree.toolbarUI.openFullScreenIcon)):(this.element.requestFullscreen?this.element.requestFullscreen():this.element.mozRequestFullScreen?this.element.mozRequestFullScreen():this.element.webkitRequestFullscreen?this.element.webkitRequestFullscreen():this.element.msRequestFullscreen&&this.element.msRequestFullscreen(),t&&(t.innerHTML=FamilyTree.toolbarUI.closeFullScreenIcon))},FamilyTree.prototype.getNode=function(t){return this.nodes[t]},FamilyTree.prototype.setLayout=function(t,e){e||(e="base"),this._layoutConfigs[e].layout=t,e=="base"&&(this.config.layout=t),this._draw(!1,FamilyTree.action.update)},FamilyTree.prototype.setOrientation=function(t,e,i){var n=this;e||(e="base"),this._layoutConfigs[e].orientation=t,e=="base"&&(this.config.orientation=t),this._draw(!1,FamilyTree.action.update,void 0,function(){FamilyTree._moveToBoundaryArea(n.getSvg(),n.getViewBox(),n.response.boundary,function(){n._draw(!0,FamilyTree.action.pan),i&&i()})})},FamilyTree.prototype.search=function(t,e,i){return FamilyTree.isNEU(e)&&(e=this.searchUI._searchFields),FamilyTree.isNEU(i)&&(i=e),FamilyTree._search.search(this.config.nodes,t,e,i,this.config.searchDisplayField,this.config.searchFieldsWeight,this.searchUI._searchFieldsAbbreviation)},FamilyTree.prototype._hideBeforeAnimation=function(t){if(this._hideBeforeAnimationCompleted!=1&&!(t&&t<FamilyTree.ANIM_THRESHOLD)){var e=this.element.getElementsByTagName("text");if(e.length>FamilyTree.TEXT_THRESHOLD)for(var i=0;i<e.length;i++)e[i].style.display="none";var n=this.element.getElementsByTagName("image");if(n.length>FamilyTree.IMAGES_THRESHOLD)for(i=0;i<n.length;i++)n[i].style.display="none";var r=this.element.querySelectorAll("["+FamilyTree.attr.link_id+"]");if(r.length>FamilyTree.LINKS_THRESHOLD)for(i=0;i<r.length;i++)r[i].style.display="none";var o=this.element.querySelectorAll("["+FamilyTree.attr.control_expcoll_id+"]");if(o.length>FamilyTree.BUTTONS_THRESHOLD)for(i=0;i<o.length;i++)o[i].style.display="none";var a=this.element.querySelectorAll("["+FamilyTree.attr.control_up_id+"]");if(a.length>FamilyTree.BUTTONS_THRESHOLD)for(i=0;i<a.length;i++)a[i].style.display="none";this._hideBeforeAnimationCompleted=!0}},FamilyTree.prototype._showAfterAnimation=function(){for(var t=this.element.getElementsByTagName("text"),e=0;e<t.length;e++)t[e].style.display="";var i=this.element.getElementsByTagName("image");for(e=0;e<i.length;e++)i[e].style.display="";var n=this.element.querySelectorAll("["+FamilyTree.attr.link_id+"]");for(e=0;e<n.length;e++)n[e].style.display="";var r=this.element.querySelectorAll("["+FamilyTree.attr.control_expcoll_id+"]");for(e=0;e<r.length;e++)r[e].style.display="";var o=this.element.querySelectorAll("["+FamilyTree.attr.control_up_id+"]");for(e=0;e<o.length;e++)o[e].style.display="";this._hideBeforeAnimationCompleted=!1},FamilyTree.prototype.isChild=function(t,e){for(var i=this.getNode(e);i;){if(i.id==t)return!0;i=i.parent?i.parent:i.stParent}return!1},FamilyTree.prototype.getCollapsedIds=function(t){for(var e=[],i=0;i<t.childrenIds.length;i++){var n=this.getNode(t.childrenIds[i]);n.collapsed==1&&e.push(n.id)}return e},FamilyTree.prototype.stateToUrl=function(){if(this.manager.state){var t={};return t.exp=this.manager.state.exp.join("*"),t.min=this.manager.state.min.join("*"),t.adjustify=this.manager.state.adjustify.x+"*"+this.manager.state.adjustify.y,t.scale=this.manager.state.scale,t.y=this.manager.state.x,t.x=this.manager.state.y,new URLSearchParams(t).toString()}return""},FamilyTree.prototype.generateId=function(){for(;;){var t="_"+("0000"+(Math.random()*Math.pow(36,4)|0).toString(36)).slice(-4);if(this.nodes==null||!this.nodes.hasOwnProperty(t))return t}},FamilyTree.prototype.moveNodesToVisibleArea=function(t,e){for(var i=this,n=this.getSvg(),r=this.getViewBox(),o=null,a=null,l=null,s=null,c=0;c<t.length;c++){var d=this.nodes[t[c]];(o===null||o<d.x+d.w)&&(o=d.x+d.w),(a===null||a<d.y+d.h)&&(a=d.y+d.h),(l===null||l>d.x)&&(l=d.x),(s===null||s>d.y)&&(s=d.y)}var p=this.width(),h=this.height(),f=p/(b=o-l+2*this.config.padding),m=h/(v=a-s+2*this.config.padding),y=f>m?m:f,x=Math.ceil(p/y),u=Math.ceil(h/y),b=0,v=0;if(x-2*this.config.padding>=o-l)b=(o+l)/2-x/2;else switch(b=firstRoot.x-x/2+FamilyTree.manager._getNodeWidth(firstRoot,this.config)/2,this.config.orientation){case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:(b=-(x/2-(l-o)/2))<this.config.padding-x&&(b=this.config.padding-x);break;case FamilyTree.orientation.left:case FamilyTree.orientation.bottom_left:case FamilyTree.orientation.top_left:case FamilyTree.orientation.left_top:(b=-(x/2-(o-l)/2))>-this.config.padding&&(b=-this.config.padding)}if(u-2*this.config.padding>=a-s)v=(a+s)/2-u/2;else switch((v=-(u/2-(a-s)/2))>-this.config.padding&&(v=-this.config.padding),this.config.orientation){case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:(v=-(u/2-(s-a)/2))<this.config.padding-u&&(v=this.config.padding-u);break;case FamilyTree.orientation.left:case FamilyTree.orientation.right:v=firstRoot.y-u/2+FamilyTree.manager._getNodeWidth(firstRoot,this.config)/2}var g=[b,v,x,u];r[0]!==g[0]||r[1]!==g[1]?FamilyTree.animate(n,{viewBox:r},{viewBox:g},this.config.anim.duration,this.config.anim.func,function(){i.draw(FamilyTree.action.update,void 0,e)}):e&&e()},FamilyTree.prototype._nodeHasHiddenParent=function(t){return!t.parent&&!FamilyTree.isNEU(t.pid)&&this.getNode(t.pid)},FamilyTree.prototype.destroy=function(){this._removeEvent(window,"resize"),FamilyTree.events.removeForEventId(this._event_id),this.element.innerHTML=null},FamilyTree.__defaultConfig=FamilyTree._defaultConfig,FamilyTree._defaultConfig=function(t){var e=FamilyTree.__defaultConfig();return e.nodeTreeMenu=null,e.template="tommy",e.mode="light",e.minPartnerSeparation=30,e.partnerChildrenSplitSeparation=10,e.siblingSeparation=35,e.tags["children-group"]={template:"cgroup",subTreeConfig:{siblingSeparation:7,columns:1}},t&&t.template?(e.tags.male={template:t.template+"_male"},e.tags.female={template:t.template+"_female"}):(e.tags.male={template:e.template+"_male"},e.tags.female={template:e.template+"_female"}),e},FamilyTree.prototype.load=function(t,e){var i=this;return this.config.nodes=t,this.config.roots=null,this._draw(!1,FamilyTree.action.init,void 0,function(){i.filterUI.update(),e&&e()}),this},FamilyTree.prototype.getRecentRootsByNodeId=function(t){this.recentRoots||(this.recentRoots=[]);var e=this.recentRoots,i=this.getNode(t);return i?(i.rids.sort(function(n,r){var o=e.indexOf(n),a=e.indexOf(r);return o==-1?1e3:a==-1?-1e3:o-a}),i.rids):[]},FamilyTree.prototype._nodeHasHiddenParent=function(t){return!(t.parent||FamilyTree.isNEU(t.pid)||!this.getNode(t.pid))||!(!t.isPartner||FamilyTree.isNEU(t.mid)||!this.getNode(t.mid))||!(!t.isPartner||FamilyTree.isNEU(t.fid)||!this.getNode(t.fid))||!!(t.isPartner&&t.pids.length>1)},FamilyTree.prototype._center=FamilyTree.prototype.center,FamilyTree.prototype.center=function(t,e,i){var n=this.getRecentRootsByNodeId(t);Array.isArray(this.config.roots)||(roots=[]),FamilyTree._changeRootOption(this.config.roots,n,this.manager.rootList),this._center(t,e,i)},FamilyTree.localStorage={},FamilyTree.localStorage.getItem=function(t){var e=localStorage.getItem("to_date");if(e){if((e=new Date(e))<new Date){for(var i=0,n=localStorage.length;i<n;++i){var r=localStorage.key(i);r&&r.startsWith&&r.startsWith('{"n"')&&localStorage.removeItem(r)}localStorage.removeItem("to_date")}}else(e=new Date).setDate(e.getDate()+5),e=e.toISOString(),localStorage.setItem("to_date",e);return localStorage.getItem(t)},FamilyTree.localStorage.setItem=function(t,e){try{localStorage.setItem(t,e)}catch(i){i.code==i.QUOTA_EXCEEDED_ERR?(console.warn("Local storage quota exceeded"),localStorage.clear()):(console.error("Local storage error code:"+i.code),console.error(i))}},FamilyTree.prototype.canUpdateLink=function(t,e){if(e==null||e==null||t==null||t==null||t==e)return!1;var i=this.getNode(e),n=this.getNode(t);return!(i&&n&&(i.isPartner||i.hasPartners&&n.isAssistant||i.hasAssistants&&n.isPartner))&&!this.isChild(t,e)},FamilyTree.prototype._canUpdateLink=FamilyTree.prototype.canUpdateLink,FamilyTree.prototype.updateNode=function(t,e,i){var n=this,r=this.get(t.id);if(i===!0&&FamilyTree.events.publish("update",[this,r,t])===!1)return!1;this.update(t),FamilyTree.events.publish("updated",[this]),this.filterUI.update();var o=this.getNode(t.id),a=o.pid;a==null&&(a=o.stpid),this._draw(!1,FamilyTree.action.update,{id:a},function(){n.ripple(t.id),e&&e()})},FamilyTree.prototype.update=function(t){for(var e=0;e<this.config.nodes.length;e++)if(this.config.nodes[e].id==t.id){this._putInUndoStack(),this.clearRedo(),this.config.nodes[e]=t;break}return this},FamilyTree.prototype.removeNode=function(t,e,i){var n=this;if(!this.canRemove(t))return!1;var r=this._getNewPidsAndStpidsForIds(t);return i===!0&&FamilyTree.events.publish("remove",[this,t,r])===!1?!1:(this.remove(t),FamilyTree.events.publish("updated",[this]),this.filterUI.update(),this._draw(!1,FamilyTree.action.update,null,function(){n.config.sticky&&FamilyTree._moveToBoundaryArea(n.getSvg(),n.getViewBox(),n.response.boundary),e&&e()}),!0)},FamilyTree.prototype.remove=function(t){var e=this.get(t);if(e){this._putInUndoStack(),this.clearRedo();for(var i=this.config.nodes.length-1;i>=0;i--)this.config.nodes[i].pid!=t&&this.config.nodes[i].stpid!=t||(this.config.nodes[i].pid=e.pid,this.config.nodes[i].stpid=e.stpid),this.config.nodes[i].id==t&&this.config.nodes.splice(i,1)}return this},FamilyTree.prototype._getNewPidsAndStpidsForIds=function(t){var e=this.get(t),i={},n={};if(e)for(var r=this.config.nodes.length-1;r>=0;r--)this.config.nodes[r].pid==t?i[this.config.nodes[r].id]=e.pid:this.config.nodes[r].stpid==t&&(n[this.config.nodes[r].id]=e.stpid);return{newPidsForIds:i,newStpidsForIds:n}},FamilyTree.prototype.addNode=function(t,e,i){var n=this;if(i===!0&&FamilyTree.events.publish("add",[this,t])===!1)return!1;this.add(t),FamilyTree.events.publish("updated",[this]),this.filterUI.update(),n._draw(!1,FamilyTree.action.insert,{id:t.pid,insertedNodeId:t.id},function(){n.ripple(t.id),e&&e()})},FamilyTree.prototype.add=function(t){if(t.id==null&&console.error("Call addNode without id"),this._putInUndoStack(),this.clearRedo(),this.config.movable&&!FamilyTree.isNEU(t.pid)){var e=this._get(t.pid);e&&(e.movex!=null&&(t.movex=e.movex),e.movey!=null&&(t.movey=e.movey))}return this.config.nodes.push(t),this},FamilyTree.prototype.replaceIds=function(t,e){this._replaceIds(t),this._draw(!1,FamilyTree.action.update,void 0,e)},FamilyTree.prototype._replaceIds=function(t){for(var e=function(s){for(var c=0;c<s.length;c++){var d=s[c];for(var p in t){var h=t[p];d.from==p&&(d.from=h),d.to==p&&(d.to=h)}}},i=0;i<this.config.nodes.length;i++){var n=this.config.nodes[i];for(var r in t){var o=t[r];n.id==r&&(n.id=o),n.pid==r&&(n.pid=o),n.stpid==r&&(n.stpid=o),n.ppid==r&&(n.ppid=o)}}if(Array.isArray(this.config.roots))for(i=0;i<this.config.roots.length;i++)FamilyTree.isNEU(t[this.config.roots[i]])||(this.config.roots[i]=t[this.config.roots[i]]);if(this.nodes)for(var a in this.nodes)FamilyTree.isNEU(t[a])||(o=t[a],(l=this.nodes[a]).id=o,this.nodes[o]=l);if(this.manager.oldNodes)for(var a in this.manager.oldNodes)FamilyTree.isNEU(t[a])||(o=t[a],(l=this.manager.oldNodes[a]).id=o,this.manager.oldNodes[o]=l);if(this.roots){for(var a in this.roots)if(!FamilyTree.isNEU(t[a])){var l;o=t[a],(l=this.roots[a]).id=o,this.roots[o]=l}}e(this.config.clinks),e(this.config.slinks),e(this.config.groupDottedLines),e(this.config.dottedLines)},FamilyTree.prototype._get=function(t){var e=this.__get(t);if(e)return e;if((this.config.groupDottedLines.length||this.config.dottedLines.length)&&!FamilyTree.isNEU(t)&&typeof t=="string"&&(t.indexOf("balkan_group_dotted_")!=-1||t.indexOf("balkan_dotted_")!=-1)){var i=(t=(t=t.replace("balkan_group_dotted_","")).replace("balkan_dotted_","")).indexOf("_balkan_id_");if(t=t.substring(i+11),e=this.__get(t))return e}return null},FamilyTree.prototype.__get=function(t){for(var e=0;e<this.config.nodes.length;e++)if(this.config.nodes[e].id==t)return this.config.nodes[e];return null},FamilyTree.prototype.get=function(t){var e=this._get(t);return e==null?null:JSON.parse(JSON.stringify(e))},FamilyTree.prototype.canRemove=function(t){var e=this.getNode(t);return!!e&&!e.hasPartners&&!e.hasAssistants},FamilyTree.prototype.addChildNode=function(t,e,i){this.hideTreeMenu(!1);var n=this;if(!t||FamilyTree.isNEU(t.mid)&&FamilyTree.isNEU(t.fid))console.error("addSonNode invalid data");else{FamilyTree.isNEU(t.id)&&(t.id=this.generateId());var r={addNodesData:[t],updateNodesData:[],removeNodeId:null};if(i===!0&&FamilyTree.events.publish("update",[this,r])===!1)return!1;n._fireUpdate_addUpdateRemove(r,i);var o="";FamilyTree.isNEU(r.addNodesData[0].pid)?FamilyTree.isNEU(r.addNodesData[0].mid)?FamilyTree.isNEU(r.addNodesData[0].fid)||(o=r.addNodesData[0].fid):o=r.addNodesData[0].mid:o=r.addNodesData[0].pid,n._draw(!1,FamilyTree.action.insert,{id:o,insertedNodeId:r.addNodesData[0].id},function(){n.ripple(r.addNodesData[0].id),e&&e(),i===!0&&FamilyTree.events.publish("updated",[n,r]),n.filterUI.update()})}},FamilyTree.prototype.addChildAndPartnerNodes=function(t,e,i,n,r){this.hideTreeMenu(!1);var o=this;if(!e||FamilyTree.isNEU(e.mid)&&FamilyTree.isNEU(e.fid))console.error("addChildAndPartnerNodes invalid childData");else if(i){FamilyTree.isNEU(e.id)&&(e.id=this.generateId()),FamilyTree.isNEU(i.id)&&(i.id=this.generateId()),e.mid=="_ft_partner"?e.mid=i.id:e.fid=="_ft_partner"&&(e.fid=i.id);var a=[],l=null;Array.isArray(i.pids)&&(i.pids.length!=1&&console.error("addChildAndPartnerNodes partnerData.pids has to have one partner"),l=this.get(i.pids[0]),Array.isArray(l.pids)||(l.pids=[]),l.pids.push(i.id),a.push(l));var s={addNodesData:[e,i],updateNodesData:a,removeNodeId:null};if(r===!0&&FamilyTree.events.publish("update",[this,s])===!1)return!1;o._fireUpdate_addUpdateRemove(s,r);var c=o.getRecentRootsByNodeId(t);FamilyTree._changeRootOption(o.config.roots,c,o.manager.rootList);var d="";l?d=l.id:FamilyTree.isNEU(e.pid)?FamilyTree.isNEU(e.mid)?FamilyTree.isNEU(e.fid)||(d=e.fid):d=e.mid:d=e.pid,o._draw(!1,FamilyTree.action.update,{id:d},function(){o.ripple(e.id),o.ripple(i.id),n&&n(),r===!0&&FamilyTree.events.publish("updated",[o,s]),o.filterUI.update()}),r===!0&&FamilyTree.events.publish("updating",[o,s])}else console.error("addChildAndPartnerNodes invalid data")},FamilyTree.prototype.addPartnerAndParentNodes=function(t,e,i,n,r){this.hideTreeMenu(!1);var o=this;if(!FamilyTree.isNEU(e)&&e.length)if(i){FamilyTree.isNEU(i.id)&&(i.id=this.generateId());for(var a=[],l=0;l<e.length;l++){var s=this.get(e[l]);if(!FamilyTree.isNEU(s.mid)&&!FamilyTree.isNEU(s.fid))return void console.error("father id (fid) or mather id (mid) has to be null or undefined");FamilyTree.isNEU(s.mid)?s.mid=i.id:FamilyTree.isNEU(s.mid)||(s.fid=i.id),a.push(s)}var c=null;Array.isArray(i.pids)&&(i.pids.length!=1&&console.error("addChildAndPartnerNodes partnerData.pids has to have one partner"),c=this.get(i.pids[0]),Array.isArray(c.pids)||(c.pids=[]),c.pids.push(i.id),a.push(c));var d={addNodesData:[i],updateNodesData:a,removeNodeId:null};if(r===!0&&FamilyTree.events.publish("update",[this,d])===!1)return!1;o._fireUpdate_addUpdateRemove(d,r);var p=o.getRecentRootsByNodeId(t);FamilyTree._changeRootOption(o.config.roots,p,o.manager.rootList);var h="";c&&(h=c.id),o._draw(!1,FamilyTree.action.update,{id:h},function(){o.ripple(i.id),n&&n(),r===!0&&FamilyTree.events.publish("updated",[o,d]),o.filterUI.update()}),r===!0&&FamilyTree.events.publish("updating",[o,d])}else console.error("addPartnerAndParentNodes invalid data");else console.error("addPartnerAndParentNodes invalid data")},FamilyTree.prototype.addPartnerNode=function(t,e,i){this.hideTreeMenu(!1);var n=this;if(t&&Array.isArray(t.pids)&&t.pids.length==1){FamilyTree.isNEU(t.id)&&(t.id=this.generateId());var r=this.get(t.pids[0]);Array.isArray(r.pids)||(r.pids=[]),r.pids.push(t.id);var o={removeNodeId:null,updateNodesData:[r],addNodesData:[t]};if(i===!0&&FamilyTree.events.publish("update",[this,o])===!1)return!1;n._fireUpdate_addUpdateRemove(o,i);var a=n.getRecentRootsByNodeId(o.updateNodesData[0].id);FamilyTree._changeRootOption(n.config.roots,a,n.manager.rootList);var l=o.updateNodesData[0].id;n._draw(!1,FamilyTree.action.insert,{id:l,insertedNodeId:o.addNodesData[0].id},function(){n.ripple(o.addNodesData[0].id),e&&e(),i===!0&&FamilyTree.events.publish("updated",[n,o]),n.filterUI.update()}),i===!0&&FamilyTree.events.publish("updating",[n,o])}else console.error("addPartnerNode invalid data")},FamilyTree.prototype.addParentNode=function(t,e,i,n,r){this.hideTreeMenu(!1);var o=this;if(i)if(["mid","fid"].has(e))if(FamilyTree.isNEU(t))console.error("addParentNode invalid childId");else{FamilyTree.isNEU(i.id)&&(i.id=this.generateId());var a=[],l=this.get(t);l[e]=i.id,a.push(l);var s=null;Array.isArray(i.pids)&&(i.pids.length!=1&&console.error("addParentNode: data has to have one partner"),s=this.get(i.pids[0]),Array.isArray(s.pids)||(s.pids=[]),s.pids.push(i.id),a.push(s));var c={removeNodeId:null,updateNodesData:a,addNodesData:[i]};if(r===!0&&FamilyTree.events.publish("update",[this,c])===!1)return!1;o._fireUpdate_addUpdateRemove(c,r);var d=t;o.config.roots=[c.addNodesData[0].id],o._draw(!1,FamilyTree.action.insert,{id:d,insertedNodeId:c.addNodesData[0].id},function(){o.ripple(c.addNodesData[0].id),n&&n(),r===!0&&FamilyTree.events.publish("updated",[o,c]),o.filterUI.update()}),r===!0&&FamilyTree.events.publish("updating",[o,c])}else console.error("addParentNode invalid type");else console.error("addParentNode invalid data")},FamilyTree.prototype.canRemove=function(t){var e=this.getNode(t);if(!e)return!1;var i=this.getNode(e.mid),n=this.getNode(e.fid),r=e.ftChildrenIds.length>0,o=!1,a=e.pids.length>0,l=e.pids.length>1;if(e.pids.length==1){var s=this.getNode(e.pids[0]);o=e.ftChildrenIds.compare(s.ftChildrenIds)}return!(!i&&!n||r||a)||!(i||n||r||l||!a||o)||!(i||n||!r||!o)||!(i||n||!r||o)||!(i||n||r||!o)},FamilyTree.prototype.removeNode=function(t,e,i){var n=this;if(this.canRemove(t)){var r=this.getNode(t),o=[];if(Array.isArray(r.pids))for(var a=0;a<r.pids.length;a++){var l=this.get(r.pids[a]);l&&(c=l.pids.indexOf(r.id))!=-1&&(l.pids.splice(c,1),o.push(l))}if(Array.isArray(r.ftChildrenIds))for(a=0;a<r.ftChildrenIds.length;a++){var s=this.get(r.ftChildrenIds[a]);s&&(s.mid==r.id?(s.mid=void 0,o.push(s)):s.fid==r.id&&(s.fid=void 0,o.push(s)))}var c,d={removeNodeId:t,updateNodesData:o,addNodesData:[]};if(i===!0&&FamilyTree.events.publish("update",[this,d])===!1)return!1;n._fireUpdate_addUpdateRemove(d,i),(c=n.config.roots.indexOf(t))!=-1&&n.config.roots.splice(c,1),n._draw(!1,FamilyTree.action.update,null,function(){n.config.sticky&&FamilyTree._moveToBoundaryArea(n.getSvg(),n.getViewBox(),n.response.boundary),e&&e(),i===!0&&FamilyTree.events.publish("updated",[n,d]),n.filterUI.update()}),i===!0&&FamilyTree.events.publish("updating",[n,d])}},FamilyTree.prototype.updateNode=function(t,e,i){var n=this,r=this.getNode(t.id);t.pids||(t.pids=[]);var o=[];o.push(t);for(var a=0;a<r.pids.length;a++)if(!t.pids.has(r.pids[a])&&(s=this._get(r.pids[a]))&&s.pids){var l=s.pids.indexOf(t.id);l!=-1&&(s.pids.splice(l,1),o.push(t)),r.pids.splice(a,1),o.push(s)}for(a=0;a<t.pids.length;a++){var s;(!r.pids||!r.pids.has(t.pids[a]))&&((s=this._get(t.pids[a])).pids||(s.pids=[]),s.pids.push(t.pids[a]),o.push(s))}var c={removeNodeId:null,updateNodesData:o,addNodesData:[]};if(i===!0&&FamilyTree.events.publish("update",[this,c])===!1)return!1;n._fireUpdate_addUpdateRemove(c,i),n._draw(!1,FamilyTree.action.update,null,function(){n.config.sticky&&FamilyTree._moveToBoundaryArea(n.getSvg(),n.getViewBox(),n.response.boundary),e&&e(),i===!0&&FamilyTree.events.publish("updated",[n,c]),n.filterUI.update()})},FamilyTree.prototype._fireUpdate_addUpdateRemove=function(t,e){for(var i=0;i<t.addNodesData.length;i++)this.add(t.addNodesData[i]);for(i=0;i<t.updateNodesData.length;i++)this.update(t.updateNodesData[i]);FamilyTree.isNEU(t.removeNodeId)||this.remove(t.removeNodeId),e===!0&&FamilyTree.events.publish("updating",[this,t])},FamilyTree.prototype.__replaceIds=FamilyTree.prototype._replaceIds,FamilyTree.prototype._replaceIds=function(t){this.__replaceIds(t);for(var e=0;e<this.config.nodes.length;e++){var i=this.config.nodes[e];for(var n in t){var r=t[n];if(i.fid==n&&(i.fid=r),i.mid==n&&(i.mid=r),Array.isArray(i.pids))for(var o=0;o<i.pids.length;o++)i.pids[o]==n&&(i.pids[o]=r)}}},FamilyTree===void 0&&(FamilyTree={}),FamilyTree._ajax=function(t,e,i,n,r){n==null&&(n="arraybuffer");var o=new XMLHttpRequest;o.onload=function(a){o.readyState==4&&this.status===200&&(a.target==null?r(this.response):r(a.target.response))},o.onerror=function(a){r({error:a})},o.open(e,t),o.responseType=n,o.setRequestHeader("Content-Type","application/json"),i==null?o.send():o.send(i)},FamilyTree===void 0&&(FamilyTree={}),FamilyTree.animate=function(t,e,i,n,r,o,a){var l,s=10,c=1,d=n/s+1;return document.getElementsByTagName("g"),Array.isArray(t)||(t=[t]),Array.isArray(e)||(e=[e]),Array.isArray(i)||(i=[i]),l=setInterval(function(){for(var p=0;p<t.length;p++)for(var h in i[p]){var f=FamilyTree._arrayContains(["top","left","right","bottom","width","height"],h.toLowerCase())?"px":"";switch(h.toLowerCase()){case"d":var m=r((c*s-s)/n)*(i[p][h][0]-e[p][h][0])+e[p][h][0],y=r((c*s-s)/n)*(i[p][h][1]-e[p][h][1])+e[p][h][1];t[p].setAttribute("d",t[p].getAttribute("d")+" L"+m+" "+y);break;case"r":var x=r((c*s-s)/n)*(i[p][h]-e[p][h])+e[p][h];t[p].setAttribute("r",x);break;case"x1":x=r((c*s-s)/n)*(i[p][h]-e[p][h])+e[p][h],t[p].setAttribute("x1",x);break;case"x2":x=r((c*s-s)/n)*(i[p][h]-e[p][h])+e[p][h],t[p].setAttribute("x2",x);break;case"y1":x=r((c*s-s)/n)*(i[p][h]-e[p][h])+e[p][h],t[p].setAttribute("y1",x);break;case"y2":x=r((c*s-s)/n)*(i[p][h]-e[p][h])+e[p][h],t[p].setAttribute("y2",x);break;case"rotate3d":if(i[p][h]){var u=e[p][h],b=i[p][h],v=[0,0,0,0];for(var g in u)v[g]=r((c*s-s)/n)*(b[g]-u[g])+u[g];t[p].style.transform="rotate3d("+v.toString()+"deg)"}break;case"transform":if(i[p][h]){u=e[p][h],b=i[p][h],v=[0,0,0,0,0,0];for(var g in u)v[g]=r((c*s-s)/n)*(b[g]-u[g])+u[g];t[p].hasAttribute("transform")?t[p].setAttribute("transform","matrix("+v.toString()+")"):t[p].style.transform="matrix("+v.toString()+")"}break;case"viewbox":if(i[p][h]){u=e[p][h],b=i[p][h],v=[0,0,0,0];for(var g in u)v[g]=r((c*s-s)/n)*(b[g]-u[g])+u[g];t[p].setAttribute("viewBox",v.toString())}break;case"margin":if(i[p][h]){u=e[p][h],b=i[p][h],v=[0,0,0,0];for(var g in u)v[g]=r((c*s-s)/n)*(b[g]-u[g])+u[g];var _="";for(g=0;g<v.length;g++)_+=parseInt(v[g])+"px ";t[p]&&t[p].style&&(t[p].style[h]=_)}break;case"scrolly":x=r((c*s-s)/n)*(i[p][h]-e[p][h])+e[p][h],t[p].scrollTo(0,x);break;default:x=r((c*s-s)/n)*(i[p][h]-e[p][h])+e[p][h],t[p]&&t[p].style&&(t[p].style[h]=x+f)}}a&&a(),(c+=1)>d+1&&(clearInterval(l),o&&o(t))},s)},FamilyTree.anim={},FamilyTree.anim.inPow=function(t){return t<0?0:t>1?1:Math.pow(t,2)},FamilyTree.anim.outPow=function(t){return t<0?0:t>1?1:-1*(Math.pow(t-1,2)+-1)},FamilyTree.anim.inOutPow=function(t){return t<0?0:t>1?1:(t*=2)<1?FamilyTree.anim.inPow(t,2)/2:-.5*(Math.pow(t-2,2)+-2)},FamilyTree.anim.inSin=function(t){return t<0?0:t>1?1:1-Math.cos(t*(Math.PI/2))},FamilyTree.anim.outSin=function(t){return t<0?0:t>1?1:Math.sin(t*(Math.PI/2))},FamilyTree.anim.inOutSin=function(t){return t<0?0:t>1?1:-.5*(Math.cos(Math.PI*t)-1)},FamilyTree.anim.inExp=function(t){return t<0?0:t>1?1:Math.pow(2,10*(t-1))},FamilyTree.anim.outExp=function(t){return t<0?0:t>1?1:1-Math.pow(2,-10*t)},FamilyTree.anim.inOutExp=function(t){return t<0?0:t>1?1:t<.5?.5*Math.pow(2,10*(2*t-1)):.5*(2-Math.pow(2,10*(-2*t+1)))},FamilyTree.anim.inCirc=function(t){return t<0?0:t>1?1:-(Math.sqrt(1-t*t)-1)},FamilyTree.anim.outCirc=function(t){return t<0?0:t>1?1:Math.sqrt(1-(t-1)*(t-1))},FamilyTree.anim.inOutCirc=function(t){return t<0?0:t>1?1:t<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(2*t-2)*(2*t-2))+1)},FamilyTree.anim.rebound=function(t){return t<0?0:t>1?1:t<1/2.75?1-7.5625*t*t:t<2/2.75?1-(7.5625*(t-1.5/2.75)*(t-1.5/2.75)+.75):t<2.5/2.75?1-(7.5625*(t-2.25/2.75)*(t-2.25/2.75)+.9375):1-(7.5625*(t-2.625/2.75)*(t-2.625/2.75)+.984375)},FamilyTree.anim.inBack=function(t){return t<0?0:t>1?1:t*t*(2.70158*t-1.70158)},FamilyTree.anim.outBack=function(t){return t<0?0:t>1?1:(t-1)*(t-1)*(2.70158*(t-1)+1.70158)+1},FamilyTree.anim.inOutBack=function(t){return t<0?0:t>1?1:t<.5?4*t*t*(7.1898*t-2.5949)*.5:.5*((2*t-2)*(2*t-2)*(3.5949*(2*t-2)+2.5949)+2)},FamilyTree.anim.impulse=function(t){var e=2*t;return e*Math.exp(1-e)},FamilyTree.anim.expPulse=function(t){return Math.exp(-2*Math.pow(t,2))},FamilyTree===void 0&&(FamilyTree={}),FamilyTree.prototype._attachInitEventHandlers=function(t){this._addEvent(window,"resize",this._resizeHandler)},FamilyTree.prototype._attachEventHandlers=function(t){if(this.config.interactive){t=this.getSvg(),this.config.enableTouch||FamilyTree.isMobile()?(this._addEvent(t,"touchstart",this._globalMouseDownHandler),this._addEvent(t,"touchend",this._globalClickHandler)):(this._addEvent(t,"mousedown",this._globalMouseDownHandler),this._addEvent(t,"click",this._globalClickHandler),this._addEvent(t,"contextmenu",this._globalContextHandler),this._addEvent(t,"dblclick",this._globalDbClickHandler),this.config.mouseScrool!=FamilyTree.action.none&&this._addEvent(t,"wheel",this._mouseScrollHandler));var e=this.getMenuButton();e&&this._addEvent(e,"click",this._menuClickHandler)}},FamilyTree.prototype._addEvent=function(t,e,i,n){var r,o;n||(n=""),t.getListenerList||(t.getListenerList={}),t.getListenerList[e+n]||(r=this,o=i,i=function(){if(o)return o.apply(r,[this,arguments[0]])},t.addEventListener?e=="mousewheel"?t.addEventListener(e,a,{passive:!1}):t.addEventListener(e,a,!1):t.attachEvent("on"+e,function(){var l=i.call(t,window.event);return l===!1&&(window.event.returnValue=!1,window.event.cancelBubble=!0),l}),t.getListenerList[e+n]=a);function a(l){var s=i.apply(this,arguments);return s===!1&&(l.stopPropagation(),l.preventDefault()),s}},FamilyTree.prototype._removeEvent=function(t,e){if(t.getListenerList[e]){var i=t.getListenerList[e];t.removeEventListener(e,i,!1),delete t.getListenerList[e]}},FamilyTree===void 0&&(FamilyTree={}),FamilyTree.VERSION="8.14.55",FamilyTree.orientation={},FamilyTree.orientation.top=0,FamilyTree.orientation.bottom=1,FamilyTree.orientation.right=2,FamilyTree.orientation.left=3,FamilyTree.orientation.top_left=4,FamilyTree.orientation.bottom_left=5,FamilyTree.orientation.right_top=6,FamilyTree.orientation.left_top=7,FamilyTree.align={},FamilyTree.align.center=FamilyTree.CENTER=8,FamilyTree.align.orientation=FamilyTree.ORIENTATION=9,FamilyTree.attr={},FamilyTree.attr.l="data-l",FamilyTree.attr.id="data-id",FamilyTree.attr.sl="data-sl",FamilyTree.attr.lbl="data-lbl",FamilyTree.attr.val="data-val",FamilyTree.attr.tlbr="data-tlbr",FamilyTree.attr.item="data-item",FamilyTree.attr.layout="data-layout",FamilyTree.attr.node_id="data-n-id",FamilyTree.attr.link_id="data-l-id",FamilyTree.attr.field_name="data-f-name",FamilyTree.attr.c_link_to="data-c-l-to",FamilyTree.attr.c_link_from="data-c-l-from",FamilyTree.attr.s_link_to="data-s-l-to",FamilyTree.attr.s_link_from="data-s-l-from",FamilyTree.attr.control_add="data-ctrl-add",FamilyTree.attr.control_expcoll_id="data-ctrl-ec-id",FamilyTree.attr.control_up_id="data-ctrl-up-id",FamilyTree.attr.control_export_menu="data-ctrl-menu",FamilyTree.attr.control_node_menu_id="data-ctrl-n-menu-id",FamilyTree.attr.control_node_circle_menu_id="data-ctrl-n-c-menu-id",FamilyTree.attr.control_node_circle_menu_name="data-ctrl-n-c-menu-name",FamilyTree.attr.control_node_circle_menu_wrraper_id="data-ctrl-n-c-menu-wrapper-id",FamilyTree.attr.width="data-width",FamilyTree.attr.text_overflow="data-text-overflow",FamilyTree.ID="id",FamilyTree.PID="pid",FamilyTree.STPID="stpid",FamilyTree.TAGS="tags",FamilyTree.NODES="nodes",FamilyTree.ELASTIC="elastic",FamilyTree.ASSISTANT="Assistant",FamilyTree.action={},FamilyTree.action.expand=0,FamilyTree.action.collapse=1,FamilyTree.action.maximize=101,FamilyTree.action.minimize=102,FamilyTree.action.expandCollapse=501,FamilyTree.action.edit=1,FamilyTree.action.zoom=2,FamilyTree.action.ctrlZoom=22,FamilyTree.action.scroll=41,FamilyTree.action.xScroll=3,FamilyTree.action.yScroll=4,FamilyTree.action.none=5,FamilyTree.action.init=6,FamilyTree.action.update=7,FamilyTree.action.move=70,FamilyTree.action.pan=8,FamilyTree.action.centerNode=9,FamilyTree.action.resize=10,FamilyTree.action.insert=11,FamilyTree.action.insertfirst=12,FamilyTree.action.details=13,FamilyTree.action.exporting=14,FamilyTree.none=400001,FamilyTree.scroll={},FamilyTree.scroll.visible=!0,FamilyTree.scroll.smooth=12,FamilyTree.scroll.speed=120,FamilyTree.scroll.safari={smooth:12,speed:250},FamilyTree.match={},FamilyTree.match.height=100001,FamilyTree.match.width=100002,FamilyTree.match.boundary=100003,FamilyTree.movable={},FamilyTree.movable.node="node",FamilyTree.movable.tree="tree",FamilyTree.movable.detachTree="detachTree",FamilyTree.layout={},FamilyTree.layout.normal=FamilyTree.normal=0,FamilyTree.layout.mixed=FamilyTree.mixed=1,FamilyTree.layout.tree=FamilyTree.tree=2,FamilyTree.layout.treeLeftOffset=FamilyTree.treeLeftOffset=3,FamilyTree.layout.treeRightOffset=FamilyTree.treeRightOffset=4,FamilyTree.layout.treeLeft=5,FamilyTree.layout.treeRight=6,FamilyTree.layout.grid=-1,FamilyTree.nodeOpenTag="<g "+FamilyTree.attr.node_id+'="{id}" style="opacity: {opacity}" transform="matrix(1,0,0,1,{x},{y})" class="{class}" '+FamilyTree.attr.sl+'="{sl}" '+FamilyTree.attr.l+"={level} {lcn}>",FamilyTree.linkOpenTag="<g "+FamilyTree.attr.link_id+'="[{id}][{child-id}]" class="{class}">',FamilyTree.expcollOpenTag="<g "+FamilyTree.attr.control_expcoll_id+'="{id}" transform="matrix(1,0,0,1,{x},{y})"  style="cursor:pointer;">',FamilyTree.upOpenTag="<g "+FamilyTree.attr.control_up_id+'="{id}" transform="matrix(1,0,0,1,{x},{y})" style="cursor:pointer;">',FamilyTree.linkFieldsOpenTag='<g transform="matrix(1,0,0,1,{x},{y}) rotate({rotate})">',FamilyTree.grCloseTag="</g>",FamilyTree.A5w=420,FamilyTree.A5h=595,FamilyTree.A4w=595,FamilyTree.A4h=842,FamilyTree.A3w=842,FamilyTree.A3h=1191,FamilyTree.A2w=1191,FamilyTree.A2h=1684,FamilyTree.A1w=1684,FamilyTree.A1h=2384,FamilyTree.Letterw=612,FamilyTree.Letterh=791,FamilyTree.Legalw=612,FamilyTree.Legalh=1009,FamilyTree.COLLAPSE_PARENT_NEIGHBORS=1,FamilyTree.COLLAPSE_SUB_CHILDRENS=2,FamilyTree.COLLAPSE_PARENT_SUB_CHILDREN_EXCEPT_CLICKED=3,FamilyTree.TEXT_THRESHOLD=400,FamilyTree.IMAGES_THRESHOLD=100,FamilyTree.LINKS_THRESHOLD=200,FamilyTree.BUTTONS_THRESHOLD=70,FamilyTree.ANIM_THRESHOLD=50,FamilyTree.IT_IS_LONELY_HERE='<g transform="translate(-100, 0)" style="cursor:pointer;"  '+FamilyTree.attr.control_add+'="control-add"><text fill="#039be5">{link}</text></g>',FamilyTree.RES={},FamilyTree.IT_IS_LONELY_HERE_LINK=FamilyTree.RES.IT_IS_LONELY_HERE_LINK="It's lonely here, add your first node",FamilyTree.FIRE_DRAG_NOT_CLICK_IF_MOVE=3,FamilyTree.STRING_TAGS=!1,FamilyTree.MAX_NODES_MESS="The trial has expired or 200 nodes limit was reached! <br /><a style='color: #039BE5;' target='_blank' href='https://balkan.app/FamilyTreeJS/Docs/Evaluation'>See more</a>",FamilyTree.OFFLINE_MESS="The evaluation version requires internet connection! <br /><a style='color: #039BE5;' target='_blank' href='https://balkan.app/FamilyTreeJS/Docs/Evaluation'>See more</a>",FamilyTree.SEARCH_PLACEHOLDER="Search... type ? to get help.",FamilyTree.SEARCH_HELP_SYMBOL="?",FamilyTree.SEARCH_CLOSE_RESULT_ON_ESCAPE_OR_CLICKOUTSIDE=!1,FamilyTree.SEARCH_RESULT_LIMIT=10,FamilyTree.IMPORT_MESSAGE="Choose the columns (fields) in your data file that contain the required information.",FamilyTree.FIXED_POSITION_ON_CLICK=!1,FamilyTree.RENDER_LINKS_BEFORE_NODES=!1,FamilyTree.RENDER_CLINKS_BEFORE_NODES=!1,FamilyTree.MIXED_LAYOUT_ALL_NODES=!0,FamilyTree.MIXED_LAYOUT_FOR_NODES_WITH_COLLAPSED_CHILDREN=!1,FamilyTree.MIXED_LAYOUT_IF_NUMBER_OF_CHILDREN_IS_MORE_THEN=1,FamilyTree.LINK_ROUNDED_CORNERS=5,FamilyTree.MOVE_STEP=5,FamilyTree.CLINK_CURVE=1,FamilyTree.MAX_DEPTH=200,FamilyTree.SCALE_FACTOR=1.44,FamilyTree.LAZY_LOADING_FACTOR=500,FamilyTree.HIDE_EDIT_FORM_ON_PAN=!0,FamilyTree.LAZY_LOADING=!0,FamilyTree.ARRAY_FIELDS=["tags"],FamilyTree.CSV_DELIMITER=",",FamilyTree.EDITFORM_CLOSE_BTN='<svg data-edit-from-close class="bft-edit-form-close"><path style="fill:#ffffff;" d="M21.205,5.007c-0.429-0.444-1.143-0.444-1.587,0c-0.429,0.429-0.429,1.143,0,1.571l8.047,8.047H1.111 C0.492,14.626,0,15.118,0,15.737c0,0.619,0.492,1.127,1.111,1.127h26.554l-8.047,8.032c-0.429,0.444-0.429,1.159,0,1.587 c0.444,0.444,1.159,0.444,1.587,0l9.952-9.952c0.444-0.429,0.444-1.143,0-1.571L21.205,5.007z"></path></svg>',FamilyTree.ESCAPE_HTML=!1,FamilyTree.VERTICAL_CHILDREN_ASSISTANT=!1,FamilyTree.EXPORT_PAGES_CUT_NODES=!1,FamilyTree.RESET_MOVABLE_ONEXPANDCOLLAPSE=!1,FamilyTree.FILTER_ALPHABETICALLY=!0,FamilyTree.SERVER_PREFIX=".azurewebsites.net/api/OrgChartJS",FamilyTree.FUNC_URL_NAME="func-url-orgfamilyjs",FamilyTree.MINIMUM_SYMBOLS_IN_SEARCH_INPUT=1,typeof module<"u"&&(module.exports=FamilyTree),FamilyTree.SERVER_PREFIX=".azurewebsites.net/api/FamilyTreeJS",FamilyTree.FUNC_URL_NAME="func-url-familytreejs",FamilyTree.OC_VERSION=FamilyTree.VERSION,FamilyTree.VERSION="1.09.45",FamilyTree.RENDER_LINKS_BEFORE_NODES=!0,FamilyTree.ARRAY_FIELDS=["tags","pids"],FamilyTree._intersects=function(t,e,i){var n=t.x-i.siblingSeparation/4,r=t.y,o=t.x+t.w+i.siblingSeparation/4,a=t.y;switch(i.orientation){case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:n=t.x,r=t.y-i.siblingSeparation/4,o=t.x,a=t.y+t.h+i.siblingSeparation/4}var l,s,c,d=e.p,p=e.q,h=e.r,f=e.s;return(l=(o-n)*(f-p)-(h-d)*(a-r))!==0&&(s=((r-a)*(h-n)+(o-n)*(f-r))/l,0<(c=((f-p)*(h-n)+(d-h)*(f-r))/l)&&c<1&&0<s&&s<1)},FamilyTree._addPoint=function(t,e,i,n,r){switch(i.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:return FamilyTree._addPointTop(t,e,i,n,r);case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:return FamilyTree._addPointBottom(t,e,i,n,r);case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:return FamilyTree._addPointLeft(t,e,i,n,r);case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:return FamilyTree._addPointRight(t,e,i,n,r)}},FamilyTree._addPointTop=function(t,e,i,n,r){var o,a,l;return r=="left"?o=t.leftNeighbor?t.x+(t.leftNeighbor.x+t.leftNeighbor.w-t.x)/2:t.x-i.siblingSeparation/2:r=="right"&&(o=t.rightNeighbor?t.x+t.w+(t.rightNeighbor.x-(t.x+t.w))/2:t.x+t.w+i.siblingSeparation/2),e.push([o,e[e.length-1][1]]),e.push([o,t.y-i.levelSeparation/3]),a=e[e.length-1][1],l=o,n.p=o,n.q=a,n.r=l,n},FamilyTree._addPointBottom=function(t,e,i,n,r){var o,a,l;return r=="left"?o=t.leftNeighbor?t.x+(t.leftNeighbor.x+t.leftNeighbor.w-t.x)/2:t.x-i.siblingSeparation/2:r=="right"&&(o=t.rightNeighbor?t.x+t.w+(t.rightNeighbor.x-(t.x+t.w))/2:t.x+t.w+i.siblingSeparation/2),e.push([o,e[e.length-1][1]]),e.push([o,t.y+t.h+i.levelSeparation/3]),a=e[e.length-1][1],l=o,n.p=o,n.q=a,n.r=l,n},FamilyTree._addPointLeft=function(t,e,i,n,r){var o,a=e[e.length-1][0];r=="bottom"?o=t.rightNeighbor?t.y+t.h+(t.rightNeighbor.y-(t.y+t.h))/2:t.y+t.h+i.siblingSeparation/2:r=="top"&&(o=t.leftNeighbor?t.y+(t.leftNeighbor.y+t.leftNeighbor.h-t.y)/2:t.y-i.siblingSeparation/2),e.push([e[e.length-1][0],o]),e.push([t.x-i.levelSeparation/3,o]),a=e[e.length-1][0];var l=o;return n.p=a,n.q=o,n.s=l,n},FamilyTree._addPointRight=function(t,e,i,n,r){var o,a=e[e.length-1][0];r=="bottom"?o=t.rightNeighbor?t.y+t.h+(t.rightNeighbor.y-(t.y+t.h))/2:t.y+t.h+i.siblingSeparation/2:r=="top"&&(o=t.leftNeighbor?t.y+(t.leftNeighbor.y+t.leftNeighbor.h-t.y)/2:t.y-i.siblingSeparation/2),e.push([e[e.length-1][0],o]),e.push([t.x+t.w+i.levelSeparation/3,o]),a=e[e.length-1][0];var l=o;return n.p=a,n.q=o,n.s=l,n},FamilyTree.editUI=function(){},FamilyTree.editUI.prototype.init=function(t){this.obj=t,this.fields=null,this._event_id=FamilyTree._guid()},FamilyTree.editUI.prototype.on=function(t,e){return FamilyTree.events.on(t,e,this._event_id),this},FamilyTree.editUI.prototype.show=function(t,e,i){if(this.hide(),FamilyTree.events.publish("show",[this,t])===!1)return!1;var n=this,r=this.content(t,e,i);this.obj.element.appendChild(r.element),FamilyTree.input.init(this.obj.element),i?e||this._focusElement(r.focusId):this.interval=FamilyTree.animate(r.element,{right:-20,opacity:0},{right:0,opacity:1},300,FamilyTree.anim.outSin,function(){e||n._focusElement(r.focusId)}),this.obj.element.querySelector("[data-edit-from-close]").addEventListener("click",function(l){l.preventDefault(),FamilyTree.events.publish("cancel",[n,{id:t}])!==!1&&n.hide()}),this.obj.element.querySelector("[data-edit-from-cancel]").addEventListener("click",function(l){l.preventDefault(),FamilyTree.events.publish("cancel",[n,{id:t}])!==!1&&n.hide()}),this.obj.element.querySelector("[data-edit-from-save]").addEventListener("click",function(l){l.preventDefault();var s=FamilyTree.input.validateAndGetData(r.element);if(s!==!1){var c=n.obj.get(t),d={data:FamilyTree.mergeDeep(c,s)};if(FamilyTree.events.publish("save",[n,d])===!1)return;n.obj.updateNode(d.data,null,!0),n.hide()}});for(var o=this.obj.element.querySelectorAll("[data-input-btn]"),a=0;a<o.length;a++)o[a].addEventListener("click",function(l){l.preventDefault(),FamilyTree.events.publish("element-btn-click",[n,{input:this.parentNode.querySelector("input"),nodeId:t,event:l}])});this.obj.element.querySelector("[data-add-more-fields-btn]").addEventListener("click",function(l){l.stopPropagation(),l.preventDefault();var s=this,c=FamilyTree.elements.textbox({},{type:"textbox",label:n.obj.config.editForm.addMoreFieldName,btn:n.obj.config.editForm.addMoreBtn},"280px");s.parentNode.insertAdjacentHTML("beforebegin",c.html),s.style.display="none",FamilyTree.input.init(s.parentNode.previousSibling);var d=document.getElementById(c.id);d.focus(),d.nextElementSibling.addEventListener("click",function(p){p.stopPropagation(),p.preventDefault();var h=d.value,f=n.obj.element.querySelector('[data-binding="'+FamilyTree._escapeDoubleQuotes(d.value)+'"]');if(FamilyTree.isNEU(h)||f)d.focus();else{var m=FamilyTree.elements.textbox({},{type:"textbox",label:h,binding:h},"280px");d.parentNode.parentNode.parentNode.removeChild(d.parentNode.parentNode),s.parentNode.insertAdjacentHTML("beforebegin",m.html),s.style.display="",FamilyTree.input.init(s.parentNode.previousSibling),document.getElementById(m.id).focus()}})}),this.obj.element.querySelector("[data-bft-edit-from-btns]").addEventListener("click",function(l){for(var s=l.target;s&&s.hasAttribute&&!s.hasAttribute("data-edit-from-btn");)s=s.parentNode;if(s&&s.hasAttribute){var c=s.getAttribute("data-edit-from-btn"),d={button:n.obj.config.editForm.buttons[c],name:c,nodeId:t,event:l};if(FamilyTree.events.publish("button-click",[n,d])===!1)return!1;switch(c){case"edit":n.obj.editUI.show(t,!1,!0);break;case"pdf":n.obj.exportPDFProfile({id:t,filename:r.title}),n.hide();break;case"png":n.obj.exportPNGProfile({id:t,filename:r.title}),n.hide();break;case"share":n.obj.shareProfile(t);break;case"remove":n.obj.removeNode(t,null,!0),n.hide()}}})},FamilyTree.editUI.prototype._focusElement=function(t){var e=null;FamilyTree.isNEU(this.obj.config.editForm.focusBinding)?FamilyTree.isNEU(t)||(e=document.getElementById(t)):e=this.obj.element.querySelector('[data-binding="'+this.obj.config.editForm.focusBinding+'"]'),e&&(e.value&&e.value.length&&e.setSelectionRange(e.value.length,e.value.length),e.focus())},FamilyTree.editUI.prototype.setAvatar=function(t){var e=this.obj.element.querySelector("#bft-avatar");FamilyTree.isNEU(t)?e.innerHTML=FamilyTree.icon.user(150,150,"#8C8C8C",0,0):e.innerHTML=`<img style="width: 100%;height:100%;object-fit:cover;border-radius: 50%;" src="${t}"></img>`},FamilyTree.editUI.prototype.content=function(t,e,i,n,r){var o,a=this.obj.config.editForm.readOnly,l=JSON.parse(JSON.stringify(this.obj.config.editForm.elements)),s=this.obj.config.editForm.addMore,c=this.obj.config.editForm.saveAndCloseBtn,d=this.obj.config.editForm.cancelBtn,p=this.obj.config.editForm.buttons,h=this.obj.config.editForm.titleBinding,f=this.obj.config.editForm.photoBinding,m=this.obj.getNode(t),y=this.obj._get(t),x=FamilyTree.t(m.templateName,m.min,this.obj.getScale()),u=y[h],b=y[f];if(this.obj.config.editForm.generateElementsFromFields)for(var v=0;v<this.fields.length;v++){var g=this.fields[v];if(g!="tags"){for(var _=!1,k=0;k<l.length;k++){if(Array.isArray(l[k])){for(var w=0;w<l[k].length;w++)if(g==l[k][w].binding){_=!0;break}}else if(g==l[k].binding){_=!0;break}if(_)break}_||l.push({type:"textbox",label:g,binding:g})}}FamilyTree.isNEU(u)&&(u=""),b=FamilyTree.isNEU(b)?FamilyTree.icon.user(150,150,"#8C8C8C",0,0):`<img style="width: 100%;height:100%;border-radius: 50%;object-fit:cover;" src="${b}"></img>`;var S=!e,I=e?"display:none;":"",M=e||!s?"display:none;":"",N=x.editFormHeaderColor?`style="background-color:${x.editFormHeaderColor};"`:"",A=document.createElement("form");if(A.setAttribute("data-bft-edit-form",""),A.classList.add("bft-edit-form"),A.classList.add(this.obj.config.mode),A.classList.add(m.templateName.replaceAll(" ","")),A.classList.add(FamilyTree.ui._defsIds[m.templateName]),Array.isArray(m.tags)&&m.tags.length)for(v=0;v<m.tags.length;v++)A.classList.add(m.tags[v].replaceAll(" ",""));A.style.display="flex",A.style.opacity=i?1:0,A.style.right=i?0:"-20px",n&&(A.style.width=n);var B=[],P=r?"":FamilyTree.EDITFORM_CLOSE_BTN;return A.innerHTML=`<div>
                        <div class="bft-edit-form-header" ${N}>
                            ${P}
                            ${FamilyTree.editUI.renderHeaderContent(u,b,m,y)}
                        </div>
                        <div data-bft-edit-from-btns class="bft-edit-form-instruments">
                        ${function(){if(r)return"";var T="";for(var O in p){var L=p[O];FamilyTree.isNEU(L)||S&&L.hideIfEditMode||e&&L.hideIfDetailsMode||a&&L.text=="Edit"||(T+=`<div data-edit-from-btn='${O}' class="bft-img-button" ${N} title="${L.text}">${L.icon}</div>`)}return T}()}    
                        </div>
                    </div>
                    <div class="bft-edit-form-fields">
                        <div class="bft-edit-form-fields-inner">
                            <div class="bft-form-fieldset">
                                ${function(){for(var T="",O=0;O<l.length;O++){var L=l[O];if(Array.isArray(L)){T+='<div class="bft-form-field-100 bft-form-fieldset">';for(var U=0;U<L.length;U++){var D=L[U],R=FamilyTree.elements[D.type](y,D,"unset",e);!FamilyTree.isNEU(R.id)&&FamilyTree.isNEU(o)&&FamilyTree.isNEU(R.value)&&(o=R.id),FamilyTree.isNEU(R.value)||B.push(`${D.label}: ${R.value}`),T+=R.html}T+="</div>"}else R=FamilyTree.elements[L.type](y,L,"280px",e),!FamilyTree.isNEU(R.id)&&FamilyTree.isNEU(o)&&FamilyTree.isNEU(R.value)&&(o=R.id),FamilyTree.isNEU(R.value)||B.push(`${L.label}: ${R.value}`),T+=R.html}return T}()}

                                <div class="bft-form-field" style="min-width: 280px; text-align:center; ${M}">
                                    <a data-add-more-fields-btn href="#" class="bft-link">${s}</a>
                                </div>
                            </div>        
                        </div>
                    </div>
                    <div class="bft-form-fieldset" style="padding: 14px 10px; ${I}">
                        <div class="bft-form-field" style="min-width: initial;">
                            <button data-edit-from-cancel type="button" class="bft-button transparent">${d}</button>
                        </div>
                        <div class="bft-form-field" style="min-width: initial;">
                            <button type="submit" data-edit-from-save type="button" class="bft-button">${c}</button>
                        </div>
                    </div>`,{element:A,focusId:o,title:u,shareText:B.join(`
`)}},FamilyTree.editUI.prototype.hide=function(){if(FamilyTree.events.publish("hide",[this])===!1)return!1;FamilyTree.isNEU(this.interval)&&(clearInterval(this.interval),this.interval=null);var t=this.obj.element.querySelector("[data-bft-edit-form]");t&&t.parentNode&&t.parentNode.removeChild(t)},FamilyTree.editUI.renderHeaderContent=function(t,e,i,n){return`<h1 class="bft-edit-form-title">${FamilyTree._escapeGreaterLessSign(t)}</h1>
                <div id="bft-avatar" class="bft-edit-form-avatar">${e}</div>`},FamilyTree.prototype.getSvg=function(){var t=this.element.getElementsByTagName("svg");return t&&t.length?t[0]:null},FamilyTree.prototype.getPointerElement=function(){return this.element.querySelector("g[data-pointer]")},FamilyTree.prototype.getNodeElement=function(t){return this.element.querySelector("["+FamilyTree.attr.node_id+"='"+t+"']")},FamilyTree.prototype.getMenuButton=function(){return this.element.querySelector("["+FamilyTree.attr.control_export_menu+"]")},FamilyTree.menuUI=function(){},FamilyTree.menuUI.prototype.init=function(t,e){this.obj=t,this.wrapper=null,this.menu=e,this._event_id=FamilyTree._guid()},FamilyTree.menuUI.prototype.showStickIn=function(t,e,i,n){this._show(t,null,e,i,n)},FamilyTree.menuUI.prototype.show=function(t,e,i,n,r){this._show(t,e,i,n,r)},FamilyTree.menuUI.prototype._show=function(t,e,i,n,r){var o=this;this.hide();var a="";r||(r=this.menu);var l={firstNodeId:i,secondNodeId:n,menu:r};if(FamilyTree.events.publish("show",[this,l])===!1)return!1;for(var s in r=l.menu){var c=r[s].icon,d=r[s].text;c===void 0&&(c=FamilyTree.icon[s]?FamilyTree.icon[s](24,24,"#7A7A7A"):""),typeof d=="function"&&(d=d()),typeof c=="function"&&(c=c()),a+="<div "+FamilyTree.attr.item+'="'+s+'">'+c+"<span>&nbsp;&nbsp;"+d+"</span></div>"}if(a!=""){if(this.wrapper=document.createElement("div"),this.wrapper.className="bft-family-menu",this.wrapper.style.left="-99999px",this.wrapper.style.top="-99999px",this.wrapper.innerHTML=a,this.obj.element.appendChild(this.wrapper),e==null){var p=FamilyTree._menuPosition(t,this.wrapper,this.obj.getSvg());t=p.x,e=p.y}var h=t+45;this.wrapper.style.left=h+"px",this.wrapper.style.top=e+"px",this.wrapper.style.left=h-this.wrapper.offsetWidth+"px";var f=t-this.wrapper.offsetWidth;FamilyTree.animate(this.wrapper,{opacity:0,left:h-this.wrapper.offsetWidth},{opacity:1,left:f},300,FamilyTree.anim.inOutPow);for(var m=this.wrapper.getElementsByTagName("div"),y=0;y<m.length;y++)(s=m[y]).addEventListener("click",function(x){var u,b=this.getAttribute(FamilyTree.attr.item);if(r[b].onClick===void 0)if(b==="add"){var v={id:o.obj.generateId(),pid:i};o.obj.addNode(v,null,!0)}else if(b==="edit"){var g=o.obj.getNode(i);o.obj.editUI.show(g.id)}else b==="details"?(g=o.obj.getNode(i),o.obj.editUI.show(g.id,!0)):b==="remove"?o.obj.removeNode(i,null,!0):b==="svg"?o.obj.exportSVG({filename:"FamilyTree.svg",expandChildren:!1,nodeId:i}):b==="pdf"?o.obj.exportPDF({filename:"FamilyTree.pdf",expandChildren:!1,nodeId:i}):b==="png"?o.obj.exportPNG({filename:"FamilyTree.png",expandChildren:!1,nodeId:i}):b==="csv"?o.obj.exportCSV({nodeId:i}):b==="xml"?o.obj.exportXML({nodeId:i}):b==="json"&&o.obj.exportJSON({nodeId:i});else u=r[b].onClick.call(o.obj,i,n);u!=0&&o.hide()})}},FamilyTree.menuUI.prototype.isVisible=function(){return this.wrapper!=null},FamilyTree.menuUI.prototype.hide=function(){this.wrapper!=null&&(this.obj.element.removeChild(this.wrapper),this.wrapper=null)},FamilyTree.menuUI.prototype.on=function(t,e){return FamilyTree.events.on(t,e,this._event_id),this},FamilyTree.circleMenuUI=function(){},FamilyTree.circleMenuUI.prototype.init=function(t,e){this.obj=t,this.menu=e,this._menu=null,this._buttonsInterval=[],this._linesInterval=[],this._event_id=FamilyTree._guid()},FamilyTree.circleMenuUI.prototype.show=function(t,e){this._show(t,e)},FamilyTree.circleMenuUI.prototype._show=function(t,e){var i=this,n=this.obj.getNode(t),r=FamilyTree.t(n.templateName,n.min,this.obj.getScale());if(!FamilyTree.isNEU(r.nodeCircleMenuButton)){var o=this.obj.getSvg(),a=this.obj.element.querySelector("["+FamilyTree.attr.control_node_circle_menu_id+'="'+t+'"]'),l=this.obj.getNodeElement(t),s=FamilyTree._getTransform(a),c=FamilyTree._getTransform(l),d=s[4]+c[4],p=s[5]+c[5],h=a.querySelectorAll("line"),f=this.obj.element.querySelector("["+FamilyTree.attr.control_node_circle_menu_wrraper_id+"]");if(FamilyTree.isNEU(f)||f.getAttribute(FamilyTree.attr.control_node_circle_menu_wrraper_id)!=t){this.hide(),e||(e=this.menu);var m={nodeId:t,menu:e},y=FamilyTree.events.publish("show",[this,m]);if(this._menu=e,y===!1)return!1;for(var x=0,u=Object.keys(m.menu).length,b=2*r.nodeCircleMenuButton.radius+4,v=2*Math.PI*b,g=v/u-(2*r.nodeCircleMenuButton.radius+2);g<0;)b+=8,g=(v=2*Math.PI*b)/u-(2*r.nodeCircleMenuButton.radius+2);for(var _ in(f=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute(FamilyTree.attr.control_node_circle_menu_wrraper_id,t),f.setAttribute("transform","matrix(1,0,0,1,"+d+","+p+")"),o.appendChild(f),m.menu){var k=m.menu[_].icon,w=m.menu[_].color,S=m.menu[_].text;typeof k=="function"&&(k=k()),typeof w=="function"&&(w=w()),typeof S=="function"&&(S=S());var I=document.createElementNS("http://www.w3.org/2000/svg","g");I.setAttribute("transform","matrix(1,0,0,1,0,0)"),I.setAttribute(FamilyTree.attr.control_node_circle_menu_name,_),I.style.cursor="pointer";var M=document.createElementNS("http://www.w3.org/2000/svg","title");FamilyTree.isNEU(S)||(M.innerHTML=S);var N=document.createElementNS("http://www.w3.org/2000/svg","circle");N.setAttribute("cx",0),N.setAttribute("cy",0),N.setAttribute("r",r.nodeCircleMenuButton.radius),N.setAttribute("fill",w),N.setAttribute("stroke-width","1"),N.setAttribute("stroke",r.nodeCircleMenuButton.stroke),I.appendChild(N),I.appendChild(M),I.innerHTML+=k,f.appendChild(I);var A=I.getElementsByTagName("svg")[0];if(A.setAttribute("pointer-events","none"),A){var B=parseInt(A.getAttribute("width")),P=parseInt(A.getAttribute("height"));A.setAttribute("x",-B/2),A.setAttribute("y",-P/2)}var T=x*Math.PI/(u/2);x++;var O=Math.cos(T)*b,L=Math.sin(T)*b;this._buttonsInterval.push(FamilyTree.animate(I,{transform:[1,0,0,1,0,0]},{transform:[1,0,0,1,O,L]},250,FamilyTree.anim.outBack,function(U){var D=U[0].getAttribute(FamilyTree.attr.control_node_circle_menu_name),R=U[0].parentNode.getAttribute(FamilyTree.attr.control_node_circle_menu_wrraper_id);U[0].addEventListener("mouseenter",function(H){FamilyTree.events.publish("mouseenter",[i,{from:R,menuItem:m.menu[D],menuItemName:D,event:H}])}),U[0].addEventListener("mouseout",function(H){FamilyTree.events.publish("mouseout",[i,{from:R,menuItem:m.menu[D],menuItemName:D,event:H}])})}))}this._linesInterval.push(FamilyTree.animate(h[0],{x1:-r.nodeCircleMenuButton.radius/2,y1:-6,x2:r.nodeCircleMenuButton.radius/2,y2:-6},{x1:-7,y1:-7,x2:7,y2:7},500,FamilyTree.anim.inOutSin)),this._linesInterval.push(FamilyTree.animate(h[1],{x1:-r.nodeCircleMenuButton.radius/2,y1:0,x2:r.nodeCircleMenuButton.radius/2,y2:0},{x1:0,y1:0,x2:0,y2:0},500,FamilyTree.anim.inOutSin)),this._linesInterval.push(FamilyTree.animate(h[2],{x1:-r.nodeCircleMenuButton.radius/2,y1:6,x2:r.nodeCircleMenuButton.radius/2,y2:6},{x1:-7,y1:7,x2:7,y2:-7},500,FamilyTree.anim.inOutSin))}else this.hide()}},FamilyTree.circleMenuUI.prototype.hide=function(){for(var t=this._buttonsInterval.length-1;t>=0;t--)clearInterval(this._buttonsInterval[t]),this._buttonsInterval.splice(t,1);for(this._buttonsInterval=[],t=this._linesInterval.length-1;t>=0;t--)clearInterval(this._linesInterval[t]),this._linesInterval.splice(t,1);this._linesInterval=[];var e=this.obj.element.querySelector("["+FamilyTree.attr.control_node_circle_menu_wrraper_id+"]");if(e!=null){var i=e.getAttribute(FamilyTree.attr.control_node_circle_menu_wrraper_id),n=this.obj.getNode(i),r=FamilyTree.t(n.templateName,n.min,this.obj.getScale()),o=this.obj.element.querySelector("["+FamilyTree.attr.control_node_circle_menu_id+'="'+i+'"]').querySelectorAll("line");o[0].setAttribute("x1",-r.nodeCircleMenuButton.radius/2),o[0].setAttribute("x2",r.nodeCircleMenuButton.radius/2),o[0].setAttribute("y1",-6),o[0].setAttribute("y2",-6),o[1].setAttribute("x1",-r.nodeCircleMenuButton.radius/2),o[1].setAttribute("x2",r.nodeCircleMenuButton.radius/2),o[1].setAttribute("y1",0),o[1].setAttribute("y2",0),o[2].setAttribute("x1",-r.nodeCircleMenuButton.radius/2),o[2].setAttribute("x2",r.nodeCircleMenuButton.radius/2),o[2].setAttribute("y1",6),o[2].setAttribute("y2",6),e.parentElement.removeChild(e),e=null}},FamilyTree.circleMenuUI.prototype.on=function(t,e){return FamilyTree.events.on(t,e,this._event_id),this},FamilyTree===void 0&&(FamilyTree={}),FamilyTree.idb={version:1,dbName:"BALKAN",tableName:"familytree-js",keyPath:"id"},FamilyTree.idb.db=null,FamilyTree.idb._open=function(t){if(FamilyTree._browser().msie)t&&t(!1);else if((navigator.userAgent.toLowerCase().indexOf("safari")>0||navigator.userAgent.toLowerCase().indexOf("firefox")>0)&&window.location!==window.parent.location)t&&t(!1);else{if(!window.indexedDB)return console.error("Your browser doesn't support a stable version of IndexedDB."),void(t&&t(!1));if(FamilyTree.idb.db==null){var e=indexedDB.open(FamilyTree.idb.dbName,FamilyTree.idb.version);e.onerror=function(i){console.error("Cannot open database!"),t&&t(!1)},e.onsuccess=function(i){FamilyTree.idb.db=i.target.result,t&&t(!0)},e.onupgradeneeded=function(i){var n=i.target.result;n.objectStoreNames.contains(FamilyTree.idb.tableName)&&n.deleteObjectStore(FamilyTree.idb.tableName),n.createObjectStore(FamilyTree.idb.tableName,{keyPath:FamilyTree.idb.keyPath})}}else t&&t(!0)}},FamilyTree.idb.read=function(t,e){FamilyTree.idb._open(function(i){if(i){var n=FamilyTree.idb.db.transaction([FamilyTree.idb.tableName]).objectStore(FamilyTree.idb.tableName).get(t);n.onerror=function(r){console.error("Unable to retrieve data from database!"),e&&e(!1)},n.onsuccess=function(r){n.result?e&&e(!0,n.result):e&&e(null)}}else e&&e(!1)})},FamilyTree.idb.write=function(t,e){FamilyTree.idb.read(t.id,function(i){if(i==null){var n=FamilyTree.idb.db.transaction([FamilyTree.idb.tableName],"readwrite").objectStore(FamilyTree.idb.tableName).add(t);n.onerror=function(r){console.error("Unable to add data to database!"),e&&e(!1)},n.onsuccess=function(r){e&&e(!0)}}else e&&e(i)})},FamilyTree.idb.put=function(t,e){FamilyTree.idb._open(function(i){if(i){var n=FamilyTree.idb.db.transaction([FamilyTree.idb.tableName],"readwrite").objectStore(FamilyTree.idb.tableName).put(t);n.onerror=function(r){console.error("Unable to put data to database!"),e&&e(!1)},n.onsuccess=function(r){e&&e(!0)}}else e&&e(!1)})},FamilyTree.idb.delete=function(t,e){FamilyTree.idb._open(function(i){if(i){var n=FamilyTree.idb.db.transaction([FamilyTree.idb.tableName],"readwrite").objectStore(FamilyTree.idb.tableName).delete(t);n.onerror=function(r){console.error("Unable to retrieve data from database!"),e&&e(!1)},n.onsuccess=function(r){n.error?e&&e(!1):e&&e(!0)}}else e&&e(!1)})},FamilyTree.toolbarUI=function(){},FamilyTree.toolbarUI.expandAllIcon='<svg style="margin-bottom:7px;box-shadow: 0px 1px 4px rgba(0,0,0,0.3); border: 1px solid #cacaca;background-color: #f9f9f9;display: block;cursor: pointer;" width="32px" height="32px"><marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="4" markerHeight="4" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#757575" /></marker><line x1="11" y1="11" x2="6" y2="6" stroke="#757575" stroke-width="2" marker-end="url(#arrow)" /><line x1="21" y1="11" x2="26" y2="6" stroke="#757575" stroke-width="2" marker-end="url(#arrow)" /><line x1="21" y1="21" x2="26" y2="26" stroke="#757575" stroke-width="2" marker-end="url(#arrow)" /><line x1="11" y1="21" x2="6" y2="26" stroke="#757575" stroke-width="2" marker-end="url(#arrow)" /><rect x="12" y="12" width="8" height="8" fill="#757575"></rect></svg>',FamilyTree.toolbarUI.fitIcon='<svg  style="margin-bottom:7px;box-shadow: 0px 1px 4px rgba(0,0,0,0.3); border: 1px solid #cacaca;background-color: #f9f9f9;display: block;cursor: pointer;" width="32px" height="32px"><path stroke-width="3" fill="none" stroke="#757575" d="M4,11 L4,4 L11,4"></path><path stroke-width="3" fill="none" stroke="#757575" d="M28,11 L28,4 L21,4"></path><path stroke-width="3" fill="none" stroke="#757575" d="M28,21 L28,28 L21,28"></path><path stroke-width="3" fill="none" stroke="#757575" d="M4,21 L4,28 L11,28"></path><circle cx="16" cy="16" r="5" fill="#757575"></circle></svg>',FamilyTree.toolbarUI.openFullScreenIcon='<svg  style="margin-bottom:7px;box-shadow: 0px 1px 4px rgba(0,0,0,0.3); border: 1px solid #cacaca;background-color: #f9f9f9;display: block;cursor: pointer;" width="32px" height="32px"><path stroke-width="3" fill="none" stroke="#757575" d="M4,11 L4,4 L11,4"></path><path stroke-width="3" fill="none" stroke="#757575" d="M28,11 L28,4 L21,4"></path><path stroke-width="3" fill="none" stroke="#757575" d="M28,21 L28,28 L21,28"></path><path stroke-width="3" fill="none" stroke="#757575" d="M4,21 L4,28 L11,28"></path><line x1="5" y1="5" x2="27" y2="27" stroke-width="3" stroke="#757575"></line><line x1="5" y1="27" x2="27" y2="5" stroke-width="3" stroke="#757575"></line></svg>',FamilyTree.toolbarUI.closeFullScreenIcon='<svg  style="margin-bottom:7px;box-shadow: 0px 1px 4px rgba(0,0,0,0.3); border: 1px solid #cacaca;background-color: #f9f9f9;display: block;cursor: pointer;" width="32px" height="32px"><path stroke-width="3" fill="none" stroke="#757575" d="M4,11 L4,4 L11,4"></path><path stroke-width="3" fill="none" stroke="#757575" d="M28,11 L28,4 L21,4"></path><path stroke-width="3" fill="none" stroke="#757575" d="M28,21 L28,28 L21,28"></path><path stroke-width="3" fill="none" stroke="#757575" d="M4,21 L4,28 L11,28"></path><rect x="11" y="11" width="10" height="10" stroke-width="3" fill="none" stroke="#757575" ></rect></svg>',FamilyTree.toolbarUI.zoomInIcon='<svg style="box-shadow: 0px 1px 4px rgba(0,0,0,0.3); border-left: 1px solid #cacaca; border-right: 1px solid #cacaca; border-top: 1px solid #cacaca; background-color: #f9f9f9;display: block; cursor: pointer;" width="32px" height="32px" ><g><rect fill="#f9f9f9" x="0" y="0" width="32" height="32" ></rect><line x1="8" y1="16" x2="24" y2="16" stroke-width="3" stroke="#757575"></line><line x1="16" y1="8" x2="16" y2="24" stroke-width="3" stroke="#757575"></line></g><line x1="4" y1="32" x2="28" y2="32" stroke-width="1" stroke="#cacaca"></line></svg>',FamilyTree.toolbarUI.zoomOutIcon='<svg style="box-shadow: 0px 1px 4px rgba(0,0,0,0.3); margin-bottom:7px; border-left: 1px solid #cacaca; border-right: 1px solid #cacaca; border-bottom: 1px solid #cacaca; background-color: #f9f9f9;display: block; cursor: pointer;" width="32px" height="32px" ><g><rect fill="#f9f9f9" x="0" y="0" width="32" height="32" ></rect><line x1="8" y1="16" x2="24" y2="16" stroke-width="3" stroke="#757575"></line></g></svg>',FamilyTree.toolbarUI.layoutIcon="<svg "+FamilyTree.attr.tlbr+'="layout" style="box-shadow: 0px 1px 4px rgba(0,0,0,0.3); border: 1px solid #cacaca;background-color: #f9f9f9;display: block;cursor: pointer;" width="32px" height="32px"><path stroke-width="3" fill="none" stroke="#757575" d="M8,24 L16,14 L24,24"></path><path stroke-width="3" fill="none" stroke="#757575" d="M8,16 L16,8 L24,16"></path></svg>',FamilyTree.toolbarUI.prototype.init=function(t,e){if(e){this.obj=t,this.toolbar=e,this._visible=!1,this.div=document.createElement("div"),this.div.classList.add("bft-toolbar-container"),Object.assign(this.div.style,{position:"absolute",padding:"3px",right:this.obj.config.padding-10+"px",bottom:this.obj.config.padding-10+"px"}),e.expandAll&&(this.div.innerHTML+="<div "+FamilyTree.attr.tlbr+'="expand">'+FamilyTree.toolbarUI.expandAllIcon+"</div>"),e.fit&&(this.div.innerHTML+="<div "+FamilyTree.attr.tlbr+'="fit">'+FamilyTree.toolbarUI.fitIcon+"</div>"),e.zoom&&(this.div.innerHTML+="<div "+FamilyTree.attr.tlbr+'="plus">'+FamilyTree.toolbarUI.zoomInIcon+"</div>",this.div.innerHTML+="<div "+FamilyTree.attr.tlbr+'="minus">'+FamilyTree.toolbarUI.zoomOutIcon+"</div>"),e.layout&&(this.div.innerHTML+="<div "+FamilyTree.attr.tlbr+'="layout">'+FamilyTree.toolbarUI.layoutIcon+"</div>",this.layouts=document.createElement("div"),this.layouts.classList.add("bft-toolbar-layout"),this.layouts.innerHTML=`<svg data-layout="normal" style="cursor: pointer;" width="110" height="100"><rect fill="#039BE5" x="35" y="0" width="50" height="27"></rect><rect fill="#F57C00" x="7" y="41" width="50" height="27"></rect><rect fill="#F57C00" x="63" y="41" width="50" height="27"></rect><line stroke="#000000" x1="60" x2="60" y1="27" y2="35" stroke-width="1"></line><line stroke="#000000" x1="32" x2="88" y1="35" y2="35" stroke-width="1"></line><line stroke="#000000" x1="32" x2="32" y1="35" y2="41" stroke-width="1"></line><line stroke="#000000" x1="88" x2="88" y1="35" y2="41" stroke-width="1"></line></svg>
            <svg data-layout="treeRightOffset" style="cursor: pointer;" width="110" height="100"><rect fill="#039BE5" x="35" y="0" width="50" height="27"></rect><rect fill="#F57C00" x="40" y="41" width="50" height="27"></rect><rect fill="#F57C00" x="40" y="73" width="50" height="27"></rect><line stroke="#000000" x1="60" x2="60" y1="27" y2="35" stroke-width="1"></line><line stroke="#000000" x1="60" x2="35" y1="35" y2="35" stroke-width="1"></line><line stroke="#000000" x1="35" x2="35" y1="35" y2="86" stroke-width="1"></line><line stroke="#000000" x1="35" x2="40" y1="86" y2="86" stroke-width="1"></line><line stroke="#000000" x1="35" x2="40" y1="54" y2="54" stroke-width="1"></line></svg>
            <svg data-layout="treeLeftOffset" style="cursor: pointer;" width="110" height="100"><rect fill="#039BE5" x="35" y="0" width="50" height="27"></rect><rect fill="#F57C00" x="30" y="41" width="50" height="27"></rect><rect fill="#F57C00" x="30" y="73" width="50" height="27"></rect><line stroke="#000000" x1="60" x2="60" y1="27" y2="35" stroke-width="1"></line><line stroke="#000000" x1="60" x2="85" y1="35" y2="35" stroke-width="1"></line><line stroke="#000000" x1="85" x2="85" y1="35" y2="86" stroke-width="1"></line><line stroke="#000000" x1="80" x2="85" y1="86" y2="86" stroke-width="1"></line><line stroke="#000000" x1="80" x2="85" y1="54" y2="54" stroke-width="1"></line></svg>
            <svg data-layout="mixed" style="cursor: pointer;" width="110" height="100"><rect fill="#039BE5" x="35" y="0" width="50" height="27"></rect><rect fill="#F57C00" x="35" y="41" width="50" height="27"></rect><rect fill="#F57C00" x="35" y="73" width="50" height="27"></rect><line stroke="#000000" x1="60" x2="60" y1="27" y2="41" stroke-width="1"></line><line stroke="#000000" x1="60" x2="60" y1="68" y2="73" stroke-width="1"></line></svg>
            <svg data-layout="tree" style="cursor: pointer;" width="110" height="100"><rect fill="#039BE5" x="35" y="0" width="50" height="27"></rect><rect fill="#F57C00" x="7" y="41" width="50" height="27"></rect><rect fill="#F57C00" x="35" y="73" width="50" height="27"></rect><rect fill="#F57C00" x="63" y="41" width="50" height="27"></rect><line stroke="#000000" x1="60" x2="60" y1="27" y2="73" stroke-width="1"></line><line stroke="#000000" x1="57" x2="63" y1="54" y2="54" stroke-width="1"></line></svg>
            <svg data-layout="grid" style="cursor: pointer;" width="110" height="100"><rect fill="#039BE5" x="35" y="0" width="50" height="27"></rect><rect fill="#F57C00" x="7" y="41" width="50" height="27"></rect><rect fill="#F57C00" x="7" y="73" width="50" height="27"></rect><rect fill="#F57C00" x="63" y="41" width="50" height="27"></rect><rect fill="#F57C00" x="63" y="73" width="50" height="27"></rect><line stroke="#000000" x1="60" x2="60" y1="27" y2="71" stroke-width="1"></line><line stroke="#000000" x1="32" x2="88" y1="39" y2="39" stroke-width="1"></line><line stroke="#000000" x1="32" x2="88" y1="71" y2="71" stroke-width="1"></line><line stroke="#000000" x1="32" x2="32" y1="71" y2="73" stroke-width="1"></line><line stroke="#000000" x1="88" x2="88" y1="71" y2="73" stroke-width="1"></line><line stroke="#000000" x1="32" x2="32" y1="39" y2="41" stroke-width="1"></line><line stroke="#000000" x1="88" x2="88" y1="39" y2="41" stroke-width="1"></line></svg>`,this.obj.element.appendChild(this.layouts)),e.fullScreen&&(this.div.innerHTML+="<div "+FamilyTree.attr.tlbr+'="fullScreen">'+FamilyTree.toolbarUI.openFullScreenIcon+"</div>"),this.obj.element.appendChild(this.div),this.layoutBtn=this.div.querySelector("["+FamilyTree.attr.tlbr+'="layout"]');var i=this.div.querySelector("["+FamilyTree.attr.tlbr+'="plus"]'),n=this.div.querySelector("["+FamilyTree.attr.tlbr+'="minus"]'),r=this.div.querySelector("["+FamilyTree.attr.tlbr+'="fit"]'),o=this.div.querySelector("["+FamilyTree.attr.tlbr+'="fullScreen"]'),a=this.div.querySelector("["+FamilyTree.attr.tlbr+'="expand"]'),l=this;i&&i.addEventListener("click",function(){l.obj.zoom(!0,null,!0)}),n&&n.addEventListener("click",function(){l.obj.zoom(!1,null,!0)}),r&&r.addEventListener("click",function(){l.obj.fit()}),o&&o.addEventListener("click",function(){l.obj.toggleFullScreen()}),a&&a.addEventListener("click",function(){l.obj.expand(null,"all")}),this.layoutBtn&&this.layoutBtn.addEventListener("click",function(){l._visible?l.hideLayout():l.showLayout()}),this.layouts&&this.layouts.addEventListener("click",function(s){for(var c=s.target;c;){if(c.hasAttribute&&c.hasAttribute(FamilyTree.attr.layout)){c=c.getAttribute(FamilyTree.attr.layout),l.obj.setLayout(FamilyTree.layout[c]);break}c=c.parentNode}})}},FamilyTree.toolbarUI.prototype.showLayout=function(){this._visible=!0,this.layoutBtn.style.transform="rotate(180deg) translateX(0px) translateY(0px)",FamilyTree.animate(this.div,{bottom:this.obj.config.padding-10},{bottom:this.obj.config.padding+135},this.obj.config.anim.duration,this.obj.config.anim.func),FamilyTree.animate(this.layouts,{bottom:-145},{bottom:0},this.obj.config.anim.duration,this.obj.config.anim.func)},FamilyTree.toolbarUI.prototype.hideLayout=function(){this._visible=!1,this.layoutBtn.style.transform="rotate(0deg) translateX(0px) translateY(0px)",FamilyTree.animate(this.div,{bottom:this.obj.config.padding+135},{bottom:this.obj.config.padding-10},this.obj.config.anim.duration,this.obj.config.anim.func),FamilyTree.animate(this.layouts,{bottom:0},{bottom:-145},this.obj.config.anim.duration,this.obj.config.anim.func)},FamilyTree.notifierUI=function(){},FamilyTree.notifierUI.prototype.init=function(t){this.obj=t},FamilyTree.notifierUI.prototype.show=function(t,e){if(t==null)return!1;t==1&&(t=FamilyTree.MAX_NODES_MESS,e="#FFCA28"),t==2&&(t=FamilyTree.OFFLINE_MESS,e="#FFCA28");var i=document.createElement("div");i.innerHTML=t,Object.assign(i.style,{position:"absolute","background-color":e,color:"#ffffff",padding:"15px","border-radius":"40px",opacity:0,overflow:"hidden","white-space":"nowrap","text-align":"center"}),this.obj.element.appendChild(i);var n=this.obj.width()/2-i.offsetWidth/2,r=this.obj.height()/2-i.offsetHeight/2;i.style.left=n+"px",i.style.top=r+"px";var o=i.offsetWidth;return i.style.width="20px",FamilyTree.animate(i,{opacity:0,width:10},{opacity:1,width:o},this.obj.config.anim.duration,this.obj.config.anim.func),!0},FamilyTree===void 0&&(FamilyTree={}),FamilyTree._validateConfig=function(t){return!!t||(console.error("config is not defined"),!1)},FamilyTree._arrayContains=function(t,e){if(t&&Array.isArray(t)){for(var i=t.length;i--;)if(t[i]===e)return!0}return!1},FamilyTree._interceptions=function(t,e){if(!t)return[];if(!e)return[];var i=[];if(Array.isArray(t)&&Array.isArray(e))for(var n in t)for(var r in e)t[n]==e[r]&&i.push(t[n]);else if(Array.isArray(t)&&!Array.isArray(e))for(var n in t)for(var r in e)t[n]==r&&i.push(t[n]);else if(!Array.isArray(t)&&Array.isArray(e))for(var n in t)for(var r in e)n==e[r]&&i.push(e[r]);return i},FamilyTree._getTags=function(t){return t.tags&&!Array.isArray(t.tags)?t.tags.split(","):t.tags&&Array.isArray(t.tags)?t.tags:[]},FamilyTree._centerPointInPercent=function(t,e,i){var n=t.getBoundingClientRect(),r=e-n.left,o=i-n.top;return[r/(n.width/100),o/(n.height/100)]},FamilyTree._trim=function(t){return t.replace(/^\s+|\s+$/g,"")},FamilyTree._getTransform=function(t){var e=t.getAttribute("transform");return e=e.replace("matrix","").replace("(","").replace(")",""),FamilyTree._browser().msie&&(e=e.replace(/ /g,",")),e="["+(e=FamilyTree._trim(e))+"]",e=JSON.parse(e)},FamilyTree.getScale=function(t,e,i,n,r,o,a,l){var s=1;if(t||n!==FamilyTree.match.boundary)if(t||n!==FamilyTree.match.width)if(t||n!==FamilyTree.match.height)if(t){var c,d;s=(c=e/t[2])>(d=i/t[3])?d:c}else s=n;else s=i/l;else s=e/a;else s=(c=e/a)>(d=i/l)?d:c;return s&&s>r&&(s=r),s&&s<o&&(s=o),s},FamilyTree.isObject=function(t){return t&&typeof t=="object"&&!Array.isArray(t)&&t!==null},FamilyTree.fileUploadDialog=function(t){var e=document.createElement("INPUT");e.setAttribute("type","file"),e.style.display="none",e.onchange=function(){var i=this.files[0];t(i)},document.body.appendChild(e),e.click()},FamilyTree.mergeDeep=function(t,e){if(FamilyTree.isObject(t)&&FamilyTree.isObject(e))for(var i in e)FamilyTree.isObject(e[i])?(t[i]||Object.assign(t,{[i]:{}}),FamilyTree.mergeDeep(t[i],e[i])):Object.assign(t,{[i]:e[i]});return t},FamilyTree._lblIsImg=function(t,e){return!(!t.nodeBinding||typeof e!="string"||e.indexOf("img")==-1||!t.nodeBinding[e])},FamilyTree._getFistImgField=function(t){if(t.nodeBinding){for(var e in t.nodeBinding)if(e.indexOf("img")!=-1)return t.nodeBinding[e]}return!1},FamilyTree._fieldIsImg=function(t,e){if(t.nodeBinding){for(var i in t.nodeBinding)if(t.nodeBinding[i]==e)return FamilyTree._lblIsImg(t,i)}return!1},FamilyTree._guid=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},FamilyTree.htmlRipple=function(t){var e=document.createElement("style");e.type="text/css",e.innerHTML=" .bft-ripple-container {position: absolute; top: 0; right: 0; bottom: 0; left: 0; } .bft-ripple-container span {transform: scale(0);border-radius:100%;position:absolute;opacity:0.75;background-color:#fff;animation: bft-ripple 1000ms; }@-moz-keyframes bft-ripple {to {opacity: 0;transform: scale(2);}}@-webkit-keyframes bft-ripple {to {opacity: 0;transform: scale(2);}}@-o-keyframes bft-ripple {to {opacity: 0;transform: scale(2);}}@keyframes bft-ripple {to {opacity: 0;transform: scale(2);}}",document.head.appendChild(e);var i,n,r,o=document.createElement("div");o.className="bft-ripple-container",t.addEventListener("mousedown",function(a){var l,s,c,d,p;return s=document.createElement("span"),c=this.offsetWidth,l=this.getBoundingClientRect(),p=a.pageX-l.left-c/2,d="top:"+(a.pageY-l.top-c/2)+"px; left: "+p+"px; height: "+c+"px; width: "+c+"px;",t.rippleContainer.appendChild(s),s.setAttribute("style",d)}),t.addEventListener("mouseup",(i=function(){for(;this.rippleContainer.firstChild;)this.rippleContainer.removeChild(this.rippleContainer.firstChild)},n=2e3,r=void 0,function(){var a,l;return l=this,a=arguments,clearTimeout(r),r=setTimeout(function(){return i.apply(l,a)},n)})),t.rippleContainer=o,t.appendChild(o)},FamilyTree._moveToBoundaryArea=function(t,e,i,n){var r=e.slice(0);e[0]<i.left&&e[0]<i.right&&(r[0]=i.left>i.right?i.right:i.left),e[0]>i.right&&e[0]>i.left&&(r[0]=i.left>i.right?i.left:i.right),e[1]<i.top&&e[1]<i.bottom&&(r[1]=i.top>i.bottom?i.bottom:i.top),e[1]>i.bottom&&e[1]>i.top&&(r[1]=i.top>i.bottom?i.top:i.bottom),e[0]!==r[0]||e[1]!==r[1]?FamilyTree.animate(t,{viewBox:e},{viewBox:r},300,FamilyTree.anim.outPow,function(){n&&n()}):n&&n()},FamilyTree.randomId=function(){return"_"+("0000"+(Math.random()*Math.pow(36,4)|0).toString(36)).slice(-4)},FamilyTree._getClientXY=function(t){return t.type.indexOf("touch")==-1?{x:t.clientX,y:t.clientY}:t.changedTouches.length?{x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY}:void 0},FamilyTree._getClientTouchesXY=function(t,e){return t.type.indexOf("touch")!=-1?t.touches.length<e+1?{x:null,y:null}:{x:t.touches[e].clientX,y:t.touches[e].clientY}:{x:t.clientX,y:t.clientY}},FamilyTree._getOffset=function(t,e){t&&(e.x+=t.offsetLeft,e.y+=t.offsetTop,FamilyTree._getOffset(t.offsetParent,e))},FamilyTree._getTopLeft=function(t){var e={x:0,y:0};return FamilyTree._getOffset(t,e),e},FamilyTree._getOffsetXY=function(t,e){if(e.type.indexOf("touch")==-1)return{x:e.offsetX,y:e.offsetY};if(e.touches.length){var i=FamilyTree._getTopLeft(t);return{x:e.touches[0].pageX-i.x,y:e.touches[0].pageY-i.y}}if(e.changedTouches.length)return i=FamilyTree._getTopLeft(t),isNaN(i.x)||isNaN(i.y)?{x:e.changedTouches[0].pageX,y:e.changedTouches[0].pageY}:{x:e.changedTouches[0].pageX-i.x,y:e.changedTouches[0].pageY-i.y}},FamilyTree._pinchMiddlePointInPercent=function(t,e,i,n){var r=FamilyTree._getTopLeft(t),o=n.touches[0].pageX-r.x,a=n.touches[0].pageY-r.y,l=n.touches[1].pageX-r.x,s=n.touches[1].pageY-r.y;return[((o-l)/2+l)/(e/100),((a-s)/2+s)/(i/100)]},FamilyTree._browser=function(){var t=!!window.opr&&!!window.opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,e=typeof InstallTrigger<"u",i=/constructor/i.test(window.HTMLElement)||(!window.safari||window.safari!==void 0&&safari.pushNotification).toString()==="[object SafariRemoteNotification]",n=!!document.documentMode,r=!n&&!!window.StyleMedia,o=!(!window.chrome||!window.chrome.webstore&&!window.chrome.runtime);return{opera:t,firefox:e,safari:i,msie:n,edge:r,chrome:o,blink:(o||t)&&!!window.CSS}},FamilyTree._menuPosition=function(t,e,i){var n=t.getBoundingClientRect(),r=i.getBoundingClientRect(),o=e.getBoundingClientRect(),a=n.left-r.left,l=n.top-r.top;return n.top+o.height>r.top+r.height&&(l-=o.height),n.left-o.width<r.left&&(a+=o.width),{x:a,y:l}},FamilyTree._getTemplate=function(t,e,i){if(Array.isArray(t))for(var n=0;n<t.length;n++){var r=e[t[n]];if(r&&r.template)return r.template}return i},FamilyTree._getMin=function(t,e){if(t.tags&&t.tags.length&&e.tags)for(var i=0;i<t.tags.length;i++){var n=e.tags[t.tags[i]];if(n&&n.min===!0)return!0}return e.min},FamilyTree._getSubLevels=function(t,e){if(t&&t.length)for(var i=0;i<t.length;i++){var n=e[t[i]];if(n&&n.subLevels)return n.subLevels}return 0},FamilyTree._isHTML=function(t){var e=new DOMParser().parseFromString(t,"text/html");return Array.from(e.body.childNodes).some(i=>i.nodeType===1)},FamilyTree._getTestDiv=function(){var t=document.getElementById("orgfamily_js_test_div");return t||((t=document.createElement("div")).id="orgfamily_js_test_div",t.style.position="fixed",t.style.top="-10000px",t.style.left="-10000px",document.body.appendChild(t)),t},FamilyTree._getLabelSize=function(t){var e=FamilyTree._getTestDiv();return e.innerHTML="<svg>"+t+"</svg>",e.querySelector("text").getBoundingClientRect()},FamilyTree.wrapText=function(t,e){var i=e.toLowerCase();if(i.indexOf("<text")==-1||i.indexOf(FamilyTree.attr.width)==-1||i.indexOf("foreignobject")!=-1||e.indexOf(FamilyTree.attr.width)==-1||FamilyTree.ESCAPE_HTML&&typeof str=="string"&&FamilyTree._isHTML(t))return FamilyTree._escapeHtml(t);if(!FamilyTree.ESCAPE_HTML&&FamilyTree._isHTML(t))return t;var n=FamilyTree._getTestDiv();e=e.replaceAll("{cw}",0),n.innerHTML="<svg>"+e+"</svg>";var r,o,a=new DOMParser().parseFromString(e,"text/xml").getElementsByTagName("text")[0],l=parseFloat(a.getAttribute("x")),s=parseFloat(a.getAttribute("y")),c=a.getAttribute("text-anchor"),d=a.getAttribute(FamilyTree.attr.width),p=a.getAttribute(FamilyTree.attr.text_overflow),h="http://www.w3.org/2000/svg",f=n.getElementsByTagName("svg")[0].getElementsByTagName("text")[0];p||(p="ellipsis");var m=p.split("-");if(m.length>1&&(r=parseInt(p.split("-")[1]),m.length>2&&m[2]=="ellipsis"&&(o=!0)),!d)return FamilyTree._escapeHtml(t);if(d=parseFloat(d),l||(l=0),s||(s=0),l||(c="start"),p=="ellipsis"){f.removeChild(f.firstChild),f.textContent=t;for(var y=f.getComputedTextLength(),x=2;y>d;)f.textContent=t.substring(0,t.length-x),f.textContent+="...",y=f.getComputedTextLength(),x++;return x>2?`<title>${FamilyTree._escapeHtml(t)}</title>${f.textContent}`:FamilyTree._escapeHtml(t)}if(p.indexOf("multiline")!=-1){var u=t.split(" "),b=f.getBBox().height;f.textContent="";var v=document.createElementNS(h,"tspan"),g=document.createTextNode(u[0]);v.setAttributeNS(null,"x",l),v.setAttributeNS(null,"y",s),v.setAttributeNS(null,"text-anchor",c),v.appendChild(g),f.appendChild(v),x=1;for(var _=1,k=!1,w=1;w<u.length;w++){var S=v.firstChild.data.length;if(v.firstChild.data+=" "+u[w],v.getComputedTextLength()>d){if(v.firstChild.data=v.firstChild.data.slice(0,S),_++,r&&_>r){if(o&&f.children.length==r){var I=f.children[r-1].textContent;f.children[r-1].textContent=I.substring(0,I.length-3)+"...",k=!0}break}(v=document.createElementNS(h,"tspan")).setAttributeNS(null,"x",l),v.setAttributeNS(null,"y",s+b*x),v.setAttributeNS(null,"text-anchor",c),g=document.createTextNode(u[w]),v.appendChild(g),f.appendChild(v),x++}}var M="";if(f.innerHTML!=null)M=f.innerHTML,f.innerHTML="";else{var N="";for(w=f.childNodes.length-1;w>=0;w--)N=XMLSerializer().serializeToString(f.childNodes[w])+N,f.removeChild(f.childNodes[w]);M=N}return k?`<title>${FamilyTree._escapeHtml(t)}</title>${M}`:M}},FamilyTree._downloadFile=function(t,e,i,n,r){var o=new Blob([e],{type:t});if(n==1){var a=URL.createObjectURL(o);window.open(a,"_blank").focus()}else if(navigator.msSaveBlob)navigator.msSaveBlob(o,i);else{var l=document.createElement("a");if(l.download!==void 0){a=URL.createObjectURL(o),l.setAttribute("href",a);var s=i;s.toLowerCase().endsWith(r.toLowerCase())||(s=s+"."+r),l.setAttribute("download",s),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l)}}},FamilyTree._getPosition=function(t,e,i,n){var r={x:e.x,y:e.y};if(i!=null&&(r.x=i),n!=null&&(r.y=i),t&&t.length==3){var o=t[0].indexOf(e.id);o!=-1&&t[1][o].transform!=null&&(i==null&&(r.x=t[1][o].transform[4]),n==null&&(r.y=t[1][o].transform[5]))}return r},FamilyTree._getOpacity=function(t,e){var i=1;if(t&&t.length==3){var n=t[0].indexOf(e.id);n!=-1&&t[1][n].opacity!=null&&(i=t[1][n].opacity)}return i},FamilyTree.t=function(t,e,i){var n=FamilyTree.templates[t];n==null&&console.error(`Template "${t}" does not exist!`);var r=null;if(i!=null&&n.scaleLessThen){var o=[];for(var a in n.scaleLessThen){var l=parseFloat(a);i<l&&o.push(l)}if(o.length>0){o.sort(function(d,p){return d-p});var s=n.scaleLessThen[o[0]];for(var c in s)r==null&&(r=Object.assign({},n)),r[c]=s[c]}}return e?r==null?n.min?n.min:n:r.min?r.min:r:r??n},FamilyTree.setNodeSize=function(t){var e=FamilyTree.t(t.templateName,t.min);t.w=e&&e.size?e.size[0]:0,t.h=e&&e.size?e.size[1]:0},FamilyTree._imgs2base64=function(t,e,i,n){var r=t.getElementsByTagName(e),o=r.length;o==0&&n();for(var a=0;a<o;a++)(function(){var l=a,s=r[l];FamilyTree._getDataUri(s.getAttribute(i),function(c){c.success&&s.setAttribute(i,c.result),l==o-1&&n()})})()},FamilyTree._getDataUri=function(t,e){if(t.indexOf("base64")!=-1)e({success:!1});else{var i=new XMLHttpRequest;i.open("GET",t),i.responseType="blob",i.onload=function(){i.status===200?n.readAsDataURL(i.response):i.status===404&&e({success:!1,result:i.status})};var n=new FileReader;n.onloadend=function(){e({success:!0,result:n.result})},i.send()}},FamilyTree._convertStringToArray=function(t,e){return FamilyTree.ARRAY_FIELDS.indexOf(t)!=-1?FamilyTree.isNEU(e)?[]:e.split(","):e},FamilyTree._convertArrayToString=function(t){return!FamilyTree.isNEU(t)&&Array.isArray(t)?t.join():t},FamilyTree._csvToArray=function(t,e){e=e||FamilyTree.CSV_DELIMITER;for(var i=new RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+"\\r\\n]*))","gi"),n=[[]],r=null;r=i.exec(t);){var o,a=r[1];a.length&&a!==e&&n.push([]),o=r[2]?r[2].replace(new RegExp('""',"g"),'"'):r[3],n[n.length-1].push(o)}return n},FamilyTree._json2xml=function(t){for(var e=document.implementation.createDocument("","",null),i=e.createElement("nodes"),n=0;n<t.length;n++){var r=e.createElement("node"),o=t[n];for(var a in o){var l=o[a];r.setAttribute(a,FamilyTree._convertArrayToString(l))}i.appendChild(r)}return e.appendChild(i),'<?xml version="1.0" encoding="utf-8" ?>'+new XMLSerializer().serializeToString(e.documentElement)},FamilyTree._xml2json=function(t){for(var e=new DOMParser().parseFromString(t,"text/xml").getElementsByTagName("node"),i=[],n=0;n<e.length;n++){for(var r=e[n],o={},a=0;a<r.attributes.length;a++){var l=r.attributes[a];o[l.name]=FamilyTree._convertStringToArray(l.name,l.value)}i.push(o)}return i},FamilyTree.convertNodesToCsv=function(t){return FamilyTree._json2csv(t)},FamilyTree._json2csv=function(t){for(var e=[],i=function(a){for(var l="",s=0;s<e.length;s++){var c;(c=e[s]=="reportsTo"?null:a[e[s]]==null?"":a[e[s]])instanceof Date&&(c=c.toLocaleString());var d=(c=c===null?"":c.toString()).replace(/"/g,'""'),p=new RegExp(`("|;|
)`,"g");d.search(p)>=0&&(d='"'+d+'"'),s>0&&(l+=FamilyTree.CSV_DELIMITER),l+=d}return l+`
`},n="",r=0;r<t.length;r++)for(var o in t[r])FamilyTree._arrayContains(e,o)||(e.push(o),n+=o+FamilyTree.CSV_DELIMITER);for(n=n.substring(0,n.length-1),n+=`
`,r=0;r<t.length;r++)n+=i(t[r]);return n=n.substring(0,n.length-1)},FamilyTree.accentFold=function(t){return(t=t.toString().toLowerCase()).replace(/([])|([])|([])|([])|([])|([])|([])|([])|([])|([])/g,function(e,i,n,r,o,a,l,s,c,d,p){return i?"a":n?"c":r?"e":o?"i":a?"n":l?"o":s?"s":c?"u":d?"y":p?"ae":void 0})},FamilyTree.copy=function(t){if(t===null||typeof t!="object"||"isActiveClone"in t)return t;if(t instanceof Date)var e=new t.constructor;else e=t.constructor();for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(t.isActiveClone=null,e[i]=FamilyTree.copy(t[i]),delete t.isActiveClone);return e},FamilyTree._getScrollSensitivity=function(){var t=FamilyTree._browser();return t.msie&&FamilyTree.scroll.ie?FamilyTree.scroll.ie:t.edge&&FamilyTree.scroll.edge?FamilyTree.scroll.edge:t.safari&&FamilyTree.scroll.safari?FamilyTree.scroll.safari:t.chrome&&FamilyTree.scroll.chrome?FamilyTree.scroll.chrome:t.firefox&&FamilyTree.scroll.firefox?FamilyTree.scroll.firefox:t.opera&&FamilyTree.scroll.opera?FamilyTree.scroll.opera:{smooth:FamilyTree.scroll.smooth,speed:FamilyTree.scroll.speed}},FamilyTree.isMobile=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},FamilyTree.isTrial=function(){return FamilyTree.remote!==void 0},FamilyTree.childrenCount=function(t,e){for(var i=0,n=0;n<e.childrenIds.length;n++)t.nodes[e.childrenIds[n]]&&i++;return i},FamilyTree.childrenTotalCount=function(t,e){for(var i=0,n=0;n<e.childrenIds.length;n++){var r=t.nodes[e.childrenIds[n]];r&&(i++,i+=FamilyTree.childrenTotalCount(t,r))}return i},FamilyTree.collapsedChildrenCount=function(t,e){for(var i=0,n=0;n<e.childrenIds.length;n++){var r=t.nodes[e.childrenIds[n]];r&&r.collapsed===!0&&i++}return i},FamilyTree.collapsedChildrenTotalCount=function(t,e,i){for(var n=0,r=0;r<e.childrenIds.length;r++){var o=t.nodes[e.childrenIds[r]];o&&((i||o.collapsed===!0)&&n++,n+=FamilyTree.collapsedChildrenTotalCount(t,o,!0))}return n},FamilyTree._setMinMaxXY=function(t,e){(e.minX==null||t.x!=null&&t.x<e.minX)&&(e.minX=t.x),(e.minY==null||t.y!=null&&t.y<e.minY)&&(e.minY=t.y),(e.maxX==null||t.x!=null&&t.x+t.w>e.maxX)&&(e.maxX=t.x+t.w),(e.maxY==null||t.y!=null&&t.y+t.h>e.maxY)&&(e.maxY=t.y+t.h)},FamilyTree.getStParentNodes=function(t,e){for(e||(e=[]);t.parent;)t=t.parent;return t.stParent&&(e.push(t.stParent),FamilyTree.getStParentNodes(t.stParent,e)),e},FamilyTree.getRootOf=function(t){for(;t&&t.parent;)t=t.parent;return t},FamilyTree._getViewBox=function(t){var e=null;return t?(e=(e="["+(e=t.getAttribute("viewBox"))+"]").replace(/\ /g,","),e=JSON.parse(e)):null},FamilyTree.isNEU=function(t){return t==null||t===""},FamilyTree.gradientCircleForDefs=function(t,e,i,n){function r(a,l,s,c){var d=(c-90)*Math.PI/180;return{x:a+s*Math.cos(d),y:l+s*Math.sin(d)}}function o(a,l,s,c,d){var p=r(a,l,s,d),h=r(a,l,s,c),f=d-c<=180?"0":"1";return["M",p.x,p.y,"A",s,s,0,f,0,h.x,h.y].join(" ")}return Array.isArray(e)||(e=[e,e,e,e,e,e]),`<linearGradient id="${t}_linearColors1" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="${e[0]}"></stop>
            <stop offset="100%" stop-color="${e[1]}"></stop>
        </linearGradient>
        <linearGradient id="${t}_linearColors2" x1="0.5" y1="0" x2="0.5" y2="1">
            <stop offset="0%" stop-color="${e[1]}"></stop>
            <stop offset="100%" stop-color="${e[2]}"></stop>
        </linearGradient>
        <linearGradient id="${t}_linearColors3" x1="1" y1="0" x2="0" y2="1">
            <stop offset="0%" stop-color="${e[2]}"></stop>
            <stop offset="100%" stop-color="${e[3]}"></stop>
        </linearGradient>
        <linearGradient id="${t}_linearColors4" x1="1" y1="1" x2="0" y2="0">
            <stop offset="0%" stop-color="${e[3]}"></stop>
            <stop offset="100%" stop-color="${e[4]}"></stop>
        </linearGradient>
        <linearGradient id="${t}_linearColors5" x1="0.5" y1="1" x2="0.5" y2="0">
            <stop offset="0%" stop-color="${e[4]}"></stop>
            <stop offset="100%" stop-color="${e[5]}"></stop>
        </linearGradient>
        <linearGradient id="${t}_linearColors6" x1="0" y1="1" x2="1" y2="0">
            <stop offset="0%" stop-color="${e[5]}"></stop>
            <stop offset="100%" stop-color="${e[0]}"></stop>
        </linearGradient>        
        <g id="${t}">
            <path stroke-width="${n}" fill="none" stroke="url(#${t}_linearColors1)" d="${o(i,i,i,1,60)}"  />
            <path stroke-width="${n}" fill="none" stroke="url(#${t}_linearColors2)" d="${o(i,i,i,60,120)}"/>
            <path stroke-width="${n}" fill="none" stroke="url(#${t}_linearColors3)" d="${o(i,i,i,120,180)}" />
            <path stroke-width="${n}" fill="none" stroke="url(#${t}_linearColors4)" d="${o(i,i,i,180,240)}" />
            <path stroke-width="${n}" fill="none" stroke="url(#${t}_linearColors5)" d="${o(i,i,i,240,300)}" />
            <path stroke-width="${n}" fill="none" stroke="url(#${t}_linearColors6)" d="${o(i,i,i,300,1)}"/>
        </g>`},FamilyTree._intersectionObserver=function(t,e){typeof IntersectionObserver=="function"?new IntersectionObserver(function(i,n){i.forEach(function(r){var o=r.intersectionRatio>0;r.intersectionRatio==0&&(o=r.isIntersecting),e(o)})}).observe(t):e(!0)},FamilyTree.convertCsvToNodes=function(t){for(var e=FamilyTree._csvToArray(t),i=e[0],n=[],r=1;r<e.length;r++){for(var o={},a=0;a<e[r].length;a++){var l=i[a],s=e[r][a];o[i[a]]=FamilyTree._convertStringToArray(l,s)}o.id.trim()!=""&&n.push(o)}return n},FamilyTree._escapeHtml=function(t){return FamilyTree.ESCAPE_HTML&&typeof t=="string"?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):t},FamilyTree._escapeDoubleQuotes=function(t){return typeof t=="string"?t.replace(/"/g,"&quot;"):t},FamilyTree._escapeGreaterLessSign=function(t){return typeof t=="string"?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):t},FamilyTree.roundPathCorners=function(t,e,i){function n(w,S,I){var M=S.x-w.x,N=S.y-w.y,A=Math.sqrt(M*M+N*N);return r(w,S,Math.min(1,I/A))}function r(w,S,I){return{x:w.x+(S.x-w.x)*I,y:w.y+(S.y-w.y)*I}}function o(w,S){w.length>2&&(w[w.length-2]=S.x,w[w.length-1]=S.y)}function a(w){return{x:parseFloat(w[w.length-2]),y:parseFloat(w[w.length-1])}}Array.isArray(t)||(t=(t=t.split(/[,\s]/).reduce(function(w,S){var I=S.match("([a-zA-Z])(.+)");return I?(w.push(I[1]),w.push(I[2])):w.push(S),w},[])).reduce(function(w,S){return parseFloat(S)==S&&w.length?w[w.length-1].push(S):w.push([S]),w},[]));var l=[];if(t.length>1){var s=a(t[0]),c=null;t[t.length-1][0]=="Z"&&t[0].length>2&&(c=["L",s.x,s.y],t[t.length-1]=c),l.push(t[0]);for(var d=1;d<t.length;d++){var p=l[l.length-1],h=t[d],f=h==c?t[1]:t[d+1];if(f&&p&&p.length>2&&h[0]=="L"&&f.length>2&&f[0]=="L"){var m,y,x=a(p),u=a(h),b=a(f);i?(m=r(u,p.origPoint||x,e),y=r(u,f.origPoint||b,e)):(m=n(u,x,e),y=n(u,b,e)),o(h,m),h.origPoint=u,l.push(h);var v=r(m,u,.5),g=r(u,y,.5),_=["C",v.x,v.y,g.x,g.y,y.x,y.y];_.origPoint=u,l.push(_)}else l.push(h)}if(c){var k=a(l[l.length-1]);l.push(["Z"]),o(l[0],k)}}else l=t;return l.reduce(function(w,S){return w+S.join(" ")+" "},"")},FamilyTree._isMoved=function(t){return t.movex!=null||t.movey!=null},FamilyTree._getDynamicGridCoulumns=function(t){for(var e=1;e<t&&(t/e,!(t/e-e<=0));e++);return e%2!=0&&e>2&&e--,e},FamilyTree._changeRootOption=function(t,e,i){for(var n=[],r=0;r<e.length;r++)for(var o=0;o<i.length;o++)if(i[o].has(e[r])){n=i[o];break}for(r=0;r<n.length;r++){var a=t.indexOf(n[r]);a!=-1&&t.splice(a,1)}e.length&&t.push(e[0])},FamilyTree._convertStringToArrayOnImport=function(t,e){return t=="tags"||t=="pids"?FamilyTree.isNEU(e)?[]:e.split(","):e},FamilyTree.isObject=function(t){return t&&typeof t=="object"&&!Array.isArray(t)&&t!==null&&t.constructor&&t.constructor.name.toLowerCase()=="object"},FamilyTree===void 0&&(FamilyTree={}),FamilyTree.icon={},FamilyTree.icon.png=function(t,e,i){return'<svg width="'+t+'" height="'+e+'" viewBox="0 0 550.801 550.801"><path fill="'+i+'" d="M146.747,276.708c0-13.998-9.711-22.352-26.887-22.352c-6.99,0-11.726,0.675-14.204,1.355v44.927 c2.932,0.676,6.539,0.896,11.52,0.896C135.449,301.546,146.747,292.28,146.747,276.708z"/><path fill="'+i+'" d="M488.426,197.019H475.2v-63.816c0-0.398-0.063-0.799-0.116-1.202c-0.021-2.534-0.827-5.023-2.562-6.995L366.325,3.694 c-0.032-0.031-0.063-0.042-0.085-0.076c-0.633-0.707-1.371-1.295-2.151-1.804c-0.231-0.155-0.464-0.285-0.706-0.419 c-0.676-0.369-1.393-0.675-2.131-0.896c-0.2-0.056-0.38-0.138-0.58-0.19C359.87,0.119,359.037,0,358.193,0H97.2 c-11.918,0-21.6,9.693-21.6,21.601v175.413H62.377c-17.049,0-30.873,13.818-30.873,30.873v160.545 c0,17.043,13.824,30.87,30.873,30.87h13.224V529.2c0,11.907,9.682,21.601,21.6,21.601h356.4c11.907,0,21.6-9.693,21.6-21.601 V419.302h13.226c17.044,0,30.871-13.827,30.871-30.87v-160.54C519.297,210.838,505.47,197.019,488.426,197.019z M97.2,21.605 h250.193v110.513c0,5.967,4.841,10.8,10.8,10.8h95.407v54.108H97.2V21.605z M234.344,335.86v45.831h-31.601V229.524h40.184 l31.611,55.759c9.025,16.031,18.064,34.983,24.825,52.154h0.675c-2.257-20.103-2.933-40.643-2.933-63.44v-44.473h31.614v152.167 h-36.117l-32.516-58.703c-9.049-16.253-18.971-35.892-26.438-53.727l-0.665,0.222C233.906,289.58,234.344,311.027,234.344,335.86z M71.556,381.691V231.56c10.613-1.804,25.516-3.159,46.506-3.159c21.215,0,36.353,4.061,46.509,12.192 c9.698,7.673,16.255,20.313,16.255,35.219c0,14.897-4.959,27.549-13.999,36.123c-11.738,11.063-29.123,16.031-49.441,16.031 c-4.522,0-8.593-0.231-11.736-0.675v54.411H71.556V381.691z M453.601,523.353H97.2V419.302h356.4V523.353z M485.652,374.688 c-10.61,3.607-30.713,8.585-50.805,8.585c-27.759,0-47.872-7.003-61.857-20.545c-13.995-13.1-21.684-32.97-21.452-55.318 c0.222-50.569,37.03-79.463,86.917-79.463c19.644,0,34.783,3.829,42.219,7.446l-7.214,27.543c-8.369-3.617-18.752-6.55-35.458-6.55 c-28.656,0-50.341,16.256-50.341,49.22c0,31.382,19.649,49.892,47.872,49.892c7.895,0,14.218-0.901,16.934-2.257v-31.835h-23.493 v-26.869h56.679V374.688z"/></svg>'},FamilyTree.icon.pdf=function(t,e,i){return'<svg width="'+t+'" height="'+e+'" viewBox="0 0 550.801 550.801"><path fill="'+i+'" d="M160.381,282.225c0-14.832-10.299-23.684-28.474-23.684c-7.414,0-12.437,0.715-15.071,1.432V307.6 c3.114,0.707,6.942,0.949,12.192,0.949C148.419,308.549,160.381,298.74,160.381,282.225z"/><path fill="'+i+'" d="M272.875,259.019c-8.145,0-13.397,0.717-16.519,1.435v105.523c3.116,0.729,8.142,0.729,12.69,0.729 c33.017,0.231,54.554-17.946,54.554-56.474C323.842,276.719,304.215,259.019,272.875,259.019z"/><path fill="'+i+'" d="M488.426,197.019H475.2v-63.816c0-0.398-0.063-0.799-0.116-1.202c-0.021-2.534-0.827-5.023-2.562-6.995L366.325,3.694 c-0.032-0.031-0.063-0.042-0.085-0.076c-0.633-0.707-1.371-1.295-2.151-1.804c-0.231-0.155-0.464-0.285-0.706-0.419 c-0.676-0.369-1.393-0.675-2.131-0.896c-0.2-0.056-0.38-0.138-0.58-0.19C359.87,0.119,359.037,0,358.193,0H97.2 c-11.918,0-21.6,9.693-21.6,21.601v175.413H62.377c-17.049,0-30.873,13.818-30.873,30.873v160.545 c0,17.043,13.824,30.87,30.873,30.87h13.224V529.2c0,11.907,9.682,21.601,21.6,21.601h356.4c11.907,0,21.6-9.693,21.6-21.601 V419.302h13.226c17.044,0,30.871-13.827,30.871-30.87v-160.54C519.297,210.838,505.47,197.019,488.426,197.019z M97.2,21.605 h250.193v110.513c0,5.967,4.841,10.8,10.8,10.8h95.407v54.108H97.2V21.605z M362.359,309.023c0,30.876-11.243,52.165-26.82,65.333 c-16.971,14.117-42.82,20.814-74.396,20.814c-18.9,0-32.297-1.197-41.401-2.389V234.365c13.399-2.149,30.878-3.346,49.304-3.346 c30.612,0,50.478,5.508,66.039,17.226C351.828,260.69,362.359,280.547,362.359,309.023z M80.7,393.499V234.365 c11.241-1.904,27.042-3.346,49.296-3.346c22.491,0,38.527,4.308,49.291,12.928c10.292,8.131,17.215,21.534,17.215,37.328 c0,15.799-5.25,29.198-14.829,38.285c-12.442,11.728-30.865,16.996-52.407,16.996c-4.778,0-9.1-0.243-12.435-0.723v57.67H80.7 V393.499z M453.601,523.353H97.2V419.302h356.4V523.353z M484.898,262.127h-61.989v36.851h57.913v29.674h-57.913v64.848h-36.593 V232.216h98.582V262.127z"/></svg>'},FamilyTree.icon.svg=function(t,e,i){return'<svg width="'+t+'" height="'+e+'" viewBox="0 0 550.801 550.801"><path fill="'+i+'" d="M488.426,197.019H475.2v-63.816c0-0.398-0.063-0.799-0.116-1.202c-0.021-2.534-0.827-5.023-2.562-6.995L366.325,3.694 c-0.032-0.031-0.063-0.042-0.085-0.076c-0.633-0.707-1.371-1.295-2.151-1.804c-0.231-0.155-0.464-0.285-0.706-0.419 c-0.676-0.369-1.393-0.675-2.131-0.896c-0.2-0.056-0.38-0.138-0.58-0.19C359.87,0.119,359.037,0,358.193,0H97.2 c-11.918,0-21.6,9.693-21.6,21.601v175.413H62.377c-17.049,0-30.873,13.818-30.873,30.873v160.545 c0,17.043,13.824,30.87,30.873,30.87h13.224V529.2c0,11.907,9.682,21.601,21.6,21.601h356.4c11.907,0,21.6-9.693,21.6-21.601 V419.302h13.226c17.044,0,30.871-13.827,30.871-30.87v-160.54C519.297,210.838,505.47,197.019,488.426,197.019z M97.2,21.605 h250.193v110.513c0,5.967,4.841,10.8,10.8,10.8h95.407v54.108H97.2V21.605z M338.871,225.672L284.545,386.96h-42.591 l-51.69-161.288h39.967l19.617,68.196c5.508,19.143,10.531,37.567,14.36,57.67h0.717c4.061-19.385,9.089-38.527,14.592-56.953 l20.585-68.918h38.77V225.672z M68.458,379.54l7.415-30.153c9.811,5.021,24.888,10.051,40.439,10.051 c16.751,0,25.607-6.935,25.607-17.465c0-10.052-7.662-15.795-27.05-22.734c-26.8-9.328-44.263-24.168-44.263-47.611 c0-27.524,22.971-48.579,61.014-48.579c18.188,0,31.591,3.823,41.159,8.131l-8.126,29.437c-6.465-3.116-17.945-7.657-33.745-7.657 c-15.791,0-23.454,7.183-23.454,15.552c0,10.296,9.089,14.842,29.917,22.731c28.468,10.536,41.871,25.365,41.871,48.094 c0,27.042-20.812,50.013-65.09,50.013C95.731,389.349,77.538,384.571,68.458,379.54z M453.601,523.353H97.2V419.302h356.4V523.353z M488.911,379.54c-11.243,3.823-32.537,9.103-53.831,9.103c-29.437,0-50.73-7.426-65.57-21.779 c-14.839-13.875-22.971-34.942-22.738-58.625c0.253-53.604,39.255-84.235,92.137-84.235c20.81,0,36.852,4.073,44.74,7.896 l-7.657,29.202c-8.859-3.829-19.849-6.95-37.567-6.95c-30.396,0-53.357,17.233-53.357,52.173c0,33.265,20.81,52.882,50.73,52.882 c8.375,0,15.072-0.96,17.94-2.395v-33.745h-24.875v-28.471h60.049V379.54L488.911,379.54z" /></svg>'},FamilyTree.icon.csv=function(t,e,i){return'<svg width="'+t+'" height="'+e+'" viewBox="0 0 548.29 548.291" ><path fill="'+i+'" d="M486.2,196.121h-13.164V132.59c0-0.399-0.064-0.795-0.116-1.2c-0.021-2.52-0.824-5-2.551-6.96L364.656,3.677 c-0.031-0.034-0.064-0.044-0.085-0.075c-0.629-0.707-1.364-1.292-2.141-1.796c-0.231-0.157-0.462-0.286-0.704-0.419 c-0.672-0.365-1.386-0.672-2.121-0.893c-0.199-0.052-0.377-0.134-0.576-0.188C358.229,0.118,357.4,0,356.562,0H96.757 C84.893,0,75.256,9.649,75.256,21.502v174.613H62.093c-16.972,0-30.733,13.756-30.733,30.73v159.81 c0,16.966,13.761,30.736,30.733,30.736h13.163V526.79c0,11.854,9.637,21.501,21.501,21.501h354.777 c11.853,0,21.502-9.647,21.502-21.501V417.392H486.2c16.966,0,30.729-13.764,30.729-30.731v-159.81 C516.93,209.872,503.166,196.121,486.2,196.121z M96.757,21.502h249.053v110.006c0,5.94,4.818,10.751,10.751,10.751h94.973v53.861 H96.757V21.502z M258.618,313.18c-26.68-9.291-44.063-24.053-44.063-47.389c0-27.404,22.861-48.368,60.733-48.368 c18.107,0,31.447,3.811,40.968,8.107l-8.09,29.3c-6.43-3.107-17.862-7.632-33.59-7.632c-15.717,0-23.339,7.149-23.339,15.485 c0,10.247,9.047,14.769,29.78,22.632c28.341,10.479,41.681,25.239,41.681,47.874c0,26.909-20.721,49.786-64.792,49.786 c-18.338,0-36.449-4.776-45.497-9.77l7.38-30.016c9.772,5.014,24.775,10.006,40.264,10.006c16.671,0,25.488-6.908,25.488-17.396 C285.536,325.789,277.909,320.078,258.618,313.18z M69.474,302.692c0-54.781,39.074-85.269,87.654-85.269 c18.822,0,33.113,3.811,39.549,7.149l-7.392,28.816c-7.38-3.084-17.632-5.939-30.491-5.939c-28.822,0-51.206,17.375-51.206,53.099 c0,32.158,19.051,52.4,51.456,52.4c10.947,0,23.097-2.378,30.241-5.238l5.483,28.346c-6.672,3.34-21.674,6.919-41.208,6.919 C98.06,382.976,69.474,348.424,69.474,302.692z M451.534,520.962H96.757v-103.57h354.777V520.962z M427.518,380.583h-42.399 l-51.45-160.536h39.787l19.526,67.894c5.479,19.046,10.479,37.386,14.299,57.397h0.709c4.048-19.298,9.045-38.352,14.526-56.693 l20.487-68.598h38.599L427.518,380.583z" /></svg>'},FamilyTree.icon.json=function(t,e,i){return'<svg width="'+t+'" height="'+e+'" viewBox="0 0 32 32" ><polygon fill="'+i+'"  points="31 11 31 21 29 21 27 15 27 21 25 21 25 11 27 11 29 17 29 11 31 11"/><path fill="'+i+'"  d="M21.3335,21h-2.667A1.6684,1.6684,0,0,1,17,19.3335v-6.667A1.6684,1.6684,0,0,1,18.6665,11h2.667A1.6684,1.6684,0,0,1,23,12.6665v6.667A1.6684,1.6684,0,0,1,21.3335,21ZM19,19h2V13H19Z"/><path fill="'+i+'"  d="M13.3335,21H9V19h4V17H11a2.002,2.002,0,0,1-2-2V12.6665A1.6684,1.6684,0,0,1,10.6665,11H15v2H11v2h2a2.002,2.002,0,0,1,2,2v2.3335A1.6684,1.6684,0,0,1,13.3335,21Z"/><path fill="'+i+'"  d="M5.3335,21H2.6665A1.6684,1.6684,0,0,1,1,19.3335V17H3v2H5V11H7v8.3335A1.6684,1.6684,0,0,1,5.3335,21Z"/><rect fill="'+i+'"  id="_Transparent_Rectangle_" data-name="&lt;Transparent Rectangle&gt;" style="fill: none;" width="32" height="32"/></svg>'},FamilyTree.icon.excel=function(t,e,i){return'<svg width="'+t+'" height="'+e+'" viewBox="0 0 512 512"><path fill="#ECEFF1" d="M496,432.011H272c-8.832,0-16-7.168-16-16s0-311.168,0-320s7.168-16,16-16h224 c8.832,0,16,7.168,16,16v320C512,424.843,504.832,432.011,496,432.011z" /><path fill="'+i+'" d="M336,176.011h-64c-8.832,0-16-7.168-16-16s7.168-16,16-16h64c8.832,0,16,7.168,16,16 S344.832,176.011,336,176.011z" /><path fill="'+i+'" d="M336,240.011h-64c-8.832,0-16-7.168-16-16s7.168-16,16-16h64c8.832,0,16,7.168,16,16 S344.832,240.011,336,240.011z" /><path fill="'+i+'" d="M336,304.011h-64c-8.832,0-16-7.168-16-16s7.168-16,16-16h64c8.832,0,16,7.168,16,16 S344.832,304.011,336,304.011z" /><path fill="'+i+'" d="M336,368.011h-64c-8.832,0-16-7.168-16-16s7.168-16,16-16h64c8.832,0,16,7.168,16,16 S344.832,368.011,336,368.011z" /><path fill="'+i+'" d="M432,176.011h-32c-8.832,0-16-7.168-16-16s7.168-16,16-16h32c8.832,0,16,7.168,16,16 S440.832,176.011,432,176.011z" /><path fill="'+i+'" d="M432,240.011h-32c-8.832,0-16-7.168-16-16s7.168-16,16-16h32c8.832,0,16,7.168,16,16 S440.832,240.011,432,240.011z" /><path fill="'+i+'" d="M432,304.011h-32c-8.832,0-16-7.168-16-16s7.168-16,16-16h32c8.832,0,16,7.168,16,16 S440.832,304.011,432,304.011z" /><path fill="'+i+'" d="M432,368.011h-32c-8.832,0-16-7.168-16-16s7.168-16,16-16h32c8.832,0,16,7.168,16,16 S440.832,368.011,432,368.011z" /><path fill="'+i+'"  d="M282.208,19.691c-3.648-3.04-8.544-4.352-13.152-3.392l-256,48C5.472,65.707,0,72.299,0,80.011v352 c0,7.68,5.472,14.304,13.056,15.712l256,48c0.96,0.192,1.952,0.288,2.944,0.288c3.712,0,7.328-1.28,10.208-3.68 c3.68-3.04,5.792-7.584,5.792-12.32v-448C288,27.243,285.888,22.731,282.208,19.691z" /><path fill="#FAFAFA" d="M220.032,309.483l-50.592-57.824l51.168-65.792c5.44-6.976,4.16-17.024-2.784-22.464 c-6.944-5.44-16.992-4.16-22.464,2.784l-47.392,60.928l-39.936-45.632c-5.856-6.72-15.968-7.328-22.56-1.504 c-6.656,5.824-7.328,15.936-1.504,22.56l44,50.304L83.36,310.187c-5.44,6.976-4.16,17.024,2.784,22.464 c2.944,2.272,6.432,3.36,9.856,3.36c4.768,0,9.472-2.112,12.64-6.176l40.8-52.48l46.528,53.152 c3.168,3.648,7.584,5.504,12.032,5.504c3.744,0,7.488-1.312,10.528-3.968C225.184,326.219,225.856,316.107,220.032,309.483z" /></svg>'},FamilyTree.icon.edit=function(t,e,i){return'<svg width="'+t+'" height="'+e+'" viewBox="0 0 528.899 528.899"><path fill="'+i+'" d="M328.883,89.125l107.59,107.589l-272.34,272.34L56.604,361.465L328.883,89.125z M518.113,63.177l-47.981-47.981 c-18.543-18.543-48.653-18.543-67.259,0l-45.961,45.961l107.59,107.59l53.611-53.611 C532.495,100.753,532.495,77.559,518.113,63.177z M0.3,512.69c-1.958,8.812,5.998,16.708,14.811,14.565l119.891-29.069 L27.473,390.597L0.3,512.69z" /></svg>'},FamilyTree.icon.details=function(t,e,i){return'<svg width="'+t+'" height="'+e+'" viewBox="0 0 512 512"><path fill="'+i+'" d="M447.933,103.629c-0.034-3.076-1.224-6.09-3.485-8.352L352.683,3.511c-0.004-0.004-0.007-0.005-0.011-0.008 C350.505,1.338,347.511,0,344.206,0H89.278C75.361,0,64.04,11.32,64.04,25.237v461.525c0,13.916,11.32,25.237,25.237,25.237 h333.444c13.916,0,25.237-11.32,25.237-25.237V103.753C447.96,103.709,447.937,103.672,447.933,103.629z M356.194,40.931 l50.834,50.834h-49.572c-0.695,0-1.262-0.567-1.262-1.262V40.931z M423.983,486.763c0,0.695-0.566,1.261-1.261,1.261H89.278 c-0.695,0-1.261-0.566-1.261-1.261V25.237c0-0.695,0.566-1.261,1.261-1.261h242.94v66.527c0,13.916,11.322,25.239,25.239,25.239 h66.527V486.763z"/><path fill="'+i+'" d="M362.088,164.014H149.912c-6.62,0-11.988,5.367-11.988,11.988c0,6.62,5.368,11.988,11.988,11.988h212.175 c6.62,0,11.988-5.368,11.988-11.988C374.076,169.381,368.707,164.014,362.088,164.014z"/><path fill="'+i+'" d="M362.088,236.353H149.912c-6.62,0-11.988,5.368-11.988,11.988c0,6.62,5.368,11.988,11.988,11.988h212.175 c6.62,0,11.988-5.368,11.988-11.988C374.076,241.721,368.707,236.353,362.088,236.353z"/><path fill="'+i+'" d="M362.088,308.691H149.912c-6.62,0-11.988,5.368-11.988,11.988c0,6.621,5.368,11.988,11.988,11.988h212.175 c6.62,0,11.988-5.367,11.988-11.988C374.076,314.06,368.707,308.691,362.088,308.691z"/><path fill="'+i+'" d="M256,381.031H149.912c-6.62,0-11.988,5.368-11.988,11.988c0,6.621,5.368,11.988,11.988,11.988H256 c6.62,0,11.988-5.367,11.988-11.988C267.988,386.398,262.62,381.031,256,381.031z"/></svg>'},FamilyTree.icon.remove=function(t,e,i){return'<svg width="'+t+'" height="'+e+'"  viewBox="0 0 900.5 900.5"><path fill="'+i+'" d="M176.415,880.5c0,11.046,8.954,20,20,20h507.67c11.046,0,20-8.954,20-20V232.487h-547.67V880.5L176.415,880.5z M562.75,342.766h75v436.029h-75V342.766z M412.75,342.766h75v436.029h-75V342.766z M262.75,342.766h75v436.029h-75V342.766z"/><path fill="'+i+'" d="M618.825,91.911V20c0-11.046-8.954-20-20-20h-297.15c-11.046,0-20,8.954-20,20v71.911v12.5v12.5H141.874 c-11.046,0-20,8.954-20,20v50.576c0,11.045,8.954,20,20,20h34.541h547.67h34.541c11.046,0,20-8.955,20-20v-50.576 c0-11.046-8.954-20-20-20H618.825v-12.5V91.911z M543.825,112.799h-187.15v-8.389v-12.5V75h187.15v16.911v12.5V112.799z"/></svg>'},FamilyTree.icon.add=function(t,e,i){return'<svg width="'+t+'" height="'+e+'"   viewBox="0 0 922 922"><path fill="'+i+'" d="M922,453V81c0-11.046-8.954-20-20-20H410c-11.045,0-20,8.954-20,20v149h318c24.812,0,45,20.187,45,45v198h149 C913.046,473.001,922,464.046,922,453z" /><path fill="'+i+'" d="M557,667.001h151c11.046,0,20-8.954,20-20v-174v-198c0-11.046-8.954-20-20-20H390H216c-11.045,0-20,8.954-20,20v149h194 h122c24.812,0,45,20.187,45,45v4V667.001z" /><path fill="'+i+'" d="M0,469v372c0,11.046,8.955,20,20,20h492c11.046,0,20-8.954,20-20V692v-12.501V667V473v-4c0-11.046-8.954-20-20-20H390H196 h-12.5H171H20C8.955,449,0,457.955,0,469z" /></svg>'},FamilyTree.icon.search=function(t,e,i){return'<svg width="'+t+'" height="'+e+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 485.213 485.213"><path fill="'+i+'" d="M471.882,407.567L360.567,296.243c-16.586,25.795-38.536,47.734-64.331,64.321l111.324,111.324 c17.772,17.768,46.587,17.768,64.321,0C489.654,454.149,489.654,425.334,471.882,407.567z" /><path fill="'+i+'" d="M363.909,181.955C363.909,81.473,282.44,0,181.956,0C81.474,0,0.001,81.473,0.001,181.955s81.473,181.951,181.955,181.951 C282.44,363.906,363.909,282.437,363.909,181.955z M181.956,318.416c-75.252,0-136.465-61.208-136.465-136.46 c0-75.252,61.213-136.465,136.465-136.465c75.25,0,136.468,61.213,136.468,136.465 C318.424,257.208,257.206,318.416,181.956,318.416z" /><path fill="'+i+'" d="M75.817,181.955h30.322c0-41.803,34.014-75.814,75.816-75.814V75.816C123.438,75.816,75.817,123.437,75.817,181.955z" /></svg>'},FamilyTree.icon.xml=function(t,e,i){return'<svg width="'+t+'" height="'+e+'" viewBox="0 0 550.801 550.801"><path fill="'+i+'"  d="M488.426,197.019H475.2v-63.816c0-0.401-0.063-0.799-0.116-1.205c-0.021-2.534-0.827-5.023-2.562-6.992L366.325,3.691 c-0.032-0.031-0.063-0.042-0.085-0.073c-0.633-0.707-1.371-1.298-2.151-1.804c-0.231-0.158-0.464-0.287-0.706-0.422 c-0.676-0.366-1.393-0.675-2.131-0.896c-0.2-0.053-0.38-0.135-0.58-0.19C359.87,0.119,359.037,0,358.193,0H97.2 c-11.918,0-21.6,9.693-21.6,21.601v175.413H62.377c-17.049,0-30.873,13.818-30.873,30.87v160.542 c0,17.044,13.824,30.876,30.873,30.876h13.224V529.2c0,11.907,9.682,21.601,21.6,21.601h356.4c11.907,0,21.6-9.693,21.6-21.601 V419.302h13.226c17.044,0,30.871-13.827,30.871-30.87V227.89C519.297,210.838,505.47,197.019,488.426,197.019z M97.2,21.605 h250.193v110.51c0,5.967,4.841,10.8,10.8,10.8h95.407v54.108H97.2V21.605z M369.531,374.53h-32.058l-2.156-55.519 c-0.644-17.434-1.298-38.518-1.298-59.611h-0.633c-4.514,18.516-10.547,39.166-16.137,56.162l-17.645,56.601h-25.618 l-15.494-56.157c-4.725-16.996-9.671-37.658-13.123-56.6h-0.43c-0.854,19.585-1.508,41.961-2.586,60.038l-2.576,55.086h-30.343 l9.26-145.035h43.677l14.207,48.421c4.517,16.774,9.041,34.847,12.258,51.843h0.654c4.081-16.77,9.038-35.923,13.774-52.064 l15.493-48.199h42.82L369.531,374.53z M69.992,374.53l41.955-73.385l-40.444-71.65h37.655l12.688,26.465 c4.316,8.828,7.533,15.928,10.99,24.092h0.422c3.438-9.242,6.23-15.694,9.893-24.092l12.274-26.465h37.434l-40.89,70.796 l43.044,74.239h-37.866l-13.134-26.257c-5.376-10.108-8.817-17.639-12.909-26.04h-0.433c-3.009,8.401-6.674,15.932-11.19,26.04 l-12.042,26.257H69.992z M453.601,523.353H97.2V419.302h356.4V523.353z M485.325,374.53h-90.608V229.495h32.933v117.497h57.682 v27.538H485.325z"/></svg>'},FamilyTree.icon.link=function(t,e,i){return'<svg width="'+t+'" height="'+e+'" viewBox="0 0 512.092 512.092"  ><path fill="'+i+'" d="M312.453,199.601c-6.066-6.102-12.792-11.511-20.053-16.128c-19.232-12.315-41.59-18.859-64.427-18.859 c-31.697-0.059-62.106,12.535-84.48,34.987L34.949,308.23c-22.336,22.379-34.89,52.7-34.91,84.318 c-0.042,65.98,53.41,119.501,119.39,119.543c31.648,0.11,62.029-12.424,84.395-34.816l89.6-89.6 c1.628-1.614,2.537-3.816,2.524-6.108c-0.027-4.713-3.87-8.511-8.583-8.484h-3.413c-18.72,0.066-37.273-3.529-54.613-10.581 c-3.195-1.315-6.867-0.573-9.301,1.877l-64.427,64.512c-20.006,20.006-52.442,20.006-72.448,0 c-20.006-20.006-20.006-52.442,0-72.448l108.971-108.885c19.99-19.965,52.373-19.965,72.363,0 c13.472,12.679,34.486,12.679,47.957,0c5.796-5.801,9.31-13.495,9.899-21.675C322.976,216.108,319.371,206.535,312.453,199.601z" /><path fill="'+i+'" d="M477.061,34.993c-46.657-46.657-122.303-46.657-168.96,0l-89.515,89.429c-2.458,2.47-3.167,6.185-1.792,9.387 c1.359,3.211,4.535,5.272,8.021,5.205h3.157c18.698-0.034,37.221,3.589,54.528,10.667c3.195,1.315,6.867,0.573,9.301-1.877 l64.256-64.171c20.006-20.006,52.442-20.006,72.448,0c20.006,20.006,20.006,52.442,0,72.448l-80.043,79.957l-0.683,0.768 l-27.989,27.819c-19.99,19.965-52.373,19.965-72.363,0c-13.472-12.679-34.486-12.679-47.957,0 c-5.833,5.845-9.35,13.606-9.899,21.845c-0.624,9.775,2.981,19.348,9.899,26.283c9.877,9.919,21.433,18.008,34.133,23.893 c1.792,0.853,3.584,1.536,5.376,2.304c1.792,0.768,3.669,1.365,5.461,2.048c1.792,0.683,3.669,1.28,5.461,1.792l5.035,1.365 c3.413,0.853,6.827,1.536,10.325,2.133c4.214,0.626,8.458,1.025,12.715,1.195h5.973h0.512l5.12-0.597 c1.877-0.085,3.84-0.512,6.059-0.512h2.901l5.888-0.853l2.731-0.512l4.949-1.024h0.939c20.961-5.265,40.101-16.118,55.381-31.403 l108.629-108.629C523.718,157.296,523.718,81.65,477.061,34.993z" /></svg>'},FamilyTree.icon.happy=function(t,e,i){return'<svg width="'+t+'" height="'+e+'" viewBox="0 0 512 512"><path fill="'+i+'" d="M256,0C114.615,0,0,114.615,0,256s114.615,256,256,256s256-114.615,256-256S397.385,0,256,0z M256,480 C132.288,480,32,379.712,32,256S132.288,32,256,32s224,100.288,224,224S379.712,480,256,480z"/><path fill="'+i+'" d="M176,176c17.673,0,32,14.327,32,32h32c0-35.346-28.654-64-64-64c-35.346,0-64,28.654-64,64h32 C144,190.327,158.327,176,176,176z"/><path fill="'+i+'" d="M336,144c-35.346,0-64,28.654-64,64h32c0-17.673,14.327-32,32-32c17.673,0,32,14.327,32,32h32 C400,172.654,371.346,144,336,144z"/><path fill="'+i+'" d="M256,368c-53.019,0-96-42.981-96-96h-32c0,70.692,57.308,128,128,128s128-57.308,128-128h-32 C352,325.019,309.019,368,256,368z"/></svg>'},FamilyTree.icon.sad=function(t,e,i){return'<svg width="'+t+'" height="'+e+'" viewBox="0 0 512 512"><path fill="'+i+'" d="M256,0C114.615,0,0,114.615,0,256s114.615,256,256,256s256-114.615,256-256S397.385,0,256,0z M256,480 C132.288,480,32,379.712,32,256S132.288,32,256,32s224,100.288,224,224S379.712,480,256,480z"/><path fill="'+i+'" d="M336,192c-17.673,0-32-14.327-32-32h-32c0,35.346,28.654,64,64,64c35.346,0,64-28.654,64-64h-32 C368,177.673,353.673,192,336,192z"/><path fill="'+i+'" d="M176,224c35.346,0,64-28.654,64-64h-32c0,17.673-14.327,32-32,32s-32-14.327-32-32h-32C112,195.346,140.654,224,176,224z "/><path fill="'+i+'" d="M256,256c-70.692,0-128,57.308-128,128h32c0-53.019,42.981-96,96-96s96,42.981,96,96h32C384,313.308,326.692,256,256,256 z"/></svg>'},FamilyTree.icon.share=function(t,e,i,n,r){return n==null&&(n=0),r==null&&(r=0),`<svg width="${t}" height="${e}" x="${n}" y="${r}" viewBox="0 0 512 512">
                <path fill="${i}" d="M406,332c-29.641,0-55.761,14.581-72.167,36.755L191.99,296.124c2.355-8.027,4.01-16.346,4.01-25.124
                    c0-11.906-2.441-23.225-6.658-33.636l148.445-89.328C354.307,167.424,378.589,180,406,180c49.629,0,90-40.371,90-90
                    c0-49.629-40.371-90-90-90c-49.629,0-90,40.371-90,90c0,11.437,2.355,22.286,6.262,32.358l-148.887,89.59
                    C156.869,193.136,132.937,181,106,181c-49.629,0-90,40.371-90,90c0,49.629,40.371,90,90,90c30.13,0,56.691-15.009,73.035-37.806
                    l141.376,72.395C317.807,403.995,316,412.75,316,422c0,49.629,40.371,90,90,90c49.629,0,90-40.371,90-90
                    C496,372.371,455.629,332,406,332z"/>
                </svg>`},FamilyTree.icon.user=function(t,e,i,n,r){return FamilyTree.isNEU(n)&&(n=0),FamilyTree.isNEU(r)&&(r=0),`<svg width="${t}" height="${e}" x="${n}" y="${r}" viewBox="0 0 24 24">
                <path fill="${i}" d="M12 11.796C14.7189 11.796 16.9231 9.60308 16.9231 6.89801C16.9231 4.19294 14.7189 2.00005 12 2.00005C9.28106 2.00005 7.07692 4.19294 7.07692 6.89801C7.07692 9.60308 9.28106 11.796 12 11.796Z" fill="#030D45"/>
                <path fill="${i}" d="M14.5641 13.8369H9.4359C6.46154 13.8369 4 16.2859 4 19.245C4 19.9593 4.30769 20.5716 4.92308 20.8777C5.84615 21.3879 7.89744 22.0001 12 22.0001C16.1026 22.0001 18.1538 21.3879 19.0769 20.8777C19.5897 20.5716 20 19.9593 20 19.245C20 16.1838 17.5385 13.8369 14.5641 13.8369Z" fill="#030D45"/>
            </svg>`},FamilyTree.icon.close=function(t,e,i,n,r){return n==null&&(n=0),r==null&&(r=0),`<svg width="${t}" height="${e}" x="${n}" y="${r}" viewBox="0 0 512 512">
    <path fill="${i}" d="m256 0c-141.49 0-256 114.5-256 256 0 141.49 114.5 256 256 256 141.49 0 256-114.5 256-256 0-141.49-114.5-256-256-256zm-12.284 317.397-58.121 58.132c-6.565 6.553-15.283 10.166-24.557 10.166-19.196 0-34.734-15.526-34.734-34.734 0-9.274 3.612-17.992 10.166-24.557l58.132-58.121c6.785-6.784 6.785-17.783 0-24.568l-58.132-58.121c-6.553-6.565-10.166-15.283-10.166-24.557 0-19.196 15.526-34.734 34.734-34.734 9.274 0 17.992 3.613 24.557 10.166l58.121 58.132c6.785 6.773 17.784 6.773 24.568 0l58.121-58.132c6.565-6.553 15.283-10.166 24.557-10.166 19.196 0 34.734 15.526 34.734 34.734 0 9.274-3.612 17.992-10.166 24.557l-58.132 58.121c-6.785 6.784-6.785 17.783 0 24.568l58.132 58.121c6.553 6.565 10.166 15.283 10.166 24.557 0 19.196-15.526 34.734-34.734 34.734-9.274 0-17.992-3.613-24.557-10.166l-58.121-58.132c-6.784-6.784-17.784-6.773-24.568 0z"/>
    </svg>`},FamilyTree.icon.undo=function(t,e,i,n,r){return n==null&&(n=0),r==null&&(r=0),`<svg width="${t}" height="${e}" x="${n}" y="${r}" viewBox="0 0 24 24">
    <path fill-rule="evenodd" clip-rule="evenodd" fill="${i}" d="M3.46447 3.46447C2 4.92893 2 7.28595 2 12C2 16.714 2 19.0711 3.46447 20.5355C4.92893 22 7.28595 22 12 22C16.714 22 19.0711 22 20.5355 20.5355C22 19.0711 22 16.7141 22 12C22 7.28598 22 4.92893 20.5355 3.46447C19.0711 2 16.714 2 12 2C7.28595 2 4.92893 2 3.46447 3.46447ZM9.25871 7.97395C9.56308 7.693 9.58205 7.21851 9.3011 6.91414C9.02015 6.60978 8.54565 6.5908 8.24129 6.87175L5.99129 8.94867C5.83748 9.09065 5.75 9.29045 5.75 9.49977C5.75 9.7091 5.83748 9.9089 5.99129 10.0509L8.24129 12.1278C8.54565 12.4088 9.02015 12.3898 9.3011 12.0854C9.58205 11.781 9.56308 11.3065 9.25871 11.0256L8.41824 10.2498H14.0385C14.7376 10.2498 15.2069 10.2506 15.5652 10.2862C15.9116 10.3205 16.0724 10.3813 16.1787 10.4501C16.3272 10.5461 16.4537 10.6726 16.5497 10.8211C16.6184 10.9274 16.6793 11.0882 16.7136 11.4345C16.7491 11.7929 16.75 12.2622 16.75 12.9613C16.75 13.6604 16.7491 14.1298 16.7136 14.4881C16.6793 14.8344 16.6185 14.9952 16.5497 15.1015C16.4537 15.2501 16.3272 15.3765 16.1787 15.4726C16.0724 15.5413 15.9116 15.6021 15.5652 15.6365C15.2069 15.672 14.7376 15.6729 14.0385 15.6729H9.5C9.08579 15.6729 8.75 16.0086 8.75 16.4229C8.75 16.8371 9.08579 17.1729 9.5 17.1729H14.0758C14.7279 17.1729 15.2721 17.1729 15.7133 17.1291C16.1748 17.0834 16.6038 16.9839 16.9931 16.7322C17.3199 16.5209 17.5981 16.2427 17.8094 15.916C18.0611 15.5266 18.1605 15.0976 18.2063 14.6361C18.25 14.195 18.25 13.6508 18.25 12.9987V12.924C18.25 12.2718 18.25 11.7276 18.2063 11.2865C18.1605 10.825 18.0611 10.396 17.8093 10.0067C17.5981 9.6799 17.3199 9.40169 16.9931 9.19042C16.6038 8.9387 16.1748 8.83927 15.7133 8.7935C15.2721 8.74975 14.7279 8.74976 14.0758 8.74977L8.41824 8.74977L9.25871 7.97395Z" />
    <rect style="opacity: 0" x="2" y="2" width="20" height="20"></rect>
    </svg>`},FamilyTree.icon.redo=function(t,e,i,n,r){return n==null&&(n=0),r==null&&(r=0),`<svg width="${t}" height="${e}" x="${n}" y="${r}" viewBox="0 0 24 24" >
    <path fill="#f9f9f9" fill-rule="evenodd" clip-rule="evenodd" fill="${i}" d="M3.46447 3.46447C2 4.92893 2 7.28595 2 12C2 16.714 2 19.0711 3.46447 20.5355C4.92893 22 7.28595 22 12 22C16.714 22 19.0711 22 20.5355 20.5355C22 19.0711 22 16.7141 22 12C22 7.28598 22 4.92893 20.5355 3.46447C19.0711 2 16.714 2 12 2C7.28595 2 4.92893 2 3.46447 3.46447ZM15.7587 6.87273C15.4543 6.59177 14.9799 6.61075 14.6989 6.91512C14.4179 7.21948 14.4369 7.69398 14.7413 7.97493L15.5818 8.75075H9.96155C7.63558 8.75075 5.75 10.6363 5.75 12.9623C5.75 15.2883 7.63557 17.1738 9.96154 17.1738H14.5C14.9142 17.1738 15.25 16.838 15.25 16.4238C15.25 16.0096 14.9142 15.6738 14.5 15.6738H9.96154C8.464 15.6738 7.25 14.4598 7.25 12.9623C7.25 11.4647 8.464 10.2508 9.96155 10.2508H15.5818L14.7413 11.0266C14.4369 11.3075 14.4179 11.782 14.6989 12.0864C14.9799 12.3908 15.4543 12.4097 15.7587 12.1288L18.0087 10.0519C18.1625 9.90987 18.25 9.71007 18.25 9.50075C18.25 9.29143 18.1625 9.09163 18.0087 8.94965L15.7587 6.87273Z"/>
    <rect style="opacity: 0" x="2" y="2" width="20" height="20"></rect>    
    </svg>`},FamilyTree.icon.ft=function(t,e,i,n,r){return`<svg width="${t}" height="${e}" x="${n}" y="${r}" viewBox="0 0 512 512"  >
                <path fill="${i}" d="m336.061 377.731c-5.086-6.54-14.511-7.717-21.049-2.631l-44.012 34.231v-200.331c0-8.284-6.716-15-15-15s-15 6.716-15 15v200.331l-44.011-34.231c-6.538-5.086-15.962-3.908-21.049 2.631-5.086 6.539-3.908 15.963 2.631 21.049l62.429 48.556v49.664c0 8.284 6.716 15 15 15s15-6.716 15-15v-49.664l62.429-48.556c6.54-5.086 7.717-14.51 2.632-21.049z" />
                <path fill="${i}" d="m271 497v-49.664l62.429-48.556c6.54-5.086 7.717-14.51 2.631-21.049-5.086-6.54-14.511-7.717-21.049-2.631l-44.011 34.231v-200.331c0-8.284-6.716-15-15-15v318c8.284 0 15-6.716 15-15z" />
                <path fill="${i}" d="m320 512h-128c-8.284 0-15-6.716-15-15s6.716-15 15-15h128c8.284 0 15 6.716 15 15s-6.716 15-15 15z" />
                <path fill="${i}" d="m320 482h-64v30h64c8.284 0 15-6.716 15-15s-6.716-15-15-15z" />
                <path fill="${i}" d="m400 439c-61.206 0-111-49.794-111-111s49.794-111 111-111 111 49.794 111 111-49.794 111-111 111z" />
                <path fill="${i}" d="m112 439c-61.206 0-111-49.794-111-111s49.794-111 111-111 111 49.794 111 111-49.794 111-111 111z" />
                <path fill="${i}" d="m256 222c-61.206 0-111-49.794-111-111s49.794-111 111-111 111 49.794 111 111-49.794 111-111 111z" />
                <path fill="${i}" d="m367 111c0-61.206-49.794-111-111-111v222c61.206 0 111-49.794 111-111z" />
            </svg>`},FamilyTree.icon.addUser=function(t,e,i,n,r){return FamilyTree.isNEU(n)&&(n=0),FamilyTree.isNEU(r)&&(r=0),`<svg width="${t}" height="${e}" x="${n}" y="${r}" viewBox="0 0 512 512" >
                <path fill="${i}" d="M300.434,257.599c-25.945,27.304-60.622,43.875-98.602,43.875c-37.979,0-72.656-16.571-98.602-43.875 c-45.617,28.738-77.826,76.818-85.092,132.736c-1.659,12.77,8.291,24.107,21.201,24.107h225.846 c0-53.371,32.011-99.402,77.838-119.914C330.812,280.165,316.452,267.69,300.434,257.599z"/>
                <ellipse fill="${i}" cx="201.828" cy="133.868" rx="112.229" ry="133.868"/>
                <path fill="${i}" d="M396.486,316.885c-53.794,0-97.558,43.764-97.558,97.558S342.693,512,396.486,512c53.792,0,97.557-43.764,97.557-97.558 S450.279,316.885,396.486,316.885z M435.199,431.315h-21.841v21.841c0,9.318-7.554,16.872-16.872,16.872 c-9.318,0-16.872-7.554-16.872-16.872v-21.841h-21.842c-9.318,0-16.872-7.554-16.872-16.872c0-9.319,7.554-16.872,16.872-16.872 h21.842v-21.841c0-9.318,7.554-16.872,16.872-16.872c9.318,0,16.872,7.554,16.872,16.872v21.841h21.841 c9.318,0,16.872,7.554,16.872,16.872C452.072,423.761,444.518,431.315,435.199,431.315z"/>
            </svg>`},FamilyTree.icon.daughter=function(t,e,i,n,r){return FamilyTree.isNEU(n)&&(n=0),FamilyTree.isNEU(r)&&(r=0),`<svg width="${t}" height="${e}" x="${n}" y="${r}" viewBox="0 0 512.879 512.879">
                <path fill="${i}" d="M213.773,238.933c4.71,0,8.533-3.823,8.533-8.533v-5.615c0.546,0.529,0.922,0.964,0.964,1.024 c1.519,2.918,4.497,4.591,7.578,4.591c1.323,0,2.671-0.307,3.934-0.964c4.181-2.176,5.803-7.33,3.627-11.511 c-2.534-4.872-10.581-13.124-24.636-13.124c-14.054,0-22.101,8.252-24.636,13.124c-2.125,4.087-0.555,8.969,3.456,11.23 c4.011,2.287,9.156,0.811,11.563-3.123c0.077-0.128,0.495-0.623,1.084-1.195v5.564 C205.239,235.11,209.062,238.933,213.773,238.933z"/>
                <path fill="${i}" d="M256.439,332.8c20.028,0,30.507-9.907,31.633-11.034c3.294-3.294,3.285-8.568,0.043-11.913 c-3.234-3.354-8.61-3.439-12.015-0.247c-0.265,0.247-6.699,6.127-19.661,6.127c-12.774,0-19.209-5.709-19.652-6.118 c-3.336-3.251-8.678-3.217-11.981,0.085c-3.337,3.337-3.337,8.73,0,12.066C225.933,322.893,236.412,332.8,256.439,332.8z"/>
                <path fill="${i}" d="M365.666,293.547c-49.826-66.441-75.093-133.623-75.093-199.68c0-4.71-3.823-8.533-8.533-8.533s-8.533,3.823-8.533,8.533 c0,68.369,25.31,137.489,75.255,205.542c-12.228,21.623-50.483,76.058-92.322,76.058c-45.218,0-86.255-63.59-94.763-80.614 c-8.388-16.768-24.704-66.765-24.704-98.586v-25.754c20.378-0.572,73.404-3.405,121.813-17.246 c4.531-1.289,7.151-6.016,5.854-10.547c-1.289-4.531-6.008-7.159-10.547-5.854C196.254,153.387,129.114,153.6,128.439,153.6 c-4.71,0-8.533,3.823-8.533,8.533v34.133c0,34.935,17.254,87.723,26.496,106.214c0.452,0.905,46.797,90.052,110.037,90.052 s109.585-89.148,110.037-90.052C367.919,299.588,367.603,296.132,365.666,293.547z"/>
                <path fill="${i}" d="M316.173,392.533c-4.71,0-8.533,3.823-8.533,8.533v17.067c0,0.06,0.034,0.111,0.034,0.171 c0,0.051-0.034,0.094-0.034,0.154c-0.034,5.205-1.749,50.876-51.2,50.876s-51.166-45.986-51.2-51.2v-17.067 c0-4.71-3.823-8.533-8.533-8.533s-8.533,3.823-8.533,8.533v8.687c-116.028,1.638-168.917,35.9-178.765,65.417l-8.533,25.6 c-1.493,4.471,0.93,9.301,5.402,10.795C7.172,511.863,8.085,512,8.973,512c3.575,0,6.903-2.261,8.098-5.837l8.533-25.6 c6.076-18.227,48.034-52.335,163.132-53.845c3.106,24.422,19.721,59.682,67.704,59.682c53.999,0,68.267-44.425,68.267-67.917 c0-0.06-0.034-0.111-0.034-0.171c0-0.068,0.034-0.119,0.034-0.179v-17.067C324.706,396.356,320.883,392.533,316.173,392.533z"/>
                <path fill="${i}" d="M256.695,273.067h-0.085c-4.71,0-8.491,3.823-8.491,8.533c0,4.71,3.866,8.533,8.576,8.533 c4.719,0,8.533-3.823,8.533-8.533C265.229,276.89,261.414,273.067,256.695,273.067z"/>
                <path fill="${i}" d="M512.004,501.641l-8.533-25.591c-4.659-13.978-22.34-28.228-49.792-40.141c-4.318-1.877-9.352,0.102-11.23,4.429 c-1.869,4.318,0.111,9.353,4.437,11.221c26.266,11.401,38.178,23.219,40.388,29.884l8.533,25.6 c1.195,3.575,4.523,5.837,8.098,5.837c0.887,0,1.801-0.145,2.697-0.444C511.074,510.942,513.498,506.112,512.004,501.641z"/>
                <path fill="${i}" d="M256.439,0c-115.558,0-179.2,63.642-179.2,179.2V256c0,66.039-24.909,141.611-25.165,142.37 c-1.485,4.471,0.93,9.301,5.402,10.795c4.48,1.476,9.301-0.93,10.795-5.402c1.058-3.191,26.035-78.908,26.035-147.763v-76.8 c0-134.008,88.175-162.133,162.133-162.133c100.454,0,162.133,94.43,162.133,162.133v17.067 c0,34.458-21.111,74.163-41.532,112.572c-18.133,34.116-35.268,66.338-35.268,92.228c0,54.11,35.14,89.873,36.634,91.366 c1.596,1.604,3.772,2.5,6.033,2.5c2.261,0,4.437-0.896,6.033-2.5c1.493-1.493,36.634-37.257,36.634-91.366 c0-53.197-17.562-72.303-19.567-74.3c-3.285-3.285-8.559-3.285-11.904-0.051c-3.354,3.234-3.439,8.61-0.265,12.015 c0.145,0.154,14.669,16.256,14.669,62.336c0,33.937-16.444,60.16-25.617,72.149c-9.19-11.947-25.583-38.05-25.583-72.149 c0-21.632,16.162-52.036,33.271-84.215c21.402-40.252,43.529-81.869,43.529-120.585V179.2C435.639,94.438,362.04,0,256.439,0z"/>
            </svg>`},FamilyTree.icon.son=function(t,e,i,n,r){return FamilyTree.isNEU(n)&&(n=0),FamilyTree.isNEU(r)&&(r=0),`<svg width="${t}" height="${e}" x="${n}" y="${r}"  viewBox="0 0 512.002 512.002">
                <path fill="${i}" d="M238.934,213.334c0-4.71-3.823-8.533-8.533-8.533h-34.133c-4.71,0-8.533,3.823-8.533,8.533 c0,4.71,3.823,8.533,8.533,8.533h8.533c0,4.71,3.823,8.533,8.533,8.533c4.71,0,8.533-3.823,8.533-8.533h8.533 C235.111,221.867,238.934,218.044,238.934,213.334z"/>
                <path fill="${i}" d="M121.601,255.19c4.565,13.466,17.178,49.98,24.371,64.358c13.551,27.11,51.977,72.986,110.029,72.986 s96.478-45.875,110.037-72.986c7.185-14.379,19.797-50.893,24.371-64.358c11.025-2.85,19.191-12.885,19.191-24.789v-34.133 c0-11.127-7.134-20.617-17.067-24.141v-44.126c0-33.69-17.741-95.923-83.354-101.931c-0.137-4.028-1.476-7.27-2.953-9.668 c-8.38-13.559-31.94-16.401-50.227-16.401c-151.842,0-153.6,143.616-153.6,145.067c0,4.71,3.814,8.525,8.525,8.525h0.009 c4.702,0,8.525-3.806,8.533-8.516c0.017-5.222,1.937-128.009,136.533-128.009c24.132,0,33.801,5.222,35.703,8.311 c0.282,0.435,0.998,1.604-0.666,4.941c-1.323,2.645-1.178,5.786,0.375,8.303c1.553,2.509,4.301,4.045,7.253,4.045 c75.656,0,76.791,81.86,76.8,85.333v51.2c0,4.71,3.823,8.533,8.533,8.533c4.702,0,8.533,3.831,8.533,8.533v34.133 c0,4.702-3.831,8.533-8.533,8.533c-3.669,0-6.929,2.347-8.098,5.837c-0.162,0.503-16.964,50.816-25.131,67.149 c-1.297,2.594-32.495,63.548-94.771,63.548s-93.466-60.954-94.763-63.548c-8.166-16.333-24.977-66.645-25.139-67.149 c-1.161-3.49-4.42-5.837-8.098-5.837c-4.702,0-8.533-3.831-8.533-8.533v-34.133c0-2.313,0.93-4.412,2.423-5.948 c3.396,7.62,10.607,14.481,23.177,14.481c3.234,0,6.187-1.826,7.637-4.719c7.535-15.061,15.283-30.575,17.399-46.652 c43.665-1.758,108.979-17.323,139.742-41.105c8.201,29.764,32.742,54.596,33.988,55.842c3.337,3.337,8.738,3.337,12.066,0 c3.337-3.336,3.337-8.73,0-12.066c-0.316-0.316-31.633-31.983-31.633-62.234c0-3.831-2.56-7.202-6.255-8.226 c-3.703-1.024-7.62,0.546-9.591,3.831c-14.549,24.243-94.746,47.061-146.287,47.061c-4.71,0-8.533,3.823-8.533,8.533 c0,13.295-6.127,27.102-13.286,41.6c-2.901-1.604-3.703-4.753-3.78-7.467c0-4.71-3.823-8.533-8.533-8.533 c-14.114,0-25.6,11.486-25.6,25.6v34.133C102.401,242.305,110.576,252.34,121.601,255.19z"/>
                <path fill="${i}" d="M256.001,332.801c20.028,0,30.507-9.907,31.633-11.034c3.294-3.294,3.285-8.567,0.051-11.913 c-3.243-3.354-8.619-3.439-12.023-0.247c-0.265,0.247-6.699,6.127-19.661,6.127c-12.774,0-19.209-5.709-19.652-6.118 c-3.336-3.251-8.678-3.217-11.981,0.085c-3.328,3.337-3.328,8.73,0,12.066C225.503,322.893,235.982,332.801,256.001,332.801z"/>
                <path fill="${i}" d="M264.79,281.601c0-4.71-3.814-8.533-8.533-8.533h-0.085c-4.71,0-8.491,3.823-8.491,8.533c0,4.71,3.866,8.533,8.576,8.533 C260.976,290.134,264.79,286.311,264.79,281.601z"/>
                <path fill="${i}" d="M511.745,501.394l-8.713-34.756c-4.386-13.158-30.285-55.484-178.765-56.636v-8.934c0-4.71-3.823-8.533-8.533-8.533 s-8.533,3.823-8.533,8.533v17.067c0,0.06,0.034,0.111,0.034,0.171c0,0.051-0.034,0.094-0.034,0.154 c-0.034,5.205-1.749,50.876-51.2,50.876s-51.166-45.986-51.2-51.2v-17.067c0-4.71-3.823-8.533-8.533-8.533 s-8.533,3.823-8.533,8.533v8.619C77.168,410.556,21.786,428.203,8.79,467.26l-8.533,34.133 c-1.143,4.574,1.638,9.207,6.212,10.351c4.557,1.143,9.199-1.638,10.342-6.204l8.354-33.51 c9.916-29.739,63.309-44.595,163.132-45.338c3.098,24.431,19.712,59.708,67.704,59.708c47.983,0,64.597-35.063,67.703-59.366 c116.958,0.862,157.628,28.467,162.953,44.373l8.533,34.133c0.973,3.874,4.446,6.46,8.269,6.46c0.691,0,1.382-0.077,2.082-0.256 C510.115,510.601,512.888,505.968,511.745,501.394z"/>
                <path fill="${i}" d="M298.668,230.401c4.71,0,8.533-3.823,8.533-8.533h8.533c4.71,0,8.533-3.823,8.533-8.533c0-4.71-3.823-8.533-8.533-8.533 h-34.133c-4.71,0-8.533,3.823-8.533,8.533c0,4.71,3.823,8.533,8.533,8.533h8.533 C290.134,226.578,293.957,230.401,298.668,230.401z"/>
            </svg>`},FamilyTree.icon.wife=function(t,e,i,n,r){return FamilyTree.isNEU(n)&&(n=0),FamilyTree.isNEU(r)&&(r=0),`<svg width="${t}" height="${e}" x="${n}" y="${r}" viewBox="0 0 512 512" >
                <path fill="${i}" d="M128,307.2c4.719,0,8.533-3.823,8.533-8.533V281.6c0-4.71-3.814-8.533-8.533-8.533c-4.719,0-8.533,3.823-8.533,8.533 v17.067C119.467,303.377,123.281,307.2,128,307.2z"/>
                <path fill="${i}" d="M384,273.067c-4.719,0-8.533,3.823-8.533,8.533v17.067c0,4.71,3.814,8.533,8.533,8.533c4.719,0,8.533-3.823,8.533-8.533 V281.6C392.533,276.89,388.719,273.067,384,273.067z"/>
                <path fill="${i}" d="M392.183,433.109c-0.162-0.606-0.418-1.152-0.7-1.715c-0.162-0.299-0.196-0.64-0.384-0.93 c-0.094-0.128-0.23-0.196-0.324-0.324c-0.358-0.469-0.802-0.845-1.254-1.246c-0.418-0.375-0.819-0.742-1.306-1.016 c-0.145-0.094-0.23-0.23-0.392-0.316l-34.133-17.067c-2.748-1.357-6.008-1.161-8.55,0.538l-51.209,34.133 c-2.372,1.587-3.797,4.25-3.797,7.1v30.259c-5.077,4.062-17.545,12.407-34.133,12.407c-16.427,0-29.013-8.388-34.133-12.433 v-30.234c0-2.85-1.425-5.513-3.797-7.1l-51.2-34.133c-2.543-1.698-5.803-1.894-8.55-0.538l-34.133,17.067 c-0.154,0.077-0.239,0.213-0.375,0.299c-0.512,0.29-0.939,0.674-1.374,1.075c-0.435,0.384-0.853,0.734-1.186,1.178 c-0.102,0.137-0.256,0.213-0.35,0.35c-0.205,0.307-0.239,0.657-0.401,0.99c-0.265,0.529-0.521,1.05-0.674,1.63 c-0.137,0.529-0.179,1.05-0.205,1.596c-0.034,0.538-0.06,1.058,0.008,1.604c0.068,0.597,0.265,1.143,0.461,1.707 c0.119,0.341,0.111,0.7,0.273,1.024c0.077,0.154,0.222,0.247,0.307,0.393c0.282,0.495,0.666,0.913,1.058,1.348 c0.384,0.427,0.742,0.853,1.186,1.195c0.137,0.102,0.213,0.256,0.35,0.35l51.2,34.133c1.459,0.973,3.106,1.434,4.727,1.434 c2.756,0,5.47-1.331,7.108-3.797c2.62-3.925,1.562-9.225-2.364-11.836l-38.972-25.975l16.555-8.277l43.281,28.851V486.4 c0,2.261,0.896,4.437,2.5,6.033C208.102,493.235,227.2,512,256,512s47.898-18.765,48.7-19.567c1.604-1.596,2.5-3.772,2.5-6.033 v-29.568l43.29-28.851l16.546,8.277l-38.972,25.975c-3.925,2.611-4.983,7.91-2.364,11.836c1.638,2.466,4.352,3.797,7.108,3.797 c1.621,0,3.268-0.461,4.727-1.434l51.2-34.133c0.137-0.094,0.205-0.239,0.333-0.341c0.478-0.35,0.853-0.794,1.254-1.246 c0.358-0.427,0.725-0.811,0.998-1.289c0.085-0.154,0.239-0.247,0.324-0.41c0.171-0.35,0.171-0.725,0.29-1.084 c0.179-0.538,0.367-1.05,0.435-1.613c0.077-0.58,0.051-1.126,0.009-1.698C392.354,434.108,392.32,433.613,392.183,433.109z"/>
                <path fill="${i}" d="M57.037,409.165c0.896,0.29,1.809,0.435,2.697,0.435c3.575,0,6.903-2.261,8.09-5.837 C68.89,400.572,93.867,324.855,93.867,256v-76.8C93.867,45.193,182.033,17.067,256,17.067c25.199,0,77.636,0,85.649,11.128 c0.333,0.452,0.828,1.135,0.128,3.243c-0.956,2.842-0.341,5.965,1.604,8.235c1.946,2.278,4.932,3.362,7.885,2.876 c10.863-1.792,20.412,0.93,29.184,8.354c22.895,19.396,37.683,69.76,37.683,128.299V256c0,77.457,25.071,145.22,26.138,148.062 c1.656,4.412,6.571,6.639,10.991,5.001c4.412-1.655,6.647-6.571,5.001-10.991C460.006,397.406,435.2,330.257,435.2,256v-76.8 c0-50.415-11.486-114.014-43.716-141.321c-9.745-8.243-20.932-12.621-32.836-12.902c-0.683-2.773-1.903-5.035-3.149-6.767 C343.356,1.374,303.258,0,256,0C140.442,0,76.8,63.642,76.8,179.2V256c0,66.039-24.909,141.611-25.156,142.37 C50.15,402.842,52.565,407.672,57.037,409.165z"/>
                <path fill="${i}" d="M91.802,426.923C19.814,444.919,1.195,498.492,0.444,500.77c-1.493,4.471,0.922,9.301,5.393,10.795 C6.733,511.864,7.646,512,8.533,512c3.576,0,6.904-2.261,8.09-5.837c0.162-0.469,16.316-46.942,79.309-62.686 c4.574-1.143,7.356-5.777,6.212-10.351C101.001,428.561,96.367,425.771,91.802,426.923z"/>
                <path fill="${i}" d="M213.333,238.933c4.719,0,8.533-3.823,8.533-8.533v-5.615c0.546,0.529,0.922,0.964,0.964,1.024 c1.519,2.918,4.497,4.591,7.578,4.591c1.323,0,2.671-0.307,3.934-0.964c4.173-2.176,5.803-7.33,3.627-11.511 c-2.534-4.873-10.59-13.124-24.636-13.124c-14.046,0-22.101,8.252-24.636,13.124c-2.125,4.087-0.546,8.969,3.456,11.23 c3.985,2.261,9.148,0.819,11.554-3.123c0.085-0.128,0.503-0.623,1.092-1.195v5.564C204.8,235.11,208.614,238.933,213.333,238.933 z"/>
                <path fill="${i}" d="M511.556,500.77c-0.751-2.278-19.371-55.851-91.358-73.847c-4.574-1.161-9.199,1.638-10.342,6.204 c-1.143,4.574,1.638,9.207,6.212,10.351c62.524,15.633,78.66,60.809,79.309,62.686c1.186,3.576,4.514,5.837,8.09,5.837 c0.888,0,1.801-0.137,2.697-0.435C510.635,510.071,513.05,505.242,511.556,500.77z"/>
                <path fill="${i}" d="M256,332.8c20.028,0,30.507-9.907,31.633-11.034c3.294-3.294,3.285-8.567,0.051-11.913 c-3.251-3.345-8.61-3.439-12.015-0.247c-0.273,0.247-6.707,6.127-19.669,6.127c-12.774,0-19.208-5.709-19.652-6.118 c-3.32-3.251-8.67-3.226-11.981,0.085c-3.337,3.337-3.337,8.73,0,12.066C225.493,322.893,235.972,332.8,256,332.8z"/>
                <path fill="${i}" d="M298.667,238.933c4.719,0,8.533-3.823,8.533-8.533v-5.615c0.546,0.529,0.922,0.964,0.964,1.024 c1.519,2.918,4.497,4.591,7.578,4.591c1.323,0,2.671-0.307,3.934-0.964c4.173-2.176,5.803-7.33,3.627-11.511 c-2.534-4.873-10.59-13.124-24.636-13.124c-14.046,0-22.101,8.252-24.636,13.124c-2.125,4.087-0.546,8.969,3.456,11.23 c3.994,2.261,9.156,0.819,11.554-3.123c0.085-0.128,0.503-0.623,1.092-1.195v5.564 C290.133,235.11,293.948,238.933,298.667,238.933z"/>
                <path fill="${i}" d="M389.129,189.449c-8.542-6.443-30.729-26.957-30.729-44.382c0-4.71-3.814-8.533-8.533-8.533s-8.533,3.823-8.533,8.533 c0,24.678,24.354,47.249,34.014,55.228c-1.835,33.476-24.917,95.223-33.118,111.625c-7.654,15.317-48.154,63.548-86.229,63.548 s-78.575-48.23-86.229-63.548c-8.542-17.084-33.237-83.379-33.237-115.652v-25.728c33.835-0.802,157.321-6.929,218.453-52.779 c3.772-2.825,4.54-8.175,1.707-11.947c-2.825-3.772-8.175-4.54-11.947-1.707C279.561,152.994,129.51,153.6,128,153.6 c-4.719,0-8.533,3.823-8.533,8.533v34.133c0,36.625,26.871,106.965,35.029,123.281c10.385,20.77,55.834,72.986,101.504,72.986 s91.119-52.216,101.504-72.986c8.158-16.316,35.029-86.656,35.029-123.281C392.533,193.587,391.27,191.061,389.129,189.449z"/>
            </svg>`},FamilyTree.icon.husband=function(t,e,i,n,r){return FamilyTree.isNEU(n)&&(n=0),FamilyTree.isNEU(r)&&(r=0),`<svg width="${t}" height="${e}" x="${n}" y="${r}" viewBox="0 0 512.007 512.007" >
                <path fill="${i}" d="M121.835,255.249c6.229,16.196,26.803,68.42,41.737,90.82l1.348,2.039c10.957,16.614,29.295,44.425,91.085,44.425 c61.79,0,80.128-27.81,91.085-44.425l1.348-2.039c14.933-22.4,35.507-74.624,41.737-90.82c11.145-2.773,19.43-12.86,19.43-24.849 v-34.133c0-11.127-7.134-20.617-17.067-24.141V128c0-33.69-17.741-95.923-83.362-101.931c-0.128-4.028-1.459-7.27-2.944-9.668 C297.844,2.85,274.292,0,256.005,0c-151.842,0-153.6,143.616-153.6,145.067c0,4.71,3.814,8.525,8.516,8.525h0.017 c4.702,0,8.516-3.806,8.533-8.508c0.017-5.231,1.937-128.017,136.533-128.017c24.132,0,33.801,5.222,35.712,8.311 c0.265,0.435,0.99,1.604-0.683,4.941c-1.323,2.645-1.178,5.786,0.375,8.303c1.562,2.509,4.301,4.045,7.262,4.045 c75.657,0,76.791,81.86,76.8,85.333v51.2c0,4.71,3.814,8.533,8.533,8.533c4.71,0,8.533,3.831,8.533,8.533V230.4 c0,4.702-3.823,8.533-8.533,8.533c-3.558,0-6.741,2.21-7.996,5.538c-0.247,0.674-25.446,67.644-41.771,92.126l-1.399,2.116 c-10.223,15.514-24.235,36.753-76.834,36.753c-52.599,0-66.611-21.239-76.834-36.753l-1.399-2.116 c-16.324-24.482-41.523-91.452-41.771-92.126c-1.254-3.328-4.437-5.538-7.996-5.538c-4.71,0-8.533-3.831-8.533-8.533v-34.133 c0-2.313,0.922-4.412,2.423-5.948c3.089,6.955,9.421,13.21,20.053,14.268l29.193,21.897c2.27,16.623,16.418,29.517,33.664,29.517 h17.067c18.825,0,34.133-15.309,34.133-34.133c0,18.825,15.309,34.133,34.133,34.133h17.067 c17.237,0,31.394-12.894,33.664-29.517l31.189-23.39c3.772-2.825,4.54-8.175,1.707-11.947c-2.825-3.772-8.175-4.548-11.947-1.707 l-21.751,16.316c-3.251-10.402-12.86-18.022-24.329-18.022h-34.133c-14.114,0-25.6,11.486-25.6,25.6 c0-14.114-11.486-25.6-25.6-25.6h-34.133c-11.469,0-21.077,7.62-24.328,18.022l-16.282-12.211 c6.716-16.23,12.8-40.235,14.524-57.088c26.897-0.478,104.713-3.763,139.332-25.37c7.851,30.31,33.058,55.817,34.321,57.08 c3.336,3.336,8.73,3.336,12.066,0c3.336-3.337,3.336-8.73,0-12.066c-0.316-0.316-31.633-31.983-31.633-62.234 c0-3.831-2.56-7.202-6.255-8.226c-3.661-1.016-7.629,0.546-9.591,3.831c-12.425,20.693-93.022,29.995-146.287,29.995 c-4.719,0-8.533,3.823-8.533,8.533c0,13.858-6.554,41.515-13.508,58.539c-2.722-1.638-3.49-4.693-3.558-7.339 c0-4.71-3.814-8.533-8.533-8.533c-14.114,0-25.6,11.486-25.6,25.6V230.4C102.405,242.389,110.691,252.476,121.835,255.249z M273.071,213.333c0-4.702,3.823-8.533,8.533-8.533h34.133c4.71,0,8.533,3.831,8.533,8.533v8.533 c0,9.412-7.654,17.067-17.067,17.067h-17.067c-9.412,0-17.067-7.654-17.067-17.067V213.333z M187.738,213.333 c0-4.702,3.823-8.533,8.533-8.533h34.133c4.71,0,8.533,3.831,8.533,8.533v8.533c0,9.412-7.654,17.067-17.067,17.067h-17.067 c-9.412,0-17.067-7.654-17.067-17.067V213.333z"/>
                <path fill="${i}" d="M298.663,307.226c0.009-4.702-3.797-8.533-8.499-8.559c-0.162,0-15.42-0.171-30.345-7.629 c-2.398-1.203-5.231-1.203-7.629,0c-14.925,7.458-30.182,7.629-30.319,7.629c-4.719,0-8.533,3.823-8.533,8.533 s3.814,8.533,8.533,8.533c0.725,0,16.853-0.094,34.133-7.646c17.28,7.552,33.408,7.646,34.133,7.646 C294.84,315.733,298.646,311.927,298.663,307.226z"/>
                <path fill="${i}" d="M247.471,324.267c-4.719,0-8.533,3.823-8.533,8.533c0,4.71,3.814,8.533,8.533,8.533h17.067 c4.719,0,8.533-3.823,8.533-8.533c0-4.71-3.814-8.533-8.533-8.533H247.471z"/>
                <path fill="${i}" d="M511.749,501.393l-8.721-34.756c-12.706-38.135-73.114-56.687-184.67-56.687c-0.879,0-1.758,0-2.645,0.009 c-4.053,0.009-7.544,2.867-8.337,6.852l-17.067,84.975c-0.93,4.625,2.065,9.122,6.682,10.052 c4.608,0.896,9.114-2.074,10.044-6.69l15.693-78.114c97.724,0.452,154.436,15.957,163.934,44.373l8.533,34.133 c0.973,3.874,4.446,6.468,8.269,6.46c0.683,0,1.382-0.077,2.074-0.256C510.11,510.601,512.892,505.976,511.749,501.393z"/>
                <path fill="${i}" d="M204.634,416.461c-0.794-3.994-4.292-6.861-8.363-6.861c-116.386,0-174.148,17.596-187.477,57.66l-8.533,34.133 c-1.152,4.582,1.638,9.207,6.212,10.351C7.164,511.923,7.864,512,8.547,512c3.823,0,7.296-2.586,8.269-6.46l8.346-33.51 c9.95-29.841,63.667-44.689,164.122-45.338l15.693,78.447c0.913,4.617,5.367,7.629,10.035,6.699 c4.617-0.93,7.62-5.427,6.69-10.044L204.634,416.461z"/>
                <path fill="${i}" d="M256.005,409.6c-14.114,0-25.6,11.486-25.6,25.6c0,11.11,7.159,20.489,17.067,24.021v44.245 c0,4.71,3.814,8.533,8.533,8.533c4.719,0,8.533-3.823,8.533-8.533V459.23c9.907-3.541,17.067-12.919,17.067-24.03 C281.605,421.086,270.119,409.6,256.005,409.6z M256.005,443.733c-4.71,0-8.533-3.831-8.533-8.533 c0-4.702,3.823-8.533,8.533-8.533c4.71,0,8.533,3.831,8.533,8.533C264.538,439.902,260.715,443.733,256.005,443.733z"/>
            </svg>`},FamilyTree.icon.father=function(t,e,i,n,r){return FamilyTree.isNEU(n)&&(n=0),FamilyTree.isNEU(r)&&(r=0),`<svg width="${t}" height="${e}" x="${n}" y="${r}" viewBox="0 0 512.002 512.002" >
                <path fill="${i}" d="M366.934,128.001c0-4.71-3.814-8.533-8.533-8.533c-2.091,0-51.2-0.683-51.2-59.733c0-4.71-3.814-8.533-8.533-8.533 s-8.533,3.823-8.533,8.533c0,75.921,67.584,76.8,68.267,76.8C363.12,136.534,366.934,132.711,366.934,128.001z"/>
                <path fill="${i}" d="M256.001,196.268c0-14.114-11.486-25.6-25.6-25.6h-34.133c-11.46,0-21.069,7.62-24.329,18.022l-21.751-16.316 c-3.772-2.825-9.114-2.048-11.947,1.707c-2.825,3.772-2.065,9.122,1.707,11.947l31.189,23.39 c2.278,16.623,16.418,29.517,33.664,29.517h17.067c18.825,0,34.133-15.309,34.133-34.133c0,18.825,15.309,34.133,34.133,34.133 h17.067c17.237,0,31.394-12.894,33.664-29.517l31.189-23.39c3.772-2.825,4.54-8.175,1.707-11.947 c-2.825-3.772-8.175-4.548-11.947-1.707l-21.751,16.316c-3.251-10.402-12.86-18.022-24.329-18.022h-34.133 C267.487,170.668,256.001,182.153,256.001,196.268z M238.934,204.801c0,9.412-7.654,17.067-17.067,17.067h-17.067 c-9.412,0-17.067-7.654-17.067-17.067v-8.533c0-4.702,3.831-8.533,8.533-8.533h34.133c4.702,0,8.533,3.831,8.533,8.533V204.801z M324.268,196.268v8.533c0,9.412-7.654,17.067-17.067,17.067h-17.067c-9.412,0-17.067-7.654-17.067-17.067v-8.533 c0-4.702,3.823-8.533,8.533-8.533h34.133C320.445,187.734,324.268,191.566,324.268,196.268z"/>
                <path fill="${i}" d="M298.659,307.226c0.009-4.702-3.797-8.533-8.499-8.559c-0.162,0-15.42-0.171-30.345-7.629 c-2.398-1.203-5.231-1.203-7.629,0c-14.925,7.458-30.191,7.629-30.319,7.629c-4.71,0-8.533,3.823-8.533,8.533 s3.823,8.533,8.533,8.533c0.725,0,16.845-0.094,34.133-7.646c17.28,7.552,33.408,7.646,34.133,7.646 C294.836,315.734,298.642,311.928,298.659,307.226z"/>
                <path fill="${i}" d="M120.986,237.953c4.378,18.611,18.91,76.877,34.048,99.584c10.974,16.452,36.668,54.997,100.966,54.997 s89.993-38.545,100.966-54.997c15.138-22.707,29.67-80.973,34.048-99.584c10.718-3.055,18.586-12.937,18.586-24.619v-34.133 c0-11.127-7.134-20.617-17.067-24.141v-44.126c0-1.109-1.562-110.933-136.533-110.933c-151.842,0-153.6,126.72-153.6,128 c0,4.702,3.806,8.516,8.516,8.525h0.017c4.693,0,8.516-3.806,8.533-8.499c0.017-4.54,2.048-110.959,136.533-110.959 c117.581,0,119.441,90.061,119.467,93.867v51.2c0,4.71,3.814,8.533,8.533,8.533c4.71,0,8.533,3.831,8.533,8.533v34.133 c0,4.702-3.823,8.533-8.533,8.533c-4.002,0-7.458,2.782-8.337,6.682c-0.162,0.751-16.896,75.52-32.896,99.516 c-10.257,15.386-31.599,47.403-86.767,47.403s-76.51-32.017-86.767-47.403c-15.992-23.979-32.734-98.765-32.905-99.516 c-0.87-3.9-4.326-6.682-8.329-6.682c-4.702,0-8.533-3.831-8.533-8.533v-34.133c0-4.702,3.831-8.533,8.533-8.533 c1.323,0,2.637-0.307,3.814-0.896c2.978-1.493,72.986-37.333,72.986-110.037c0-4.71-3.823-8.533-8.533-8.533 s-8.533,3.823-8.533,8.533c0,56.678-52.523,88.636-62.08,93.978c-13.022,1.186-23.253,12.169-23.253,25.489v34.133 C102.401,225.016,110.269,234.898,120.986,237.953z"/>
                <path fill="${i}" d="M196.097,416.462c-0.794-3.994-4.292-6.861-8.363-6.861c-140.399,0-168.892,27.409-178.944,57.66l-8.533,34.133 c-1.143,4.582,1.638,9.207,6.204,10.351c0.7,0.179,1.391,0.256,2.082,0.256c3.823,0,7.296-2.586,8.269-6.46l8.354-33.51 c7.339-22.025,31.718-44.527,155.58-45.338l15.693,78.447c0.913,4.617,5.393,7.603,10.035,6.699 c4.625-0.93,7.62-5.427,6.69-10.044L196.097,416.462z"/>
                <path fill="${i}" d="M511.745,501.394l-8.721-34.756c-7.117-21.342-39.689-57.216-178.782-56.678c-4.062,0.009-7.544,2.867-8.337,6.852 l-17.067,84.975c-0.93,4.625,2.065,9.122,6.682,10.052c4.591,0.896,9.114-2.074,10.044-6.69l15.693-78.114 c103.714,0.674,148.412,23.484,155.401,44.373l8.533,34.133c0.973,3.874,4.446,6.468,8.269,6.46c0.683,0,1.382-0.077,2.074-0.256 C510.106,510.601,512.888,505.976,511.745,501.394z"/>
                <path fill="${i}" d="M256.257,426.668h-0.085c-4.71,0-8.491,3.823-8.491,8.533s3.866,8.533,8.576,8.533c4.71,0,8.533-3.823,8.533-8.533 S260.967,426.668,256.257,426.668z"/>
                <path fill="${i}" d="M256.257,494.934h-0.085c-4.71,0-8.491,3.823-8.491,8.533s3.866,8.533,8.576,8.533c4.71,0,8.533-3.823,8.533-8.533 S260.967,494.934,256.257,494.934z"/>
                <path fill="${i}" d="M247.468,324.268c-4.71,0-8.533,3.823-8.533,8.533c0,4.71,3.823,8.533,8.533,8.533h17.067 c4.719,0,8.533-3.823,8.533-8.533c0-4.71-3.814-8.533-8.533-8.533H247.468z"/>
                <path fill="${i}" d="M256.257,460.801h-0.085c-4.71,0-8.491,3.823-8.491,8.533c0,4.71,3.866,8.533,8.576,8.533 c4.71,0,8.533-3.823,8.533-8.533C264.79,464.624,260.967,460.801,256.257,460.801z"/>
            </svg>`},FamilyTree.icon.mother=function(t,e,i,n,r){return FamilyTree.isNEU(n)&&(n=0),FamilyTree.isNEU(r)&&(r=0),`<svg width="${t}" height="${e}" x="${n}" y="${r}" viewBox="0 0 512.011 512.011" >
                <path fill="${i}" d="M299.355,445.356c-1.621,1.536-2.56,3.755-2.56,5.973c0,2.304,0.939,4.437,2.56,6.059 c1.536,1.621,3.755,2.475,5.973,2.475c2.304,0,4.523-0.853,6.059-2.475c1.621-1.536,2.475-3.755,2.475-6.059 c0-2.219-0.853-4.437-2.475-5.973C308.23,442.113,302.512,442.199,299.355,445.356z"/>
                <path fill="${i}" d="M276.23,458.668c-1.621,1.621-2.475,3.755-2.475,6.059c0,2.219,0.939,4.437,2.475,5.973 c1.621,1.621,3.84,2.56,6.059,2.56c2.219,0,4.437-0.939,5.973-2.56c1.621-1.536,2.56-3.755,2.56-5.973 c0-2.304-0.939-4.437-2.56-6.059C285.104,455.511,279.387,455.511,276.23,458.668z"/>
                <path fill="${i}" d="M392.539,196.268c0-2.68-1.263-5.205-3.405-6.818c-8.55-6.443-30.729-26.957-30.729-44.382 c0-4.71-3.823-8.533-8.533-8.533s-8.533,3.823-8.533,8.533c0,24.678,24.354,47.249,34.014,55.228 c-1.835,33.476-24.917,95.223-33.118,111.625c-7.654,15.317-48.154,63.548-86.229,63.548s-78.575-48.23-86.229-63.548 c-8.542-17.084-33.237-83.379-33.237-115.652V170.54c33.835-0.802,157.321-6.929,218.453-52.779 c3.772-2.825,4.531-8.175,1.707-11.947c-2.825-3.763-8.166-4.531-11.947-1.707c-65.186,48.887-215.236,49.493-216.747,49.493 c-4.71,0-8.533,3.823-8.533,8.533v34.133c0,36.625,26.871,106.965,35.029,123.281c10.394,20.77,55.834,72.986,101.504,72.986 s91.11-52.215,101.504-72.986C365.668,303.233,392.539,232.893,392.539,196.268z"/>
                <path fill="${i}" d="M249.947,463.276c-1.536,1.621-2.475,3.84-2.475,6.059c0,2.219,0.939,4.437,2.475,6.059 c1.621,1.536,3.84,2.475,6.059,2.475s4.437-0.939,6.059-2.475c1.536-1.621,2.475-3.84,2.475-6.059 c0-2.219-0.939-4.437-2.475-6.059C258.907,460.119,253.104,460.119,249.947,463.276z"/>
                <path fill="${i}" d="M34.139,230.401c0,18.85,6.75,36.659,19.098,50.688c-1.348,5.76-2.031,11.648-2.031,17.579 c0,42.342,34.458,76.8,76.8,76.8c6.494,0,12.954-0.819,19.191-2.432c4.565-1.178,7.305-5.828,6.127-10.394 c-1.178-4.565-5.828-7.305-10.394-6.127c-4.847,1.254-9.865,1.886-14.925,1.886c-32.939,0-59.733-26.795-59.733-59.733 c0-5.922,0.879-11.793,2.603-17.459c0.922-3.021,0.102-6.298-2.133-8.525c-11.307-11.298-17.536-26.308-17.536-42.283 c0-19.251,9.421-37.453,25.199-48.674c3.78-2.688,4.719-7.893,2.116-11.742c-6.707-9.89-10.249-21.461-10.249-33.451 c0-28.843,20.591-53.53,48.947-58.701c2.432-0.452,4.557-1.929,5.811-4.053c18.987-32.137,40.892-56.713,133.888-56.713 c71.714,0,128.947,23.484,142.413,58.436c0.888,2.304,2.731,4.105,5.052,4.949c23.535,8.559,39.356,31.095,39.356,56.081 c0,11.989-3.541,23.561-10.249,33.451c-2.603,3.849-1.664,9.054,2.116,11.742c15.778,11.221,25.199,29.423,25.199,48.674 c0,15.974-6.229,30.984-17.536,42.283c-2.236,2.227-3.055,5.504-2.133,8.525c1.724,5.666,2.603,11.537,2.603,17.459 c0,32.939-26.795,59.733-59.733,59.733c-5.018,0-10.001-0.623-14.814-1.852c-4.574-1.186-9.207,1.579-10.377,6.144 c-1.169,4.574,1.587,9.216,6.153,10.385c6.195,1.587,12.595,2.389,19.038,2.389c42.342,0,76.8-34.458,76.8-76.8 c0-5.931-0.683-11.819-2.031-17.579c12.348-14.029,19.098-31.838,19.098-50.688c0-22.11-9.643-43.128-26.138-57.643 c5.956-11.102,9.071-23.475,9.071-36.224c0-30.865-18.748-58.82-47.044-70.733C395.475,25.704,334.598,0.001,256.919,0.001 c-90.172,0-121.984,21.7-146.62,61.85c-34.475,8.115-59.093,38.921-59.093,74.684c0,12.749,3.115,25.122,9.071,36.224 C43.782,187.274,34.139,208.291,34.139,230.401z"/>
                <path fill="${i}" d="M316.507,424.876c-1.621,1.621-2.475,3.84-2.475,6.059c0,2.304,0.853,4.437,2.475,6.059 c1.621,1.536,3.755,2.475,5.973,2.475c2.304,0,4.437-0.939,6.059-2.475c1.621-1.621,2.475-3.755,2.475-6.059 c0-2.219-0.853-4.437-2.475-6.059C325.382,421.719,319.664,421.719,316.507,424.876z"/>
                <path fill="${i}" d="M223.664,458.668c-1.536,1.621-2.475,3.755-2.475,6.059c0,2.219,0.939,4.437,2.475,6.059 c1.621,1.536,3.84,2.475,6.059,2.475c2.304,0,4.437-0.939,6.059-2.475c1.621-1.621,2.475-3.84,2.475-6.059 c0-2.219-0.853-4.437-2.475-6.059C232.624,455.511,226.907,455.511,223.664,458.668z"/>
                <path fill="${i}" d="M337.67,411.905c1.621-1.621,2.475-3.755,2.475-6.059c0-2.219-0.853-4.437-2.475-6.059 c-3.157-3.157-8.875-3.072-12.032,0.085c-1.621,1.536-2.56,3.755-2.56,5.973c0,2.304,0.939,4.437,2.56,6.059 c1.536,1.621,3.755,2.475,5.973,2.475C333.915,414.38,336.048,413.527,337.67,411.905z"/>
                <path fill="${i}" d="M213.339,238.935c4.71,0,8.533-3.823,8.533-8.533v-5.615c0.546,0.529,0.922,0.964,0.964,1.024 c1.519,2.918,4.497,4.591,7.578,4.591c1.323,0,2.671-0.307,3.934-0.964c4.181-2.176,5.803-7.33,3.627-11.511 c-2.534-4.873-10.581-13.124-24.636-13.124c-14.054,0-22.101,8.252-24.636,13.124c-2.125,4.087-0.555,8.969,3.456,11.23 c4.011,2.287,9.156,0.811,11.563-3.123c0.077-0.128,0.495-0.623,1.084-1.195v5.564 C204.806,235.112,208.629,238.935,213.339,238.935z"/>
                <path fill="${i}" d="M256.006,332.801c20.028,0,30.507-9.907,31.633-11.034c3.294-3.294,3.285-8.567,0.043-11.913 c-3.234-3.345-8.61-3.439-12.015-0.247c-0.265,0.247-6.699,6.127-19.661,6.127c-12.774,0-19.208-5.709-19.652-6.118 c-3.336-3.251-8.678-3.217-11.981,0.085c-3.337,3.336-3.337,8.73,0,12.066C225.499,322.894,235.978,332.801,256.006,332.801z"/>
                <path fill="${i}" d="M298.672,238.935c4.71,0,8.533-3.823,8.533-8.533v-5.615c0.546,0.529,0.922,0.964,0.964,1.024 c1.519,2.918,4.497,4.591,7.578,4.591c1.323,0,2.671-0.307,3.934-0.964c4.181-2.176,5.803-7.33,3.627-11.511 c-2.534-4.873-10.581-13.124-24.636-13.124s-22.101,8.252-24.636,13.124c-2.125,4.087-0.555,8.969,3.456,11.23 c4.011,2.287,9.165,0.811,11.563-3.123c0.077-0.128,0.495-0.623,1.084-1.195v5.564 C290.139,235.112,293.962,238.935,298.672,238.935z"/>
                <path fill="${i}" d="M511.571,500.771l-8.533-25.6c-8.883-26.658-62.464-65.212-136.098-65.212c-3.482,0-6.613,2.116-7.919,5.333 c-0.316,0.802-33.015,79.642-103.014,79.642c-69.99,0-102.69-79.181-103.014-79.983c-1.306-3.226-4.437-5.35-7.919-5.35 c-106.001,0-130.97,50.185-136.098,65.57l-8.533,25.6c-1.493,4.471,0.93,9.301,5.402,10.795c4.48,1.502,9.301-0.93,10.795-5.402 l8.533-25.6c8.465-25.412,42.974-52.514,114.381-53.845c9.293,19.703,45.577,85.282,116.454,85.282 c70.827,0,107.102-65.229,116.437-84.898c64.051,1.835,108.339,35.294,114.398,53.461l8.533,25.6 c1.195,3.576,4.523,5.837,8.098,5.837c0.887,0,1.801-0.137,2.697-0.435C510.64,510.073,513.064,505.243,511.571,500.771z"/>
                <path fill="${i}" d="M375.472,281.601v17.067c0,4.71,3.823,8.533,8.533,8.533c4.71,0,8.533-3.823,8.533-8.533v-17.067 c0-4.71-3.823-8.533-8.533-8.533C379.295,273.068,375.472,276.891,375.472,281.601z"/>
                <path fill="${i}" d="M188.934,405.847c0-2.219-0.939-4.437-2.56-5.973c-3.157-3.243-8.875-3.243-12.032,0 c-1.621,1.536-2.475,3.755-2.475,5.973c0,2.304,0.853,4.437,2.475,6.059s3.755,2.475,6.059,2.475 c2.219,0,4.437-0.853,5.973-2.475C187.995,410.284,188.934,408.151,188.934,405.847z"/>
                <path fill="${i}" d="M189.531,439.468c2.219,0,4.437-0.939,5.973-2.475c1.621-1.621,2.475-3.755,2.475-6.059c0-2.219-0.853-4.437-2.475-6.059 c-3.157-3.157-8.875-3.157-12.032,0c-1.621,1.621-2.475,3.84-2.475,6.059c0,2.304,0.853,4.437,2.475,6.059 C185.008,438.529,187.227,439.468,189.531,439.468z"/>
                <path fill="${i}" d="M200.624,445.356c-1.621,1.621-2.56,3.755-2.56,6.059c0,2.219,0.939,4.437,2.56,5.973c1.621,1.621,3.755,2.56,6.059,2.56 c2.219,0,4.437-0.939,5.973-2.56c1.621-1.536,2.475-3.755,2.475-5.973c0-2.304-0.853-4.523-2.475-6.059 C209.499,442.199,203.782,442.199,200.624,445.356z"/>
                <path fill="${i}" d="M119.472,281.601v17.067c0,4.71,3.823,8.533,8.533,8.533s8.533-3.823,8.533-8.533v-17.067 c0-4.71-3.823-8.533-8.533-8.533S119.472,276.891,119.472,281.601z"/>
            </svg>`},FamilyTree.icon.teddy=function(t,e,i,n,r){return FamilyTree.isNEU(n)&&(n=0),FamilyTree.isNEU(r)&&(r=0),`<svg width="${t}" height="${e}" x="${n}" y="${r}" viewBox="0 0 512 512">
                <path fill="${i}" d="M234.513,246.613c9.378-1.929,16.555-9.02,21.487-15.863c4.932,6.844,12.109,13.935,21.487,15.863 c1.459,0.299,3.089,0.486,4.873,0.486c6.118,0,13.978-2.304,22.34-10.667c3.337-3.337,3.337-8.73,0-12.066s-8.73-3.337-12.066,0 c-4.361,4.369-8.337,6.212-11.699,5.53c-6.912-1.408-13.611-12.203-16.401-18.364c9.523-3.866,17.067-13.577,17.067-23.799 c0-9.353-9.566-14.933-25.6-14.933c-16.026,0-25.6,5.581-25.6,14.933c0,10.223,7.535,19.934,17.067,23.799 c-2.807,6.178-9.498,16.956-16.401,18.364c-3.405,0.666-7.339-1.178-11.699-5.53c-3.336-3.337-8.73-3.337-12.066,0 s-3.337,8.73,0,12.066C218.104,247.236,228.062,247.91,234.513,246.613z M263.748,190.669c-1.502,2.944-4.873,5.598-7.748,5.598	s-6.246-2.654-7.748-5.598C251.793,189.833,260.207,189.833,263.748,190.669z"/>
                <path fill="${i}" d="M390.033,53.7c1.621,1.613,2.5,3.755,2.5,6.033s-0.879,4.42-2.5,6.025c-3.337,3.337-3.337,8.738,0,12.075 c1.664,1.664,3.849,2.5,6.033,2.5s4.369-0.836,6.033-2.492c4.838-4.838,7.501-11.273,7.501-18.108s-2.662-13.269-7.501-18.099 c-9.984-9.984-26.214-9.984-36.198,0c-3.337,3.328-3.337,8.73,0,12.066s8.73,3.337,12.066,0 C381.303,50.372,386.697,50.372,390.033,53.7z"/>
                <path fill="${i}" d="M311.467,136.533c7.057,0,12.8-5.743,12.8-12.8c0-7.057-5.743-12.8-12.8-12.8s-12.8,5.743-12.8,12.8 C298.667,130.79,304.41,136.533,311.467,136.533z"/>
                <path fill="${i}" d="M200.533,136.533c7.057,0,12.8-5.743,12.8-12.8c0-7.057-5.743-12.8-12.8-12.8s-12.8,5.743-12.8,12.8 C187.733,130.79,193.476,136.533,200.533,136.533z"/>
                <path fill="${i}" d="M115.934,80.333c2.185,0,4.369-0.836,6.042-2.5c3.328-3.337,3.328-8.738-0.009-12.075c-1.613-1.604-2.5-3.746-2.5-6.025 s0.887-4.42,2.509-6.033c3.209-3.226,8.841-3.226,12.058,0c3.328,3.337,8.738,3.328,12.066,0 c3.337-3.328,3.337-8.738,0.009-12.066c-9.677-9.677-26.539-9.668-36.207-0.009c-4.838,4.838-7.501,11.273-7.501,18.108 s2.662,13.269,7.501,18.108C111.565,79.497,113.749,80.333,115.934,80.333z"/>
                <path fill="${i}" d="M498.552,286.191c-28.262-23.945-91.742-14.2-98.884-13.005c-4.651,0.768-7.791,5.171-7.014,9.813 c0.777,4.651,5.171,7.799,9.813,7.014c17.246-2.867,66.133-6.827,85.052,9.199c5.06,4.284,7.415,9.54,7.415,16.521 c0,3.977-1.476,6.946-4.779,9.626c-24.098,19.567-114.33,5.982-147.063-0.913c-3.703-0.776-7.441,0.981-9.242,4.275 c-1.801,3.311-1.212,7.424,1.434,10.095c0.12,0.119,8.499,8.755,12.493,19.951c-2.125-0.222-4.267-0.367-6.443-0.367 c-37.641,0-68.267,34.458-68.267,76.8c0,7.629,1.024,14.993,2.884,21.956c-3.823,1.715-10.197,3.644-19.951,3.644 c-10.052,0-16.367-2.082-19.908-3.814c1.826-6.912,2.842-14.217,2.842-21.786c0-42.342-30.626-76.8-68.267-76.8 c-2.176,0-4.318,0.145-6.443,0.367c3.994-11.196,12.373-19.831,12.476-19.934c2.671-2.671,3.268-6.775,1.468-10.095 c-1.792-3.319-5.521-5.069-9.259-4.292c-32.725,6.895-122.974,20.48-147.063,0.913c-3.302-2.68-4.779-5.649-4.779-9.626 c0-6.98,2.355-12.228,7.407-16.512c18.867-15.991,67.806-12.066,85.06-9.208c4.651,0.794,9.045-2.364,9.813-7.014 c0.776-4.651-2.364-9.045-7.006-9.813c-7.151-1.195-70.613-10.957-98.884,13.005C4.651,293.649,0,303.863,0,315.733 c0,9.079,3.831,16.998,11.093,22.886c27.179,22.05,102.818,12.783,140.535,6.426c-2.825,5.47-5.188,11.896-6.11,18.825 c-25.216,11.29-43.119,38.98-43.119,71.33c0,42.342,30.626,76.8,68.267,76.8c25.446,0,47.642-15.778,59.383-39.057 c5.743,2.56,14.174,4.924,25.95,4.924c11.674,0,20.164-2.287,26.035-4.77C293.794,496.29,315.938,512,341.333,512 c37.641,0,68.267-34.458,68.267-76.8c0-32.35-17.903-60.041-43.119-71.33c-0.922-6.929-3.277-13.355-6.101-18.825 c37.717,6.357,113.365,15.633,140.527-6.426c7.262-5.888,11.093-13.807,11.093-22.886 C512,303.863,507.349,293.649,498.552,286.191z M170.667,494.933c-28.237,0-51.2-26.795-51.2-59.733s22.963-59.733,51.2-59.733 s51.2,26.795,51.2,59.733S198.904,494.933,170.667,494.933z M392.533,435.2c0,32.939-22.963,59.733-51.2,59.733 c-20.983,0-39.04-14.814-46.942-35.942c-0.145-0.614-0.324-1.186-0.606-1.766c-2.338-6.818-3.652-14.242-3.652-22.025 c0-32.939,22.963-59.733,51.2-59.733C369.57,375.467,392.533,402.261,392.533,435.2z"/>
                <path fill="${i}" d="M307.2,443.733c0,18.825,15.309,34.133,34.133,34.133c18.825,0,34.133-15.309,34.133-34.133 c0-18.825-15.309-34.133-34.133-34.133C322.509,409.6,307.2,424.909,307.2,443.733z M358.4,443.733 c0,9.412-7.654,17.067-17.067,17.067c-9.404,0-17.067-7.654-17.067-17.067c0-9.412,7.663-17.067,17.067-17.067 C350.746,426.667,358.4,434.321,358.4,443.733z"/>
                <path fill="${i}" d="M115.541,118.161c-8.619,21.709-13.141,45.525-13.141,69.572c0,67.849,52.762,136.533,153.6,136.533 s153.6-68.685,153.6-136.533c0-24.491-4.412-47.846-13.107-69.581c26.957-5.76,47.24-29.764,47.24-58.419 C443.733,26.795,416.93,0,384,0c-24.67,0-46.14,14.916-55.108,36.745C307.115,23.859,282.368,17.067,256,17.067 c-26.615,0-51.2,6.716-73.259,19.925C174.08,14.754,153.088,0,128,0C95.061,0,68.267,26.795,68.267,59.733 C68.267,88.397,88.559,112.41,115.541,118.161z M128,17.067c19.226,0,35.021,12.177,40.115,30.054 c-11.085,8.61-21.163,18.816-29.901,30.592c-2.807,3.789-2.014,9.131,1.775,11.938c3.789,2.816,9.139,2.022,11.938-1.766 c8.9-12.006,19.26-22.281,30.788-30.507C204.288,41.95,228.949,34.133,256,34.133c41.429,0,78.396,19.098,104.098,53.786 c1.681,2.253,4.25,3.447,6.869,3.447c1.766,0,3.55-0.546,5.077-1.681c3.78-2.799,4.574-8.149,1.775-11.938 c-8.969-12.092-19.157-22.485-30.345-31.104c5.427-17.374,21.632-29.577,40.525-29.577c23.526,0,42.667,19.14,42.667,42.667 S407.526,102.4,384,102.4c-2.935,0-5.658,1.502-7.228,3.985c-1.553,2.483-1.732,5.589-0.461,8.243 c10.761,22.443,16.222,47.044,16.222,73.105C392.533,247.1,345.634,307.2,256,307.2s-136.533-60.1-136.533-119.467 c0-25.617,5.615-50.901,16.23-73.122c1.263-2.637,1.084-5.751-0.478-8.226c-1.562-2.483-4.292-3.985-7.219-3.985 c-23.526,0-42.667-19.14-42.667-42.667S104.474,17.067,128,17.067z"/>
                <path fill="${i}" d="M256,290.133c47.053,0,85.333-30.626,85.333-68.267c0-36.258-36.489-76.8-85.333-76.8s-85.333,40.542-85.333,76.8 C170.667,259.507,208.947,290.133,256,290.133z M256,162.133c38.451,0,68.267,32.111,68.267,59.733 c0,28.237-30.626,51.2-68.267,51.2c-37.641,0-68.267-22.963-68.267-51.2C187.733,194.244,217.557,162.133,256,162.133z"/>
                <path fill="${i}" d="M170.667,409.6c-18.825,0-34.133,15.309-34.133,34.133c0,18.825,15.309,34.133,34.133,34.133 s34.133-15.309,34.133-34.133C204.8,424.909,189.491,409.6,170.667,409.6z M170.667,460.8c-9.412,0-17.067-7.654-17.067-17.067 c0-9.412,7.654-17.067,17.067-17.067c9.412,0,17.067,7.654,17.067,17.067C187.733,453.146,180.079,460.8,170.667,460.8z"/>
            </svg>`},FamilyTree.prototype.exportPDFProfile=function(t,e){t=this._defaultExportProfileOptions(t,"pdf"),this._exportProfile(t,e)},FamilyTree.prototype.exportPDFPreview=function(t){FamilyTree.pdfPrevUI.show(this,t)},FamilyTree.prototype.exportPNGProfile=function(t,e){t=this._defaultExportProfileOptions(t,"png"),this._exportProfile(t,e)},FamilyTree.prototype.shareProfile=function(t){var e;typeof t=="object"?t=(e=t).focusId:e=this.editUI.content(t,!0,!0,"100%",!0);var i=new URL(window.location.href);i.searchParams.append("nodeId",t);var n={title:e.title,text:e.shareText,url:i.href};try{navigator.share(n)}catch(r){console.error("error: "+r)}},FamilyTree.prototype.exportPDF=function(t,e){t=this._defaultExportOptions(t,"pdf"),this._export(t,e)},FamilyTree.prototype.exportPNG=function(t,e){t=this._defaultExportOptions(t,"png"),this._export(t,e)},FamilyTree.prototype.exportSVG=function(t,e){t=this._defaultExportOptions(t,"svg"),this._export(t,e)},FamilyTree.prototype._defaultExportOptions=function(t,e){return t==null&&(t={}),e=="svg"?(t.ext="svg",t.mime="image/svg+xml"):e=="pdf"?(t.mime="application/pdf",t.ext="pdf"):e=="png"&&(t.mime="image/png",t.ext="png"),t.margin==null&&(t.margin=[50,40,50,40]),t.padding==null&&(t.padding=0),t.landscape==null&&(t.landscape=!1),t.filename==null&&(t.filename="FamilyTree."+t.ext),t.scale==null&&(t.scale="fit"),t.format==null&&(t.format="fit"),t.header==null&&(t.header=""),e=="pdf"&&t.footer==null?t.footer="Page {current-page} of {total-pages}":t.footer==null&&(t.footer=""),t.openInNewTab==null&&(t.openInNewTab=!1),t.mode==null&&(t.mode="bft-"+this.config.mode),t},FamilyTree.prototype._export=function(t,e){var i=this,n={id:t.nodeId,expandChildren:t.expandChildren,min:t.min};t.margin&&t.margin[0]<2&&(t.margin[0]=2),t.margin&&t.margin[1]<2&&(t.margin[1]=2),t.margin&&t.margin[2]<2&&(t.margin[2]=2),t.margin&&t.margin[3]<2&&(t.margin[3]=2),this._draw(!1,FamilyTree.action.exporting,n,function(r,o){var a=document.createElement("div");if(a.innerHTML=r,t.padding>0){var l=a.querySelector("svg"),s=FamilyTree._getViewBox(l);s[0]-=t.padding,s[1]-=t.padding,s[2]+=2*t.padding,s[3]+=2*t.padding,l.setAttribute("viewBox",s.join()),l.setAttribute("width",s[2]),l.setAttribute("height",s[3])}if(t.ext=="svg")if(e)e(t,a.innerHTML);else{(l=a.querySelector("svg")).classList.add("bft-"+i.config.mode);var c={content:a.innerHTML,options:t,styles:""},d=FamilyTree.events.publish("exportstart",[i,c]),p=i.element.querySelector("[data-bft-styles]");if(p&&(c.styles+=p.outerHTML),c.styles&&(a.childNodes[0].insertAdjacentHTML("afterbegin",c.styles),c.content=a.innerHTML),d===!1||(d=FamilyTree.events.publish("exportend",[i,c]))===!1)return!1;FamilyTree._downloadFile(t.mime,c.content,c.options.filename,c.options.openInNewTab,c.options.ext)}else i._pages(t,a.querySelector("svg"),o,function(h){var f={content:a.innerHTML,options:t,pages:h,styles:""},m=FamilyTree.events.publish("exportstart",[i,f]),y=i.element.querySelector("[data-bft-styles]");if(y&&(f.styles+=y.outerHTML),m===!1)return!1;e||FamilyTree.loading.show(i),e?e(i,f,a.querySelector("svg")):(f=JSON.stringify(f),FamilyTree._ajax(i.config.exportUrl+"/v3","POST",f,"arraybuffer",function(x){var u=FamilyTree.events.publish("exportend",[i,x]);if(FamilyTree.loading.hide(i),u===!1)return!1;FamilyTree._downloadFile(t.mime,x,t.filename,t.openInNewTab,t.ext)}))})})},FamilyTree.prototype.exportCSV=function(t){var e=FamilyTree._defaultExportProfileOptionsForCSV_SVG_JSON(t,"csv"),i=this.getNode(e.nodeId),n=null;i?(n=[],FamilyTree._exportIterateForJSON_XML_CSV(this,i,e,n)):e.min===!1||e.expandChildren===!1?FamilyTree._exportIterateForJSON_XML_CSV(this,this.roots,e,n):n=JSON.parse(JSON.stringify(this.config.nodes));var r={ext:"csv",filename:t,options:e,nodes:n};if(FamilyTree.events.publish("exportstart",[this,r])===!1)return!1;var o=FamilyTree._json2csv(r.nodes),a={ext:r.ext,filename:r.filename,options:e,nodes:r.nodes,content:o};if(FamilyTree.events.publish("exportend",[this,a])===!1)return!1;FamilyTree._downloadFile("text/csv;charset=utf-8;","\uFEFF"+a.content,a.options.filename,a.options.openInNewTab,a.ext)},FamilyTree.prototype.exportXML=function(t){var e=FamilyTree._defaultExportProfileOptionsForCSV_SVG_JSON(t,"xml"),i=this.getNode(e.nodeId),n=null;i?(n=[],FamilyTree._exportIterateForJSON_XML_CSV(this,i,e,n)):e.min===!1||e.expandChildren===!1?FamilyTree._exportIterateForJSON_XML_CSV(this,this.roots,e,n):n=JSON.parse(JSON.stringify(this.config.nodes));var r={ext:"xml",filename:t,options:e,nodes:n};if(FamilyTree.events.publish("exportstart",[this,r])===!1)return!1;var o=FamilyTree._json2xml(r.nodes),a={ext:r.ext,filename:r.filename,options:e,nodes:r.nodes,content:o};if(FamilyTree.events.publish("exportend",[this,a])===!1)return!1;FamilyTree._downloadFile("application/xml",a.content,a.options.filename,a.options.openInNewTab,a.ext)},FamilyTree.prototype.exportJSON=function(t){var e=FamilyTree._defaultExportProfileOptionsForCSV_SVG_JSON(t,"json"),i=this.getNode(e.nodeId),n=null;i?(n=[],FamilyTree._exportIterateForJSON_XML_CSV(this,i,e,n)):e.min===!1||e.expandChildren===!1?FamilyTree._exportIterateForJSON_XML_CSV(this,this.roots,e,n):n=JSON.parse(JSON.stringify(this.config.nodes));var r={ext:"json",filename:e.filename,options:e,nodes:n};if(FamilyTree.events.publish("exportstart",[this,r])===!1)return!1;var o={ext:r.ext,filename:r.filename,options:e,nodes:r.nodes,content:JSON.stringify(r.nodes)};if(FamilyTree.events.publish("exportend",[this,o])===!1)return!1;FamilyTree._downloadFile("application/json",o.content,o.options.filename,o.options.openInNewTab,o.ext)},FamilyTree._exportIterateForJSON_XML_CSV=function(t,e,i,n){if(Array.isArray(e))for(var r=0;r<e.length;r++)FamilyTree._exportIterateForJSON_XML_CSV(t,e[r],i,n);else{var o=t.get(e.id);if(n.push(o),i.min)for(r=0;r<e.stChildrenIds.length;r++)FamilyTree._exportIterateForJSON_XML_CSV(t,t.getNode(e.stChildrenIds[r]),i,n);else for(r=0;r<e.stChildren.length;r++)FamilyTree._exportIterateForJSON_XML_CSV(t,e.stChildren[r],i,n);if(i.expandChildren)for(r=0;r<e.childrenIds.length;r++)FamilyTree._exportIterateForJSON_XML_CSV(t,t.getNode(e.childrenIds[r]),i,n);else for(r=0;r<e.children.length;r++)FamilyTree._exportIterateForJSON_XML_CSV(t,e.children[r],i,n)}},FamilyTree.prototype._pages=function(t,e,i,n){t.format=="A5"&&t.scale!="fit"||t.format=="A4"&&t.scale!="fit"||t.format=="A3"&&t.scale!="fit"||t.format=="A2"&&t.scale!="fit"||t.format=="A1"&&t.scale!="fit"||t.format=="Letter"&&t.scale!="fit"||t.format=="Legal"&&t.scale!="fit"?n(this._pagesA100(t,e,t.scale)):t.format=="A5"&&t.scale=="fit"||t.format=="A4"&&t.scale=="fit"||t.format=="A3"&&t.scale=="fit"||t.format=="A2"&&t.scale=="fit"||t.format=="A1"&&t.scale=="fit"||t.format=="Letter"&&t.scale=="fit"||t.format=="Legal"&&t.scale=="fit"?n(this._pagesAfit(t,e,i)):t.format=="fit"&&n(this._pagesFit(t,e))},FamilyTree.prototype._pagesFit=function(t,e){var i=e.getAttribute("width"),n=e.getAttribute("height"),r=FamilyTree._getViewBox(e),o={w:parseFloat(i),h:parseFloat(n)};return[{vb:r,size:{w:o.w+(t.margin[1]+t.margin[3]),h:o.h+(t.margin[0]+t.margin[2])},innerSize:o}]},FamilyTree.prototype._pagesAfit=function(t,e,i){var n=e.getAttribute("width"),r=0,o=0;switch(t.format){case"A5":r=FamilyTree.A5w,o=FamilyTree.A5h;break;case"A4":r=FamilyTree.A4w,o=FamilyTree.A4h;break;case"A3":r=FamilyTree.A3w,o=FamilyTree.A3h;break;case"A2":r=FamilyTree.A2w,o=FamilyTree.A2h;break;case"A1":r=FamilyTree.A1w,o=FamilyTree.A1h;break;case"Letter":r=FamilyTree.Letterw,o=FamilyTree.Letterh;break;case"Legal":r=FamilyTree.Legalw,o=FamilyTree.Legalh}var a=t.landscape?o-(t.margin[1]+t.margin[3]):r-(t.margin[1]+t.margin[3]),l=(t.landscape,t.margin[0],t.margin[2],a/n);return this._pagesA100(t,e,100*l,i)},FamilyTree.prototype._pagesA100=function(t,e,i,n){var r=FamilyTree._getViewBox(e),o=0,a=0;switch(t.format){case"A5":o=FamilyTree.A5w,a=FamilyTree.A5h;break;case"A4":o=FamilyTree.A4w,a=FamilyTree.A4h;break;case"A3":o=FamilyTree.A3w,a=FamilyTree.A3h;break;case"A2":o=FamilyTree.A2w,a=FamilyTree.A2h;break;case"A1":o=FamilyTree.A1w,a=FamilyTree.A1h;break;case"Letter":o=FamilyTree.Letterw,a=FamilyTree.Letterh;break;case"Legal":o=FamilyTree.Legalw,a=FamilyTree.Legalh}var l=r[0],s=r[1],c=r[2],d=r[3],p={w:t.landscape?a-(t.margin[1]+t.margin[3]):o-(t.margin[1]+t.margin[3]),h:t.landscape?o-(t.margin[0]+t.margin[2]):a-(t.margin[0]+t.margin[2])},h={w:t.landscape?a:o,h:t.landscape?o:a};e.setAttribute("width",p.w),e.setAttribute("height",p.h);var f=p.w*(100/i),m=p.h*(100/i),y=l,x=s,u=[],b=!0;if(!FamilyTree.EXPORT_PAGES_CUT_NODES&&t.scale=="fit"){e.setAttribute("preserveAspectRatio","xMinYMin");for(var v=Object.keys(n.bordersByRootIdAndLevel),g=n.bordersByRootIdAndLevel[v[0]],_=Object.keys(g).length,k=1;k<v.length;k++)_<Object.keys(n.bordersByRootIdAndLevel[v[k]]).length&&(g=n.bordersByRootIdAndLevel[v[k]],_=Object.keys(g).length);for(var w=0,S=0;;){for(S=w;!(_<=w);){if((g[w].maxY-g[w].minY)/(100/i)>p.h){b=!1;break}var I=(g[w].minY-g[S].minY)/(100/i);if(w==_-1&&(I=(g[w].maxY-g[S].minY)/(100/i)),I>p.h)break;w++}if(!b)break;var M=(w==_?g[w-1].maxY:g[w-1].minY)-g[S].minY;if(M==0){b=!1;break}if(N=(N=[y,g[S].minY,f,M]).join(),u.push({vb:N,innerSize:{w:p.x,h:M/(100/i)-1},size:h}),w==_)break;w--}u.length&&(u[u.length-1].innerSize.h+=1)}if(!b||FamilyTree.EXPORT_PAGES_CUT_NODES||t.scale!="fit")for(e.setAttribute("preserveAspectRatio","xMinYMin slice"),u=[];y<c+l;){for(;x<d+s;){var N;N=(N=[y,x,f,m]).join(),u.push({vb:N,innerSize:p,size:h}),x+=m}y+=f,x=s}return u},FamilyTree.prototype._defaultExportProfileOptions=function(t,e){return FamilyTree.isNEU(t)||t.id==null||t.nodeId!=null||(t.nodeId=t.id),(FamilyTree.isNEU(t)||FamilyTree.isNEU(t.nodeId))&&console.error("options.nodeId is not defilned"),e=="svg"?(t.ext="svg",t.mime="image/svg+xml"):e=="pdf"?(t.mime="application/pdf",t.ext="pdf"):e=="png"&&(t.mime="image/png",t.ext="png"),t.margin==null&&(t.margin=[50,40,50,40]),t.padding==null&&(t.padding=0),t.landscape==null&&(t.landscape=!1),t.filename==null&&(t.filename="Profile."+t.ext),t.scale==null&&(t.scale="fit"),t.format==null&&(t.format="A4"),t.header==null&&(t.header=""),t.footer==null&&(t.footer=""),t.openInNewTab==null&&(t.openInNewTab=!1),t.mode==null&&(t.mode="bft-"+this.config.mode),t},FamilyTree._defaultExportProfileOptionsForCSV_SVG_JSON=function(t,e){return FamilyTree.isNEU(t)&&(t={}),typeof t=="string"&&(t={filename:t}),FamilyTree.isNEU(t.filename)&&(t.filename=`FamilyTree.${e}`),FamilyTree.isNEU(t.expandChildren)&&(t.expandChildren=!0),FamilyTree.isNEU(t.min)&&(t.min=!0),FamilyTree.isNEU(t.openInNewTab)&&(t.openInNewTab=!1),t},FamilyTree.prototype._exportProfile=function(t,e){var i=this,n=0,r=0;switch(t.format){case"A5":n=FamilyTree.A5w,r=FamilyTree.A5h;break;case"A4":n=FamilyTree.A4w,r=FamilyTree.A4h;break;case"A3":n=FamilyTree.A3w,r=FamilyTree.A3h;break;case"A2":n=FamilyTree.A2w,r=FamilyTree.A2h;break;case"A1":n=FamilyTree.A1w,r=FamilyTree.A1h;break;case"Letter":n=FamilyTree.Letterw,r=FamilyTree.Letterh;break;case"Legal":n=FamilyTree.Legalw,r=FamilyTree.Legalh}var o={w:t.landscape?r-(t.margin[1]+t.margin[3]):n-(t.margin[1]+t.margin[3]),h:t.landscape?n-(t.margin[0]+t.margin[2]):r-(t.margin[0]+t.margin[2])},a={w:t.landscape?r:n,h:t.landscape?n:r},l=this.editUI.content(t.nodeId,!0,!0,"100%",!0).element;FamilyTree.input.init(l);var s={content:l.outerHTML,options:t,pages:[{vb:"",innerSize:o,size:a}],styles:""};if(!e){if(FamilyTree.events.publish("exportstart",[i,s])===!1)return!1;FamilyTree.loading.show(i)}var c=this.element.querySelector("[data-bft-styles]");c&&(s.styles+=c.outerHTML);var d=this.getSvg().querySelector("defs");if(d)for(var p=0;p<d.children.length;p++)d.children[p].nodeName.toLowerCase()=="style"&&(s.styles+=d.children[p].outerHTML);s=JSON.stringify(s),FamilyTree._ajax(this.config.exportUrl+"/v3","POST",s,"arraybuffer",function(h){if(e)e(i,h);else{var f=FamilyTree.events.publish("exportend",[i,h]);if(FamilyTree.loading.hide(i),f===!1)return!1;FamilyTree._downloadFile(t.mime,h,t.filename,t.openInNewTab,t.ext)}})},FamilyTree===void 0&&(FamilyTree={}),FamilyTree.events=function(){var t={};return{on:function(e,i,n){Array.isArray(t[e])||(t[e]=[]),t[e].push({listener:i,event_id:n})},removeAll:function(e){Array.isArray(t[e])||(t[e]=[]),t[e]=[]},remove:function(e,i,n){var r=!1;if(t[e]&&Array.isArray(t[e])&&t[e].length>0)for(var o=t[e].length-1;o>=0;o--)(!FamilyTree.isNEU(n)&&!FamilyTree.isNEU(i)&&t[e][o].event_id==n&&t[e][o].listener==i||!FamilyTree.isNEU(n)&&FamilyTree.isNEU(i)&&t[e][o].event_id==n||FamilyTree.isNEU(n)&&!FamilyTree.isNEU(i)&&t[e][o].listener==i||FamilyTree.isNEU(n)&&FamilyTree.isNEU(i))&&(t[e].splice(o,1),r=!0);return r},has:function(e,i){if(t[e]&&Array.isArray(t[e])&&t[e].length>0){if(FamilyTree.isNEU(i))return!0;for(var n=0;n<t[e].length;n++)if(t[e][n].event_id==i)return!0}return!1},removeForEventId:function(e){for(var i in t)if(Array.isArray(t[i]))for(var n=t[i].length-1;n>=0;n--)t[i][n].event_id==e&&t[i].splice(n,1)},publish:function(e,i){if(t[e]){for(var n=[],r=0;r<t[e].length;r++){var o=t[e][r];o.event_id!=null&&o.event_id!=i[0]._event_id||n.push(o.listener)}if(n.length>0){var a=!0;for(r=0;r<n.length&&(i.length==1?a=n[r](i[0])&&a:i.length==2?a=n[r](i[0],i[1])&&a:i.length==3?a=n[r](i[0],i[1],i[2])&&a:i.length==4?a=n[r](i[0],i[1],i[2],i[3])&&a:i.length==5&&(a=n[r](i[0],i[1],i[2],i[3],i[4])&&a),a!==!1);r++);return a}}}}}(),FamilyTree.prototype.importCSV=function(){var t=this,e=document.createElement("INPUT");e.setAttribute("type","file"),e.setAttribute("accept",".csv"),e.style.display="none",e.onchange=function(i){var n=i.target,r=new FileReader;r.onload=function(){var o=r.result,a=FamilyTree._csvToArray(o),l=[],s=a[0];FamilyTree._importSetColumnNames(s,function(c){for(var d=1;d<a.length;d++){for(var p={},h=0;h<a[d].length;h++){var f=c[h],m=a[d][h];p[f]=FamilyTree._convertStringToArray(f,m)}p.id.trim()!=""&&l.push(p)}var y={nodes:l,columnNames:a[0]};FamilyTree.events.publish("import",[t,y])!=0&&(t._putInUndoStack(),t.clearRedo(),t.config.nodes=y.nodes,FamilyTree.events.publish("updated",[t]),t.filterUI.update(),t.draw())})},r.readAsText(n.files[0])},e.click()},FamilyTree._importSetColumnNames=function(t,e){if(t.indexOf("id")==-1||t.indexOf("pid")==-1){var i=document.createElement("DIV"),n=document.createElement("P");n.style.padding="5px",n.style.color="rgb(122, 122, 122)",n.innerHTML=FamilyTree.IMPORT_MESSAGE,i.appendChild(n);var r=document.createElement("div"),o=document.createElement("div"),a=document.createElement("div"),l=document.createElement("span");r.setAttribute("id","bft-sampleDialog"),r.style.height="260px",r.style.width="400px",r.style.background="white",r.style.border="0.5px solid grey",r.style.position="fixed",r.style.overflow="hidden",r.style.zIndex="99",o.setAttribute("id","title"),o.style.backgroundColor="#e5e5e5",o.style.fontWeight="bold",o.style.color="rgb(122, 122, 122)",o.style.height="20px",o.style.padding="3px 0 0 7px",l.setAttribute("id","close"),l.style.cursor="pointer",l.style.position="absolute",l.style.color="rgb(122, 122, 122)",l.style.fontWeight="bold",l.style.top="2px",l.style.zIndex=100,a.setAttribute("id","content"),a.style.padding="2px",o.innerHTML="Import Organizational Chart Data",l.innerHTML="&times;";var s=document.createElement("HR");s.style.height="0.1px",s.style.backgroundColor="#aeaeae",s.style.border="none",s.style.margin="0",r.appendChild(o),r.appendChild(s),a.appendChild(i),r.appendChild(a),r.appendChild(l),document.body.appendChild(r),FamilyTree._importCenter(r),l.style.left=r.offsetWidth-20+"px";var c=document.createElement("div");c.setAttribute("id","overlay"),c.style.width="100%",c.style.height="100%",c.style.left=0,c.style.top=0,c.style.position="fixed",c.style.background="grey",c.style.opacity="0.5",c.style.zIndex=98,document.body.appendChild(c),r._overlay=c;var d=document.createElement("LABEL"),p=document.createTextNode("Name:");d.setAttribute("for","bft-id-select"),d.appendChild(p),d.style.fontSize="16px",d.style.color="rgb(122, 122, 122)",d.style.padding="5px",d.style.margin="5px",d.style.width="30%",d.style.textAlign="right",d.style.display="inline-block",i.appendChild(d);var h=document.createElement("SELECT");h.id="bft-id-select",h.style.fontSize="16px",h.style.color="rgb(122, 122, 122)",h.style.padding="5px",h.style.margin="5px",h.style.width="60%",h.style.border="1px solid #aeaeae",i.appendChild(h);var f=document.createElement("BR");i.appendChild(f);for(var m=0;m<t.length;m++){(v=document.createElement("option")).setAttribute("value",t[m]);var y=document.createTextNode(t[m]);v.appendChild(y),h.appendChild(v)}var x=document.createElement("LABEL"),u=document.createTextNode("Reports to:");x.setAttribute("for","pid-select"),x.appendChild(u),x.style.fontSize="16px",x.style.color="rgb(122, 122, 122)",x.style.padding="5px",x.style.margin="5px",x.style.width="30%",x.style.textAlign="right",x.style.display="inline-block",i.appendChild(x);var b=document.createElement("SELECT");for(b.id="pid-select",b.style.fontSize="16px",b.style.color="rgb(122, 122, 122)",b.style.padding="5px",b.style.margin="5px",b.style.width="60%",b.style.border="1px solid #aeaeae",i.appendChild(b),m=0;m<t.length;m++){var v;(v=document.createElement("option")).setAttribute("value",t[m]),y=document.createTextNode(t[m]),v.appendChild(y),b.appendChild(v)}var g=document.createElement("BUTTON");g.innerHTML="Import",g.style.fontSize="16px",g.style.color="rgb(122, 122, 122)",g.style.padding="5px 20px",g.style.margin="20px auto",g.style.display="block",g.onclick=function(){r.style.display="none",r._overlay&&r._overlay.parentNode.removeChild(r._overlay);var k=h.options[h.selectedIndex].value,w=t.indexOf(k);t[w]="id";var S=b.options[b.selectedIndex].value,I=t.indexOf(S);t[I]="pid",e(t)};var _=document.createElement("DIV");return _.appendChild(g),i.appendChild(_),l.onclick=function(k){r._overlay&&r._overlay.parentNode.removeChild(r._overlay),r.parentNode.removeChild(r),k.stopPropagation()},o.onmousedown=function(k){k=k||window.event,r._dragging=!0,r._originalLeft=r.offsetLeft,r._originalTop=r.offsetTop,r._mouseLeft=k.clientX,r._mouseTop=k.clientY},document.onmousemove=function(k){k=k||window.event,r._dragging&&(r.style.left=r._originalLeft+k.clientX-r._mouseLeft+"px",r.style.top=r._originalTop+k.clientY-r._mouseTop+"px")},document.onmouseup=function(k){k=k||window.event,r._dragging&&(r.style.left=r._originalLeft+k.clientX-r._mouseLeft+"px",r.style.top=r._originalTop+k.clientY-r._mouseTop+"px",r._dragging=!1)},r}e(t)},FamilyTree._importCenter=function(t){t&&(t.style.left=(window.innerWidth-t.offsetWidth)/2+"px",t.style.top=(window.innerHeight-t.offsetHeight)/2+"px")},FamilyTree.prototype.importXML=function(){var t=this,e=document.createElement("INPUT");e.setAttribute("type","file"),e.setAttribute("accept",".xml"),e.style.display="none",e.onchange=function(i){var n=i.target,r=new FileReader;r.onload=function(){var o=r.result,a=FamilyTree._xml2json(o);FamilyTree.events.publish("import",[t,a])!=0&&(t._putInUndoStack(),t.clearRedo(),t.config.nodes=a,FamilyTree.events.publish("updated",[t]),t.filterUI.update(),t.draw())},r.readAsText(n.files[0])},e.click()},FamilyTree.prototype.importJSON=function(){var t=this,e=document.createElement("INPUT");e.setAttribute("type","file"),e.setAttribute("accept",".json"),e.style.display="none",e.onchange=function(i){var n=i.target,r=new FileReader;r.onload=function(){var o=r.result,a=JSON.parse(o);FamilyTree.events.publish("import",[t,a])!=0&&(t._putInUndoStack(),t.clearRedo(),t.config.nodes=a,FamilyTree.events.publish("updated",[t]),t.filterUI.update(),t.draw())},r.readAsText(n.files[0])},e.click()},FamilyTree.prototype.__importJSON=FamilyTree.prototype.importJSON,FamilyTree.prototype.importJSON=function(){this.config.roots=[],this.__importJSON()},FamilyTree.prototype.__importCSV=FamilyTree.prototype.importCSV,FamilyTree.prototype.importCSV=function(){this.config.roots=[],this.__importCSV()},FamilyTree.prototype.__importXML=FamilyTree.prototype.importXML,FamilyTree.prototype.importXML=function(){this.config.roots=[],this.__importXML()},FamilyTree._importSetColumnNames=function(t,e){e(t)},FamilyTree.prototype.expand=function(t,e,i){this._resetMovableNodes();var n={id:t,ids:e};this._draw(!1,FamilyTree.action.expand,n,i)},FamilyTree.prototype.collapse=function(t,e,i){this._resetMovableNodes();var n={id:t,ids:e};this._draw(!1,FamilyTree.action.collapse,n,i)},FamilyTree.prototype.expandCollapse=function(t,e,i,n){this._resetMovableNodes(),Array.isArray(e)||(e=[]),Array.isArray(i)||(i=[]);var r={id:t,expandIds:e,collapseIds:i,ids:e.concat(i)};this._draw(!1,FamilyTree.action.collapse,r,n)},FamilyTree.prototype.changeRoots=function(t,e,i){this.config.roots=e;var n={id:t,changeRoots:e};this._draw(!1,FamilyTree.action.update,n,i)},FamilyTree.prototype._resetMovableNodes=function(){if(FamilyTree.RESET_MOVABLE_ONEXPANDCOLLAPSE&&this.config.movable!=null){for(var t=!1,e=0;e<this.config.nodes.length;e++){var i=this.config.nodes[e];i.movex!=null&&(i.movex=0,t=!0),i.movey!=null&&(i.movey=0,t=!0)}t&&FamilyTree.events.publish("updated",[this])}},FamilyTree.prototype.maximize=function(t,e,i,n){var r=this,o={id:t,options:{}};FamilyTree.isNEU(o.id)&&(o.id=this.roots[0].id,o.all=!0),o.options.horizontal=!1,o.options.vertical=!1,e&&(o.options.horizontal=e),i&&(o.options.vertical=i),this._draw(!1,FamilyTree.action.maximize,o,function(){r.ripple(t),n&&n()})},FamilyTree.prototype.minimize=function(t,e){var i=this,n={id:t};FamilyTree.isNEU(n.id)&&(n.id=this.roots[0].id,n.all=!0),this._draw(!1,FamilyTree.action.minimize,n,function(){i.ripple(t),e&&e()})},FamilyTree.prototype._expCollHandler=function(t){this.nodeMenuUI.hide(),this.nodeContextMenuUI.hide(),this.menuUI.hide(),this.nodeCircleMenuUI.hide();var e=this.getNode(t),i=this.getCollapsedIds(e);if(i.length){if(FamilyTree.events.publish("expcollclick",[this,!1,t,i])===!1)return!1;this.expand(t,i,!1)}else{if(FamilyTree.events.publish("expcollclick",[this,!0,t,e.childrenIds])===!1)return!1;this.collapse(t,e.childrenIds,!1)}},FamilyTree.prototype._upHandler=function(t){this.nodeMenuUI.hide(),this.nodeContextMenuUI.hide(),this.menuUI.hide(),this.nodeCircleMenuUI.hide();var e=this._upHandlerCreateArgs(t);if(FamilyTree.events.publish("up-click",[this,e])===!1)return!1;this.changeRoots(e.id,e.roots,!1)},FamilyTree.prototype._upHandlerCreateArgs=function(t){var e,i=this.getNode(t),n=Object.assign([],this.config.roots),r=this.getNode(i.pid);if(r&&(e=r),e){if(Array.isArray(n)){var o=n.indexOf(i.id);o!=-1&&n.splice(o,1)}else n=[];n.push(e.id)}return{id:i.id,roots:n}},FamilyTree.prototype._upHandlerCreateArgs=function(t){var e=this.getNode(t),i=Object.assign([],this.config.roots),n=this.getRecentRootsByNodeId(t);return Array.isArray(i)||(i=[]),FamilyTree._changeRootOption(i,n,this.manager.rootList),{id:e.id,roots:i}},String.prototype.replaceAll||(String.prototype.replaceAll=function(t,e){return this.replace(new RegExp(t,"g"),e)}),String.prototype.endsWith||(String.prototype.endsWith=function(t){return this.indexOf(t,this.length-t.length)!==-1}),String.prototype.splice||(String.prototype.splice=function(t,e,i){return this.slice(0,t)+i+this.slice(t+Math.abs(e))}),String.prototype.insert||(String.prototype.insert=function(t,e){return t>0?this.substring(0,t)+e+this.substr(t):e+this}),Array.prototype.unique||Object.defineProperty(Array.prototype,"unique",{value:function(){for(var t=this.concat(),e=0;e<t.length;++e)for(var i=e+1;i<t.length;++i)t[e]===t[i]&&t.splice(i--,1);return t},writable:!0,configurable:!0,enumerable:!1}),Array.prototype.has||Object.defineProperty(Array.prototype,"has",{value:function(t){for(var e=0;e<this.length;e++)if(this[e]==t)return!0;return!1},writable:!0,configurable:!0,enumerable:!1}),Array.prototype.compare||Object.defineProperty(Array.prototype,"compare",{value:function(t){if(this.length!=t.length)return!1;for(var e=0;e<this.length;e++)if(!t.has(this[e]))return!1;return!0},writable:!0,configurable:!0,enumerable:!1}),Object.assign||Object.defineProperty(Object,"assign",{value:function(t,e){"use strict";if(t==null)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(r!=null)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(i[o]=r[o])}return i},writable:!0,configurable:!0}),FamilyTree.prototype._globalMouseDownHandler=function(t,e){var i={move:"mousemove",up:"mouseup",leave:"mouseleave"};if(e.type.indexOf("touch")!=-1&&(e.touches.length==1?this._touch={x:e.touches[0].clientX,y:e.touches[0].clientY}:this._touch=null,i={move:"touchmove",up:"touchend",touchstart:"touchstart"}),t==e.target)return e.stopPropagation(),e.preventDefault(),void this._mouseDownHandler(t,e,i);if(this.config.nodeMouseClick==FamilyTree.action.pan){for(var n=e.target;n!=t&&!n.hasAttribute(FamilyTree.attr.control_expcoll_id)&&!n.hasAttribute(FamilyTree.attr.control_up_id);)n=n.parentNode;if(!n.hasAttribute(FamilyTree.attr.control_expcoll_id)&&!n.hasAttribute(FamilyTree.attr.control_up_id))return e.stopPropagation(),e.preventDefault(),void this._mouseDownHandler(t,e,i)}for(var r=e.target;r!=t;){if(r.hasAttribute(FamilyTree.attr.node_id))return void this._nodeMouseDownHandler(r,e,i);if(r.hasAttribute(FamilyTree.attr.control_node_circle_menu_name))return e.stopPropagation(),e.preventDefault(),void this._nodeCircleNodeMenuItemMouseDownHandler(r,e,i);r=r.parentNode}},FamilyTree.prototype._globalClickHandler=function(t,e){if(e.type.indexOf("touch")!=-1&&this._touch&&e.changedTouches.length==1){if(e.changedTouches.length){var i={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY},n=FamilyTree.t(this.config.template,!1,this.getScale()).size,r=this.getScale(),o=Math.abs(i.x-this._touch.x)/r,a=Math.abs(i.y-this._touch.y)/r;if(this._touch=null,o>n[0]/10||a>n[1]/10)return}}else if(e.type.indexOf("touch")!=-1&&this._touch==null)return;for(var l=e.target;l!=t;){if(l.hasAttribute(FamilyTree.attr.control_expcoll_id)){var s=l.getAttribute(FamilyTree.attr.control_expcoll_id),c=this.getNode(s);return void this._expCollHandler(c.id)}if(l.hasAttribute(FamilyTree.attr.node_id))return s=l.getAttribute(FamilyTree.attr.node_id),c=this.getNode(s),void this._nodeClickHandler(c.id,e);if(l.hasAttribute(FamilyTree.attr.control_node_menu_id))return e.stopPropagation(),e.preventDefault(),s=l.getAttribute(FamilyTree.attr.control_node_menu_id),c=this.getNode(s),void this._nodeMenuClickHandler(c.id,l,e);if(l.hasAttribute(FamilyTree.attr.control_node_circle_menu_id))return e.stopPropagation(),e.preventDefault(),s=l.getAttribute(FamilyTree.attr.control_node_circle_menu_id),void this._nodeCircleMenuClickHandler(s);if(l.hasAttribute(FamilyTree.attr.control_node_circle_menu_name))return e.stopPropagation(),e.preventDefault(),void this._nodeCircleMenuItemClickHandler(l,e);if(l.hasAttribute(FamilyTree.attr.control_add))return void this._lonelyButtonHandler();if(l.hasAttribute(FamilyTree.attr.control_up_id))return s=l.getAttribute(FamilyTree.attr.control_up_id),e.stopPropagation(),e.preventDefault(),void this._upHandler(s);if(l.hasAttribute(FamilyTree.attr.c_link_from))return void FamilyTree.events.publish("clink-click",[this,{from:l.getAttribute(FamilyTree.attr.c_link_from),to:l.getAttribute(FamilyTree.attr.c_link_to),event:e}]);if(l.hasAttribute(FamilyTree.attr.s_link_from))return void FamilyTree.events.publish("slink-click",[this,{from:l.getAttribute(FamilyTree.attr.s_link_from),to:l.getAttribute(FamilyTree.attr.s_link_to),event:e}]);l=l.parentNode}},FamilyTree.prototype._globalContextHandler=function(t,e){for(var i=e.target;i!=t;){if(i.hasAttribute(FamilyTree.attr.node_id)){var n=i.getAttribute(FamilyTree.attr.node_id),r=this.getNode(n);return void this._nodeContextHandler(r.id,e)}i=i.parentNode}},FamilyTree.prototype._nodeContextHandler=function(t,e){e.preventDefault(),FamilyTree.SEARCH_CLOSE_RESULT_ON_ESCAPE_OR_CLICKOUTSIDE&&this.searchUI.hide(),this.nodeMenuUI.hide(),this.nodeContextMenuUI.hide(),this.menuUI.hide(),this.nodeCircleMenuUI.hide();var i=this.get(t),n=null;if(i!=null&&Array.isArray(i.tags))for(var r=0;r<i.tags.length;r++){var o=i.tags[r];this.config.tags[o]&&this.config.tags[o].nodeContextMenu&&(n=this.config.tags[o].nodeContextMenu)}var a=this.element.getBoundingClientRect(),l=e.clientX-a.left,s=e.clientY-a.top;this.nodeContextMenuUI.show(l,s,t,null,n)},FamilyTree.prototype._globalDbClickHandler=function(t,e){for(var i=e.target;i!=t;){if(i.hasAttribute(FamilyTree.attr.node_id)){var n=i.getAttribute(FamilyTree.attr.node_id),r=this.getNode(n);return void this._nodeDbClickHandler(r.id,e)}i=i.parentNode}},FamilyTree.prototype._mouseScrollHandler=function(t,e){this.__mouseScrollHandler(this.getSvg(),e)},FamilyTree.prototype.__mouseScrollHandler=function(t,e){if(e.ctrlKey){if(this.config.mouseScrool==FamilyTree.action.zoom)return}else if(this.config.mouseScrool==FamilyTree.action.ctrlZoom||this.config.mouseScrool!=FamilyTree.action.zoom)return;var i=this,n=!1,r=this.config.zoom.speed,o=this.config.zoom.smooth,a=0,l=this.getScale(),s=FamilyTree._centerPointInPercent(t,e.pageX,e.pageY),c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(p){setTimeout(p,20)};e.preventDefault();var d=e.delta||e.wheelDelta;d===void 0&&(d=-e.detail),d=Math.max(-1,Math.min(1,d)),a+=-d*r,n||function p(){n=!0;var h=(a-l)/o;h>0?h++:h--,l+=h,i.zoom(1-h/12/50,s),parseInt(l)==parseInt(a)?n=!1:c(p)}()},FamilyTree.prototype._nodeCircleNodeMenuItemMouseDownHandler=function(t,e,i){var n=t.parentNode.getAttribute(FamilyTree.attr.control_node_circle_menu_wrraper_id),r=t.getAttribute(FamilyTree.attr.control_node_circle_menu_name),o=this.nodeCircleMenuUI._menu[r];if(o.draggable){var a=this,l=FamilyTree._getClientXY(e),s=this.getNode(n);t._dragEventFired=!1;var c=a.getScale(),d=null,p=null;this._gragStartedId=n,document.body.style.mozUserSelect=document.body.style.webkitUserSelect=document.body.style.userSelect="none";var h=this.getSvg(),f={x:l.x,y:l.y},m=t.cloneNode(!0);h.insertBefore(m,h.firstChild);var y=FamilyTree._getTransform(m),x=y[4],u=y[5],b=function(k){for(;k&&!k.hasAttribute(FamilyTree.attr.control_node_circle_menu_wrraper_id);)k=k.parentNode;if(k){var w=FamilyTree._getTransform(k);return{x:w[4],y:w[5]}}console.error("cannot find parent"+FamilyTree.attr.control_node_circle_menu_wrraper_id)}(t);m.setAttribute("transform","matrix(1,0,0,1,"+(x+b.x)+","+(u+b.y)+")"),m.style.opacity=.7;var v=function(k,w){if(k!=null){w.classList.remove("bft-drag-over");for(var S=FamilyTree.getStParentNodes(a.getNode(d)),I=0;I<S.length;I++){var M=a.getNodeElement(S[I].id);M&&(M.style.opacity=1)}}},g=function(k){if(f){var w=FamilyTree._getClientXY(k),S=k.target;FamilyTree.isMobile()&&(S=document.elementFromPoint(w.x,w.y)),w.x+=b.x*c,w.y+=b.y*c;var I=FamilyTree._getOffsetXY(a.element,k),M={left:a.width()-(I.x+a.config.padding)<0,right:I.x-a.config.padding<0,up:a.height()-(I.y+a.config.padding)<0,down:I.y-a.config.padding<0};if(M.left||M.right||M.up||M.down){h.classList&&(h.classList.remove("bft-cursor-grab"),h.classList.add("bft-cursor-move"),h.classList.remove("bft-cursor-nodrop"),h.classList.remove("bft-cursor-copy"));var N=y[4],A=y[5],B=f.x,P=f.y,T=w.x,O=w.y;a.moveStart(M,function(z){y[4]=N+z.x,y[5]=A+z.y,f.x=B-z.xWithoutScale,f.y=P-z.yWithoutScale,w.x=T-z.xWithoutScale,w.y=O-z.yWithoutScale,m.setAttribute("transform","matrix("+y.toString()+")")})}else{for(a.moveEnd(),h.classList&&(h.classList.add("bft-cursor-grab"),h.classList.remove("bft-cursor-move"),h.classList.remove("bft-cursor-nodrop"),h.classList.remove("bft-cursor-copy")),v(d,p),d=null,p=null;S!=null&&S!=h;){if(S.hasAttribute&&S.hasAttribute(FamilyTree.attr.node_id)){var L=S.getAttribute(FamilyTree.attr.node_id);d=L,p=S;break}S=S.parentNode}if(d!=null){p.classList.add("bft-drag-over");for(var U=a.getNode(d),D=FamilyTree.getStParentNodes(U),R=0;R<D.length;R++){var H=a.getNodeElement(D[R].id);H&&(H.style.opacity=.1)}h.classList.remove("bft-cursor-grab"),h.classList.remove("bft-cursor-move"),h.classList.add("bft-cursor-copy"),h.classList.remove("bft-cursor-nodrop")}var Y=(w.x-f.x)/c,C=(w.y-f.y)/c;y[4]=x+Y,y[5]=u+C,!t._dragEventFired&&(Math.abs(w.x-f.x)>FamilyTree.FIRE_DRAG_NOT_CLICK_IF_MOVE||Math.abs(w.y-f.y)>FamilyTree.FIRE_DRAG_NOT_CLICK_IF_MOVE)&&(FamilyTree.events.publish("drag",[a.nodeCircleMenuUI,{from:L,menuItem:o,menuItemName:r}])===!1&&_(),t._dragEventFired=!0),m.setAttribute("transform","matrix("+y.toString()+")")}}},_=function(k){if(a.moveEnd(),h.classList&&(h.classList.remove("bft-cursor-grab"),h.classList.remove("bft-cursor-move"),h.classList.remove("bft-cursor-nodrop"),h.classList.remove("bft-cursor-copy")),h.removeEventListener(i.move,g),h.removeEventListener(i.up,_),i.leave&&h.removeEventListener(i.leave,_),s.id==d||d==null)return h.removeChild(m),a._gragStartedId=null,void(t._dragEventFired&&FamilyTree.events.publish("drop",[a.nodeCircleMenuUI,{from:s.id,menuItemName:r,menuItem:o,event:k}]));var w=a.getNode(d);FamilyTree.events.publish("drop",[a.nodeCircleMenuUI,{from:s.id,to:w.id,menuItem:o,menuItemName:r,event:k}]),v(d,p),h.removeChild(m),a._gragStartedId=null};h.addEventListener(i.move,g),h.addEventListener(i.up,_),i.leave&&h.addEventListener(i.leave,_)}},FamilyTree.prototype._nodeMouseDownHandler=function(t,e,i){var n=t.getAttribute(FamilyTree.attr.node_id),r=this.getNode(n);this.config.movable&&!FamilyTree.getRootOf(r).stParent?this._movableHandler(t,e,i):this.config.enableDragDrop&&this._dragDropHandler(t,e,i)},FamilyTree.prototype._movableHandler=function(t,e,i){var n=this,r=t.getAttribute(FamilyTree.attr.node_id),o=[],a=function(O,L){if(Array.isArray(O))for(var U=0;U<O.length;U++)a(O[U],L);else{for(L.push(O.id),U=0;U<O.stChildren.length;U++)a(O.stChildren[U],L);for(U=0;U<O.children.length;U++)a(O.children[U],L)}},l=function(O,L){if(Array.isArray(O))for(var U=0;U<O.length;U++)a(O[U],L);else{for(L.push(O.id),U=0;U<O.stChildrenIds.length;U++)l(n.getNode(O.stChildrenIds[U]),L);for(U=0;U<O.childrenIds.length;U++)l(n.getNode(O.childrenIds[U]),L)}},s=this.getNode(r);a(s,o);for(var c=this.getSvg(),d=FamilyTree._getClientXY(e),p=[],h=[],f=[],m=[],y=[],x=[],u=[],b=[],v=0;v<o.length;v++){var g=this.getNode(o[v]);p.push(g),f.push({x:g.x,y:g.y});var _=this.getNodeElement(o[v]);if(_){y.push(_);var k=FamilyTree._getTransform(_);m.push({x:k[4],y:k[5]}),h.push(k);var w=this.element.querySelector(`[data-ctrl-ec-id="${o[v]}"]`);if(w){x.push(w);var S=FamilyTree._getTransform(w);u.push(S),b.push({x:S[4],y:S[5]})}else x.push(null),u.push(null),b.push(null);if(this.config.movable==FamilyTree.movable.node)break}}t._dragEventFired=!1;var I=null,M=null;this._gragStartedId=o[0],document.body.style.mozUserSelect=document.body.style.webkitUserSelect=document.body.style.userSelect="none";var N={x:d.x,y:d.y},A=n.getScale(),B=function(O,L){if(O!=null){L.classList.remove("bft-drag-over");for(var U=n.getNode(I),D=FamilyTree.getStParentNodes(U),R=0;R<D.length;R++){var H=n.getNodeElement(D[R].id);H&&(H.style.opacity=1)}}},P=function(O){if(N){var L=FamilyTree._getClientXY(O),U=O.target;FamilyTree.isMobile()&&(U=document.elementFromPoint(L.x,L.y));var D=FamilyTree._getOffsetXY(n.element,O),R={left:n.width()-(D.x+n.config.padding)<0,right:D.x-n.config.padding<0,up:n.height()-(D.y+n.config.padding)<0,down:D.y-n.config.padding<0};if(R.left||R.right||R.up||R.down){c.classList&&(c.classList.remove("bft-cursor-grab"),c.classList.add("bft-cursor-move"),c.classList.remove("bft-cursor-nodrop"),c.classList.remove("bft-cursor-copy"));for(var H=[],Y=[],C=[],z=[],E=0;E<h.length;E++)H.push(h[E][4]),Y.push(h[E][5]),u[E]?(C.push(u[E][4]),z.push(u[E][5])):(C.push(null),z.push(null));var V=N.x,W=N.y,mt=L.x,ot=L.y;n.moveStart(R,function(K){for(var F=0;F<h.length;F++){var at=H[F],st=Y[F],xt=C[F],bt=z[F];h[F][4]=at+K.x,h[F][5]=st+K.y,N.x=V-K.xWithoutScale,N.y=W-K.yWithoutScale,L.x=mt-K.xWithoutScale,L.y=ot-K.yWithoutScale,p[F].x=at+K.x,p[F].y=st+K.y,p[F].movex=K.x,p[F].movey=K.y,u[F]&&(u[F][4]=xt+K.x,u[F][5]=bt+K.y);for(var Z=FamilyTree.ui.link(p[F],n,A,n.response.bordersByRootIdAndLevel,n.nodes,FamilyTree.action.update,!0),J=0;J<Z.length;J++){var it=Z[J];(q=n.element.querySelector(`[data-l-id="[${it.id}][${it.childId}]"]`))&&(q.innerHTML=it.html)}if(p[F].parent)for(Z=FamilyTree.ui.link(p[F].parent,n,A,n.response.bordersByRootIdAndLevel,n.nodes,FamilyTree.action.update,!0),J=0;J<Z.length;J++){var q;it=Z[J],(q=n.element.querySelector(`[data-l-id="[${it.id}][${it.childId}]"]`))&&(q.innerHTML=it.html)}y[F].setAttribute("transform","matrix("+h[F].toString()+")"),x[F]&&x[F].setAttribute("transform","matrix("+u[F].toString()+")")}})}else{if(n.moveEnd(),c.classList&&(c.classList.add("bft-cursor-grab"),c.classList.remove("bft-cursor-move"),c.classList.remove("bft-cursor-nodrop"),c.classList.remove("bft-cursor-copy")),B(I,M),I=null,M=null,n.config.enableDragDrop)for(;U!=null&&U!=c;){if(U.hasAttribute&&U.hasAttribute(FamilyTree.attr.node_id)){var lt=U.getAttribute(FamilyTree.attr.node_id);if(n._gragStartedId&&lt!=n._gragStartedId){I=lt,M=U;break}}U=U.parentNode}if(I!=null){M.classList.add("bft-drag-over");for(var tt=n.getNode(I),X=FamilyTree.getStParentNodes(tt),G=0;G<X.length;G++){var nt=n.getNodeElement(X[G].id);nt&&(nt.style.opacity=.1)}!n.canUpdateLink(p[0].id,I)&&c.classList?(c.classList.remove("bft-cursor-grab"),c.classList.remove("bft-cursor-move"),c.classList.remove("bft-cursor-copy"),c.classList.add("bft-cursor-nodrop")):c.classList&&(c.classList.remove("bft-cursor-grab"),c.classList.remove("bft-cursor-move"),c.classList.add("bft-cursor-copy"),c.classList.remove("bft-cursor-nodrop"))}var et=(L.x-N.x)/A,pt=(L.y-N.y)/A;for(E=0;E<h.length;E++){h[E][4]=m[E].x+et,h[E][5]=m[E].y+pt,u[E]&&(u[E][4]=b[E].x+et,u[E][5]=b[E].y+pt),p[E].x=f[E].x+et,p[E].y=f[E].y+pt,p[E].movex=et,p[E].movey=pt;var ht=FamilyTree.ui.link(p[E],n,A,n.response.bordersByRootIdAndLevel,n.nodes,FamilyTree.action.update,!0);for(G=0;G<ht.length;G++){var rt=ht[G];(j=n.element.querySelector(`[data-l-id="[${rt.id}][${rt.childId}]"]`))&&(j.innerHTML=rt.html)}}if(s.parent)if(n.config.movable==FamilyTree.movable.detachTree)(j=n.element.querySelector(`[data-l-id="[${s.parent.id}][${s.id}]"]`))&&j.parentElement.removeChild(j);else for(ht=FamilyTree.ui.link(s.parent,n,A,n.response.bordersByRootIdAndLevel,n.nodes,FamilyTree.action.update,!0),G=0;G<ht.length;G++){var j;rt=ht[G],(j=n.element.querySelector(`[data-l-id="[${rt.id}][${rt.childId}]"]`))&&(j.innerHTML=rt.html)}if(!t._dragEventFired&&(Math.abs(L.x-N.x)>FamilyTree.FIRE_DRAG_NOT_CLICK_IF_MOVE||Math.abs(L.y-N.y)>FamilyTree.FIRE_DRAG_NOT_CLICK_IF_MOVE)){if(FamilyTree.events.publish("drag",[n,r,O,o])===!1&&T(),n.config.enableDragDrop)for(E=0;E<y.length;E++)c.insertBefore(y[E],c.firstChild);t._dragEventFired=!0}for(E=0;E<h.length;E++)y[E].setAttribute("transform","matrix("+h[E].toString()+")"),x[E]&&x[E].setAttribute("transform","matrix("+u[E].toString()+")")}}},T=function(O){for(var L=0;L<p.length;L++)p[L].x=f[L].x,p[L].y=f[L].y;if(n.moveEnd(),c.classList&&(c.classList.remove("bft-cursor-grab"),c.classList.remove("bft-cursor-move"),c.classList.remove("bft-cursor-nodrop"),c.classList.remove("bft-cursor-copy")),c.removeEventListener(i.move,P),c.removeEventListener(i.up,T),i.leave&&c.removeEventListener(i.leave,T),p[0].id!=I&&I!=null){var U=n.getNode(I);if((D=FamilyTree.events.publish("drop",[n,p[0].id,U.id,y[0],O]))===!1)return B(I,M),void(n._gragStartedId=null);n.canUpdateLink(p[0].id,I)?((z=n.get(p[0].id)).pid=I,z.stpid=null,n.updateNode(z,null,!0)):B(I,M),n._gragStartedId=null}else{if(t._dragEventFired){var D=FamilyTree.events.publish("drop",[n,p[0].id,void 0,y[0],O]);if(n.config.movable&&D!==!1)if(n.config.movable==FamilyTree.movable.detachTree){var R=FamilyTree._getTransform(n.getNodeElement(s.id));(z=n.get(s.id)).pid=null,z.stpid=null,n.updateNode(z,null,!0)}else{var H=[];n.config.movable==FamilyTree.movable.node?H.push(s.id):l(s,H);var Y=(R=FamilyTree._getTransform(n.getNodeElement(s.id)))[4]-s.x,C=R[5]-s.y;for(L=0;L<H.length;L++){var z;(z=n.get(H[L]))&&(z.movex!=null?z.movex+=Y:z.movex=Y,z.movey!=null?z.movey+=C:z.movey=C,n.update(z))}FamilyTree.events.publish("updated",[n]),n.draw(FamilyTree.action.update,{dragNodeIdList:H})}}n._gragStartedId=null}};c.addEventListener(i.move,P),c.addEventListener(i.up,T),i.leave&&c.addEventListener(i.leave,T)},FamilyTree.prototype._dragDropHandler=function(t,e,i){var n=FamilyTree._getClientXY(e),r=t.getAttribute(FamilyTree.attr.node_id),o=this.getNode(r);t._dragEventFired=!1;var a=null,l=null;this._gragStartedId=r,this.element.style.mozUserSelect=this.element.style.webkitUserSelect=this.element.style.userSelect="none";var s=this,c=this.getSvg(),d={x:n.x,y:n.y},p=FamilyTree._getTransform(t),h=p[4],f=p[5],m=s.getScale(),y=t.cloneNode(!0);y.setAttribute("data-n-id","draging"),c.insertBefore(y,c.firstChild),y.style.opacity=.7;var x=function(v,g){if(v!=null){g.classList.remove("bft-drag-over");for(var _=s.getNode(a),k=FamilyTree.getStParentNodes(_),w=0;w<k.length;w++){var S=s.getNodeElement(k[w].id);S&&(S.style.opacity=1)}}},u=function(v){if(d){var g=FamilyTree._getClientXY(v),_=v.target;FamilyTree.isMobile()&&(_=document.elementFromPoint(g.x,g.y));var k=FamilyTree._getOffsetXY(s.element,v),w={left:s.width()-(k.x+s.config.padding)<0,right:k.x-s.config.padding<0,up:s.height()-(k.y+s.config.padding)<0,down:k.y-s.config.padding<0};if(w.left||w.right||w.up||w.down){c.classList&&(c.classList.remove("bft-cursor-grab"),c.classList.add("bft-cursor-move"),c.classList.remove("bft-cursor-nodrop"),c.classList.remove("bft-cursor-copy"));var S=p[4],I=p[5],M=d.x,N=d.y,A=g.x,B=g.y;s.moveStart(w,function(H){p[4]=S+H.x,p[5]=I+H.y,d.x=M-H.xWithoutScale,d.y=N-H.yWithoutScale,g.x=A-H.xWithoutScale,g.y=B-H.yWithoutScale,y.setAttribute("transform","matrix("+p.toString()+")")})}else{if(s.moveEnd(),c.classList&&(c.classList.add("bft-cursor-grab"),c.classList.remove("bft-cursor-move"),c.classList.remove("bft-cursor-nodrop"),c.classList.remove("bft-cursor-copy")),x(a,l),a=null,l=null,s.config.enableDragDrop)for(;_!=null&&_!=c;){if(_.hasAttribute&&_.hasAttribute(FamilyTree.attr.node_id)){var P=_.getAttribute(FamilyTree.attr.node_id);if(s._gragStartedId&&P!=s._gragStartedId){a=P,l=_;break}}_=_.parentNode}if(a=="draging"&&(a=null,l=null),a!=null){l.classList.add("bft-drag-over");for(var T=s.getNode(a),O=FamilyTree.getStParentNodes(T),L=0;L<O.length;L++){var U=s.getNodeElement(O[L].id);U&&(U.style.opacity=.1)}!s.canUpdateLink(o.id,a)&&c.classList?(c.classList.remove("bft-cursor-grab"),c.classList.remove("bft-cursor-move"),c.classList.remove("bft-cursor-copy"),c.classList.add("bft-cursor-nodrop")):c.classList&&(c.classList.remove("bft-cursor-grab"),c.classList.remove("bft-cursor-move"),c.classList.add("bft-cursor-copy"),c.classList.remove("bft-cursor-nodrop"))}var D=(g.x-d.x)/m,R=(g.y-d.y)/m;p[4]=h+D,p[5]=f+R,!t._dragEventFired&&(Math.abs(g.x-d.x)>FamilyTree.FIRE_DRAG_NOT_CLICK_IF_MOVE||Math.abs(g.y-d.y)>FamilyTree.FIRE_DRAG_NOT_CLICK_IF_MOVE)&&(FamilyTree.events.publish("drag",[s,P,v])===!1&&b(),t._dragEventFired=!0),y.setAttribute("transform","matrix("+p.toString()+")")}}},b=function(v){if(s.moveEnd(),c.classList&&(c.classList.remove("bft-cursor-grab"),c.classList.remove("bft-cursor-move"),c.classList.remove("bft-cursor-nodrop"),c.classList.remove("bft-cursor-copy")),c.removeEventListener(i.move,u),c.removeEventListener(i.up,b),i.leave&&c.removeEventListener(i.leave,b),o.id==a||a==null)return t._dragEventFired&&FamilyTree.events.publish("drop",[s,o.id,void 0,y,v]),c.removeChild(y),void(s._gragStartedId=null);var g=s.getNode(a);if(FamilyTree.events.publish("drop",[s,o.id,g.id,y,v])===!1)return x(a,l),c.removeChild(y),void(s._gragStartedId=null);if(s.canUpdateLink(o.id,a)){var _=s.get(o.id);_.pid=a,_.stpid=null,_.movex!=null&&(_.movex=void 0),_.movey!=null&&(_.movey=void 0),s.updateNode(_,null,!0)}else c.removeChild(y),x(a,l);s._gragStartedId=null};c.addEventListener(i.move,u),c.addEventListener(i.up,b),i.leave&&c.addEventListener(i.leave,b)},FamilyTree.prototype._resizeHandler=function(t,e){if(this.isVisible){var i=this.getViewBox(),n=this.getSvg(),r=n.getAttribute("width"),o=n.getAttribute("height"),a=r/i[2],l=o/i[3],s=a>l?l:a;n.setAttribute("width",this.width()),n.setAttribute("height",this.height()),i[2]=this.width()/s,i[3]=this.height()/s,this.setViewBox(i),this.xScrollUI.create(this.width()),this.yScrollUI.create(this.height()),this._draw(!1,FamilyTree.action.resize)}},FamilyTree.prototype._nodeDbClickHandler=function(t,e){if(FamilyTree.events.publish("dbclick",[this,this.get(t)])===!1)return!1;this._commonClickHandler(t,e,this.config.nodeMouseDbClick)},FamilyTree.prototype._nodeClickHandler=function(t,e){var i=this.getNodeElement(t);if(i&&i._dragEventFired)i._dragEventFired=!1;else{if(FamilyTree.events.publish("click",[this,{node:this.getNode(t),event:e}])===!1)return!1;this._commonClickHandler(t,e,this.config.nodeMouseClick)}},FamilyTree.prototype._nodeCircleMenuItemClickHandler=function(t,e){var i=t.parentNode.getAttribute(FamilyTree.attr.control_node_circle_menu_wrraper_id),n=t.getAttribute(FamilyTree.attr.control_node_circle_menu_name),r=this.nodeCircleMenuUI._menu[n];FamilyTree.events.publish("click",[this.nodeCircleMenuUI,{nodeId:i,menuItemName:n,menuItem:r,event:e}])},FamilyTree.prototype._nodeCircleMenuClickHandler=function(t){FamilyTree.SEARCH_CLOSE_RESULT_ON_ESCAPE_OR_CLICKOUTSIDE&&this.searchUI.hide(),this.nodeMenuUI.hide(),this.nodeContextMenuUI.hide(),this.menuUI.hide();var e=this.getNode(t),i=null;if(Array.isArray(e.tags))for(var n=0;n<e.tags.length;n++){var r=e.tags[n];this.config.tags[r]&&this.config.tags[r].nodeCircleMenu&&(i=this.config.tags[r].nodeCircleMenu)}this.nodeCircleMenuUI.show(t,i)},FamilyTree.prototype._commonClickHandler=function(t,e,i){var n;FamilyTree.SEARCH_CLOSE_RESULT_ON_ESCAPE_OR_CLICKOUTSIDE&&this.searchUI.hide(),this.nodeMenuUI.hide(),this.nodeContextMenuUI.hide(),this.menuUI.hide(),this.nodeCircleMenuUI.hide(),i==FamilyTree.action.expandCollapse&&this.toggleExpandCollapse(t,e),i==FamilyTree.action.edit&&(n=this.getNode(t))&&(this.editUI.show(n.id),this.ripple(n.id,e.clientX,e.clientY)),i==FamilyTree.action.details&&(n=this.getNode(t))&&(this.editUI.show(n.id,!0),this.ripple(n.id,e.clientX,e.clientY))},FamilyTree.prototype._menuHandlerMouseDownHandler=function(t,e){e.stopPropagation(),e.preventDefault()},FamilyTree.prototype._nodeMenuClickHandler=function(t,e,i){FamilyTree.SEARCH_CLOSE_RESULT_ON_ESCAPE_OR_CLICKOUTSIDE&&this.searchUI.hide(),this.nodeMenuUI.hide(),this.nodeContextMenuUI.hide(),this.menuUI.hide(),this.nodeCircleMenuUI.hide();var n=this.getNode(t),r=null;if(Array.isArray(n.tags))for(var o=0;o<n.tags.length;o++){var a=n.tags[o];this.config.tags[a]&&this.config.tags[a].nodeMenu&&(r=this.config.tags[a].nodeMenu)}this.nodeMenuUI.showStickIn(e,t,null,r)},FamilyTree.prototype._menuClickHandler=function(t,e){e.stopPropagation(),e.preventDefault(),this.nodeMenuUI.hide(),this.nodeContextMenuUI.hide(),this.menuUI.show(t.offsetLeft,t.offsetTop)},FamilyTree.prototype._lonelyButtonHandler=function(){var t={id:this.generateId()};this.addNode(t,null,!0)!==!1&&this.center(t.id)},FamilyTree.prototype.toggleExpandCollapse=function(t,e){var i=this.getNode(t),n=this.getCollapsedIds(i);if(n.length){if(FamilyTree.events.publish("expcollclick",[this,!1,t,n])===!1)return!1;this.expand(t,n,!1)}else{if(FamilyTree.events.publish("expcollclick",[this,!0,t,i.childrenIds])===!1)return!1;this.collapse(t,i.childrenIds,!1)}e&&this.ripple(i.id,e.clientX,e.clientY)},FamilyTree.prototype._move=function(t,e,i){i[0]=e,i[1]=t,this.setViewBox(i),this.xScrollUI.setPosition(),this.yScrollUI.setPosition()},FamilyTree.prototype.moveStart=function(t,e,i,n){if(t){if(!this._moveInterval){var r=this,o=this.getViewBox().slice(0),a=this.getScale(),l=0,s=0,c=1;FamilyTree.isNEU(i)&&(i=FamilyTree.anim.inSin),FamilyTree.isNEU(n)&&(n=3e3),this._moveInterval=setInterval(function(){var d={x:0,y:0,xWithoutScale:0,yWithoutScale:0};t.left?(l++,d.x=l*FamilyTree.MOVE_STEP/a,d.xWithoutScale=l*FamilyTree.MOVE_STEP):t.right&&(l++,d.x=-l*FamilyTree.MOVE_STEP/a,d.xWithoutScale=-l*FamilyTree.MOVE_STEP),t.up?(s++,d.y=s*FamilyTree.MOVE_STEP/a,d.yWithoutScale=s*FamilyTree.MOVE_STEP):t.down&&(s++,d.y=-s*FamilyTree.MOVE_STEP/a,d.yWithoutScale=-s*FamilyTree.MOVE_STEP);var p=i((10*c-10)/n);d.x=d.x*p,d.xWithoutScale=d.xWithoutScale*p,d.y=d.y*p,d.yWithoutScale=d.yWithoutScale*p,r.setViewBox([o[0]+d.x,o[1]+d.y,o[2],o[3]]),e&&e(d),c+=1},10)}}else console.error("movePosition parameter not defined")},FamilyTree.prototype.moveEnd=function(){this._moveInterval&&(clearInterval(this._moveInterval),this._moveInterval=null)},FamilyTree===void 0&&(FamilyTree={}),FamilyTree.node=function(t,e,i,n){this.templateName=n,this.id=t,this.pid=e,this.children=[],this.childrenIds=[],this.parent=null,this.stpid=null,this.stParent=null,this.stChildren=[],this.stChildrenIds=[],this.tags=i,this.tags||(this.tags=[])},FamilyTree.prototype._mouseDownHandler=function(t,e,i){var n=this;FamilyTree.HIDE_EDIT_FORM_ON_PAN&&this.editUI.hide(),FamilyTree.SEARCH_CLOSE_RESULT_ON_ESCAPE_OR_CLICKOUTSIDE&&this.searchUI.hide(),this.nodeMenuUI.hide(),this.nodeContextMenuUI.hide(),this.menuUI.hide(),this.nodeCircleMenuUI.hide();var r=this.getViewBox(),o=this.getScale(),a=FamilyTree._getClientTouchesXY(e,0),l=FamilyTree._getClientTouchesXY(e,1),s={diffX:0,diffY:0,x0:a.x,y0:a.y,type:"pan",viewBoxLeft:r[0],viewBoxTop:r[1]};e.touches&&e.touches.length>1&&(s.type="pinch",s.dist=Math.sqrt((a.x-l.x)*(a.x-l.x)+(a.y-l.y)*(a.y-l.y))),s.type=="pan"&&(this._hideBeforeAnimation(),this._changeCursorOnPanStart(r,o,e));var c=function(p){var h=FamilyTree._getClientTouchesXY(p,0);if(s&&s.type=="pan"){n._hideBeforeAnimation(),s.diffX=h.x-s.x0,s.diffY=h.y-s.y0;var f=-s.diffY/o+s.viewBoxTop,m=-s.diffX/o+s.viewBoxLeft;n._move(f,m,r)}else if(s&&s.type=="pinch"){var y=FamilyTree._getClientTouchesXY(p,1),x=Math.sqrt((h.x-y.x)*(h.x-y.x)+(h.y-y.y)*(h.y-y.y)),u=1+(x-s.dist)/(s.dist/100)/100;s.dist=x;var b=FamilyTree._pinchMiddlePointInPercent(n.element,n.width(),n.height(),p);n.zoom(u,b)}},d=function(){s.type=="pan"&&n.config.sticky?setTimeout(function(){FamilyTree._moveToBoundaryArea(t,n.getViewBox(),n.response.boundary,function(){n._draw(!0,FamilyTree.action.pan)})},0):s.type!="pan"||n.config.sticky||setTimeout(function(){n._draw(!0,FamilyTree.action.pan)},0),s.type=="pan"&&n._changeCursorOnPanEnd(),s=null,t.removeEventListener(i.move,c),t.removeEventListener(i.up,d),i.leave&&t.removeEventListener(i.leave,d),i.touchstart&&t.removeEventListener(i.touchstart,d)};this.config.enablePan&&(t.addEventListener(i.move,c),t.addEventListener(i.up,d),i.leave&&t.addEventListener(i.leave,d),i.touchstart&&t.addEventListener(i.touchstart,d))},FamilyTree.prototype._changeCursorOnPanStart=function(t,e,i){var n=this.getPointerElement(),r=FamilyTree._getOffsetXY(this.element,i),o=r.x/e+t[0]-16/e,a=r.y/e+t[1]-16/e;n.style.display="inherit",n.setAttribute("transform","matrix(0,0,0,0,"+o+","+a+")"),FamilyTree.animate(n,{transform:[0,0,0,0,o,a],opacity:0},{transform:[1/e,0,0,1/e,o,a],opacity:1},300,FamilyTree.anim.outBack)},FamilyTree.prototype._changeCursorOnPanEnd=function(){this.getPointerElement().style.display="none"},FamilyTree.searchUI=function(){this.lastSearch=[],this._searchAfterEnterPress=!1,this._event_id=FamilyTree._guid(),this.instance=null},FamilyTree.searchUI.prototype.init=function(t){this.instance=t,this.obj=this.instance,this._initSearchFields();var e=this,i=this.instance.config.padding-10,n=this.instance.config.padding-10,r=this.instance.getMenuButton();if(r){var o=r.getBoundingClientRect(),a=this.instance.getSvg().getBoundingClientRect();i=a.right-o.left+10,n=o.top-a.top-10}var l=document.createElement("div");l.classList.add("bft-search"),l.style.right=i+"px",l.style.top=n+"px";var s=FamilyTree.elements.textbox({},{label:FamilyTree.SEARCH_PLACEHOLDER,btn:"X"},"320px");l.innerHTML+=s.html,this.xBtn=l.querySelector("[data-input-btn]"),this.xBtn.style.display="none",this.searchTableWrapper=document.createElement("div"),l.appendChild(this.searchTableWrapper);var c=this.instance.getSvg().nextSibling;this.instance.element.insertBefore(l,c),FamilyTree.input.init(l),this.input=document.getElementById(s.id),this.xBtn.addEventListener("click",function(h){h.preventDefault(),e.hide()}),this.input.addEventListener("keypress",function(h){h.key=="Enter"&&h.preventDefault()}),this.input.addEventListener("focus",function(h){e.xBtn.style.display="",e._search()}),this.input.addEventListener("blur",function(h){FamilyTree.isNEU(e.input.value)&&FamilyTree.SEARCH_HELP_SYMBOL!=e.input.value&&(e.xBtn.style.display="none")}),this.input.addEventListener("keydown",function(h){(h.key=="ArrowDown"||h.key=="ArrowUp")&&h.preventDefault()}),this.input.addEventListener("keyup",function(h){h.key=="ArrowDown"?d():h.key=="ArrowUp"?p():h.key=="Enter"?e._enterHandler():h.key=="Escape"?e.hide():this.value.length>=FamilyTree.MINIMUM_SYMBOLS_IN_SEARCH_INPUT&&e._search()});var d=function(){var h=e.instance.element.querySelectorAll("[data-search-item-id]"),f=e.instance.element.querySelector('[data-selected="yes"]');f==null&&h.length>0?h[0].setAttribute("data-selected","yes"):h.length>0&&f.nextSibling&&f.nextSibling.setAttribute&&(f.removeAttribute("data-selected"),f.nextSibling.setAttribute("data-selected","yes"))},p=function(){var h=e.instance.element.querySelectorAll("[data-search-item-id]"),f=e.instance.element.querySelector('[data-selected="yes"]');f==null&&h.length>0?h[h.length-1].setAttribute("data-selected","yes"):h.length>0&&f.previousSibling&&f.previousSibling.setAttribute&&(f.removeAttribute("data-selected"),f.previousSibling.setAttribute("data-selected","yes"))}},FamilyTree.searchUI.prototype._enterHandler=function(){var t=this.instance.element.querySelector('[data-selected="yes"]');if(t){if(t.hasAttribute("data-search-item-id")){var e=t.getAttribute("data-search-item-id");if(this.input.value!=FamilyTree.SEARCH_HELP_SYMBOL){var i=FamilyTree.events.publish("",[this.instance,e]),n=FamilyTree.events.publish("searchclick",[this,{nodeId:e}]);i===!1&&(n=!1),n!=0&&this.instance.center(e)}else this.input.value=e+" ",this.searchTableWrapper.innerHTML=""}}else this._searchAfterEnterPress=!0,this.__search(),this.searchTableWrapper.innerHTML="",this.instance.draw()},FamilyTree.searchUI.prototype._initSearchFields=function(){if(this.instance.config.searchFields==null){this._searchFields=[];for(var t=0;t<this.instance.response.allFields.length;t++){var e=this.instance.response.allFields[t];e=="tags"||FamilyTree._fieldIsImg(this.instance.config,e)||this._searchFields.indexOf(e)==-1&&this._searchFields.push(e)}}else this._searchFields=this.instance.config.searchFields;if(this.instance.config.searchFieldsAbbreviation==null)for(this.searchFieldsAbbreviation={},t=0;t<this._searchFields.length;t++){for(var i=this._searchFields[t],n=0,r=i.slice(0,n+1).toLowerCase();this.searchFieldsAbbreviation[r];)n++,r=i.slice(0,n+1).toLowerCase();this.searchFieldsAbbreviation[r]=i}else this.searchFieldsAbbreviation=this.instance.config.searchFieldsAbbreviation;this._searchFieldsAbbreviation=this.searchFieldsAbbreviation},FamilyTree.searchUI.prototype.find=function(t){this.input&&(this.input.value=t,document.activeElement==this.input?this._search(t):this.input.focus())},FamilyTree.searchUI.prototype.addMatchTag=function(t){if(this._searchAfterEnterPress){for(var e=0;e<this.lastSearch.length;e++)if(this.lastSearch[e].id==t)return!0;return!1}return null},FamilyTree.searchUI.prototype.__search=function(){this.lastSearch=FamilyTree._search.search(this.instance.config.nodes,this.input.value,this._searchFields,this._searchFields,this.instance.config.searchDisplayField,this.instance.config.searchFieldsWeight,this.searchFieldsAbbreviation)},FamilyTree.searchUI.prototype._search=function(){var t,e=this;if(this._searchAfterEnterPress=!1,this.input.value==FamilyTree.SEARCH_HELP_SYMBOL)t=this.helpView();else{this.__search();var i=FamilyTree._getFistImgField(this.instance.config);t=`<table border="0" cellspacing="0" cellpadding="0">
                        <tbody>
                            ${function(){for(var o="",a=0;a<e.lastSearch.length&&!(a>=FamilyTree.SEARCH_RESULT_LIMIT);a++){var l=e.lastSearch[a],s="";if(i){var c=e.instance._get(l.id);typeof i=="function"?s=i(e.instance,e.instance.getNode(l.id),c):c[i]&&(s=c[i])}var d="",p="";e.instance.config.searchDisplayField==l.__searchField?d=l.__searchMarks:e.instance.config.searchDisplayField?(d=l[e.instance.config.searchDisplayField],FamilyTree.isNEU(d)&&(d=""),p=l.__searchMarks):d=l.__searchMarks;var h={img:s,nodeId:l.id,first:d,second:p,searchItem:l,html:FamilyTree.searchUI.createItem(s,l.id,d,p)};FamilyTree.events.publish("add-item",[e,h]),o+=h.html}return o}()}  
                        </tbody>
                    </table>`}this.searchTableWrapper.innerHTML=t;for(var n=this.instance.element.querySelectorAll("[data-search-item-id]"),r=0;r<n.length;r++)n[r].addEventListener("click",function(){if(this.hasAttribute("data-search-item-id")){var o=this.getAttribute("data-search-item-id");if(e.input.value!=FamilyTree.SEARCH_HELP_SYMBOL){var a=FamilyTree.events.publish("searchclick",[e.instance,o]),l=FamilyTree.events.publish("searchclick",[e,{nodeId:o}]);if(a===!1&&(l=!1),l!==!1){e.instance.center(this.getAttribute("data-search-item-id"));var s=e.instance.element.querySelector('[data-selected="yes"]');s&&s.removeAttribute("data-selected"),this.setAttribute("data-selected","yes"),e.input.focus()}}else e.input.value=o+" ",e.searchTableWrapper.innerHTML="",e.input.focus()}});FamilyTree.events.publish("show-items",[this,{}])},FamilyTree.searchUI.prototype.helpView=function(){var t='<table border="0" cellspacing="0" cellpadding="0">';for(var e in this.searchFieldsAbbreviation)t+=`<tr data-search-item-id="${e}" style="height: 50px;"><td class="bft-search-image-td" style="text-align: center;">${e}</td><td class="bft-search-text-td">${this.searchFieldsAbbreviation[e]}</td></tr>`;return t+="</table>"},FamilyTree.searchUI.createItem=function(t,e,i,n){return i&&(i="<b>"+i+"</b>"),`<tr data-search-item-id="${e}">
                <td class="bft-search-image-td">
                    ${t=t?`<div class="bft-search-photo" style="background-image: url(${t})"></div>`:`<div class="bft-search-photo">${FamilyTree.icon.user(32,32,"#aeaeae")}</div>`}
                </td>
                <td class="bft-search-text-td">${i} <br/>${n}</td>
            </tr>`},FamilyTree.searchUI.prototype.hide=function(){if(FamilyTree.events.publish("hide",[this])===!1)return!1;this._searchAfterEnterPress&&(this._searchAfterEnterPress=!1,this.instance.draw()),this.lastSearch=[],this.xBtn&&(this.xBtn.style.display="none"),this.searchTableWrapper&&(this.searchTableWrapper.innerHTML=""),this.input&&(this.input.value="",document.activeElement==this.input&&this.input.blur(),document.activeElement==this.xBtn&&FamilyTree.input.blurHandler(this.input))},FamilyTree.searchUI.prototype.on=function(t,e){return FamilyTree.events.on(t,e,this._event_id),this},FamilyTree===void 0&&(FamilyTree={}),FamilyTree.manager=function(t){this.config=t.config,this.layoutConfigs=t._layoutConfigs,this.visibleNodeIds=[],this.viewBox=null,this.action=null,this.actionParams=null,this.nodes={},this.oldNodes={},this.maxX=null,this.maxY=null,this.minX=null,this.minY=null,this.bordersByRootIdAndLevel=null,this.roots=null,this.state=null,this.vbIsInitializedFromState=!1,this.rootList=[],this.instance=t,this._fixAdjustForExport={x:0,y:0}},FamilyTree.manager.prototype.read=function(t,e,i,n,r,o,a,l){var s=this;FamilyTree.state._get(this.config.state,e,i,function(c){s.state=c,s.action=r,s.actionParams=o,r!=FamilyTree.action.init||!s.state||o&&o.method&&o.method=="fit"?(s.viewBox=n,s.vbIsInitializedFromState=!1):(s.viewBox=s.state.vb,s.vbIsInitializedFromState=!0,Array.isArray(s.state.roots)&&(s.config.roots=s.state.roots));var d=s.maxX,p=s.maxY,h=s.minX,f=s.minY,m=s.bordersByRootIdAndLevel,y=s.roots,x=s.nodes;if(t){var u=FamilyTree.manager._getResponse(e,i,s.visibleNodeIds,s.config,d,p,h,f,s.viewBox,y,s.action,s.actionParams,x,s.oldNodes,s.vbIsInitializedFromState);r!=FamilyTree.action.exporting&&(s.maxX=d,s.maxY=p,s.minX=h,s.minY=f,s.roots=y,s.nodes=x,s.visibleNodeIds=u.visibleNodeIds),u.bordersByRootIdAndLevel=m,u.roots=y,u.adjustify={x:0,y:0},s.state&&(u.adjustify=s.state.adjustify),a(u)}else s.oldNodes=x||null,s._read(function(b){d=b.maxX,p=b.maxY,h=b.minX,f=b.minY,m=b.bordersByRootIdAndLevel,y=b.roots,x=b.nodes;var v=FamilyTree.manager._getResponse(e,i,s.visibleNodeIds,s.config,d,p,h,f,s.viewBox,y,s.action,s.actionParams,x,s.oldNodes,s.vbIsInitializedFromState);v.notif=b.limit,v.roots=y,v.bordersByRootIdAndLevel=m,v.adjustify=b.adjustify,r!=FamilyTree.action.exporting&&(s.maxX=d,s.maxY=p,s.minX=h,s.minY=f,s.roots=y,s.nodes=x,s.visibleNodeIds=v.visibleNodeIds,s.bordersByRootIdAndLevel=m,s.rootList=b.rootList),a(v)},l)})},FamilyTree.manager.prototype._read=function(t,e){var i=this,n=FamilyTree.manager._createNodes(this.instance);e(n);var r=n.nodes,o=n.roots,a=FamilyTree.remote;a==null&&(a=FamilyTree.local),a._setPositions(o,i.layoutConfigs,function(l){var s=FamilyTree.manager._doNotChangePositionOfClickedNodeIfAny(o,r,i.action,i.actionParams,i.oldNodes,i.config.orientation);i.state&&i.action==FamilyTree.action.init&&(s=i.state.adjustify),i.action==FamilyTree.action.exporting?s=i._fixAdjustForExport:i._fixAdjustForExport=s;for(var c={minX:null,minY:null,maxX:null,maxY:null},d={},p=[],h=0;h<o.length;h++)FamilyTree.manager._setMinMaxXYAdjustifyIterate(o[h],o[h],c,0,d,s,i.config.orientation,p);for(var f in p)for(var m in p[f]){var y=d[f][m],x=p[f][m];y.minX==null&&y.minY==null&&y.maxX==null&&y.maxY==null&&FamilyTree._setMinMaxXY(x,y)}t({minX:c.minX,minY:c.minY,maxX:c.maxX,maxY:c.maxY,bordersByRootIdAndLevel:d,nodes:r,roots:o,rootList:n.rootList,limit:l,adjustify:s})},r)},FamilyTree===void 0&&(FamilyTree={}),FamilyTree.manager._initDinamicNode=function(t,e,i){e&&(t.lcn=e),i&&(t.isAssistant=!0);var n=FamilyTree.t(t.templateName);t.w=n&&n.size?n.size[0]:0,t.h=n&&n.size?n.size[1]:0,t.isSplit=t.templateName=="split",t.isMirror=t.templateName=="mirror",t.isSubLevel=t.templateName=="subLevel"},FamilyTree.manager._setCollpasedProperty=function(t,e,i,n,r,o,a){t.collapsed==null&&e.collapse&&e.collapse.allChildren?t.collapsed=!0:t.collapsed==null&&(t.collapsed=!1),r==FamilyTree.action.expand&&i.ids.indexOf(t.id)!=-1&&(t.collapsed=!1),r==FamilyTree.action.collapse&&(i.expandIds||i.collapseIds)?i.expandIds&&i.expandIds.indexOf(t.id)!=-1?t.collapsed=!1:i.collapseIds&&i.collapseIds.indexOf(t.id)!=-1&&(t.collapsed=!0):r==FamilyTree.action.collapse&&i.ids.indexOf(t.id)!=-1&&(t.collapsed=!0),r==FamilyTree.action.expand&&i.ids=="all"&&(t.collapsed=!1),r==FamilyTree.action.exporting&&i.expandChildren&&(t.collapsed=!1),r==FamilyTree.action.init&&a!=null?t.collapsed=!a.exp.has(t.id):r==FamilyTree.action.init?t.tags.indexOf("left-partner")!=-1||t.tags.indexOf("right-partner")!=-1||t.tags.indexOf("partner")!=-1||t.parentPartner?t.collapsed=e.collapse&&o>=e.collapse.level&&n.indexOf(t.id)==-1:t.collapsed=e.collapse&&o>=e.collapse.level-1&&n.indexOf(t.id)==-1:r==FamilyTree.action.centerNode||r==FamilyTree.action.insert||r==FamilyTree.action.expand||r==FamilyTree.action.collapse?n.has(t.id)&&(t.collapsed=!1):r==FamilyTree.action.update&&i&&i.changeRoots&&i.changeRoots.has(t.id)&&(t.collapsed=!1)},FamilyTree.manager._initNode=function(t,e,i,n,r,o,a){var l=a.manager.config,s=a.manager.layoutConfigs,c=a.manager.action,d=a.manager.actionParams,p=a.manager.state,h=s[i||"base"];t.parent==null&&FamilyTree.manager._setCollpasedProperty(t,h,d,r,c,n-1,p);for(var f=0;f<t.childrenIds.length;f++){var m=e[t.childrenIds[f]];if(FamilyTree.manager._setCollpasedProperty(m,h,d,r,c,n,p),!m.collapsed){if(m.parent=t,m.ppid!=null){var y=e[m.ppid];y&&(m.parentPartner=y)}(m.tags.indexOf("left-partner")!=-1||m.tags.indexOf("right-partner")!=-1||m.tags.indexOf("partner")!=-1||m.parentPartner)&&o.indexOf(t.id)==-1&&o.push(t.id),t.children.push(m)}}if(c!=FamilyTree.action.minimize||t.min?c==FamilyTree.action.maximize&&t.min===!0?(d.all||d.id==t.id)&&(t.min=!1):c==FamilyTree.action.exporting&&d.min===!1?t.min=!1:c==FamilyTree.action.init&&p!=null&&(t.min=p.min.has(t.id)):(d.all||d.id==t.id)&&(t.min=!0),!t.min)for(f=0;f<t.stChildrenIds.length;f++)m=e[t.stChildrenIds[f]],t.tags&&t.tags.has("filter")||(m.stParent=t,t.stChildren.push(m));n!=null&&(t.level=n),i&&(t.lcn=i);var x=FamilyTree._getSubLevels(t.tags,l.tags);x>0&&(t.subLevels=x),t.tags.indexOf("assistant")!=-1&&t.parent!=null&&(t.isAssistant=!0);var u=FamilyTree.t(t.templateName,t.min);t.w=u&&u.size?u.size[0]:0,t.h=u&&u.size?u.size[1]:0,t.padding=u&&u.padding?u.padding:[0,0,0,0];var b={node:t};FamilyTree.events.publish("node-initialized",[a,b])},FamilyTree.manager._iterate=function(t,e,i,n,r,o,a,l,s,c,d,p){var h=p.manager.layoutConfigs;if(FamilyTree.manager._initNode(e,i,s,n,c,d,p),e.isAssistant&&(o[e.pid]||(o[e.pid]=[]),o[e.pid].push(e.id)),e.subLevels>0&&a.push(e.id),FamilyTree.MIXED_LAYOUT_FOR_NODES_WITH_COLLAPSED_CHILDREN&&!e.isAssistant&&e.parent){if(e.parent&&e.parent.children.length&&e.parent.children[e.parent.children.length-1]==e){for(var f=[],m=0,y=0,x=0;x<e.parent.children.length;x++)(u=e.parent.children[x]).tags.indexOf("partner")==-1&&u.tags.indexOf("left-partner")==-1&&u.tags.indexOf("right-partner")==-1&&u.tags.indexOf("assistant")==-1&&u.children.length==0?f.push(u.id):u.tags.indexOf("assistant")!=-1?m++:u.tags.indexOf("partner")==-1&&u.tags.indexOf("left-partner")==-1&&u.tags.indexOf("right-partner")==-1||y++;(FamilyTree.MIXED_LAYOUT_ALL_NODES&&f.length>1&&f.length==e.parent.children.length-m-y||!FamilyTree.MIXED_LAYOUT_ALL_NODES&&f.length>1)&&(l[e.pid]=f)}}else if(!e.isAssistant&&e.childrenIds.length==0&&e.parent&&!l[e.pid]){for(f=[],m=0,y=0,x=0;x<e.parent.children.length;x++){var u;(u=e.parent.children[x]).tags.indexOf("partner")==-1&&u.tags.indexOf("left-partner")==-1&&u.tags.indexOf("right-partner")==-1&&u.tags.indexOf("assistant")==-1&&u.childrenIds.length==0?f.push(u.id):u.tags.indexOf("assistant")!=-1?m++:u.tags.indexOf("partner")==-1&&u.tags.indexOf("left-partner")==-1&&u.tags.indexOf("right-partner")==-1||y++}(FamilyTree.MIXED_LAYOUT_ALL_NODES&&f.length>FamilyTree.MIXED_LAYOUT_IF_NUMBER_OF_CHILDREN_IS_MORE_THEN&&f.length==e.parent.childrenIds.length-m-y||!FamilyTree.MIXED_LAYOUT_ALL_NODES&&f.length>FamilyTree.MIXED_LAYOUT_IF_NUMBER_OF_CHILDREN_IS_MORE_THEN)&&(l[e.pid]=f)}e.stChildren.length&&(t.stContainerNodes||(t.stContainerNodes=[]),t.stContainerNodes.push(e));for(var b=0;b<e.stChildren.length;b++){var v="";for(x=0;x<e.tags.length;x++)if(h[e.tags[x]]){v=e.tags[x];break}r.push(e.stChildren[b].id),FamilyTree.manager._iterate(t,e.stChildren[b],i,0,r,o,a,l,v,c,d,p)}for(n++,b=0;b<e.children.length;b++)FamilyTree.manager._iterate(t,e.children[b],i,n,r,o,a,l,s,c,d,p)},FamilyTree.manager.__createNodes=function(t,e,i,n,r,o,a,l){for(var s=[],c=FamilyTree._addDottedLines(i),d=0;d<c.length;d++){var p,h=c[d];p=FamilyTree.STRING_TAGS?h.tags?h.tags.split(","):[]:Array.isArray(h.tags)?h.tags.slice(0):[],l.filterUI.addFilterTag(h)&&p.unshift("filter");var f=l.searchUI.addMatchTag(h.id);f===!0?p.unshift("match"):f===!1&&p.unshift("no-match");var m=FamilyTree._getTemplate(p,i.tags,i.template),y=new FamilyTree.node(h.id,h.pid,p,m);FamilyTree.isNEU(h.ppid)||(y.ppid=h.ppid),FamilyTree.isNEU(h.stpid)||(y.stpid=h.stpid),i.orderBy!=null&&(y.order=FamilyTree.manager._getOrderFieldValue(h,i.orderBy)),h.movex!=null&&(y.movex=h.movex),h.movey!=null&&(y.movey=h.movey),t[h.id]=y,s.push(h.id)}for(i.orderBy!=null&&s.sort(function(_,k){var w=t[_].order,S=t[k].order;return typeof w=="number"||typeof S=="number"?(w==null&&(w=-1),S==null&&(S=-1),i.orderBy.desc?S-w:w-S):typeof w=="string"||typeof S=="string"?(w==null&&(w=""),S==null&&(S=""),i.orderBy.desc?S.localeCompare(w):w.localeCompare(S)):void 0}),d=0;d<s.length;d++){var x=s[d],u=(y=t[x],o?o[x]:null),b=t[y.stpid],v=t[y.pid];if(b||(y.stpid=null),v||(y.pid=null),b){var g=o?o[b.id]:null;g&&(b.min=g.min),b.stChildrenIds.push(y.id)}else v?(u&&(y.collapsed=u.collapsed,y.min=u.min),v.childrenIds.push(y.id)):(u&&(y.collapsed=u.collapsed,y.min=u.min),e.push(y),a.push(y.id));n==FamilyTree.action.init&&(y.min=FamilyTree._getMin(y,i))}},FamilyTree.manager._createNodes=function(t){var e=t.manager.config,i=t.manager.layoutConfigs,n=t.manager.action,r=t.manager.actionParams,o=t.manager.oldNodes,a=t.manager.state,l={},s=[],c=[];if(FamilyTree.manager.__createNodes(l,s,e,n,r,o,c,t),e.roots!=null){s=[];for(var d=0;d<e.roots.length;d++){var p=l[e.roots[d]];if(p&&n==FamilyTree.action.centerNode){for(var h=p;h.pid!=null||h.stpid!=null;)h=h.pid==null&&h.stpid!=null?l[h.stpid]:l[h.pid];for(var f=l[r.id];(f.pid!=null||f.stpid!=null)&&f!=p;)f=f.pid==null&&f.stpid!=null?l[f.stpid]:l[f.pid];h==f&&(p=h)}if(p){for(var m=!1,y=0;y<s.length;y++)if(s[y].id==p.id){m=!0;break}m||(FamilyTree.isNEU(p.pid)||(ut=(b=l[p.pid]).childrenIds.indexOf(p.id))>-1&&b.childrenIds.splice(ut,1),s.push(p))}}for(e.roots=[],d=0;d<s.length;d++)e.roots.push(s[d].id)}n==FamilyTree.action.exporting&&r.id!=null&&(u=l[r.id])&&(u.pid=null,s=[u]);var x=[];if(n==FamilyTree.action.init&&e.expand&&e.expand.nodes&&a==null)for(d=0;d<e.expand.nodes.length;d++){var u=l[e.expand.nodes[d]];for(e.expand.allChildren===!0&&FamilyTree.manager._addExpandedNodeIdsIterate(u,l,x);u;)x.push(u.id),u.pid==null&&u.stpid!=null?(u=l[u.stpid]).min=!1:u=l[u.pid]}else if(n==FamilyTree.action.expand&&r.ids&&r.ids!="all"||n==FamilyTree.action.collapse&&r&&r.expandIds)for(F=n==FamilyTree.action.expand?r.ids:r.expandIds,d=0;d<F.length;d++)for(var b=l[(u=l[F[d]]).pid];b;)x.push(b.id),b.pid==null&&b.stpid!=null?(b=l[b.stpid]).min=!1:b=l[b.pid];else if(n==FamilyTree.action.centerNode){for(var v=l[r.id];v;){if(x.push(v.id),r.options.parentState===FamilyTree.COLLAPSE_PARENT_NEIGHBORS&&v)for(d=0;d<v.childrenIds.length;d++)(C=l[v.childrenIds[d]]).collapsed=!0;v.pid==null&&v.stpid!=null?(v=l[v.stpid]).min=!1:v=l[v.pid]}if(v=l[r.id],r.options.childrenState===FamilyTree.COLLAPSE_SUB_CHILDRENS)for(d=0;d<v.childrenIds.length;d++){(_=l[v.childrenIds[d]]).collapsed=!1;for(var g=0;g<_.childrenIds.length;g++)l[_.childrenIds[g]].collapsed=!0}if(r.options.parentState===FamilyTree.COLLAPSE_PARENT_SUB_CHILDREN_EXCEPT_CLICKED&&(b=l[v.pid]))for(d=0;d<b.childrenIds.length;d++){var _;if((_=l[b.childrenIds[d]])!=v)for(_.collapsed=!1,g=0;g<_.childrenIds.length;g++)l[_.childrenIds[g]].collapsed=!0}}else if(n==FamilyTree.action.insert)for(u=l[r.insertedNodeId];u;)x.push(u.id),u.pid==null&&u.stpid!=null?(u=l[u.stpid]).min=!1:u=l[u.pid];var k=[],w={},S=[],I={},M=[];for(d=0;d<s.length;d++)FamilyTree.manager._iterate(s[d],s[d],l,0,k,w,S,I,"",x,M,t);if(n==FamilyTree.action.collapse&&r&&Array.isArray(r.expandIds)&&Array.isArray(r.collapseIds))for(d=0;d<r.ids.length;d++)r.expandIds.has(r.collapseIds[d])?console.error(`id ${r.collapseIds[d]} exist in both collapseIds and expandIds`):(u=l[r.collapseIds[d]])&&(u.collapsed=!0);for(d=s.length-1;d>=0;d--)s[d].collapsed&&s.splice(d,1);for(d=0;d<M.length;d++){u=l[M[d]];var N=[],A=[],B=[],P={},T=0,O=0,L=0,U=[],D=[];for(g=0;g<u.children.length;g++)(C=u.children[g]).isAssistant?N.push(C.id):C.tags.indexOf("right-partner")!=-1?(C.isPartner=1,C.children=[],A.push(C.id)):C.tags.indexOf("left-partner")!=-1?(C.isPartner=2,C.children=[],B.push(C.id)):C.tags.indexOf("partner")==-1||T%2?C.tags.indexOf("partner")!=-1&&T%2?(C.isPartner=2,C.children=[],B.push(C.id),T++):C.parentPartner?(P[C.parentPartner.id]||(P[C.parentPartner.id]=[]),P[C.parentPartner.id].push(C.id)):N.push(C.id):(C.isPartner=1,C.children=[],A.push(C.id),T++);u.children=[];var R=[];for(g=0;g<A.length;g++){P[(C=l[A[g]]).id]?u.children.push(C):u.children.splice(0,0,C);for(var H=0;H<C.childrenIds.length;H++)R.push(C.childrenIds[H])}var Y=[];for(g=0;g<B.length;g++)for(P[(C=l[B[g]]).id]?u.children.push(C):u.children.splice(0,0,C),H=0;H<C.childrenIds.length;H++)Y.push(C.childrenIds[H]);for(g=0;g<Y.length;g++)(C=l[Y[g]]).collapsed||(C.parentPartner=C.parent,C.parent=u,C.isChildOfPartner=!0,u.children.push(C));for(g=B.length-1;g>=0;g--)if(P[B[g]])for(y=0;y<P[B[g]].length;y++)u.children.push(l[P[B[g]][y]]),O++,D.indexOf(B[g])==-1&&D.push(B[g]);for(g=0;g<N.length;g++){var C=l[N[g]];u.children.push(C)}for(g=0;g<A.length;g++)if(P[A[g]])for(y=0;y<P[A[g]].length;y++)u.children.push(l[P[A[g]][y]]),L++,U.indexOf(A[g])==-1&&U.push(A[g]);for(g=0;g<R.length;g++)(C=l[R[g]]).collapsed||(C.parentPartner=C.parent,C.parent=u,C.isChildOfPartner=!0,u.children.push(C));u.partnerSeparation=Math.max(D.length,U.length)*e.partnerChildrenSplitSeparation+e.minPartnerSeparation,N.length||!O||L?N.length||O||!L?N.length||O!=1||L!=1?N.length||O||L?!N.length||O||L?N.length&&(O||L)?u.hasPartners=7:u.hasPartners=1:u.hasPartners=6:u.hasPartners=5:u.hasPartners=4:u.hasPartners=3:u.hasPartners=2}for(d=0;d<S.length;d++){var z=i[(u=l[S[d]]).lcn?u.lcn:"base"];for(g=0;g<u.subLevels;g++){var E=new FamilyTree.node(u.id+"_sub_level_index_"+g,u.pid,[],"subLevel");FamilyTree.manager._initDinamicNode(E,u.lcn),(b=u.parent)&&((ut=b.children.indexOf(u))>-1&&(b.children.splice(ut,1),b.children.splice(ut,0,E)),E.children.push(u),E.parent=b,u.parent=E,l[E.id]=E)}}for(var V in w){(b=l[V]).hasAssistants=!0,E=new FamilyTree.node(b.id+"_split_assitant_0",b.id,["assistant"],"split"),FamilyTree.manager._initDinamicNode(E,b.lcn,!0),l[E.id]=E;var W=[];for(g=b.children.length-1;g>=0;g--)(C=b.children[g]).isAssistant?(C.parent=null,b.children.splice(g,1),W.splice(0,0,C.id)):C.isPartner||(C.parent&&I[C.parent.id]&&E&&C.parent.id!=E.id&&(Object.defineProperty(I,E.id,Object.getOwnPropertyDescriptor(I,C.parent.id)),delete I[C.parent.id]),C.parent=E,E.children.unshift(C),b.children.splice(g,1));if(W.length%2){var mt=l[W[W.length-1]],ot=new FamilyTree.node(mt.id+"_mirror",b.pid,[],"mirror");FamilyTree.manager._initDinamicNode(ot,mt.lcn,!0),ot.isAssistant=!0,ot.w=mt.w,ot.h=mt.h,l[ot.id]=ot,W.splice(W.length-1,0,ot.id)}var lt=1;for(g=W.length-1;g>=0;g--)if(g%2&&g!=W.length-1){var tt=new FamilyTree.node(b.id+"_split_assitant_"+lt,b.pid,[],"split");FamilyTree.manager._initDinamicNode(tt,b.lcn,!0),l[tt.id]=tt,W.splice(g,0,tt.id),lt++}else g%2&&W.splice(g,0,E.id);for(g=0;g<W.length;g+=3){var X=null;X=g==0?b:l[W[g-2]];var G=l[W[g]],nt=l[W[g+1]],et=l[W[g+2]];G.parent=X,nt.parent=X,et.parent=X,X.children.push(G),X.children.push(nt),X.children.push(et)}}var pt=!1;for(var ht in i)if((z=i[ht]).layout!=0){pt=!0;break}var rt=FamilyTree.events.has("node-layout",t._event_id);if(pt||rt){var j={nodes:l,config:e,action:n,actionParams:r};if(S.length){var K=!1;for(var V in I){var F=I[V];for(d=0;d<F.length;d++)if((u=l[F[d]]).subLevels){K=!0;break}if(K)break}if(K){var at={},st={},xt={};for(var V in I){F=I[V];var bt=!1,Z=null;for(d=0;d<F.length;d++){var J=F[d];(Z===null||S.has(J))&&(Z=l[J].parent.id,bt||FamilyTree.isNEU(l[J].subLevels)||(bt=l[J].subLevels>0)),at[Z]||(at[Z]=[]),at[Z].push(J),bt&&(xt[Z]=V,st[Z]||(st[Z]=[]),st[Z].push(J))}}for(var V in I={},st)if(st[V].length>FamilyTree.MIXED_LAYOUT_IF_NUMBER_OF_CHILDREN_IS_MORE_THEN){var it=xt[V];for(d=l[it].children.length-1;d>=0;d--)C=l[it].children[d],st[V].has(C.id)&&l[it].children.splice(d,1)}for(var V in at)at[V].length>FamilyTree.MIXED_LAYOUT_IF_NUMBER_OF_CHILDREN_IS_MORE_THEN&&(I[V]=at[V])}}for(var V in I){for(var q=b=l[V];q.isSplit;)q=l[q.pid];for(;q.isSubLevel;)q=l[q.pid];if((z=i[b.lcn?b.lcn:"base"]).layout!=0||rt){j.pnode=b,j.layout=z.layout,j.layoutGridColumns=e.layoutGridColumns,j.childrenIds=I[V],j.lastChildrenPidIds=I,j.subLevels=0,j.layouts=[],FamilyTree.events.publish("node-layout",[t,j]),FamilyTree.events.publish("layout",[j]),j.layouts.length||j.layouts.push({layout:j.layout,childrenIds:j.childrenIds,subLevels:j.subLevels,layoutGridColumns:j.layoutGridColumns});for(var ft=0;ft<j.layouts.length;ft++){var $=j.layouts[ft];for(FamilyTree.isNEU($.subLevels)&&($.subLevels=0),FamilyTree.isNEU($.layout)&&($.layout=z.layout),q=b=l[V];q.isSplit;)q=l[q.pid];for(;q.isSubLevel;)q=l[q.pid];var dt=b;for(g=0;g<$.subLevels;g++)E=new FamilyTree.node(ft+"_sublevel_layout_"+g,dt.id,[],"subLevel"),FamilyTree.manager._initDinamicNode(E,dt.lcn),E.parent=dt,dt.children.push(E),l[E.id]=E,dt=E;if($.subLevels){for(g=0;g<$.childrenIds.length;g++){var ut;C=l[$.childrenIds[g]],(ut=b.children.indexOf(C))!=-1&&b.children.splice(ut,1),C.parent=dt,dt.children.push(C)}b=dt}if($.layout==FamilyTree.layout.grid&&$.childrenIds.length>2){$.layoutGridColumns=="dynamic"&&($.layoutGridColumns=FamilyTree._getDynamicGridCoulumns($.childrenIds.length));var vt=b.id;for(d=b.children.length-1;d>=0;d--)for(g=0;g<$.childrenIds.length;g++)if(J=$.childrenIds[g],b.children[d].id==J){b.children.splice(d,1);break}var ct=$.layoutGridColumns;for(ct%2!=0&&ct>2&&ct--,d=0;d<$.childrenIds.length;d+=ct){var gt=null;for(g=0;g<ct;g++){var kt=d+ct>=$.childrenIds.length;if($.childrenIds.length-1<d+g)break;(C=l[J=$.childrenIds[d+g]]).parent=l[vt],l[vt].children.push(C),kt||(ct/2-1==g&&(gt=new FamilyTree.node($.childrenIds[d+g-1]+"_grid_pseudo_node_"+$.childrenIds[d+g+1],vt,[],"subLevel"),FamilyTree.manager._initDinamicNode(gt,b.lcn),gt.parent=l[vt],l[vt].children.push(gt),l[gt.id]=gt),ct-1==g&&(vt=gt.id))}}}if($.layout==FamilyTree.layout.mixed){var _t=$.childrenIds;for(d=_t.length-1;d>=0;d--){for(b=(C=l[_t[d]]).parent,C.layout=FamilyTree.layout.mixed,g=b.children.length-1;g>=0;g--)if(C.id==b.children[g].id){b.children.splice(g,1);break}if(d>0){var wt=l[_t[d-1]];C.parent=wt,C.layout=FamilyTree.layout.mixed,wt.children.push(C)}else b.children.push(C)}}else if($.layout>1){E=new FamilyTree.node(ft+"_"+b.id+"_split_0",q.id,[],"split"),FamilyTree.manager._initDinamicNode(E,b.lcn),l[E.id]=E,E.layout=$.layout;var Q=[];for(d=$.childrenIds.length-1;d>=0;d--){for(C=l[$.childrenIds[d]],g=0;g<b.children.length;g++)b.children[g].id==C.id&&b.children.splice(g,1);if(C.parent=null,C.layout=$.layout,$.layout!=FamilyTree.layout.treeRightOffset&&$.layout!=FamilyTree.layout.treeRight||Q.splice(0,0,C.id),$.layout>2){var yt=new FamilyTree.node(ft+"_"+C.id+"_mirror",q.id,[],"mirror");FamilyTree.manager._initDinamicNode(yt,C.lcn),yt.layout=$.layout,l[yt.id]=yt,Q.splice(0,0,yt.id)}$.layout!=FamilyTree.layout.treeRightOffset&&$.layout!=FamilyTree.layout.treeRight&&Q.splice(0,0,C.id)}for(lt=1,g=Q.length-1;g>=0;g--)g%2&&g!=Q.length-1?(tt=new FamilyTree.node(ft+"_"+b.id+"_split_"+lt,q.id,[],"split"),FamilyTree.manager._initDinamicNode(tt,b.lcn),tt.layout=$.layout,l[tt.id]=tt,Q.splice(g,0,tt.id),lt++):g%2&&Q.splice(g,0,E.id);for(g=0;g<Q.length;g+=3)X=null,g==0&&(X=b),G=l[Q[g]],nt=l[Q[g+1]],et=l[Q[g+2]],g!=0&&(X=l[Q[g-3]]),g==0||nt||(X=l[Q[g-2]]),G.parent=X,X.children.push(G),nt&&(g!=0&&(X=l[Q[g-2]]),nt.parent=X,X.children.push(nt)),et&&(g!=0&&(X=l[Q[g-1]]),et.parent=X,X.children.push(et))}}}}}if(FamilyTree.VERTICAL_CHILDREN_ASSISTANT)for(d=0;d<s.length;d++)FamilyTree.manager._verticalAssistantIterate(s[d],l);return j={nodes:l,roots:s},FamilyTree.events.publish("nodes-initialized",[t,j]),{nodes:j.nodes,roots:j.roots,rootList:c}},FamilyTree.manager._getOrderFieldValue=function(t,e){var i=e;return e.field&&(i=e.field),t[i]},FamilyTree.manager._getNodeWidth=function(t,e){switch(e.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:return t.w;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:return t.h}return 0},FamilyTree.manager._isVisible=function(t,e,i,n){if(t.x!=null&&t.y!=null){if(e.lazyLoading&&n!==FamilyTree.action.exporting){let a=function(l,s){var c=l.x,d=l.y,p=l.w,h=l.h,f=s[0]-FamilyTree.LAZY_LOADING_FACTOR,m=s[2]+FamilyTree.LAZY_LOADING_FACTOR+s[0],y=s[1]-FamilyTree.LAZY_LOADING_FACTOR,x=s[3]+FamilyTree.LAZY_LOADING_FACTOR+s[1],u=c+p>f&&m>c;return u&&(u=d+h>y&&x>d),u};var o=a;if(a(t,i))return!0;for(var r=0;r<t.children.length;r++)if(a(t.children[r],i))return!0;return!1}return!0}},FamilyTree.manager.getAllFields=function(t){var e=[FamilyTree.TAGS];for(var i in t.nodeBinding)e.push(t.nodeBinding[i]);for(i=0;i<t.nodes.length;i++)for(var n in t.nodes[i])n!==FamilyTree.ID&&n!==FamilyTree.TAGS&&n!==FamilyTree.NODES&&n!==FamilyTree.PID&&n!==FamilyTree.STPID&&n!=="movex"&&n!=="movey"&&(t.nodeBinding[n]||e.has(n)||e.push(n));return e},FamilyTree.manager._getMostDeepChild=function(t){if(t){var e=t;return function i(n){n.sl>e.sl&&(e=n);for(var r=0;r<n.children.length;r++)i(n.children[r])}(t),e}},FamilyTree.manager._getResponse=function(t,e,i,n,r,o,a,l,s,c,d,p,h,f,m){var y=c[0],x=[],u={top:null,left:null,bottom:null,right:null,minX:null,maxX:null,minY:null,maxY:null},b=[[],[],[]],v=r-a+2*n.padding,g=o-l+2*n.padding,_=FamilyTree.getScale(s,t,e,n.scaleInitial,n.scaleMax,n.scaleMin,v,g);if(u.top=l-n.padding,u.left=a-n.padding,u.bottom=o+n.padding-e/_,u.right=r+n.padding-t/_,u.maxX=r,u.minX=a,u.maxY=o,u.minY=l,c.length==0||s==null&&!m&&n.align==FamilyTree.CENTER){var k=Math.ceil(t/_),w=Math.ceil(e/_),S=0,I=0;if(k-2*n.padding>=r-a)switch(S=(r+a)/2-k/2,n.orientation){case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:S=(a-r)/2-k/2}else switch(S=y.x-k/2+FamilyTree.manager._getNodeWidth(y,n)/2,n.orientation){case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:(S=-(k/2-(a-r)/2))<n.padding-k&&(S=n.padding-k);break;case FamilyTree.orientation.left:case FamilyTree.orientation.bottom_left:case FamilyTree.orientation.top_left:case FamilyTree.orientation.left_top:(S=-(k/2-(r-a)/2))>-n.padding&&(S=-n.padding)}if(w-2*n.padding>=o-l)switch(I=(o+l)/2-w/2,n.orientation){case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:I=(l-o)/2-w/2}else switch((I=-(w/2-(o-l)/2))>-n.padding&&(I=-n.padding),n.orientation){case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:(I=-(w/2-(l-o)/2))<n.padding-w&&(I=n.padding-w);break;case FamilyTree.orientation.left:case FamilyTree.orientation.right:I=y.y-w/2+FamilyTree.manager._getNodeWidth(y,n)/2}s=[S,I,k,w]}else if(s==null&&!m&&n.align==FamilyTree.ORIENTATION){switch(k=Math.ceil(t/_),w=Math.ceil(e/_),S=0,I=0,n.orientation){case FamilyTree.orientation.top:S=y.x-k/2+FamilyTree.manager._getNodeWidth(y,n)/2,I=-n.padding;break;case FamilyTree.orientation.bottom:S=y.x-k/2+FamilyTree.manager._getNodeWidth(y,n)/2,I=n.padding-w;break;case FamilyTree.orientation.left:S=-n.padding,I=y.y-w/2+FamilyTree.manager._getNodeWidth(y,n)/2;break;case FamilyTree.orientation.right:S=n.padding-k,I=y.y-w/2+FamilyTree.manager._getNodeWidth(y,n)/2;break;case FamilyTree.orientation.top_left:S=-n.padding,I=-n.padding;break;case FamilyTree.orientation.right_top:S=n.padding-k,I=-n.padding;break;case FamilyTree.orientation.left_top:S=-n.padding,I=-n.padding;break;case FamilyTree.orientation.bottom_left:S=-n.padding,I=n.padding-w}s=[S,I,k,w],n.sticky&&(s[0]<u.left&&s[0]<u.right&&(s[0]=u.left>u.right?u.right:u.left),s[0]>u.right&&s[0]>u.left&&(s[0]=u.left>u.right?u.left:u.right),s[1]<u.top&&s[1]<u.bottom&&(s[1]=u.top>u.bottom?u.bottom:u.top),s[1]>u.bottom&&s[1]>u.top&&(s[1]=u.top>u.bottom?u.top:u.bottom))}if(d==FamilyTree.action.centerNode||d==FamilyTree.action.maximize){var M=h[p.id];p.options.horizontal==1&&(s[0]=M.x+M.w/2-s[2]/2),p.options.vertical==1&&(s[1]=M.y+M.h/2-s[3]/2),n.sticky&&(s[0]<u.left&&s[0]<u.right&&(s[0]=u.left>u.right?u.right:u.left),s[0]>u.right&&s[0]>u.left&&(s[0]=u.left>u.right?u.left:u.right),s[1]<u.top&&s[1]<u.bottom&&(s[1]=u.top>u.bottom?u.bottom:u.top),s[1]>u.bottom&&s[1]>u.top&&(s[1]=u.top>u.bottom?u.top:u.bottom))}if(d==FamilyTree.action.insert||d==FamilyTree.action.expand||d==FamilyTree.action.collapse||d==FamilyTree.action.update||d==FamilyTree.action.centerNode){var N=null;if(d==FamilyTree.action.insert&&p&&p.insertedNodeId!=null&&p.insertedNodeId!=null)N=h[p.insertedNodeId];else if(d==FamilyTree.action.update&&p&&p.visId!=null&&p.visId!=null)N=h[p.visId];else if(d!=FamilyTree.action.expand&&d!=FamilyTree.action.collapse||!p||p.id==null||p.id==null){if(d==FamilyTree.action.centerNode){switch(n.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:p.options.vertical||(N=h[p.id]);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:p.options.horizontal||(N=h[p.id])}N&&(N=FamilyTree.manager._getMostDeepChild(N,h))}}else N=h[p.id],N=FamilyTree.manager._getMostDeepChild(N,h);if(!FamilyTree.FIXED_POSITION_ON_CLICK&&N)switch(n.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:var A=N.y+N.h-s[3]+n.padding;s[1]<A&&(s[1]=A);break;case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:A=N.y-n.padding,s[1]>A&&(s[1]=A);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:A=N.x-n.padding,s[0]>A&&(s[0]=A);break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:A=N.x+N.w-s[2]+n.padding,s[0]<A&&(s[0]=A)}}for(var B=0;B<c.length;B++)FamilyTree.manager._iterate2(c[B],h,n,s,d,p,x,f,i,b);return{animations:b,boundary:u,viewBox:s,visibleNodeIds:x,nodes:h,allFields:FamilyTree.manager.getAllFields(n)}},FamilyTree.manager._iterate2=function(t,e,i,n,r,o,a,l,s,c){if(FamilyTree.manager._isVisible(t,i,n,r)){a.push(t.id);var d=null;if((r==FamilyTree.action.expand||r==FamilyTree.action.collapse||r==FamilyTree.action.maximize)&&l&&l[t.id]&&o.method=="expandCollapseToLevel"){if(d={x:(m=l[t.id]).x,y:m.y},m){d={x:m.x,y:m.y};for(var p=t,h=null;p!=null;)l[p.id]&&l[p.id].collapsed&&(h=p),p=p.parent;h&&h.parent&&(d={x:h.parent.x,y:h.parent.y})}if(y=e[o.id]){for(p=t.parent;p!=null;)p=p.parent;p&&(d={x:y.x+y.w/2-t.w/2,y:y.y+y.h/2-t.h/2})}}else if((r==FamilyTree.action.expand||r==FamilyTree.action.collapse)&&l&&l[t.id]){if(d={x:(m=l[t.id]).x,y:m.y},o.ids=="all"&&m){for(d={x:m.x,y:m.y},p=t,h=null;p!=null;)l[p.id]&&l[p.id].collapsed&&(h=p),p=p.parent;h&&h.parent&&(d={x:h.parent.x,y:h.parent.y})}if(y=e[o.id]){for(p=t.parent;p!=null&&o.ids.indexOf(t.id)==-1&&o.ids.indexOf(p.id)==-1;)p=p.parent;p&&(d={x:y.x+y.w/2-t.w/2,y:y.y+y.h/2-t.h/2})}}else if(r==FamilyTree.action.centerNode&&l&&l[t.id])(m=l[t.id]).x!=null&&m.y!=null&&(d={x:m.x,y:m.y}),(f=e[o.id])&&f==t&&(p=t.parent)&&p.id==o.id&&(d={x:f.x+f.w/2-t.w/2,y:f.y+f.h/2-t.h/2});else if(r==FamilyTree.action.maximize&&l&&l[t.id]){var f;(m=l[t.id]).x!=null&&m.y!=null&&(d={x:m.x,y:m.y}),(f=e[o.id])&&f==t&&(p=t.parent)&&p.id==o.id&&(d={x:f.x+f.w/2-t.w/2,y:f.y+f.h/2-t.h/2})}else if(r==FamilyTree.action.minimize&&l&&l[t.id])d={x:(m=l[t.id]).x,y:m.y};else if(r==FamilyTree.action.insert&&o&&o.insertedNodeId==t.id&&t.parent)d={x:t.parent.x,y:t.parent.y};else if(r!=FamilyTree.action.update&&r!=FamilyTree.action.insert||!l)r!==FamilyTree.action.exporting&&r!==FamilyTree.action.init&&s.indexOf(t.id)==-1&&(c[0].push(t.id),c[1].push({opacity:0}),c[2].push({opacity:1}));else{var m,y;if((!(m=l[t.id])||FamilyTree.isNEU(m.x)&&FamilyTree.isNEU(m.y))&&o){if(y=e[o.id]){for(p=y;p&&p.id==t.id;)p=p.parent;p&&(d={x:y.x,y:y.y})}}else m&&(d={x:m.x,y:m.y})}d!=null&&d.x!=null&&d.y!=null&&(d.x!=t.x||d.y!=t.y)&&(o&&o.dragNodeIdList&&o.dragNodeIdList.indexOf(t.id)!=-1||(c[0].push(t.id),c[1].push({transform:[1,0,0,1,d.x,d.y]}),c[2].push({transform:[1,0,0,1,t.x,t.y]})))}for(var x=0;x<t.stChildren.length;x++)FamilyTree.manager._iterate2(t.stChildren[x],e,i,n,r,o,a,l,s,c);for(x=0;x<t.children.length;x++)FamilyTree.manager._iterate2(t.children[x],e,i,n,r,o,a,l,s,c)},FamilyTree.manager._addExpandedNodeIdsIterate=function(t,e,i){for(var n=0;n<t.childrenIds.length;n++)i.push(t.childrenIds[n]),FamilyTree.manager._addExpandedNodeIdsIterate(e[t.childrenIds[n]],e,i)},FamilyTree.manager._setMinMaxXYAdjustifyIterate=function(t,e,i,n,r,o,a,l){t.x+=o.x,t.y+=o.y;for(var s=0;s<t.stChildren.length;s++)FamilyTree.manager._setMinMaxXYAdjustifyIterate(t.stChildren[s],t.stChildren[s],i,0,r,o,a,l);for(t.isPartner?t.sl=n-1:t.sl=n,r[e.id]==null&&(r[e.id]={}),r[e.id][t.sl]==null&&(r[e.id][t.sl]={minX:null,minY:null,maxX:null,maxY:null}),t.layout?(l[e.id]==null&&(l[e.id]={}),l[e.id][t.sl]==null&&(l[e.id][t.sl]=t)):FamilyTree._setMinMaxXY(t,r[e.id][t.sl]),t.movex!=null&&(t.x+=t.movex),t.movey!=null&&(t.y+=t.movey),FamilyTree._setMinMaxXY(t,i),n++,s=0;s<t.children.length;s++)FamilyTree.manager._setMinMaxXYAdjustifyIterate(t.children[s],e,i,n,r,o,a,l)},FamilyTree.manager._doNotChangePositionOfClickedNodeIfAny=function(t,e,i,n,r,o){if(i!=FamilyTree.action.expand&&i!=FamilyTree.action.collapse&&i!=FamilyTree.action.minimize&&i!=FamilyTree.action.maximize&&i!=FamilyTree.action.centerNode&&i!=FamilyTree.action.update&&i!=FamilyTree.action.insert)return{x:0,y:0};if(i==FamilyTree.action.update&&(!n||n.id==null)){if(!t||!t.length)return{x:0,y:0};n={id:t[0].id}}if(n.id==null)return{x:0,y:0};var a=n.id;(i==FamilyTree.action.minimize&&e[a].parent||i==FamilyTree.action.maximize&&e[a].parent)&&(a=e[a].pid);var l=e[a],s=r[a];if(!s)return{x:0,y:0};var c=s.movex!=null?s.movex:0,d=s.movey!=null?s.movey:0;return{x:(s.x?s.x-c:0)-l.x,y:(s.y?s.y-d:0)-l.y}},FamilyTree.manager._verticalAssistantIterate=function(t,e){for(var i=0;i<t.stChildren.length;i++)FamilyTree.manager._verticalAssistantIterate(t.stChildren[i],e);if(t.children.length==3)FamilyTree.manager._verticalAssistantIterate(t.children[0],e),FamilyTree.manager._verticalAssistantIterate(t.children[2],e),FamilyTree.manager._verticalAssistantIterate(t.children[1],e);else for(i=0;i<t.children.length;i++)FamilyTree.manager._verticalAssistantIterate(t.children[i],e);if(t.isAssistant&&t.isSplit&&t.children.length){for(var n=t.parent.children[0],r=t.parent.children[2],o=t.parent;!o.hasAssistants;)o=o.parent;var a={max:0},l={max:0};FamilyTree.manager._verticalAssistantLevelCountIterate(n,0,a),FamilyTree.manager._verticalAssistantLevelCountIterate(r,0,l);var s=Math.max(a.max,l.max),c=[];for(i=0;i<s;i++){var d=new FamilyTree.node(t.parent.id+"_split_assitant_level_"+i,t.pid,[],"subLevel");FamilyTree.manager._initDinamicNode(d,t.lcn,!0),i>0&&(c[i-1].children.push(d),d.parent=c[i-1]),e[d.id]=d,c.push(d)}if(c.length){for(var p=c[c.length-1],h=c[0],f=t.children.length-1;f>=0;f--){var m=t.children[f];p.children.unshift(m),m.parent=p,t.children.splice(f,1)}t.children.push(h),h.parent=t}}},FamilyTree.manager._verticalAssistantLevelCountIterate=function(t,e,i){i.max<e&&(i.max=e),e++;for(var n=0;n<t.children.length;n++)FamilyTree.manager._verticalAssistantLevelCountIterate(t.children[n],e,i)},FamilyTree._addDottedLines=function(t){var e=t.nodes;if((t.groupDottedLines.length||t.dottedLines.length)&&(e=JSON.parse(JSON.stringify(e))),t.groupDottedLines.length)for(var i=[],n=0;n<t.groupDottedLines.length;n++){var r=t.groupDottedLines[n];r.rootId==null&&(r.rootId=r.to);var o=`balkan_group_dotted_${r.rootId}`;if(!i.has(o)){for(var a=0;a<e.length;a++)if(e[a].id==r.rootId){(d=JSON.parse(JSON.stringify(e[a]))).id=`balkan_group_dotted_${r.rootId}_balkan_id_${e[a].id}`,d.pid=void 0,d.stpid=e[a].id,e.push(d),i.push(o),e[a].tags||(e[a].tags=[]),e[a].tags.push("group-dotted-lines"),e[a].tags.push("group-dotted-lines-"+o);break}}for(a=0;a<e.length;a++)if(e[a].id==r.from){if((d=JSON.parse(JSON.stringify(e[a]))).id=`balkan_group_dotted_${r.rootId}_balkan_id_${e[a].id}`,d.pid=`balkan_group_dotted_${r.rootId}_balkan_id_${r.to}`,d.tags){var l=d.tags.indexOf("group-dotted-lines");l!=-1&&d.tags.splice(l,1)}if(d.tags||(d.tags=[]),d.tags.push("bft-dotted-connector"),r.tags)for(var s=0;s<r.tags.length;s++)d.tags.push(r.tags[s]);e.push(d);break}}if(t.dottedLines.length)for(n=0;n<t.dottedLines.length;n++){var c=t.dottedLines[n];for(c.rootId==null&&(c.rootId=c.to),a=0;a<e.length;a++)if(e[a].id==c.from){var d;if((d=JSON.parse(JSON.stringify(e[a]))).id=`balkan_dotted_${c.rootId}_balkan_id_${e[a].id}`,c.rootId==c.to?d.pid=c.to:d.pid=`balkan_dotted_${c.rootId}_balkan_id_${c.to}`,d.tags||(d.tags=[]),d.tags.push("bft-dotted-connector"),c.tags)for(s=0;s<c.tags.length;s++)d.tags.push(c.tags[s]);e.push(d);break}}return e},FamilyTree.manager.__createNodes=function(t,e,i,n,r,o,a,l){for(var s=i.nodes,c=[],d={},p={},h=0;h<s.length;h++){var f,m=s[h];f=FamilyTree.STRING_TAGS?m.tags?m.tags.split(","):[]:Array.isArray(m.tags)?m.tags.slice(0):[],l.filterUI.addFilterTag(m)&&f.push("filter");var y=l.searchUI.addMatchTag(m.id);y===!0?f.unshift("match"):y===!1&&f.unshift("no-match"),m.gender&&f.push(m.gender);var x=FamilyTree._getTemplate(f,i.tags,i.template);m.templateName&&(x=m.templateName);var u=new FamilyTree.node(m.id,m.pid,f,x);u.ftChildrenIds=[],u.rids=[],FamilyTree.isNEU(m.ppid)||(u.ppid=m.ppid),FamilyTree.isNEU(m.stpid)||(u.stpid=m.stpid),FamilyTree.isNEU(m.mid)||(u.mid=m.mid),FamilyTree.isNEU(m.fid)||(u.fid=m.fid),FamilyTree.isNEU(m.gender)||(u.gender=m.gender),Array.isArray(m.pids)?u.pids=m.pids:u.pids=[],i.orderBy!=null&&(u.order=FamilyTree.manager._getOrderFieldValue(m,i.orderBy)),t[m.id]=u,FamilyTree.isNEU(u.stpid)?(FamilyTree.isNEU(u.mid)||(d[u.mid]||(d[u.mid]=[]),d[u.mid].push(u.id)),FamilyTree.isNEU(u.fid)||(d[u.fid]||(d[u.fid]=[]),d[u.fid].push(u.id)),FamilyTree.isNEU(u.mid)&&FamilyTree.isNEU(u.fid)&&FamilyTree.isNEU(u.stpid)&&(c.has(u.id)||c.push(u.id))):(p[u.stpid]||(p[u.stpid]=[]),p[u.stpid].push(u.id))}if(i.orderBy!=null&&d)for(var b in d)d[b].sort(function(M,N){var A=t[M].order,B=t[N].order;return typeof A=="number"||typeof B=="number"?(A==null&&(A=-1),B==null&&(B=-1),i.orderBy.desc?B-A:A-B):typeof A=="string"||typeof B=="string"?(A==null&&(A=""),B==null&&(B=""),i.orderBy.desc?B.localeCompare(A):A.localeCompare(B)):void 0});for(h=0;h<c.length;h++){var v=t[c[h]];if(v){var g=[];FamilyTree.manager._iterateSetRootIds(v.id,v.id,p,d,t,g),a.push(g)}}for(h=0;h<a.length;h++)for(var _=0;_<a.length;_++)if(_!=h){for(var k=a[h],w=a[_],S=!1,I=0;I<k.length;I++)if(w.has(k[I])){S=!0;break}S&&(a[h]=k.concat(w).unique(),a[_]=[])}for(h=a.length-1;h>=0;h--)a[h].length||a.splice(h,1);if(!i.roots||!i.roots.length)for(i.roots=[],h=a.length-1;h>=0;h--)i.roots.push(a[h][0]);for(h=0;h<i.roots.length;h++)FamilyTree.manager._iterateFT(i.roots[h],p,d,t,o,e,n,r,i)},FamilyTree.manager._iterateSetRootIds=function(t,e,i,n,r,o){var a=r[t];if(a){a.rids.has(e)||a.rids.push(e);for(var l=0;l<a.rids.length;l++)o.has(a.rids[l])||o.push(a.rids[l]);for(l=0;l<a.pids.length;l++){var s=r[a.pids[l]];if(s)for(var c=0;c<s.rids.length;c++)o.has(s.rids[c])||o.push(s.rids[c])}if(i[a.id])for(l=0;l<i[a.id].length;l++)FamilyTree.manager._iterateSetRootIds(i[a.id][l],e,i,n,r,o);if(n[a.id])for(l=0;l<n[a.id].length;l++)FamilyTree.manager._iterateSetRootIds(n[a.id][l],e,i,n,r,o)}},FamilyTree.manager._iterateFT=function(t,e,i,n,r,o,a,l,s){var c,d=n[t],p=r?r[t]:null,h=n[d.stpid],f=n[d.mid],m=n[d.fid];if(h||(d.stpid=null),f?m&&(f.tags.has("partner")||f.tags.has("left-partner")||f.tags.has("right-partner"))?(d.pid=m.id,c=m,d.ppid=f.id):(d.pid=f.id,c=f,m&&(d.ppid=m.id)):m?f&&(m.tags.has("partner")||m.tags.has("left-partner")||m.tags.has("right-partner"))?(d.pid=f.id,c=f,d.ppid=m.id):(d.pid=m.id,c=m,f&&(d.ppid=f.id)):d.pid,h){var y=r?r[h.id]:null;y&&(h.min=y.min),h.stChildrenIds.push(d.id)}else f||m?(p&&(d.collapsed=p.collapsed,d.min=p.min),c&&!c.childrenIds.has(d.id)&&c.childrenIds.push(d.id),f&&!f.ftChildrenIds.has(d.id)&&f.ftChildrenIds.push(d.id),m&&!m.ftChildrenIds.has(d.id)&&m.ftChildrenIds.push(d.id)):(p&&(d.collapsed=p.collapsed,d.min=p.min),o.push(d));a==FamilyTree.action.init&&(d.min=FamilyTree._getMin(d,s));for(var x=0;x<d.pids.length;x++){var u=n[d.pids[x]];if(u){u.pid=d.id;var b=r?r[u.id]:null;if(b&&(u.collapsed=b.collapsed,u.min=b.min),a==FamilyTree.action.init&&(u.min=FamilyTree._getMin(u,s)),l&&p&&b&&l.id==d.id?b.hasPartners&&p.isPartner==1?u.tags.push("left-partner"):b.hasPartners&&p.isPartner==2||p.isPartner==1?u.tags.push("right-partner"):p.isPartner==2?u.tags.push("left-partner"):u.tags.push("partner"):b&&b.isPartner==2?u.tags.push("left-partner"):b&&b.isPartner==1?u.tags.push("right-partner"):u.tags.push("partner"),!FamilyTree.isNEU(u)&&i[u.id])for(var v=0;v<i[u.id].length;v++){var g=n[i[u.id][v]];g&&(FamilyTree.isNEU(g.fid)||FamilyTree.isNEU(g.mid))&&FamilyTree.manager._iterateFT(i[u.id][v],e,i,n,r,o,a,l,s)}d.childrenIds.push(u.id)}}if(e[t])for(v=0;v<e[t].length;v++)FamilyTree.manager._iterateFT(e[t][v],e,i,n,r,o,a,l,s);if(i[t])for(v=0;v<i[t].length;v++)FamilyTree.manager._iterateFT(i[t][v],e,i,n,r,o,a,l,s)},FamilyTree.manager.getAllFields=function(t){var e=[FamilyTree.TAGS];for(var i in t.nodeBinding)e.push(t.nodeBinding[i]);for(i=0;i<t.nodes.length;i++)for(var n in t.nodes[i])n!==FamilyTree.ID&&n!==FamilyTree.TAGS&&n!==FamilyTree.NODES&&n!==FamilyTree.PID&&n!==FamilyTree.STPID&&n!=="mid"&&n!=="fid"&&n!=="pids"&&(t.nodeBinding[n]||e.has(n)||e.push(n));return e},FamilyTree.templates={},FamilyTree.templates.base={defs:`<g transform="matrix(1,0,0,1,0,0)" id="dot"><circle class="bft-fill" cx="0" cy="0" r="5" stroke="#aeaeae" stroke-width="1"></circle></g>
            <g id="base_node_menu" style="cursor:pointer;"><rect x="0" y="0" fill="transparent" width="22" height="22"></rect><circle cx="4" cy="11" r="2" fill="#aeaeae"></circle><circle cx="11" cy="11" r="2" fill="#aeaeae"></circle><circle cx="18" cy="11" r="2" fill="#aeaeae"></circle></g>
            <g style="cursor: pointer;" id="base_tree_menu">
                <rect x="0" y="0" width="25" height="25" fill="transparent"></rect>
                ${FamilyTree.icon.addUser(25,25,"#fff",0,0)}
            </g>
            <g style="cursor: pointer;" id="base_tree_menu_close">
                <circle cx="12.5" cy="12.5" r="12" fill="#F57C00"></circle>
                ${FamilyTree.icon.close(25,25,"#fff",0,0)}
            </g>            
            <g id="base_up">
                <circle cx="15" cy="15" r="15" fill="#fff" stroke="#aeaeae" stroke-width="1"></circle>
                ${FamilyTree.icon.ft(20,20,"#aeaeae",5,5)}
            </g>
            <clipPath id="base_img_0"><rect id="base_img_0_stroke" stroke-width="3" stroke="#fff" x="170" y="-5" rx="25" ry="25" width="70" height="70"></rect></clipPath>`,size:[250,120],linkAdjuster:{fromX:0,fromY:0,toX:0,toY:0},ripple:{radius:0,color:"#e6e6e6",rect:null},expandCollapseSize:0,svg:'<svg class="{randId} {template}" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  style="display:block;" width="{w}" height="{h}" viewBox="{viewBox}">{content}</svg>',link:'<path stroke-linejoin="round" stroke="#aeaeae" stroke-width="1px" fill="none" d="{rounded}" />',assistanseLink:'<path stroke-linejoin="round" stroke="#aeaeae" stroke-width="2px" fill="none" d="M{xa},{ya} {xb},{yb} {xc},{yc} {xd},{yd} L{xe},{ye}"/>',pointer:'<g data-pointer="pointer" transform="matrix(0,0,0,0,100,100)"><radialGradient id="pointerGradient"><stop stop-color="#ffffff" offset="0" /><stop stop-color="#C1C1C1" offset="1" /></radialGradient><circle cx="16" cy="16" r="16" stroke-width="1" stroke="#acacac" fill="url(#pointerGradient)"></circle></g>',node:'<rect x="0" y="0" height="{h}" width="{w}" stroke-width="1" stroke="#aeaeae" rx="7" ry="7"></rect>',menuButton:'<div style="position:absolute;right:{p}px;top:{p}px; width:40px;height:50px;cursor:pointer;" '+FamilyTree.attr.control_export_menu+'=""><hr style="background-color: #7A7A7A; height: 3px; border: none;"><hr style="background-color: #7A7A7A; height: 3px; border: none;"><hr style="background-color: #7A7A7A; height: 3px; border: none;"></div>',padding:[50,20,35,20],nodeMenuButton:`<use ${FamilyTree.attr.control_node_menu_id}="{id}" x="220" y="95" xlink:href="#base_node_menu"/>`,nodeTreeMenuButton:'<use data-ctrl-n-t-menu-id="{id}" x="10" y="10" xlink:href="#base_tree_menu"/>',nodeTreeMenuCloseButton:'<use data-ctrl-n-t-menu-c="" x="10" y="10" xlink:href="#base_tree_menu_close"/>',up:'<use x="110" y="-10" xlink:href="#base_up"/>',img_0:'<use xlink:href="#base_img_0_stroke" /><image preserveAspectRatio="xMidYMid slice" clip-path="url(#base_img_0)" xlink:href="{val}"  x="170" y="-5"  width="70" height="70"></image>',link_field_0:'<text text-anchor="middle" fill="#aeaeae" '+FamilyTree.attr.width+'="290" x="0" y="0" style="font-size:10px;">{val}</text>'},FamilyTree.templates.dot=Object.assign({},FamilyTree.templates.base),FamilyTree.templates.dot.node='<circle cx="5" cy="5" r="5" fill="none" stroke-width="1" stroke="#aeaeae"></circle>',FamilyTree.templates.dot.size=[10,10],FamilyTree.templates.dot.nodeMenuButton="",FamilyTree.templates.dot.nodeTreeMenuButton="",FamilyTree.templates.dot.nodeTreeMenuCloseButton="",FamilyTree.templates.dot.up="",FamilyTree.templates.john=Object.assign({},FamilyTree.templates.base),FamilyTree.templates.john.nodeMenuButton=`<use ${FamilyTree.attr.control_node_menu_id}="{id}" x="90" y="50" xlink:href="#base_node_menu"/>`,FamilyTree.templates.john.defs=`<style>                          
                                        .{randId} .bft-edit-form-header, .{randId} .bft-img-button{
                                            background-color: #aeaeae;
                                        }
                                        .{randId}.male .bft-edit-form-header, .{randId}.male .bft-img-button{
                                            background-color: #039BE5;
                                        }        
                                        .{randId}.male div.bft-img-button:hover{
                                            background-color: #F57C00;
                                        }
                                        .{randId}.female .bft-edit-form-header, .{randId}.female .bft-img-button{
                                            background-color: #F57C00;
                                        }        
                                        .{randId}.female div.bft-img-button:hover{
                                            background-color: #039BE5;
                                        }
                                    </style>
                                    <clipPath id="john_img_0"><rect  x="6" y="6" rx="54" ry="54" width="108" height="108"></rect></clipPath>
                                    ${FamilyTree.gradientCircleForDefs("circle","#aeaeae",60,5)}
                                    ${FamilyTree.gradientCircleForDefs("male_circle","#039BE5",60,5)}
                                    ${FamilyTree.gradientCircleForDefs("female_circle","#F57C00",60,5)}`,FamilyTree.templates.john.field_0="<text "+FamilyTree.attr.width+'="230" style="font-size: 16px;font-weight:bold;" fill="#aeaeae" x="60" y="135" text-anchor="middle">{val}</text>',FamilyTree.templates.john.field_1="<text "+FamilyTree.attr.width+'="150" style="font-size: 13px;" fill="#aeaeae" x="60" y="150" text-anchor="middle">{val}</text>',FamilyTree.templates.john.node='<use x="0" y="0" xlink:href="#circle" />',FamilyTree.templates.john.img_0='<image preserveAspectRatio="xMidYMid slice" clip-path="url(#john_img_0)" xlink:href="{val}"  x="6" y="6"  width="108" height="108"></image>',FamilyTree.templates.john.ripple={radius:60,color:"#e6e6e6",rect:null},FamilyTree.templates.john.size=[120,120],FamilyTree.templates.john_male=Object.assign({},FamilyTree.templates.john),FamilyTree.templates.john_male.node+='<use x="0" y="0" xlink:href="#male_circle" />',FamilyTree.templates.john_male.ripple={radius:60,color:"#039BE5",rect:null},FamilyTree.templates.john_female=Object.assign({},FamilyTree.templates.john),FamilyTree.templates.john_female.node+='<use x="0" y="0" xlink:href="#female_circle" />',FamilyTree.templates.john_female.ripple={radius:60,color:"#F57C00",rect:null},FamilyTree.templates.tommy=Object.assign({},FamilyTree.templates.base),FamilyTree.templates.tommy.defs=`<style>                          
                                        .{randId} .bft-edit-form-header, .{randId} .bft-img-button{
                                            background-color: #aeaeae;
                                        }
                                        .{randId}.male .bft-edit-form-header, .{randId}.male .bft-img-button{
                                            background-color: #039BE5;
                                        }        
                                        .{randId}.male div.bft-img-button:hover{
                                            background-color: #F57C00;
                                        }
                                        .{randId}.female .bft-edit-form-header, .{randId}.female .bft-img-button{
                                            background-color: #F57C00;
                                        }        
                                        .{randId}.female div.bft-img-button:hover{
                                            background-color: #039BE5;
                                        }
                                    </style>`,FamilyTree.templates.tommy.field_0="<text "+FamilyTree.attr.width+'="230" style="font-size: 18px;font-weight:bold;" fill="#ffffff" x="10" y="90" text-anchor="start">{val}</text>',FamilyTree.templates.tommy.field_1="<text "+FamilyTree.attr.width+'="150" style="font-size: 14px;" fill="#ffffff" x="10" y="65" text-anchor="start">{val}</text>',FamilyTree.templates.tommy.node='<rect x="0" y="0" height="{h}" width="{w}" stroke-width="1" fill="#aeaeae" stroke="#aeaeae" rx="7" ry="7"></rect>',FamilyTree.templates.tommy_male=Object.assign({},FamilyTree.templates.tommy),FamilyTree.templates.tommy_male.node='<rect x="0" y="0" height="{h}" width="{w}" stroke-width="1" fill="#039BE5" stroke="#aeaeae" rx="7" ry="7"></rect>',FamilyTree.templates.tommy_female=Object.assign({},FamilyTree.templates.tommy),FamilyTree.templates.tommy_female.node='<rect x="0" y="0" height="{h}" width="{w}" stroke-width="1" fill="#F57C00" stroke="#aeaeae" rx="7" ry="7"></rect>',FamilyTree.templates.hugo=Object.assign({},FamilyTree.templates.base),FamilyTree.templates.hugo.up='<use x="200" y="10" xlink:href="#hugo_up"/>',FamilyTree.templates.hugo.nodeMenuButton=`<use x="225" y="10" ${FamilyTree.attr.control_node_menu_id}="{id}" xlink:href="#hugo_node_menu"/>`,FamilyTree.templates.hugo.defs=`<clipPath id="hugo_img_0"><rect id="hugo_img_0_stroke" stroke-width="2" stroke="#fff" x="90" y="-5" rx="25" ry="25" width="70" height="70"></rect></clipPath>
                                    <linearGradient id="hugo_grad_female" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" style="stop-color:#FF8024;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#FF46A3;stop-opacity:1" />
                                    </linearGradient>
                                    <linearGradient id="hugo_grad_male" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" style="stop-color:#00D3A5;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#00A7D4;stop-opacity:1" />
                                    </linearGradient>
                                    <linearGradient id="hugo_grad" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" style="stop-color:#D0D0D0;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#909090;stop-opacity:1" />
                                    </linearGradient>
                                    <g id="hugo_up">
                                        <circle cx="12" cy="12" r="15" fill="transparent" ></circle>
                                        ${FamilyTree.icon.ft(24,24,"#fff",0,0)}
                                    </g>
                                    <g id="hugo_node_menu" style="cursor:pointer;"><rect x="0" y="0" fill="transparent" width="22" height="22"></rect><circle cx="11" cy="4" r="2" fill="#ffffff"></circle><circle cx="11" cy="11" r="2" fill="#ffffff"></circle><circle cx="11" cy="18" r="2" fill="#ffffff"></circle></g>
                                    <style>
                                        .{randId} .bft-edit-form-header{
                                            background: linear-gradient(90deg, #D0D0D0 0%, #909090 100%);
                                        }
                                        .{randId}.male .bft-edit-form-header{
                                            background: linear-gradient(90deg, #00D3A5 0%, #00A7D4 100%);
                                        }
                                        .{randId}.female .bft-edit-form-header{
                                            background: linear-gradient(90deg, #FF8024 0%, #FF46A3 100%);
                                        }  
                                        .{randId} .bft-img-button{
                                            background-color: #909090;
                                        }      
                                        .{randId} .bft-img-button:hover{
                                            background-color: #D0D0D0;
                                        }
                                        .{randId}.male .bft-img-button{
                                            background-color: #00A7D4;
                                        }      
                                        .{randId}.male .bft-img-button:hover{
                                            background-color: #00D3A5;
                                        }
                                        .{randId}.female .bft-img-button{
                                            background-color: #FF46A3;
                                        }      
                                        .{randId}.female .bft-img-button:hover{
                                            background-color: #FF8024;
                                        }
                                        
                                    </style>`,FamilyTree.templates.hugo.img_0='<use xlink:href="#hugo_img_0_stroke" /><image preserveAspectRatio="xMidYMid slice" clip-path="url(#hugo_img_0)" xlink:href="{val}"  x="90" y="-5"  width="70" height="70"></image>',FamilyTree.templates.hugo.field_0="<text "+FamilyTree.attr.width+'="230" style="font-size: 18px;font-weight:bold;" fill="#ffffff" x="125" y="85" text-anchor="middle">{val}</text>',FamilyTree.templates.hugo.field_1="<text "+FamilyTree.attr.width+'="230" style="font-size: 14px;" fill="#ffffff" x="125" y="105" text-anchor="middle">{val}</text>',FamilyTree.templates.hugo.node='<rect x="0" y="0" height="{h}" width="{w}" stroke-width="1" fill=url(#hugo_grad) stroke="#aeaeae" rx="7" ry="7"></rect>',FamilyTree.templates.hugo_male=Object.assign({},FamilyTree.templates.hugo),FamilyTree.templates.hugo_male.node='<rect x="0" y="0" height="{h}" width="{w}" stroke-width="1" fill=url(#hugo_grad_male) stroke="#aeaeae" rx="7" ry="7"></rect>',FamilyTree.templates.hugo_female=Object.assign({},FamilyTree.templates.hugo),FamilyTree.templates.hugo_female.node='<rect x="0" y="0" height="{h}" width="{w}" stroke-width="1" fill=url(#hugo_grad_female) stroke="#aeaeae" rx="7" ry="7"></rect>',FamilyTree.templates.mother=Object.assign({},FamilyTree.templates.base),FamilyTree.templates.mother.up="",FamilyTree.templates.mother.node='<rect x="0" y="0" height="{h}" width="{w}" style="fill:transparent;"  stroke-width="1" stroke="#F57C00" rx="5" ry="5"></rect><text style="font-size: 18px;" fill="#F57C00" x="240" y="30" text-anchor="end">Add mother</text>'+FamilyTree.icon.mother(70,70,"#F57C00",10,40),FamilyTree.templates.mother.field_0="",FamilyTree.templates.mother.field_1="",FamilyTree.templates.father=Object.assign({},FamilyTree.templates.mother),FamilyTree.templates.father.node='<rect x="0" y="0" height="{h}" width="{w}" style="fill:transparent;height:{h}; width:{w};stroke-width:1;stroke:#039BE5;rx:5;ry:5;"></rect><text style="font-size: 18px;" fill="#039BE5" x="240" y="30" text-anchor="end">Add father</text>'+FamilyTree.icon.father(70,70,"#039BE5",10,40),FamilyTree.templates.partner=Object.assign({},FamilyTree.templates.mother),FamilyTree.templates.partner.node='<rect x="0" y="0" height="{h}" width="{w}" style="fill:transparent;height:{h}; width:{w};stroke-width:1;stroke:#aeaeae;rx:5;ry:5;"></rect><text style="font-size: 18px;" fill="#aeaeae" x="240" y="30" text-anchor="end">Add partner</text>',FamilyTree.templates.son=Object.assign({},FamilyTree.templates.mother),FamilyTree.templates.son.node='<rect x="0" y="0" height="{h}" width="{w}" style="fill:transparent;height:{h}; width:{w};stroke-width:1;stroke:#039BE5;rx:5;ry:5;"></rect><text style="font-size: 18px;" fill="#039BE5" x="240" y="30" text-anchor="end">Add son</text>'+FamilyTree.icon.son(70,70,"#039BE5",10,40),FamilyTree.templates.daughter=Object.assign({},FamilyTree.templates.mother),FamilyTree.templates.daughter.node='<rect x="0" y="0" height="{h}" width="{w}" style="fill:transparent;height:{h}; width:{w};stroke-width:1;stroke:#F57C00;rx:5;ry:5;"></rect><text style="font-size: 18px;" fill="#F57C00" x="240" y="30" text-anchor="end">Add daughter</text>'+FamilyTree.icon.daughter(70,70,"#F57C00",10,40),FamilyTree.templates.husband=Object.assign({},FamilyTree.templates.mother),FamilyTree.templates.husband.node='<rect x="0" y="0" height="{h}" width="{w}" style="fill:transparent;height:{h}; width:{w};stroke-width:1;stroke:#039BE5;rx:5;ry:5;"></rect><text style="font-size: 18px;" fill="#039BE5" x="240" y="30" text-anchor="end">Add husband</text>'+FamilyTree.icon.husband(70,70,"#039BE5",10,40),FamilyTree.templates.wife=Object.assign({},FamilyTree.templates.mother),FamilyTree.templates.wife.node='<rect x="0" y="0" height="{h}" width="{w}" style="fill:transparent;height:{h}; width:{w};stroke-width:1;stroke:#F57C00;rx:5;ry:5;"></rect><text style="font-size: 18px;" fill="#F57C00" x="240" y="30" text-anchor="end">Add wife</text>'+FamilyTree.icon.wife(70,70,"#F57C00",10,40),FamilyTree.templates.pet=Object.assign({},FamilyTree.templates.mother),FamilyTree.templates.pet.node='<rect x="0" y="0" style="fill:transparent;height:{h}; width:{w};stroke-width:1;stroke:#F57C00;rx:5;ry:5;"></rect><text style="font-size: 18px;" fill="#F57C00" x="240" y="30" text-anchor="end">Add pet</text>'+FamilyTree.icon.teddy(70,70,"#F57C00",10,40),FamilyTree.templates.cgroup=Object.assign({},FamilyTree.templates.base),FamilyTree.templates.cgroup.defs="",FamilyTree.templates.cgroup.size=[250,120],FamilyTree.templates.cgroup.padding=[0,0,0,0],FamilyTree.templates.cgroup.node="",FamilyTree.templates.split=Object.assign({},FamilyTree.templates.base),FamilyTree.templates.split.size=[10,10],FamilyTree.templates.split.node='<circle cx="5" cy="5" r="5" fill="none" stroke-width="1" stroke="#aeaeae"></circle>',FamilyTree.templates.mirror={linkAdjuster:{},link:"",node:"",nodeMenuButton:"",size:[0,0]},FamilyTree.ui={_defsIds:{},defs:function(t){var e="";for(var i in FamilyTree.templates){var n=FamilyTree.templates[i];n.defs&&(FamilyTree.ui._defsIds[i]=FamilyTree.randomId(),e+=n.defs.replaceAll("{randId}",FamilyTree.ui._defsIds[i]))}return"<defs>"+e+t+"</defs>"},lonely:function(t){return t.nodes&&t.nodes.length?"":FamilyTree.IT_IS_LONELY_HERE.replace("{link}",FamilyTree.RES.IT_IS_LONELY_HERE_LINK)},pointer:function(t,e,i){return e===FamilyTree.action.exporting?"":FamilyTree.t(t.template,!1,i).pointer},node:function(t,e,i,n,r,o,a,l,s,c){var d=FamilyTree.t(t.templateName,t.min,s),p=d.node.replaceAll("{w}",t.w).replaceAll("{h}",t.h);d.defs&&(p=p.replaceAll("{randId}",FamilyTree.ui._defsIds[t.templateName])),a==null&&(a=n.nodeBinding);var h={node:t,data:e};for(var f in a){var m,y=a[f];e&&(m=e[y]);var x=FamilyTree._lblIsImg(n,f);if(h.value=m,h.element=d[f],h.name=y,h.field=f,FamilyTree.events.publish("field",[c,h])!==!1&&h.value!=null&&h.value!=null&&h.element!=null&&(!x||x&&!FamilyTree.isNEU(h.value))){if(!x&&typeof h.value=="string"){var u=h.element;u&&(u=u.replaceAll("{ew}",t.w-(t.padding?t.padding[1]:0)).replaceAll("{cw}",t.w/2)),h.value=FamilyTree.wrapText(h.value,u)}var b=h.element.replace("{val}",h.value);p+=b=b.replaceAll("{ew}",t.w-(t.padding?t.padding[1]:0)).replaceAll("{cw}",t.w/2).replaceAll("{randId}",FamilyTree.randomId()).replaceAll("{randId2}",FamilyTree.randomId())}}var v=FamilyTree._getPosition(i,t,r,o),g="node";Array.isArray(t.tags)&&t.tags.length&&(g+=" "+t.tags.join(" ")),t.layout&&(g+=" tree-layout");var _="";t.lcn&&(_='lcn="'+t.lcn+'"');var k=FamilyTree.nodeOpenTag.replace("{lcn}",_).replace("{id}",t.id).replace("{class}",g).replace("{sl}",t.sl).replace("{level}",t.level).replace("{x}",v.x).replace("{y}",v.y),w=FamilyTree._getOpacity(i,t);return p=(k=k.replace("{opacity}",w))+(p+=FamilyTree.ui.nodeBtns(n,t,l,d,c))+FamilyTree.grCloseTag},nodeBtns:function(t,e,i,n,r){var o="";return t.nodeMenu==null||e.isSplit||i===FamilyTree.action.exporting||(o+=n.nodeMenuButton.replace("{id}",e.id).replace("{cw}",e.w/2).replace("{ch}",e.h/2).replace("{ew}",e.w-(e.padding?e.padding[1]:0)).replace("{eh}",e.h-(e.padding?e.padding[2]:0))),t.nodeCircleMenu==null||e.isSplit||i===FamilyTree.action.exporting||FamilyTree.isNEU(n.nodeCircleMenuButton)||(o+='<g style="cursor:pointer;" transform="matrix(1,0,0,1,'+n.nodeCircleMenuButton.x+","+n.nodeCircleMenuButton.y+')" '+FamilyTree.attr.control_node_circle_menu_id+'="'+e.id+'"><circle cx="0" cy="0" fill="'+n.nodeCircleMenuButton.color+'" r="'+n.nodeCircleMenuButton.radius+'" stroke-width="1" stroke="'+n.nodeCircleMenuButton.stroke+'"></circle><line x1="-'+n.nodeCircleMenuButton.radius/2+'" y1="-6" x2="'+n.nodeCircleMenuButton.radius/2+'" y2="-6" stroke-width="2" stroke="'+n.nodeCircleMenuButton.stroke+'"></line><line x1="-'+n.nodeCircleMenuButton.radius/2+'" y1="0" x2="'+n.nodeCircleMenuButton.radius/2+'" y2="0" stroke-width="2" stroke="'+n.nodeCircleMenuButton.stroke+'"></line><line x1="-'+n.nodeCircleMenuButton.radius/2+'" y1="6" x2="'+n.nodeCircleMenuButton.radius/2+'" y2="6" stroke-width="2" stroke="'+n.nodeCircleMenuButton.stroke+'"></line></g>'),o},expandCollapseBtn:function(t,e,i,n,r){var o="";if(n!==FamilyTree.action.exporting&&!e.isSplit){var a=i[e.lcn?e.lcn:"base"],l=0,s=0,c=FamilyTree.t(e.templateName,e.min,r);if(e.childrenIds.length>0){if(e.hasPartners){for(var d=!1,p=0;p<e.childrenIds.length;p++){var h=t.getNode(e.childrenIds[p]);!h||h.parentPartner||h.isPartner||(d=!0)}if(!d)return""}switch(a.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:l=e.x+e.w/2,s=e.y+e.h;break;case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:l=e.x+e.w/2,s=e.y;break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:l=e.x,s=e.y+e.h/2;break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:l=e.x+e.w,s=e.y+e.h/2}if(l-=c.expandCollapseSize/2,s-=c.expandCollapseSize/2,t.getCollapsedIds(e).length?(o+=FamilyTree.expcollOpenTag.replace("{id}",e.id).replace("{x}",l).replace("{y}",s),o+=c.plus,o+=FamilyTree.grCloseTag):(o+=FamilyTree.expcollOpenTag.replace("{id}",e.id).replace("{x}",l).replace("{y}",s),o+=c.minus,o+=FamilyTree.grCloseTag),o.indexOf("{collapsed-children-count}")!=-1){var f=FamilyTree.collapsedChildrenCount(t,e);o=o.replace("{collapsed-children-count}",f)}if(o.indexOf("{collapsed-children-total-count}")!=-1){var m=FamilyTree.collapsedChildrenTotalCount(t,e);o=o.replace("{collapsed-children-total-count}",m)}if(o.indexOf("{children-count}")!=-1){var y=FamilyTree.childrenCount(t,e);o=o.replace("{children-count}",y)}if(o.indexOf("{children-total-count}")!=-1){var x=FamilyTree.childrenTotalCount(t,e);o=o.replace("{children-total-count}",x)}}t._nodeHasHiddenParent(e)&&(o+=FamilyTree.upOpenTag.replace("{id}",e.id).replace("{x}",e.x).replace("{y}",e.y),o+=c.up,o+=FamilyTree.grCloseTag)}var u={html:o,node:e};return FamilyTree.events.publish("renderbuttons",[t,u]),u.html},link:function(t,e,i,n,r,o,a){var l=t.lcn?t.lcn:"base",s=e._layoutConfigs[l],c=FamilyTree.t(t.templateName,t.min,i),d=[],p=[],h=s.levelSeparation/2;t.layout>0&&(h=s.mixedHierarchyNodesSeparation/2);var f=0,m=FamilyTree.getRootOf(t).id,y=n[m][t.sl],x=void 0;if(t.hasPartners){x={ids:[],indexes:{},ppnodes:{},lastLeft:null,firstRight:null,maxSidePartnersWithChildren:0,rightIds:[],leftIds:[],partnerChildrenSplitSeparation:e.config.partnerChildrenSplitSeparation};for(var u=0;u<t.children.length;u++)(v=t.children[u]).parentPartner?(x.ppnodes[v.id]=v.parentPartner,x.ids.push(v.id),v.parentPartner.isPartner==1?(x.rightIds.indexOf(v.parentPartner.id)==-1&&x.rightIds.push(v.parentPartner.id),x.indexes[v.id]=x.rightIds.indexOf(v.parentPartner.id),x.firstRight||(x.firstRight=v)):v.parentPartner.isPartner==2&&(x.leftIds.indexOf(v.parentPartner.id)==-1&&x.leftIds.push(v.parentPartner.id),x.indexes[v.id]=x.leftIds.indexOf(v.parentPartner.id),x.lastLeft=v)):v.isPartner||(x.lastLeft=v,x.firstRight||(x.firstRight=v));x.maxSidePartnersWithChildren=Math.max(x.leftIds.length,x.rightIds.length),f=x.maxSidePartnersWithChildren==0?e.config.minPartnerSeparation/2:e.config.minPartnerSeparation/2+x.partnerChildrenSplitSeparation*x.maxSidePartnersWithChildren+x.partnerChildrenSplitSeparation/2}for(u=0;u<t.children.length;u++){var b,v=t.children[u],g=n[m][v.sl],_={xa:0,ya:0,xb:0,yb:0,xc:0,yc:0,xd:0,yd:0,x:0,y:0,rotate:0},k=(c=FamilyTree.t(v.templateName,v.min,i)).link;if(v.isChildOfPartner)switch(s.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:var w=v.layout==1?void 0:g.minY-(g.minY-y.maxY)/2;_=FamilyTree.ui._linkTopToBottom(v.parentPartner,v,c,h,w);break;case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:w=v.layout==1?void 0:g.maxY-(g.maxY-y.minY)/2,_=FamilyTree.ui._linkBottomToTop(v.parentPartner,v,c,h,w);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:w=v.layout==1?void 0:g.maxX-(g.maxX-y.minX)/2,_=FamilyTree.ui._linkRightToLeft(v.parentPartner,v,c,h,w);break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:w=v.layout==1?void 0:g.minX-(g.minX-y.maxX)/2,_=FamilyTree.ui._linkLeftToRight(v.parentPartner,v,c,h,w)}else if(x&&x.ids.indexOf(v.id)!=-1)switch(s.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:_=FamilyTree.ui._linkPpTop(x,t,v,g,y,c);break;case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:_=FamilyTree.ui._linkPpBottom(x,t,v,g,y,c);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:_=FamilyTree.ui._linkPpRight(x,t,v,g,y,c);break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:_=FamilyTree.ui._linkPpLeft(x,t,v,g,y,c)}else{var S=v.isAssistant&&v.rightNeighbor&&v.rightNeighbor.isAssistant&&v.parent==v.rightNeighbor.parent,I=v.isAssistant&&v.leftNeighbor&&v.leftNeighbor.isAssistant&&v.parent==v.leftNeighbor.parent;if((S||v.layout>1)&&v.rightNeighbor&&v.rightNeighbor.isSplit)switch(s.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:_=FamilyTree.ui._linkRightToLeft(v.rightNeighbor,v,c,h);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:_=FamilyTree.ui._linkBottomToTop(v.rightNeighbor,v,c,h)}else if((I||v.layout>1)&&v.leftNeighbor&&v.leftNeighbor.isSplit)switch(s.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:_=FamilyTree.ui._linkLeftToRight(v.leftNeighbor,v,c,h);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:_=FamilyTree.ui._linkTopToBottom(v.leftNeighbor,v,c,h)}else switch(s.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:v.isPartner==1?_=FamilyTree.ui._linkLeftToRight(t,v,c,f):v.isPartner==2?_=FamilyTree.ui._linkRightToLeft(t,v,c,f):(w=v.layout==1?void 0:g.minY-(g.minY-y.maxY)/2,_=FamilyTree.ui._linkTopToBottom(t,v,c,h,w));break;case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:v.isPartner==1?_=FamilyTree.ui._linkLeftToRight(t,v,c,f):v.isPartner==2?_=FamilyTree.ui._linkRightToLeft(t,v,c,f):(w=v.layout==1?void 0:g.maxY-(g.maxY-y.minY)/2,_=FamilyTree.ui._linkBottomToTop(t,v,c,h,w));break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:v.isPartner==1?_=FamilyTree.ui._linkTopToBottom(t,v,c,f):v.isPartner==2?_=FamilyTree.ui._linkBottomToTop(t,v,c,f):(w=v.layout==1?void 0:g.maxX-(g.maxX-y.minX)/2,_=FamilyTree.ui._linkRightToLeft(t,v,c,h,w));break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:v.isPartner==1?_=FamilyTree.ui._linkTopToBottom(t,v,c,f):v.isPartner==2?_=FamilyTree.ui._linkBottomToTop(t,v,c,f):(w=v.layout==1?void 0:g.minX-(g.minX-y.maxX)/2,_=FamilyTree.ui._linkLeftToRight(t,v,c,h,w))}}var M=FamilyTree.ui._draggableLinkPath(e,t,v,_,h,s.orientation);if(M)b=M,k=k.replaceAll("{rounded}",M).replaceAll("{edge}",M).replaceAll("{curve}",b);else if(k.indexOf("{rounded}")!=-1)if(_.xa==_.xb&&_.xa==_.xc&&_.xa==_.xd||_.ya==_.yb&&_.ya==_.yc&&_.ya==_.yd)b="M"+_.xa+","+_.ya+" L"+_.xd+","+_.yd,k=k.replaceAll("{rounded}",b);else if(Math.abs(_.xa-_.xd)<=FamilyTree.LINK_ROUNDED_CORNERS&&Math.abs(_.xa-_.xc)<=FamilyTree.LINK_ROUNDED_CORNERS&&Math.abs(_.xa-_.xb)<=FamilyTree.LINK_ROUNDED_CORNERS)b="M"+_.xa+","+_.ya+" L"+_.xa+","+_.yd,k=k.replaceAll("{rounded}",b);else if(Math.abs(_.ya-_.yd)<=FamilyTree.LINK_ROUNDED_CORNERS&&Math.abs(_.ya-_.yc)<=FamilyTree.LINK_ROUNDED_CORNERS&&Math.abs(_.ya-_.yb)<=FamilyTree.LINK_ROUNDED_CORNERS)b="M"+_.xa+","+_.ya+" L"+_.xd+","+_.ya,k=k.replaceAll("{rounded}",b);else{var N=FamilyTree.ui._roundedEdge(_.xa,_.ya,_.xb,_.yb,_.xc,_.yc),A=FamilyTree.ui._roundedEdge(_.xb,_.yb,_.xc,_.yc,_.xd,_.yd);b="M"+N.x1+","+N.y1+" "+N.x2+","+N.y2+" Q"+N.qx1+","+N.qy1+" "+N.qx2+","+N.qy2+" L"+A.x2+","+A.y2+" Q"+A.qx1+","+A.qy1+" "+A.qx2+","+A.qy2+" L"+A.x3+","+A.y3,k=k.replaceAll("{rounded}",b)}else k.indexOf("{edge}")!=-1?(b="M"+_.xa+","+_.ya+" "+_.xb+","+_.yb+" "+_.xc+","+_.yc+" L"+_.xd+","+_.yd,k=k.replaceAll("{edge}",b)):k.indexOf("{curve}")!=-1?(b="M"+_.xa+","+_.ya+" C"+_.xb+","+_.yb+" "+_.xc+","+_.yc+" "+_.xd+","+_.yd,k=k.replaceAll("{curve}",b)):(b=k.replaceAll("{xa}",_.xa).replaceAll("{ya}",_.ya).replaceAll("{xb}",_.xb).replaceAll("{yb}",_.yb).replaceAll("{xc}",_.xc).replaceAll("{yc}",_.yc).replaceAll("{xd}",_.xd).replaceAll("{yd}",_.yd),k=b);d.push(FamilyTree.linkOpenTag.replaceAll("{id}",t.id).replaceAll("{class}","link "+v.tags.join(" ")).replaceAll("{child-id}",v.id));var B={node:t,cnode:v,p:_,html:k,action:o};FamilyTree.events.publish("render-link",[e,B]),d.push(B.html),a&&p.push({id:t.id,childId:v.id,html:B.html});var P="";for(var T in e.config.linkBinding){var O=e.config.linkBinding[T],L=e._get(v.id);if(L){var U=L[O];B.value=U,B.element=c[T],B.name=O,FamilyTree.events.publish("label",[e,B])!==!1&&(FamilyTree.isNEU(B.value)||FamilyTree.isNEU(B.element)||(P+=B.element.replace("{val}",B.value)))}}if(P!=""){var D=_.x,R=_.y;v.movey!=null&&(R+=v.movey),P=FamilyTree.linkFieldsOpenTag.replace("{x}",D).replace("{y}",R).replace("{rotate}",0)+P+FamilyTree.grCloseTag,d.push(P)}d.push(FamilyTree.grCloseTag)}return a?p:d.join("")},svg:function(t,e,i,n,r,o){return FamilyTree.t(n.template,!1,o).svg.replace("{w}",t).replace("{h}",e).replace("{viewBox}",i).replace("{randId}",FamilyTree.ui._defsIds[n.template]).replace("{mode}",n.mode).replace("{template}",n.template).replace("{content}",function(){return r})},menuButton:function(t){return t.menu==null?"":FamilyTree.t(t.template,!1).menuButton.replaceAll("{p}",t.padding)},_roundedEdge:function(t,e,i,n,r,o){var a,l,s,c=FamilyTree.LINK_ROUNDED_CORNERS,d=0;return t==i&&t==r||e==n&&e==o?(a=s=i,l=d=n):(t!=r&&i==r&&(a=s=i,l=n,e<o?d=n+c:e>o&&(d=n-c)),t<r&&i==r?i-=c:t>r&&i==r&&(i+=c),e!=o&&n==o&&(a=i,l=d=n,t<r?s=i+c:t>r&&(s=i-c)),e<o&&n==o?n-=c:e>o&&n==o&&(n+=c)),{x1:t,y1:e,x2:i,y2:n,x3:r,y3:o,qx1:a,qy1:l,qx2:s,qy2:d}},_linkTopToBottom:function(t,e,i,n,r){var o,a,l,s,c,d=0;return o=t.x+t.w/2+i.linkAdjuster.toX,a=t.y+t.h+i.linkAdjuster.toY,s=l=e.x+e.w/2+i.linkAdjuster.fromX,c=e.y+i.linkAdjuster.fromY,{xa:o,ya:a,xb:o,yb:d=t.rightNeighbor&&t.rightNeighbor.isAssistant&&e.templateName=="split"?t.rightNeighbor.y+t.rightNeighbor.h+n:t.templateName=="split"&&(e.isAssistant||e.layout>1)?c:e.templateName=="split"?a+n:r??c-n,xc:l,yc:d,xd:s,yd:c,x:l,y:FamilyTree.isNEU(e.parentPartner)?d+16:d,rotate:0}},_linkBottomToTop:function(t,e,i,n,r){var o,a,l,s,c,d=0;return o=t.x+t.w/2+i.linkAdjuster.toX,a=t.y+i.linkAdjuster.toY,s=l=e.x+e.w/2+i.linkAdjuster.fromX,c=e.y+e.h+i.linkAdjuster.fromY,{xa:o,ya:a,xb:o,yb:d=t.rightNeighbor&&t.rightNeighbor.isAssistant&&e.templateName=="split"?t.rightNeighbor.y-n:t.templateName=="split"&&(e.isAssistant||e.layout>1)?c:e.templateName=="split"?a-n:r??c+n,xc:l,yc:d,xd:s,yd:c,x:l,y:d-14,rotate:0}},_linkRightToLeft:function(t,e,i,n,r){var o,a,l,s,c,d,p=0;return o=t.x+i.linkAdjuster.toX,a=t.y+t.h/2+i.linkAdjuster.toY,c=e.x+e.w+i.linkAdjuster.fromX,d=s=e.y+e.h/2+i.linkAdjuster.fromY,l=a,{xa:o,ya:a,xb:p=t.rightNeighbor&&t.rightNeighbor.isAssistant&&e.templateName=="split"?t.rightNeighbor.x-n:t.templateName=="split"&&(e.isAssistant||e.layout>1)?c:e.templateName=="split"?o-n:r??c+n,yb:l,xc:p,yc:s,xd:c,yd:d,x:p-16,y:s,rotate:90}},_linkLeftToRight:function(t,e,i,n,r){var o,a,l,s,c,d,p=0;return o=t.x+t.w+i.linkAdjuster.toX,a=t.y+t.h/2+i.linkAdjuster.toY,c=e.x+i.linkAdjuster.fromX,d=s=e.y+e.h/2+i.linkAdjuster.fromY,l=a,{xa:o,ya:a,xb:p=t.rightNeighbor&&t.rightNeighbor.isAssistant&&e.templateName=="split"?t.rightNeighbor.x+t.rightNeighbor.w+n:t.templateName=="split"&&(e.isAssistant||e.layout>1)?c:e.templateName=="split"?o+n:r??c-n,yb:l,xc:p,yc:s,xd:c,yd:d,x:p+14,y:s,rotate:270}},_linkPpTop:function(t,e,i,n,r,o){var a=t.ppnodes[i.id],l=a.y+a.h/2,s=n.minY-(n.minY-r.maxY)/2,c=(n.minY-r.maxY)/t.maxSidePartnersWithChildren/4,d=FamilyTree.ui.__linkPpBottomTop(t,e,i,s,c,a),p=d.x;return s=d.mid,FamilyTree.ui._linkTopToBottom({x:p,y:l,w:0,h:0},i,o,0,s)},_linkPpBottom:function(t,e,i,n,r,o){var a=t.ppnodes[i.id],l=a.y+a.h/2,s=n.maxY-(n.maxY-r.minY)/2,c=(n.maxY-r.minY)/t.maxSidePartnersWithChildren/4,d=FamilyTree.ui.__linkPpBottomTop(t,e,i,s,c,a),p=d.x;return s=d.mid,FamilyTree.ui._linkBottomToTop({x:p,y:l,w:0,h:0},i,o,0,s)},_linkPpLeft:function(t,e,i,n,r,o){var a=t.ppnodes[i.id],l=n.minX-(n.minX-r.maxX)/2,s=(n.minX-r.maxX)/t.maxSidePartnersWithChildren/4,c=a.x+a.w/2,d=FamilyTree.ui.__linkPpLeftRight(t,e,i,l,s,a),p=d.y;return l=d.mid,FamilyTree.ui._linkLeftToRight({x:c,y:p,w:0,h:0},i,o,0,l)},_linkPpRight:function(t,e,i,n,r,o){var a=t.ppnodes[i.id],l=n.maxX-(n.maxX-r.minX)/2,s=(n.maxX-r.minX)/t.maxSidePartnersWithChildren/4,c=a.x+a.w/2,d=FamilyTree.ui.__linkPpLeftRight(t,e,i,l,s,a),p=d.y;return l=d.mid,FamilyTree.ui._linkRightToLeft({x:c,y:p,w:0,h:0},i,o,0,l)},__linkPpBottomTop:function(t,e,i,n,r,o){var a=0;return o.isPartner==1?(a=o.x-e.partnerSeparation/2+t.indexes[i.id]*t.partnerChildrenSplitSeparation-(t.rightIds.length-1)*t.partnerChildrenSplitSeparation/2,t.lastLeft&&a<t.lastLeft.x+t.lastLeft.w/2?a<i.x+i.w/2?n-=(t.indexes[i.id]+1)*r:n-=(t.rightIds.length-t.indexes[i.id])*r:a<i.x+i.w/2?n+=(t.rightIds.length-t.indexes[i.id])*r:n+=(t.indexes[i.id]+1)*r):o.isPartner==2&&(a=o.x+o.w+e.partnerSeparation/2+t.indexes[i.id]*t.partnerChildrenSplitSeparation-(t.leftIds.length-1)*t.partnerChildrenSplitSeparation/2,t.firstRight&&a>t.firstRight.x+t.firstRight.w/2?a<i.x+i.w/2?n-=(t.indexes[i.id]+1)*r:n-=(t.leftIds.length-t.indexes[i.id])*r:a<i.x+i.w/2?n+=(t.leftIds.length-t.indexes[i.id])*r:n+=(t.indexes[i.id]+1)*r),{x:a,mid:n}},__linkPpLeftRight:function(t,e,i,n,r,o){var a=0;return o.isPartner==1?(a=o.y-e.partnerSeparation/2+t.indexes[i.id]*t.partnerChildrenSplitSeparation-(t.rightIds.length-1)*t.partnerChildrenSplitSeparation/2,t.lastLeft&&a<t.lastLeft.y+t.lastLeft.h/2?a<i.y+i.h/2?n-=(t.indexes[i.id]+1)*r:n-=(t.rightIds.length-t.indexes[i.id])*r:a<i.y+i.h/2?n+=(t.rightIds.length-t.indexes[i.id])*r:n+=(t.indexes[i.id]+1)*r):o.isPartner==2&&(a=o.y+o.h+e.partnerSeparation/2+t.indexes[i.id]*t.partnerChildrenSplitSeparation-(t.leftIds.length-1)*t.partnerChildrenSplitSeparation/2,t.firstRight&&a>t.firstRight.y+t.firstRight.h/2?a<i.y+i.h/2?n-=(t.indexes[i.id]+1)*r:n-=(t.leftIds.length-t.indexes[i.id])*r:a<i.y+i.h/2?n+=(t.leftIds.length-t.indexes[i.id])*r:n+=(t.indexes[i.id]+1)*r),{y:a,mid:n}},_draggableLinkPath:function(t,e,i,n,r,o){if(i.isPartner||i.isAssistant)return null;if(FamilyTree._isMoved(i)&&!FamilyTree._isMoved(e)){var a=[];switch(o){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:if(n.yb+r/2<n.yd)return null;s=n.xa<n.xd?i.x-r/2:i.x+i.w+r/2,c=i.y-r/2;break;case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:if(n.yb-r/2>n.yd)return null;s=n.xa<n.xd?i.x-r/2:i.x+i.w+r/2,c=i.y+i.h+r/2;break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:if(n.xb-r/2>n.xd)return null;c=n.ya<n.yd?i.y-r/2:i.y+i.h+r/2,s=i.x+i.w+r/2;break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:if(n.xb+r/2<n.xd)return null;c=n.ya<n.yd?i.y-r/2:i.y+i.h+r/2,s=i.x-r/2}switch(o){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:a.push(["M",n.xa,n.ya]),a.push(["L",n.xb,n.yb]),a.push(["L",s,n.yb]),a.push(["L",s,c]),a.push(["L",n.xd,c]),a.push(["L",n.xd,n.yd]);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:(a=[]).push(["M",n.xa,n.ya]),a.push(["L",n.xb,n.yb]),a.push(["L",n.xb,c]),a.push(["L",s,c]),a.push(["L",s,n.yd]),a.push(["L",n.xd,n.yd])}return FamilyTree.roundPathCorners(a,FamilyTree.LINK_ROUNDED_CORNERS,!1)}if(!FamilyTree._isMoved(i)&&FamilyTree._isMoved(e)){var l=!1;switch(a=[],o){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:if(n.ya+r/2>n.yb)l=!0,s=n.xa<n.xd?e.x+e.w+r/2:e.x-r/2,c=e.y+e.h+r;else{if(n.yb+r/2<n.yd)return null;s=n.xa<n.xd?i.x-r/2:i.x+i.w+r/2,c=i.y-r/2}break;case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:if(n.ya-r/2<n.yb)l=!0,s=n.xa<n.xd?e.x+e.w+r/2:e.x-r/2,c=e.y-r;else{if(n.yb-r/2>n.yd)return null;s=n.xa<n.xd?i.x-r/2:i.x+i.w+r/2,c=i.y+i.h+r/2}break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:if(n.xa-r/2<n.xb)l=!0,c=n.ya<n.yd?e.y+e.h+r/2:e.y-r/2,s=e.x-r;else{if(n.xb-r/2>n.xd)return null;c=n.ya<n.yd?i.y-r/2:i.y+i.h+r/2,s=i.x+i.w+r/2}break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:if(n.xa+r/2>n.xb)l=!0,c=n.ya<n.yd?e.y+e.h+r/2:e.y-r/2,s=e.x+e.w+r;else{if(n.xb+r/2<n.xd)return null;c=n.ya<n.yd?i.y-r/2:i.y+i.h+r/2,s=i.x-r/2}}if(l)switch(o){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:a.push(["M",n.xa,n.ya]),a.push(["L",n.xa,c]),a.push(["L",s,c]),a.push(["L",s,n.yc]),a.push(["L",n.xc,n.yc]),a.push(["L",n.xd,n.yd]);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:a.push(["M",n.xa,n.ya]),a.push(["L",s,n.ya]),a.push(["L",s,c]),a.push(["L",n.xc,c]),a.push(["L",n.xc,n.yc]),a.push(["L",n.xd,n.yd])}else switch(o){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:a.push(["M",n.xa,n.ya]),a.push(["L",n.xb,n.yb]),a.push(["L",s,n.yb]),a.push(["L",s,c]),a.push(["L",n.xd,c]),a.push(["L",n.xd,n.yd]);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:a.push(["M",n.xa,n.ya]),a.push(["L",n.xb,n.yb]),a.push(["L",n.xb,c]),a.push(["L",s,c]),a.push(["L",s,n.yd]),a.push(["L",n.xd,n.yd])}return FamilyTree.roundPathCorners(a,FamilyTree.LINK_ROUNDED_CORNERS,!1)}if(FamilyTree._isMoved(i)&&FamilyTree._isMoved(e)){switch(a=[],o){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:if(n.ya+r>n.yd){var s=n.xa<n.xd?e.x+e.w+r/2:e.x-r/2,c=e.y+e.h+r,d=i.y-r;a.push(["M",n.xa,n.ya]),a.push(["L",n.xa,c]),a.push(["L",s,c]),a.push(["L",s,d]),a.push(["L",n.xc,d]),a.push(["L",n.xd,n.yd])}else a.push(["M",n.xa,n.ya]),a.push(["L",n.xa,e.y+e.h+r]),a.push(["L",n.xc,e.y+e.h+r]),a.push(["L",n.xd,n.yd]);break;case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:n.ya-r<n.yd?(s=n.xa<n.xd?e.x+e.w+r/2:e.x-r/2,c=e.y-r,d=i.y+i.h+r,a.push(["M",n.xa,n.ya]),a.push(["L",n.xa,c]),a.push(["L",s,c]),a.push(["L",s,d]),a.push(["L",n.xc,d]),a.push(["L",n.xd,n.yd])):(a.push(["M",n.xa,n.ya]),a.push(["L",n.xa,e.y-r]),a.push(["L",n.xc,e.y-r]),a.push(["L",n.xd,n.yd]));break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:if(n.xa-r<n.xd){c=n.ya<n.yd?e.y+e.h+r/2:e.y-r/2,s=e.x-r;var p=i.x+i.w+r;a.push(["M",n.xa,n.ya]),a.push(["L",s,n.ya]),a.push(["L",s,c]),a.push(["L",p,c]),a.push(["L",p,n.yc]),a.push(["L",n.xd,n.yd])}else a.push(["M",n.xa,n.ya]),a.push(["L",e.x-r,n.ya]),a.push(["L",e.x-r,n.yc]),a.push(["L",n.xd,n.yd]);break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:n.xa+r>n.xd?(c=n.ya<n.yd?e.y+e.h+r/2:e.y-r/2,s=e.x+e.w+r,p=i.x-r,a.push(["M",n.xa,n.ya]),a.push(["L",s,n.ya]),a.push(["L",s,c]),a.push(["L",p,c]),a.push(["L",p,n.yc]),a.push(["L",n.xd,n.yd])):(a.push(["M",n.xa,n.ya]),a.push(["L",e.x+e.w+r,n.ya]),a.push(["L",e.x+e.w+r,n.yc]),a.push(["L",n.xd,n.yd]))}return FamilyTree.roundPathCorners(a,FamilyTree.LINK_ROUNDED_CORNERS,!1)}return null}},FamilyTree.ui._base_nodeBtns=FamilyTree.ui.nodeBtns,FamilyTree.ui.nodeBtns=function(t,e,i,n,r){var o="";return r._tree_menu_temp?!e.isSplit&&i!==FamilyTree.action.exporting&&n.nodeTreeMenuCloseButton&&r._tree_menu_temp.id==e.id&&(o+=n.nodeTreeMenuCloseButton):(o=FamilyTree.ui._base_nodeBtns(t,e,i,n,r),t.nodeTreeMenu!=null&&!e.isSplit&&i!==FamilyTree.action.exporting&&n.nodeTreeMenuButton&&(o+=n.nodeTreeMenuButton.replace("{id}",e.id))),o},FamilyTree.ui._base_expandCollapseBtn=FamilyTree.ui.expandCollapseBtn,FamilyTree.ui.expandCollapseBtn=function(t,e,i,n,r){return t._tree_menu_temp?"":FamilyTree.ui._base_expandCollapseBtn(t,e,i,n,r)},FamilyTree.xScrollUI=function(t,e,i,n,r){this.element=t,this.requestParams=i,this.config=e,this.onSetViewBoxCallback=n,this.onDrawCallback=r,this.position=0,this.bar=null,this._event_id=FamilyTree._guid()},FamilyTree.xScrollUI.prototype.addListener=function(t){var e=this;if((this.config.mouseScrool==FamilyTree.action.xScroll||this.config.mouseScrool==FamilyTree.action.scroll)&&this.bar){var i=navigator.userAgent.indexOf("Mac OS")!==-1,n=FamilyTree._getScrollSensitivity();(function(r,o,a){var l=!1;function s(){l=!0;var d=(e.position-e.bar.scrollLeft)/a;if(d>0)d++;else{if(d==0)return void(l=!1);d--}Math.ceil(e.bar.scrollLeft)==Math.ceil(e.position)?l=!1:(e.bar.scrollLeft+=d,c(s))}r.addEventListener("wheel",function(d){if(!d.ctrlKey){var p=0;if(e.config.mouseScrool==FamilyTree.action.xScroll)(p=d.deltaX||d.wheelDeltaX)||(p=d.deltaY||d.wheelDeltaY);else if(e.config.mouseScrool==FamilyTree.action.scroll&&!(p=i||!d.shiftKey?d.deltaX||d.wheelDeltaX:d.deltaY||d.wheelDeltaY))return;p=-p,p=Math.max(-1,Math.min(1,p)),e.position+=-p*o;var h=parseFloat(e.innerBar.clientWidth)-parseFloat(e.bar.clientWidth);e.position<0&&(e.position=0),e.position>h&&(e.position=h),l||s()}},{passive:!0});var c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(d){setTimeout(d,20)}})(t,n.speed,n.smooth)}},FamilyTree.xScrollUI.prototype.create=function(t){if(this.config.showXScroll===FamilyTree.scroll.visible||this.config.mouseScrool===FamilyTree.action.scroll||this.config.mouseScrool===FamilyTree.action.xScroll){var e=this;this.bar&&this.bar.parentNode&&this.bar.parentNode.removeChild(this.bar),this.bar=document.createElement("div"),this.innerBar=document.createElement("div"),this.requestParams(),this.innerBar.innerHTML="&nbsp",Object.assign(this.bar.style,{position:"absolute",left:0,bottom:0,width:t+"px","overflow-x":"scroll",height:"20px"}),this.element.appendChild(this.bar),this.bar.appendChild(this.innerBar),this.bar.addEventListener("scroll",function(){if(this.ignore)this.ignore=!1;else{var i=e.requestParams(),n=(parseFloat(e.innerBar.clientWidth)-parseFloat(e.bar.clientWidth))/100,r=this.scrollLeft/n,o=(i.boundary.right-i.boundary.left)/100;i.viewBox[0]=r*o+i.boundary.left,e.onSetViewBoxCallback(i.viewBox),clearTimeout(this._timeout),this._timeout=setTimeout(function(){e.onDrawCallback()},500)}})}},FamilyTree.xScrollUI.prototype.setPosition=function(){if(this.bar){var t=this.requestParams(),e=(Math.abs(t.boundary.maxX-t.boundary.minX)+2*this.config.padding)*t.scale;switch(this.config.orientation){case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:e=Math.abs(t.boundary.minX*t.scale)}this.innerBar.style.width=e+"px";var i=(t.boundary.right-t.boundary.left)/100,n=(t.viewBox[0]-t.boundary.left)/i;n<0?n=0:n>100&&(n=100);var r=(parseFloat(this.innerBar.clientWidth)-parseFloat(this.bar.clientWidth))/100,o=n*r;this.bar.ignore=!0,this.bar.scrollLeft=o,this.position=this.bar.scrollLeft,this.bar.style.visibility=r<=0?"hidden":"",this.config.showXScroll!==FamilyTree.scroll.visible&&(this.bar.style.visibility="hidden"),FamilyTree.events.publish("change",[this,{isScrollBarVisible:this.bar.style.visibility!="hidden"}])}},FamilyTree.xScrollUI.prototype.on=function(t,e){return FamilyTree.events.on(t,e,this._event_id),this},FamilyTree.yScrollUI=function(t,e,i,n,r){this.element=t,this.requestParams=i,this.config=e,this.onSetViewBoxCallback=n,this.onDrawCallback=r,this.position=0,this.bar=null,this._event_id=FamilyTree._guid()},FamilyTree.yScrollUI.prototype.addListener=function(t){var e=this;if((this.config.mouseScrool==FamilyTree.action.yScroll||this.config.mouseScrool==FamilyTree.action.scroll)&&this.bar){var i=navigator.userAgent.indexOf("Mac OS")!==-1,n=FamilyTree._getScrollSensitivity();(function(r,o,a){var l=!1;function s(){l=!0;var d=(e.position-e.bar.scrollTop)/a;if(d>0)d++;else{if(d==0)return void(l=!1);d--}Math.ceil(e.bar.scrollTop)==Math.ceil(e.position)?l=!1:(e.bar.scrollTop+=d,c(s))}r.addEventListener("wheel",function(d){if(!d.ctrlKey){var p=0;if(e.config.mouseScrool==FamilyTree.action.yScroll)(p=d.deltaY||d.wheelDeltaY)||(p=d.deltaX||d.wheelDeltaX);else if(e.config.mouseScrool==FamilyTree.action.scroll&&!(p=i||!d.shiftKey?d.deltaY||d.wheelDeltaY:d.deltaX||d.wheelDeltaX))return;p=-p,p=Math.max(-1,Math.min(1,p)),e.position+=-p*o;var h=parseFloat(e.innerBar.clientHeight)-parseFloat(e.bar.clientHeight);e.position<0&&(e.position=0),e.position>h&&(e.position=h),l||s()}},{passive:!0});var c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(d){setTimeout(d,20)}})(t,n.speed,n.smooth)}},FamilyTree.yScrollUI.prototype.create=function(t){if(this.config.showYScroll===FamilyTree.scroll.visible||this.config.mouseScrool===FamilyTree.action.scroll||this.config.mouseScrool===FamilyTree.action.yScroll){var e=this;this.bar&&this.bar.parentNode&&this.bar.parentNode.removeChild(this.bar),this.bar=document.createElement("div"),this.innerBar=document.createElement("div"),this.innerBar.innerHTML="&nbsp",Object.assign(this.bar.style,{position:"absolute",right:0,bottom:0,height:t+"px","overflow-y":"scroll",width:"20px"}),this.element.appendChild(this.bar),this.bar.appendChild(this.innerBar),this.bar.addEventListener("scroll",function(){if(this.ignore)this.ignore=!1;else{var i=e.requestParams(),n=(parseFloat(e.innerBar.clientHeight)-parseFloat(e.bar.clientHeight))/100,r=this.scrollTop/n,o=(i.boundary.bottom-i.boundary.top)/100;i.viewBox[1]=r*o+i.boundary.top,e.onSetViewBoxCallback(i.viewBox),clearTimeout(this._timeout),this._timeout=setTimeout(function(){e.onDrawCallback()},500)}})}},FamilyTree.yScrollUI.prototype.setPosition=function(){if(this.bar){var t=this.requestParams(),e=(Math.abs(t.boundary.maxY-t.boundary.minY)+2*this.config.padding)*t.scale;switch(this.config.orientation){case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:e=Math.abs(t.boundary.minY*t.scale)}this.innerBar.style.height=e+"px";var i=(t.boundary.bottom-t.boundary.top)/100,n=(t.viewBox[1]-t.boundary.top)/Math.abs(i);n<0?n=0:n>100&&(n=100);var r=(parseFloat(this.innerBar.clientHeight)-parseFloat(this.bar.clientHeight))/100,o=n*r;this.bar.ignore=!0,this.bar.scrollTop=o,this.position=this.bar.scrollTop,this.bar.style.visibility=r<=0?"hidden":"",this.config.showYScroll!==FamilyTree.scroll.visible&&(this.bar.style.visibility="hidden"),FamilyTree.events.publish("change",[this,{isScrollBarVisible:this.bar.style.visibility!="hidden"}])}},FamilyTree.yScrollUI.prototype.on=function(t,e){return FamilyTree.events.on(t,e,this._event_id),this},FamilyTree.prototype.zoom=function(t,e,i,n){var r=this.getViewBox().slice(0),o=r,a=r[2],l=r[3];t===!0?(r[2]=r[2]/FamilyTree.SCALE_FACTOR,r[3]=r[3]/FamilyTree.SCALE_FACTOR):t===!1?(r[2]=r[2]*FamilyTree.SCALE_FACTOR,r[3]=r[3]*FamilyTree.SCALE_FACTOR):(r[2]=r[2]/t,r[3]=r[3]/t),e||(e=[50,50]),r[0]=o[0]-(r[2]-a)/(100/e[0]),r[1]=o[1]-(r[3]-l)/(100/e[1]);var s=this.getScale(r);if(r[2]=this.width()/s,r[3]=this.height()/s,t===!0&&s<this.config.scaleMax||t===!1&&s>this.config.scaleMin||t!=0&&t!=1&&s<this.config.scaleMax&&s>this.config.scaleMin){this._hideBeforeAnimation();var c=this;i?(clearTimeout(c._timeout),FamilyTree.animate(this.getSvg(),{viewbox:this.getViewBox()},{viewbox:r},this.config.anim.duration,this.config.anim.func,function(){clearTimeout(c._timeout),c._timeout=setTimeout(function(){c._draw(!0,FamilyTree.action.zoom,null,n)},500)})):(this.setViewBox(r),clearTimeout(c._timeout),c._timeout=setTimeout(function(){c._draw(!0,FamilyTree.action.zoom,null,n)},500))}},FamilyTree.loading={},FamilyTree.loading.show=function(t){var e=document.createElement("div");e.id="bft-loading",e.innerHTML='<style>@-webkit-keyframes dot-keyframes {0% { opacity: .4; -webkit-transform: scale(1, 1);transform: scale(1, 1);}50% {opacity: 1;-webkit-transform: scale(1.2, 1.2);transform: scale(1.2, 1.2);}100% {opacity: .4;-webkit-transform: scale(1, 1);transform: scale(1, 1);}}@keyframes dot-keyframes {0% {opacity: .4;-webkit-transform: scale(1, 1);transform: scale(1, 1);}50% {opacity: 1;-webkit-transform: scale(1.2, 1.2);transform: scale(1.2, 1.2);}100% {opacity: .4;-webkit-transform: scale(1, 1);transform: scale(1, 1);}}.bft-loading-dots div {margin: 10px;}      .bft-dot-1 {background-color: #039BE5;}.bft-dot-2 {background-color: #F57C00;}.bft-dot-3 {background-color: #FFCA28;}      .bft-loading-dots {text-align: center;width: 100%; position: absolute; top: 0;}.bft-loading-dots--dot {-webkit-animation: dot-keyframes 1.5s infinite ease-in-out;animation: dot-keyframes 1.5s infinite ease-in-out;        border-radius: 10px;display: inline-block;height: 10px;width: 10px;}.bft-loading-dots--dot:nth-child(2) {-webkit-animation-delay: .5s;animation-delay: .5s;}.bft-loading-dots--dot:nth-child(3) {-webkit-animation-delay: 1s;animation-delay: 1s;}</style><div class="bft-loading-dots"><div class="bft-loading-dots--dot bft-dot-1"></div><div class="bft-loading-dots--dot bft-dot-2"></div><div class="bft-loading-dots--dot bft-dot-3"></div></div>',t.element.appendChild(e)},FamilyTree.loading.hide=function(t){var e=t.element.querySelector("#bft-loading");e&&e.parentNode.removeChild(e)},FamilyTree.pdfPrevUI={},FamilyTree.loc||(FamilyTree.loc={}),FamilyTree.loc.ppdfCmdTitle="PDF Preview",FamilyTree.loc.ppdfSave="Save",FamilyTree.loc.ppdfCancel="Cancel",FamilyTree.loc.ppdfFormat="Format",FamilyTree.loc.ppdfFitToDrwaing="Fit",FamilyTree.loc.ppdfA4="A4",FamilyTree.loc.ppdfA3="A3",FamilyTree.loc.ppdfA2="A2",FamilyTree.loc.ppdfA1="A1",FamilyTree.loc.ppdfLetter="Letter",FamilyTree.loc.ppdfLegal="Legal",FamilyTree.loc.ppdfLayout="Layout",FamilyTree.loc.ppdfPortrait="Portrait",FamilyTree.loc.ppdfLandscape="Landscape",FamilyTree.loc.ppdfFittopagewidth="Fit to page width",FamilyTree.loc.ppdfMargin="Margin",FamilyTree.loc.ppdfHeader="Header",FamilyTree.loc.ppdfFooter="Footer",FamilyTree.loc.ppdfScale="Scale",FamilyTree.pdfPrevUI.show=function(t,e){FamilyTree.pdfPrevUI.hide(t),e=t._defaultExportOptions(e,"pdf");var i=document.createElement("div");i.classList.add(t.config.mode),i.id="bft-ppdf-btns",Object.assign(i.style,{position:"absolute",top:0,left:0,"background-color":"#fff","z-index":5,margin:"0 0 0 -265px","box-shadow":"0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19)",width:"265px",height:"100%","font-family":"Roboto,Helvetica",color:"#757575","text-align":"right",padding:"10px"}),t.element.appendChild(i),i.innerHTML="<h1>"+FamilyTree.loc.ppdfCmdTitle+'</h1><div><button type="button" id="bft-prev-save" style="font-size: 14px; width: 90px;">'+FamilyTree.loc.ppdfSave+'</button>&nbsp;<button type="button" id="bft-prev-cancel" style="width: 90px;font-size: 14px;">'+FamilyTree.loc.ppdfCancel+'</button></div><div style="margin-top:30px; height:10px;border-bottom:1px solid #eeeeee;"></div><div style="padding-top:30px;"><label for="bft-size">'+FamilyTree.loc.ppdfFormat+': </label><select id="bft-ppdf-size" style="color: #757575; width: 150px; font-size: 14px;" id="bft-size"><option value="fit">'+FamilyTree.loc.ppdfFitToDrwaing+'</option><option value="A4">'+FamilyTree.loc.ppdfA4+'</option><option value="A3">'+FamilyTree.loc.ppdfA3+'</option><option value="A2">'+FamilyTree.loc.ppdfA2+'</option><option value="A1">'+FamilyTree.loc.ppdfA1+'</option><option value="Letter">'+FamilyTree.loc.ppdfLetter+'</option><option value="Legal">'+FamilyTree.loc.ppdfLegal+'</option></select></div><div style="padding-top:10px;"><label for="bft-ppdf-layout">'+FamilyTree.loc.ppdfLayout+': </label><select id="bft-ppdf-layout" style="color: #757575; width: 150px;font-size: 14px;" ><option value="false">'+FamilyTree.loc.ppdfPortrait+'</option><option value="true">'+FamilyTree.loc.ppdfLandscape+'</option></select></div><div style="padding-top:10px;"><label for="bft-scale">'+FamilyTree.loc.ppdfScale+': </label><select id="bft-ppdf-scale" style="color: #757575; width: 150px;font-size: 14px;" id="bft-scale"><option value="fit">'+FamilyTree.loc.ppdfFittopagewidth+'</option><option value="10">10%</option><option value="20">20%</option><option value="30">30%</option><option value="40">40%</option><option value="50">50%</option><option value="60">60%</option><option value="70">70%</option><option value="80">80%</option><option value="90">90%</option><option value="100">100%</option><option value="110">110%</option><option value="120">120%</option><option value="130">130%</option><option value="140">140%</option><option value="150">150%</option><option value="160">160%</option><option value="170">170%</option><option value="180">180%</option><option value="190">190%</option><option value="200">200%</option></select></div><div style="margin-top:10px;margin-bottom:10px; height:10px;border-bottom:1px solid #eeeeee;"></div><div style="padding-top:10px;"><label for="bft-ppdf-header">'+FamilyTree.loc.ppdfHeader+': </label><input id="bft-ppdf-header" type="text" style="color: #757575; width: 100px;font-size: 14px;" ></div><div style="padding-top:10px;"><label for="bft-ppdf-footer">'+FamilyTree.loc.ppdfFooter+': </label><input id="bft-ppdf-footer" type="text" style="color: #757575; width: 100px;font-size: 14px;" ></div><div style="padding-top:10px;"><label for="bft-ppdf-margin">'+FamilyTree.loc.ppdfMargin+': </label><input id="bft-ppdf-margin" type="text" style="color: #757575; width: 100px;font-size: 14px;" ></div>';var n=document.createElement("div");n.id="bft-ppdf-wrapper",Object.assign(n.style,{"overflow-y":"scroll","z-index":11,position:"absolute",top:0,left:"285px","background-color":"#eee",width:t.width()-270+"px",height:"100%"}),t.element.appendChild(n),n.innerHTML='<div id="bft-ppdf-content" style="width: 100%;margin-top:10px;margin-bottom:10px;opacity:0;"></div>';var r,o,a,l=t.element.querySelector("#bft-ppdf-size"),s=t.element.querySelector("#bft-ppdf-layout"),c=t.element.querySelector("#bft-ppdf-scale"),d=t.element.querySelector("#bft-ppdf-margin"),p=t.element.querySelector("#bft-ppdf-header"),h=t.element.querySelector("#bft-ppdf-footer");l.value=e.format,s.value=e.landscape,c.value=e.scale,d.value=e.margin,p.value=e.header,h.value=e.footer,FamilyTree.animate(t.element.querySelector("#bft-ppdf-btns"),{margin:[0,0,0,-250]},{margin:[0,0,0,0]},300,FamilyTree.anim.outSin,function(){t.exportPDF(e,FamilyTree.pdfPrevUI._handler)}),t.element.querySelector("#bft-prev-cancel").addEventListener("click",function(){FamilyTree.pdfPrevUI.hide(t)}),t.element.querySelector("#bft-prev-save").addEventListener("click",function(){t.exportPDF(e),FamilyTree.pdfPrevUI.hide(t)}),FamilyTree.pdfPrevUI._showHide(l,s,c),l.addEventListener("change",function(){FamilyTree.animate(t.element.querySelector("#bft-ppdf-content"),{opacity:1},{opacity:0},300,FamilyTree.anim.inSin,function(){t.element.querySelector("#bft-ppdf-content").innerHTML="",e.format=l.value,t.exportPDF(e,FamilyTree.pdfPrevUI._handler),FamilyTree.pdfPrevUI._showHide(l,s,c)})}),s.addEventListener("change",function(){FamilyTree.animate(t.element.querySelector("#bft-ppdf-content"),{opacity:1},{opacity:0},300,FamilyTree.anim.inSin,function(){t.element.querySelector("#bft-ppdf-content").innerHTML="",e.landscape=s.value=="true",t.exportPDF(e,FamilyTree.pdfPrevUI._handler),FamilyTree.pdfPrevUI._showHide(l,s,c)})}),c.addEventListener("change",function(){FamilyTree.animate(t.element.querySelector("#bft-ppdf-content"),{opacity:1},{opacity:0},300,FamilyTree.anim.inSin,function(){t.element.querySelector("#bft-ppdf-content").innerHTML="",e.scale=c.value,t.exportPDF(e,FamilyTree.pdfPrevUI._handler),FamilyTree.pdfPrevUI._showHide(l,s,c)})}),d.addEventListener("keyup",function(){clearTimeout(r),r=setTimeout(function(){FamilyTree.animate(t.element.querySelector("#bft-ppdf-content"),{opacity:1},{opacity:0},300,FamilyTree.anim.inSin,function(){t.element.querySelector("#bft-ppdf-content").innerHTML="";var f=d.value.split(",");if(f.length==4){for(var m=0;m<f.length;m++)f[m]=parseInt(f[m]);e.margin=f,t.exportPDF(e,FamilyTree.pdfPrevUI._handler)}})},1e3)}),p.addEventListener("keyup",function(){clearTimeout(o),o=setTimeout(function(){FamilyTree.animate(t.element.querySelector("#bft-ppdf-content"),{opacity:1},{opacity:0},300,FamilyTree.anim.inSin,function(){t.element.querySelector("#bft-ppdf-content").innerHTML="",e.header=p.value,t.exportPDF(e,FamilyTree.pdfPrevUI._handler)})},1e3)}),h.addEventListener("keyup",function(){clearTimeout(a),a=setTimeout(function(){FamilyTree.animate(t.element.querySelector("#bft-ppdf-content"),{opacity:1},{opacity:0},300,FamilyTree.anim.inSin,function(){t.element.querySelector("#bft-ppdf-content").innerHTML="",e.footer=h.value,t.exportPDF(e,FamilyTree.pdfPrevUI._handler)})},1e3)})},FamilyTree.pdfPrevUI._showHide=function(t,e,i){t.value=="A4"||t.value=="A3"||t.value=="A2"||t.value=="A1"||t.value=="Letter"||t.value=="Legal"?(e.parentNode.style.display="block",i.parentNode.style.display="block"):(e.parentNode.style.display="none",i.parentNode.style.display="none")},FamilyTree.pdfPrevUI._handler=function(t,e,i){var n=e.options,r=e.pages,o=n.margin[0],a=n.margin[2],l=document.createElement("div");l.classList.add(t.config.mode),l.innerHTML=i.outerHTML,FamilyTree._browser().msie&&(l.innerHTML=new XMLSerializer().serializeToString(i));for(var s=l.querySelector("svg"),c=t.element.querySelector("#bft-ppdf-content"),d=0;d<r.length;d++){var p=document.createElement("iframe");Object.assign(p.style,{display:"block",margin:"10px auto",border:"1px solid #eeeeee","box-shadow":"0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19)"}),c.appendChild(p),s&&s.style.backgroundColor?p.style.backgroundColor=s.style.backgroundColor:p.style.backgroundColor="#fff";var h=p.contentWindow.document;h.open(),p.style.width=r[d].size.w+"px",p.style.height=r[d].size.h+"px",p.style.margin="10 auto",r[d].backgroundColor&&(p.style.backgroundColor=r[d].backgroundColor);var f=n.header;r[d].header&&(f=r[d].header),f&&(f=f.replace("{current-page}",d+1).replace("{total-pages}",r.length));var m=n.footer;r[d].footer&&(m=r[d].footer),m&&(m=m.replace("{current-page}",d+1).replace("{total-pages}",r.length)),r[d].html?h.write(FamilyTree._exportHtml(r[d].html,e.styles,n,r[d].innerSize.w,r[d].innerSize.h,f,m,t.config.mode)):(s.setAttribute("viewBox",r[d].vb),h.write(FamilyTree._exportHtml(l.innerHTML,e.styles,n,r[d].innerSize.w,r[d].innerSize.h,f,m,t.config.mode)));var y=h.getElementById("bft-header"),x=h.getElementById("bft-footer");if(y){var u=o-y.offsetHeight-7;y.style.top=u+"px"}if(x){var b=a-x.offsetHeight-7;x.style.bottom=b+"px"}h.close()}var v=t.element.querySelector("#bft-ppdf-content");FamilyTree.animate(v,{opacity:0},{opacity:1},300,FamilyTree.anim.outSin)},FamilyTree.pdfPrevUI._getViewBox=function(t){var e=null;return t?(e=(e="["+(e=t.getAttribute("viewBox"))+"]").replace(/\ /g,","),e=JSON.parse(e)):null},FamilyTree._exportHtml=function(t,e,i,n,r,o,a,l){for(var s="",c=0;c<i.margin.length;c++)s+=i.margin[c]+"px ";var d='<!DOCTYPE html><html style="margin:0;padding:0;"><head></head>'+e+'<body class="bft-'+l+'" style="margin:0; padding:0;"><div style="margin: '+s+";overflow:hidden;width:"+n+"px;height:"+r+'px">';return o&&(d+='<div id="bft-header" style="width:'+n+"px;color:#757575;position:absolute;left:"+i.margin[3]+'px;top:0;">'+o+"</div>"),d+=t,a&&(d+='<div id="bft-footer" style="width:'+n+"px;color:#757575;position:absolute;left:"+i.margin[3]+'px;bottom:0;">'+a+"</div>"),d+="</div>",d+="</body></html>"},FamilyTree.pdfPrevUI.hide=function(t){var e=t.element.querySelector("#bft-ppdf-wrapper");if(e){e.parentNode.removeChild(e),e.style.opacity=0;var i=t.element.querySelector("#bft-ppdf-btns");i.parentNode.removeChild(i)}},FamilyTree===void 0&&(FamilyTree={}),FamilyTree.events.on("renderdefs",function(t,e){for(var i=0;i<t.config.clinks.length;i++){var n=t.config.clinks[i].template;n||(n="orange");var r=FamilyTree.clinkTemplates[n];e.defs+=r.defs}}),FamilyTree.events.on("prerender",function(t,e){FamilyTree.RENDER_CLINKS_BEFORE_NODES&&t._clink(t,e)}),FamilyTree.events.on("render",function(t,e){FamilyTree.RENDER_CLINKS_BEFORE_NODES||t._clink(t,e)}),FamilyTree.events.on("drag",function(t,e,i,n){if(t instanceof FamilyTree&&t.config.movable&&n)for(var r=0;r<n.length;r++){for(var o=n[r],a=t.element.querySelectorAll(`[data-c-l-from="${o}"]`),l=t.element.querySelectorAll(`[data-c-l-to="${o}"]`),s=0;s<a.length;s++)a[s].parentNode.removeChild(a[s]);for(s=0;s<l.length;s++)l[s].parentNode.removeChild(l[s])}}),FamilyTree.prototype._clink=function(t,e){for(var i="",n=0;n<this.config.clinks.length;n++){let S=function(I,M,N){N==null&&(N=1);var A=M.x-I.x,B=M.y-I.y,P=Math.sqrt(Math.pow(M.x-I.x,2)+Math.pow(M.y-I.y,2))/3;return P=P/(Math.sqrt(A*A+B*B)*N)*FamilyTree.clinkCurve(r),{x:I.x+A/2-B*P,y:I.y+B/2+A*P}};var w=S,r=this.config.clinks[n],o=t.getNode(r.from),a=t.getNode(r.to);if(o&&e.res.visibleNodeIds.indexOf(o.id)!=-1&&a&&e.res.visibleNodeIds.indexOf(a.id)!=-1){var l=o.x,s=o.y,c=a.x,d=a.y,p={},h={},f=l+o.w/2,m=c+a.w/2,y=s+o.h/2,x=d+a.h/2,u=1;switch(this.config.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:f<=m?(u=1,p.x=f+o.w/10,h.x=m-a.w/10):(u=-1,p.x=f-o.w/10,h.x=m+a.w/10),s==d?(u=1,p.y=s,h.y=d):s>d?(p.y=s,h.y=d+a.h):(p.y=s+o.h,h.y=d);break;case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:f<=m?(u=-1,p.x=f+o.w/10,h.x=m+a.w/10):(u=1,p.x=f-o.w/10,h.x=m+a.w/10),s==d?(u=-1,p.y=s+o.h,h.y=d+a.h):s>d?(p.y=s,h.y=d+a.h):(p.y=s+o.h,h.y=d);break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:y<=x?(u=-1,p.y=y+o.h/5,h.y=x+a.h/5):(u=1,p.y=y-o.h/5,h.y=x+a.h/5),l==c?(u=-1,p.x=l,h.x=c):l>c?(p.x=l,h.x=c+a.w):(p.x=l+o.w,h.x=c);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:y<=x?(u=1,p.y=y+o.h/5,h.y=x+a.h/5):(u=-1,p.y=y-o.h/5,h.y=x+a.h/5),l==c?(u=1,p.x=l+o.w,h.x=c+a.w):l>c?(p.x=l,h.x=c+a.w):(p.x=l+o.w,h.x=c)}var b=S(p,h,u),v=r.template;v||(v="orange");var g=FamilyTree.clinkTemplates[v];if(r.label){var _=FamilyTree.clinkLabelPosition(r,p,h,b);i+=g.label.replace("{x}",_.x).replace("{y}",_.y).replace("{val}",r.label)}var k="M"+p.x+","+p.y+"C"+p.x+","+p.y+" "+b.x+","+b.y+" "+h.x+","+h.y;i+=("<g "+FamilyTree.attr.c_link_from+'="{from}" '+FamilyTree.attr.c_link_to+'="{to}">').replace("{from}",o.id).replace("{to}",a.id)+g.link.replaceAll("{d}",k)+'<path stroke="transparent" stroke-width="15" fill="none" d="'+k+'" />',i+=FamilyTree.grCloseTag}}e.content+=i},FamilyTree.clinkLabelPosition=function(t,e,i,n){var r=(i.x-e.x)/2+e.x,o=(i.y-e.y)/2+e.y;return{x:(r-n.x)/2+n.x,y:(o-n.y)/2+n.y}},FamilyTree.clinkCurve=function(t){return FamilyTree.CLINK_CURVE},FamilyTree.prototype.addClink=function(t,e,i,n){this._putInUndoStack(),this.clearRedo();for(var r=this.config.clinks.length-1;r>=0;r--){var o=this.config.clinks[r];o.from==t&&o.to==e&&this.config.clinks.splice(r,1)}return this.config.clinks.push({from:t,to:e,label:i,template:n}),FamilyTree.events.publish("updated",[this]),this},FamilyTree.prototype.removeClink=function(t,e){this._putInUndoStack(),this.clearRedo();for(var i=this.config.clinks.length-1;i>=0;i--){var n=this.config.clinks[i];n.from==t&&n.to==e&&this.config.clinks.splice(i,1)}return FamilyTree.events.publish("updated",[this]),this},FamilyTree.clinkTemplates={},FamilyTree.clinkTemplates.orange={defs:'<marker id="arrowOrange" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path fill="#F57C00" d="M 0 0 L 10 5 L 0 10 z" /></marker><marker id="dotOrange" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="5" markerHeight="5"> <circle cx="5" cy="5" r="5" fill="#F57C00" /></marker>',link:'<path marker-start="url(#dotOrange)" marker-end="url(#arrowOrange)" stroke="#F57C00" stroke-width="2" fill="none" d="{d}" />',label:'<text fill="#F57C00" text-anchor="middle" x="{x}" y="{y}">{val}</text>'},FamilyTree.clinkTemplates.blue={defs:'<marker id="arrowBlue" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path fill="#039BE5" d="M 0 0 L 10 5 L 0 10 z" /></marker><marker id="dotBlue" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="5" markerHeight="5"> <circle cx="5" cy="5" r="5" fill="#039BE5" /></marker>',link:'<path marker-start="url(#dotBlue)" marker-end="url(#arrowBlue)" stroke="#039BE5" stroke-width="2" fill="none" d="{d}" />',label:'<text fill="#039BE5"  text-anchor="middle" x="{x}" y="{y}">{val}</text>'},FamilyTree.clinkTemplates.yellow={defs:'<marker id="arrowYellow" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path fill="#FFCA28" d="M 0 0 L 10 5 L 0 10 z" /></marker><marker id="dotYellow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="5" markerHeight="5"> <circle cx="5" cy="5" r="5" fill="#FFCA28" /></marker>',link:'<path marker-start="url(#dotYellow)" marker-end="url(#arrowYellow)" stroke="#FFCA28" stroke-width="2" fill="none" d="{d}" />',label:'<text fill="#FFCA28"  text-anchor="middle" x="{x}" y="{y}">{val}</text>'},FamilyTree===void 0&&(FamilyTree={}),FamilyTree.events.on("renderdefs",function(t,e){for(var i=0;i<t.config.slinks.length;i++){var n=t.config.slinks[i].template;n||(n="orange");var r=FamilyTree.slinkTemplates[n];e.defs+=r.defs}}),FamilyTree.events.on("render",function(t,e){t._slinks(t,e)}),FamilyTree.events.on("drag",function(t,e,i,n){if(t instanceof FamilyTree&&t.config.movable&&n)for(var r=0;r<n.length;r++){for(var o=n[r],a=t.element.querySelectorAll(`[data-s-l-from="${o}"]`),l=t.element.querySelectorAll(`[data-s-l-to="${o}"]`),s=0;s<a.length;s++)a[s].parentNode.removeChild(a[s]);for(s=0;s<l.length;s++)l[s].parentNode.removeChild(l[s])}}),FamilyTree.prototype._slinks=function(t,e){var i="",n=this.getScale(),r=e.res.boundary;function o(d,p,h){var f=[],m=null,y="left",x=d.lcn?d.lcn:"base",u=t._layoutConfigs[x];switch(u.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:p.x>d.x&&(y="right");break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:y="top",p.y>d.y&&(y="bottom")}var b=FamilyTree.t(d.templateName,d.min,n),v=u.levelSeparation;d.parent&&d.parent.layout&&(v=u.mixedHierarchyNodesSeparation);var g={p:d.x+d.w/2+b.expandCollapseSize,q:d.y,r:d.x+d.w/2+b.expandCollapseSize,s:r.minY+v};if(d.sl==p.sl)switch(m=p,u.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:f.push([g.p,g.q]),f.push([g.p,g.q-v/3]),b=FamilyTree.t(m.templateName,m.min,n),f.push([m.x+m.w/2+b.expandCollapseSize,f[f.length-1][1]]),f.push([f[f.length-1][0],m.y]);break;case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:g.q=d.y+d.h,g.s=r.maxY-v,f.push([g.p,g.q]),f.push([g.r,d.y+d.h+v/3]),b=FamilyTree.t(m.templateName,m.min,n),f.push([m.x+m.w/2+b.expandCollapseSize,f[f.length-1][1]]),f.push([f[f.length-1][0],m.y+m.h]);break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:g.p=d.x,g.q=d.y+d.h/2+b.expandCollapseSize,g.r=r.minX-v,g.s=d.y+d.h/2+b.expandCollapseSize,f.push([g.p,g.q]),f.push([d.x-v/3,g.q]),b=FamilyTree.t(m.templateName,m.min,n),f.push([f[f.length-1][0],m.y+m.h/2+b.expandCollapseSize]),f.push([m.x,f[f.length-1][1]]);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:g.p=d.x+d.w,g.q=d.y+d.h/2+b.expandCollapseSize,g.r=r.maxX+v,g.s=d.y+d.h/2+b.expandCollapseSize,f.push([g.p,g.q]),f.push([d.x+d.w+v/3,g.q]),b=FamilyTree.t(m.templateName,m.min,n),f.push([f[f.length-1][0],m.y+m.h/2+b.expandCollapseSize]),f.push([m.x+m.w,f[f.length-1][1]])}else{switch(u.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:f.push([g.p,g.q]),f.push([g.r,d.y-v/3]);break;case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:g.q=d.y+d.h,g.s=r.maxY-v,f.push([g.p,g.q]),f.push([g.r,d.y+d.h+v/3]);break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:g.p=d.x,g.q=d.y+d.h/2+b.expandCollapseSize,g.r=r.minX-v,g.s=d.y+d.h/2+b.expandCollapseSize,f.push([g.p,g.q]),f.push([d.x-v/3,g.q]);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:g.p=d.x+d.w,g.q=d.y+d.h/2+b.expandCollapseSize,g.r=r.maxX+v,g.s=d.y+d.h/2+b.expandCollapseSize,f.push([g.p,g.q]),f.push([d.x+d.w+v/3,g.q])}for(var _=d,k=d;k.parent;)k=k.parent;for(;m==null;){var w=!1,S=_.parent,I=S.leftNeighbor,M=S.rightNeighbor;if(S.id==p.id?m=S:FamilyTree._intersects(S,g,u)&&(g=FamilyTree._addPoint(S,f,u,g,y),w=!0),S.id!=p.id){for(;I;){if(I.id==p.id){m=I;break}FamilyTree._intersects(I,g,u)&&(g=FamilyTree._addPoint(I,f,u,g,y),w=!0),I=I.leftNeighbor}for(;M;){if(M.id==p.id){m=M;break}FamilyTree._intersects(M,g,u)&&(g=FamilyTree._addPoint(M,f,u,g,y),w=!0),M=M.rightNeighbor}}if(!w){var N=f[f.length-1][0],A=0;if(S.parent){v=u.levelSeparation,S.parent.layout&&(v=u.mixedHierarchyNodesSeparation);var B=t.manager.bordersByRootIdAndLevel[k.id][S.parent.sl];switch(u.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:A=B.maxY+v*(2/3);break;case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:A=B.minY-v*(2/3);break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:N=B.maxX+v*(2/3),A=f[f.length-1][1];break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:N=B.minX-v*(2/3),A=f[f.length-1][1]}}f.push([N,A])}_=S}switch(b=FamilyTree.t(m.templateName,m.min,n),f.splice(f.length-1,1),u.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:f.push([m.x+m.w/2+b.expandCollapseSize,f[f.length-1][1]]),f.push([f[f.length-1][0],m.y+m.h]);break;case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:f.push([m.x+m.w/2+b.expandCollapseSize,f[f.length-1][1]]),f.push([f[f.length-1][0],m.y]);break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:f.push([f[f.length-1][0],m.y+m.h/2+b.expandCollapseSize]),f.push([m.x+m.w,f[f.length-1][1]]);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:f.push([f[f.length-1][0],m.y+m.h/2+b.expandCollapseSize]),f.push([m.x,f[f.length-1][1]])}}var P=l.template;P||(P="orange");var T,O,L=null;switch((b=FamilyTree.slinkTemplates[P]).labelPosition){case"start":L={x:f[1][0],y:f[1][1]};break;case"middle":var U=Math.ceil(f.length/2);T=f[U],O=f[U-1],L={x:(T[0]+O[0])/2,y:(T[1]+O[1])/2};break;case"end":L={x:f[f.length-2][0],y:f[f.length-2][1]}}h&&(f=f.reverse()),f[0].unshift("M");for(var D=1;D<f.length;D++)f[D].unshift("L");var R=FamilyTree.roundPathCorners(f,FamilyTree.LINK_ROUNDED_CORNERS,!1);if(l.label){var H=b.label.replace("{x}",L.x).replace("{y}",L.y).replace("{val}",l.label),Y=FamilyTree._getLabelSize(H),C=-Y.height/2;switch(u.orientation){case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:C=Y.height}i+=b.label.replace("{x}",L.x).replace("{y}",L.y+C).replace("{val}",l.label)}var z=d.id,E=p.id;h&&(z=p.id,E=d.id),i+=("<g "+FamilyTree.attr.s_link_from+'="{from}" '+FamilyTree.attr.s_link_to+'="{to}">').replace("{from}",z).replace("{to}",E)+b.link.replaceAll("{d}",R)+'<path stroke="transparent" stroke-width="15" fill="none" d="'+R+'" />',i+=FamilyTree.grCloseTag}for(var a=0;a<this.config.slinks.length;a++){var l=this.config.slinks[a],s=t.getNode(l.from),c=t.getNode(l.to);s&&c&&e.res.visibleNodeIds.indexOf(c.id)!=-1&&e.res.visibleNodeIds.indexOf(s.id)!=-1&&(s.sl>=c.sl?o(s,c,!1):o(c,s,!0))}e.content+=i},FamilyTree.prototype.addSlink=function(t,e,i,n){this._putInUndoStack(),this.clearRedo();for(var r=this.config.slinks.length-1;r>=0;r--){var o=this.config.slinks[r];o.from==t&&o.to==e&&this.config.slinks.splice(r,1)}return this.config.slinks.push({from:t,to:e,label:i,template:n}),FamilyTree.events.publish("updated",[this]),this},FamilyTree.prototype.removeSlink=function(t,e){this._putInUndoStack(),this.clearRedo();for(var i=this.config.slinks.length-1;i>=0;i--){var n=this.config.slinks[i];n.from==t&&n.to==e&&this.config.slinks.splice(i,1)}return FamilyTree.events.publish("updated",[this]),this},FamilyTree.slinkTemplates={},FamilyTree.slinkTemplates.orange={defs:'<marker id="arrowSlinkOrange" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path fill="#F57C00" d="M 0 0 L 10 5 L 0 10 z" /></marker><marker id="dotSlinkOrange" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="5" markerHeight="5"> <circle cx="5" cy="5" r="5" fill="#F57C00" /></marker>',link:'<path stroke-dasharray="4, 2" marker-start="url(#dotSlinkOrange)" marker-end="url(#arrowSlinkOrange)" stroke-linejoin="round" stroke="#F57C00" stroke-width="2" fill="none" d="{d}" />',label:'<text dominant-baseline="middle" fill="#F57C00" alignment-baseline="middle" text-anchor="middle" x="{x}" y="{y}">{val}</text>',labelPosition:"middle"},FamilyTree.slinkTemplates.blue={defs:'<marker id="arrowSlinkBlue" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path fill="#039BE5" d="M 0 0 L 10 5 L 0 10 z" /></marker><marker id="dotSlinkBlue" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="5" markerHeight="5"> <circle cx="5" cy="5" r="5" fill="#039BE5" /></marker>',link:'<path stroke-dasharray="4, 2" marker-start="url(#dotSlinkBlue)" marker-end="url(#arrowSlinkBlue)" stroke-linejoin="round" stroke="#039BE5" stroke-width="2" fill="none" d="{d}" />',label:'<text fill="#039BE5" text-anchor="middle" x="{x}" y="{y}">{val}</text>',labelPosition:"middle"},FamilyTree.slinkTemplates.yellow={defs:'<marker id="arrowSlinkYellow" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path fill="#FFCA28" d="M 0 0 L 10 5 L 0 10 z" /></marker><marker id="dotSlinkYellow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="5" markerHeight="5"> <circle cx="5" cy="5" r="5" fill="#FFCA28" /></marker>',link:'<path stroke-dasharray="4, 2" marker-start="url(#dotSlinkYellow)" marker-end="url(#arrowSlinkYellow)" stroke-linejoin="round" stroke="#FFCA28" stroke-width="2" fill="none" d="{d}" />',label:'<text  fill="#FFCA28" text-anchor="middle" x="{x}" y="{y}">{val}</text>',labelPosition:"middle"},FamilyTree.events.on("renderbuttons",function(t,e){if(e.node&&e.node.tags&&e.node.tags.has("group-dotted-lines")){var i=t.getScale(),n=FamilyTree.t(e.node.templateName,e.node.min,i),r="";e.node.min?(n.nodeGroupDottedOpenButton||console.error(`[${e.node.templateName}].nodeGroupDottedOpenButton is not defined`),r+=`<g style="cursor:pointer;"  data-ctrl-n-dotted-open="${e.node.id}" transform="matrix(1,0,0,1,${e.node.x},${e.node.y})">`,r+=n.nodeGroupDottedOpenButton):(n.nodeGroupDottedCloseButton||console.error(`[${e.node.templateName}].nodeGroupDottedCloseButton is not defined`),r+=`<g style="cursor:pointer;" transform="matrix(1,0,0,1,${e.node.x},${e.node.y})" data-ctrl-n-dotted-close="${e.node.id}">`,r+=n.nodeGroupDottedCloseButton),r=(r+="</g>").replaceAll("{cw}",e.node.w/2).replaceAll("{ch}",e.node.h/2).replaceAll("{ew}",e.node.w-(e.node.padding?e.node.padding[1]:0)).replaceAll("{eh}",e.node.h-(e.node.padding?e.node.padding[2]:0));var o=t.getNode(e.node.stChildrenIds[0]);if(r.indexOf("{collapsed-children-count}")!=-1){var a=FamilyTree.collapsedChildrenCount(t,o);r=r.replace("{collapsed-children-count}",a)}if(r.indexOf("{collapsed-children-total-count}")!=-1){var l=FamilyTree.collapsedChildrenTotalCount(t,o);r=r.replace("{collapsed-children-total-count}",l)}if(r.indexOf("{children-count}")!=-1){var s=FamilyTree.childrenCount(t,o);r=r.replace("{children-count}",s)}if(r.indexOf("{children-total-count}")!=-1){var c=FamilyTree.childrenTotalCount(t,o);r=r.replace("{children-total-count}",c)}e.html+=r}}),FamilyTree.events.on("redraw",function(t,e){if(t.config.groupDottedLines.length){for(var i=t.element.querySelectorAll("[data-ctrl-n-dotted-close]"),n=0;n<i.length;n++)i[n].addEventListener("click",function(){var o=this.getAttribute("data-ctrl-n-dotted-close");t.minimize(o)});var r=t.element.querySelectorAll("[data-ctrl-n-dotted-open]");for(n=0;n<r.length;n++)r[n].addEventListener("click",function(){var o=this.getAttribute("data-ctrl-n-dotted-open");t.maximize(o)})}}),FamilyTree===void 0&&(FamilyTree={}),FamilyTree.prototype.undo=function(t){if(this.config.undoRedoStorageName){var e=this.undoStepsCount();if(e!=0){this._putInRedoStack();var i=`${this.config.undoRedoStorageName}_undo_`+(e-1),n=sessionStorage.getItem(i);sessionStorage.removeItem(i);var r=JSON.parse(n);this.config.nodes=r.nodes,this.config.clinks=r.clinks,this.config.slinks=r.slinks,this.config.groupDottedLines=r.groupDottedLines,this.config.dottedLines=r.dottedLines,FamilyTree.events.publish("updated",[this]),this.filterUI.update(),this.draw(FamilyTree.action.update,void 0,t),this.undoRedoUI.refresh()}}},FamilyTree.prototype.redo=function(t){if(this.config.undoRedoStorageName){var e=this.redoStepsCount();if(e!=0){this._putInUndoStack();var i=`${this.config.undoRedoStorageName}_redo_`+(e-1),n=sessionStorage.getItem(i);sessionStorage.removeItem(i);var r=JSON.parse(n);this.config.nodes=r.nodes,this.config.clinks=r.clinks,this.config.slinks=r.slinks,this.config.groupDottedLines=r.groupDottedLines,this.config.dottedLines=r.dottedLines,FamilyTree.events.publish("updated",[this]),this.filterUI.update(),this.draw(FamilyTree.action.update,void 0,t),this.undoRedoUI.refresh()}}},FamilyTree.prototype.clearRedo=function(){if(this.config.undoRedoStorageName){for(var t=`${this.config.undoRedoStorageName}_redo_`,e=Object.keys(sessionStorage),i=0;e.indexOf(t+i)!=-1;)sessionStorage.removeItem(t+i),i++;this.undoRedoUI.refresh()}},FamilyTree.prototype.clearUndo=function(){if(this.config.undoRedoStorageName){for(var t=`${this.config.undoRedoStorageName}_undo_`,e=Object.keys(sessionStorage),i=0;e.indexOf(t+i)!=-1;)sessionStorage.removeItem(t+i),i++;this.undoRedoUI.refresh()}},FamilyTree.prototype.undoStepsCount=function(){for(var t=`${this.config.undoRedoStorageName}_undo_`,e=Object.keys(sessionStorage),i=0;e.indexOf(t+i)!=-1;)i++;return i},FamilyTree.prototype.redoStepsCount=function(){for(var t=`${this.config.undoRedoStorageName}_redo_`,e=Object.keys(sessionStorage),i=0;e.indexOf(t+i)!=-1;)i++;return i},FamilyTree.prototype._putInUndoStack=function(){if(this.config.undoRedoStorageName){var t=`${this.config.undoRedoStorageName}_undo_`+this.undoStepsCount();sessionStorage.setItem(t,JSON.stringify({nodes:this.config.nodes,clinks:this.config.clinks,slinks:this.config.slinks,groupDottedLines:this.config.groupDottedLines,dottedLines:this.config.dottedLines}))}},FamilyTree.prototype._putInRedoStack=function(){if(this.config.undoRedoStorageName){var t=`${this.config.undoRedoStorageName}_redo_`+this.redoStepsCount();sessionStorage.setItem(t,JSON.stringify({nodes:this.config.nodes,clinks:this.config.clinks,slinks:this.config.slinks,groupDottedLines:this.config.groupDottedLines,dottedLines:this.config.dottedLines}))}},FamilyTree===void 0&&(FamilyTree={}),FamilyTree.undoRedoUI=function(){this.instance=null,this._event_id=FamilyTree._guid()},FamilyTree.undoRedoUI.prototype.init=function(t){t.config.undoRedoStorageName&&(this.instance=t,this.refresh())},FamilyTree.undoRedoUI.prototype.refresh=function(){var t=this;if(this.instance.config.undoRedoStorageName){var e={undoStepsCount:this.instance.undoStepsCount(),redoStepsCount:this.instance.redoStepsCount()};if(FamilyTree.events.publish("change",[this,e])!==!1){var i=this.instance.element.querySelector("[data-undo]"),n=this.instance.element.querySelector("[data-redo]");if(!i||!n){var r=document.createElement("div");r.classList.add("bft-undo-redo"),r.innerHTML=`<span data-undo>${FamilyTree.icon.undo(50,50,"")}<span class="bft-undo-i"></span></span>
                            <span data-redo>${FamilyTree.icon.redo(50,50,"")}<span class="bft-redo-i"></span></span>`,this.instance.element.appendChild(r),i=this.instance.element.querySelector("[data-undo]"),n=this.instance.element.querySelector("[data-redo]"),i.addEventListener("click",function(){t.instance.undo()}),n.addEventListener("click",function(){t.instance.redo()})}e.undoStepsCount>0?(i.classList.add("bft-ur-clickable"),i.querySelector(".bft-undo-i").innerHTML=e.undoStepsCount,i.querySelector(".bft-undo-i").style.display="inline-block"):(i.classList.remove("bft-ur-clickable"),i.querySelector(".bft-undo-i").style.display="none"),e.redoStepsCount>0?(n.classList.add("bft-ur-clickable"),n.querySelector(".bft-redo-i").innerHTML=e.redoStepsCount,n.querySelector(".bft-redo-i").style.display="inline-block"):(n.classList.remove("bft-ur-clickable"),n.querySelector(".bft-redo-i").style.display="none")}}},FamilyTree.undoRedoUI.prototype.on=function(t,e){return FamilyTree.events.on(t,e,this._event_id),this},FamilyTree.undoRedoUI.prototype.onChange=function(t){return this.on("change",function(e,i){return t.call(e,i)})},FamilyTree.events.on("redraw",function(t,e){if(t.config.miniMap){if(t.manager.action!=FamilyTree.action.move){FamilyTree.miniMap._settings._scale=Math.min(FamilyTree.miniMap.width/(t.response.boundary.maxX-t.response.boundary.minX),FamilyTree.miniMap.height/(t.response.boundary.maxY-t.response.boundary.minY)),FamilyTree.miniMap._settings._translateX=-t.response.boundary.minX*FamilyTree.miniMap._settings._scale+(FamilyTree.miniMap.width-(t.response.boundary.maxX-t.response.boundary.minX)*FamilyTree.miniMap._settings._scale)/2,FamilyTree.miniMap._settings._translateY=-t.response.boundary.minY*FamilyTree.miniMap._settings._scale+(FamilyTree.miniMap.height-(t.response.boundary.maxY-t.response.boundary.minY)*FamilyTree.miniMap._settings._scale)/2;var i=t.getViewBox();FamilyTree.miniMap._init(t),FamilyTree.miniMap._drawMainCanvas(t),FamilyTree.miniMap._drawRectSelectorCanvas(t,i);var n,r,o,a,l=t.element.querySelector('[data-id="mini-map-focus"]'),s=!1,c=null;l.onmousedown=function(p){var h,f,m,y=l.getBoundingClientRect(),x=y.left,u=y.top;if(n=parseInt(p.clientX-x),r=parseInt(p.clientY-u),h=r,f=(n-FamilyTree.miniMap._settings._translateX)/FamilyTree.miniMap._settings._scale,m=(h-FamilyTree.miniMap._settings._translateY)/FamilyTree.miniMap._settings._scale,f>i[0]&&f<i[0]+i[2]&&m>i[1]&&m<i[1]+i[3])return p.preventDefault(),p.stopPropagation(),void(s=!0)},l.onmousemove=function(p){if(s){p.preventDefault(),p.stopPropagation(),FamilyTree.miniMap._mouseMove=!0;var h=l.getBoundingClientRect(),f=h.left,m=h.top;o=parseInt(p.clientX-f),a=parseInt(p.clientY-m);var y=(o-n)/FamilyTree.miniMap._settings._scale,x=(a-r)/FamilyTree.miniMap._settings._scale;i[0]=y+i[0],i[1]=x+i[1],t.setViewBox(i),c&&(clearTimeout(c),c=null),c=setTimeout(function(){t._draw(!0,FamilyTree.action.move)},300),FamilyTree.miniMap._drawRectSelectorCanvas(t,i),n=o,r=a}},l.onmouseup=function(p){s&&(p.preventDefault(),p.stopPropagation(),s=!1)},l.onmouseout=function(p){s&&(p.preventDefault(),p.stopPropagation(),s=!1,FamilyTree.miniMap._mouseMove=!1)},l.onclick=function(p){if(p.preventDefault(),p.stopPropagation(),FamilyTree.miniMap._mouseMove)FamilyTree.miniMap._mouseMove=!1;else{var h=l.getBoundingClientRect(),f=h.left,m=h.top;o=parseInt(p.clientX-f),a=parseInt(p.clientY-m);var y=o/FamilyTree.miniMap._settings._scale,x=a/FamilyTree.miniMap._settings._scale;i[0]=y-(i[0]+i[2]-i[0])/2-FamilyTree.miniMap._settings._translateX/FamilyTree.miniMap._settings._scale,i[1]=x-(i[1]+i[3]-i[1])/2-FamilyTree.miniMap._settings._translateY/FamilyTree.miniMap._settings._scale,t.setViewBox(i),c&&(clearTimeout(c),c=null),c=setTimeout(function(){t._draw(!0,FamilyTree.action.move)},300),FamilyTree.miniMap._drawRectSelectorCanvas(t,i)}}}}else{var d=t.element.querySelector('[data-id="mini-map"]');d&&d.parentNode.removeChild(d)}}),FamilyTree.miniMap={},FamilyTree.miniMap._settings={_translateX:0,_translateY:0,_scale:1},FamilyTree.miniMap._drawMainCanvas=function(t){var e=t.element.querySelector('[data-id="mini-map-main"]'),i=e.getContext("2d");FamilyTree.miniMap._initCtx(t,e,1);var n=0,r=[];(function o(a,l){if(Array.isArray(l))for(var s=0;s<l.length;s++)o(a,l[s]);else{for(i.fillStyle=FamilyTree.miniMap.colors[3],i.beginPath(),i.lineWidth="0.5",i.fillRect(l.x,l.y,l.w,l.h),i.strokeRect(l.x,l.y,l.w,l.h),s=0;s<l.stChildrenIds.length;s++)n++,r.includes(l.id)||(n==1?i.fillStyle=FamilyTree.miniMap.colors[0]:n==2?i.fillStyle=FamilyTree.miniMap.colors[1]:n==3&&(i.fillStyle=FamilyTree.miniMap.colors[2]),i.beginPath(),i.fillRect(l.x,l.y,l.w,l.h),i.strokeRect(l.x,l.y,l.w,l.h),r.push(l.id)),o(a,a.getNode(l.stChildrenIds[s])),n--;for(s=0;s<l.childrenIds.length;s++)o(a,a.getNode(l.childrenIds[s]))}})(t,t.roots)},FamilyTree.miniMap._drawRectSelectorCanvas=function(t,e){var i=t.element.querySelector('[data-id="mini-map-focus"]'),n=i.getContext("2d");FamilyTree.miniMap._initCtx(t,i,FamilyTree.miniMap.opacity);var r=e[0],o=e[1],a=e[2],l=e[3];n.lineWidth=.5/FamilyTree.miniMap._settings._scale,n.strokeStyle=FamilyTree.miniMap.focusStroke,n.globalAlpha=1,n.clearRect(r,o,a,l),n.strokeRect(r,o,a,l)},FamilyTree.miniMap._initCtx=function(t,e,i){var n=e.getContext("2d");e.width=e.width,e.height=e.height,n.clearRect(0,0,FamilyTree.miniMap.width,FamilyTree.miniMap.height),n.globalAlpha=i,i!=1&&(n.fillStyle=FamilyTree.miniMap.selectorBackgroundColor,n.fillRect(0,0,FamilyTree.miniMap.width,FamilyTree.miniMap.height)),n.translate(FamilyTree.miniMap._settings._translateX,FamilyTree.miniMap._settings._translateY),n.scale(FamilyTree.miniMap._settings._scale,FamilyTree.miniMap._settings._scale)},FamilyTree.miniMap._init=function(t){if(!t.element.querySelector('[data-id="mini-map"]')){var e=document.createElement("canvas");e.width=FamilyTree.miniMap.width,e.height=FamilyTree.miniMap.height,e.setAttribute("data-id","mini-map-main"),e.style.display="inline-block",e.style.backgroundColor=FamilyTree.miniMap.backgroundColor,e.style.position="absolute",e.style.top=0,e.style.left=0;var i=document.createElement("canvas");i.width=FamilyTree.miniMap.width,i.height=FamilyTree.miniMap.height,i.setAttribute("data-id","mini-map-focus"),i.style.display="inline-block",i.style.position="absolute",i.style.top=0,i.style.left=0;var n=document.createElement("div");n.setAttribute("data-id","mini-map"),n.style.position="absolute";for(var r=["top","right","left","bottom"],o=0;o<r.length;o++){var a=r[o];FamilyTree.isNEU(FamilyTree.miniMap.position[a])||(FamilyTree.miniMap.position[a]=="padding"?n.style[a]=t.config.padding+"px":n.style[a]=FamilyTree.miniMap.position[a]+"px")}n.style.border=FamilyTree.miniMap.border,n.style.padding=FamilyTree.miniMap.padding+"px",n.style.backgroundColor=FamilyTree.miniMap.backgroundColor;var l=document.createElement("div");l.style.position="relative",l.style.width=FamilyTree.miniMap.width+"px",l.style.height=FamilyTree.miniMap.height+"px",l.appendChild(e),l.appendChild(i),n.appendChild(l),t.element.appendChild(n);var s=function(f,m){t.__mouseScrollHandler(n,m)};t._addEvent(n,"DOMMouseScroll",s),t._addEvent(n,"mousewheel",s);var c=0,d=0,p=function(f){FamilyTree.miniMap._mouseMove=!0;var m=f.clientX-c,y=f.clientY-d;if(!FamilyTree.isNEU(n.style.left)){var x=parseFloat(n.style.left)+m;n.style.left=`${x}px`}if(!FamilyTree.isNEU(n.style.right)){var u=parseFloat(n.style.right)-m;n.style.right=`${u}px`}if(!FamilyTree.isNEU(n.style.bottom)){var b=parseFloat(n.style.bottom)-y;n.style.bottom=`${b}px`}if(!FamilyTree.isNEU(n.style.top)){var v=parseFloat(n.style.top)+y;n.style.top=`${v}px`}c=f.clientX,d=f.clientY},h=function(){document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",h)};FamilyTree.miniMap.draggable&&n.addEventListener("mousedown",function(f){c=f.clientX,d=f.clientY,document.addEventListener("mousemove",p),document.addEventListener("mouseup",h)})}},FamilyTree.miniMap.colors=["#E0E0E0","#BDBDBD","#9E9E9E","#757575"],FamilyTree.miniMap.selectorBackgroundColor="white",FamilyTree.miniMap.backgroundColor="white",FamilyTree.miniMap.focusStroke="#f57c00",FamilyTree.miniMap.opacity=.4,FamilyTree.miniMap.border="1px solid #aeaeae",FamilyTree.miniMap.width=250,FamilyTree.miniMap.height=140,FamilyTree.miniMap.padding=5,FamilyTree.miniMap.position={top:void 0,left:"padding",right:void 0,bottom:"padding"},FamilyTree.miniMap.draggable=!0,FamilyTree._search={},FamilyTree._search.search=function(t,e,i,n,r,o,a){var l=[],s=e.toLowerCase(),c=s.split(" ");if(a&&c.length>1){var d=c[0];a[d]&&(i=[a[d]],c=(s=s.replace(d,"").trim()).split(" "))}c=c.filter(function(v,g,_){return _.indexOf(v)===g});for(var p={},h=0;h<t.length;h++)for(var f=t[h],m=0;m<i.length;m++){var y=i[m];if(!FamilyTree.isNEU(f[y])){var x=f[y];if((e=FamilyTree._search.searchAndComputeScore(c,x,y,o))!=null){var u=f.id;if(p[u]){if(p[u]&&p[u]<e.__score){p[u]=e.__score;for(var b=l.length-1;b>=0;b--)l[b].id==u&&l.splice(b,1);FamilyTree._search.addNodeToResult(l,n,f,e,y,r)}}else p[u]=e.__score,FamilyTree._search.addNodeToResult(l,n,f,e,y,r)}}}return l.sort(function(v,g){return v.__score<g.__score?1:v.__score>g.__score?-1:0}),l},FamilyTree._search.addNodeToResult=function(t,e,i,n,r,o){var a={};a.id=i.id,FamilyTree.isNEU(i[o])||(a[o]=i[o]);for(var l=0;l<e.length;l++){var s=e[l];FamilyTree.isNEU(i[s])||FamilyTree.isNEU(a[s])&&(a[s]=i[s])}n!=null&&(FamilyTree.isNEU(a.__score)&&(a.__score=n.__score),FamilyTree.isNEU(a.__searchField)&&(a.__searchField=r),FamilyTree.isNEU(a.__searchMarks)&&(a.__searchMarks=n.__searchMarks)),t.push(a)},FamilyTree._search.searchAndComputeScore=function(t,e,i,n){if(FamilyTree.isNEU(e)||FamilyTree.isNEU(t)||!t.length)return null;typeof e!="string"&&(e=e.toString());var r=e.toLowerCase(),o=FamilyTree._search.searchIndexesOf(r,t);if(!o.length)return null;for(var a=r.length/100,l=0,s=0,c=l>0?100:0,d=0,p=0;p<t.length;p++)for(var h=t[p],f=0;f<o.length;f++)if(h.indexOf(o[f].searchPhrase)!=-1){d++;break}var m=100/(t.length/d);if(o.length){for(s=o[0].start,f=0;f<o.length;f++)if(l+=o[f].length,o[f].start<s&&(s=o[f].start),f>=1&&o[f-1].start>o[f].start){c=0;break}}var y=0;l!=0&&(y=l/a);var x=l>0?100:0;s!=0&&(x=100-s/a);var u=0;n&&n[i]&&(u=n[i]),m&&(m=m/100*50),y>0&&(y=y/100*10),x>0&&(x=x/100*10),c>0&&(c=c/100*10),u>0&&(u=u/100*20);var b=Math.round(1e4*(m+y+x+c+u));for(o.sort(function(g,_){return g.start<_.start?-1:g.start>_.start?1:0}),f=o.length-1;f>=0;f--)for(p=0;p<o.length;p++)p<f&&o[p].start+o[p].length>o[f].start&&o.splice(f,1);var v=e;for(f=o.length-1;f>=0;f--)v=(v=v.insert(o[f].start+o[f].length,"</mark>")).insert(o[f].start,"<mark>");return{__searchMarks:v,__score:b}},FamilyTree._search.searchIndexesOf=function(t,e){var i=[];if(!FamilyTree.isNEU(t))for(var n=0;n<e.length;n++){var r=e[n];if(!FamilyTree.isNEU(r))for(var o=0;(o=t.indexOf(r,o))>-1;)i.push({length:r.length,start:o,searchPhrase:r}),o+=r.length}return i.sort(function(a,l){return a.length<l.length?1:a.length>l.length||a.start<l.start?-1:a.start>l.start?1:0}),i=i.filter(function(a){for(var l=!1,s=0;s<i.length;s++){var c=i[s].start,d=i[s].start+i[s].length-1,p=a.start,h=a.start+a.length-1;if(c==p&&d==h){l=!1;break}if(c>=p&&d<=h){l=!0;break}if(c<=p&&d>=h){l=!0;break}}return!l})},FamilyTree.events.on("redraw",function(t,e){if(t.config.state){var i=[],n=[];(function r(o){if(Array.isArray(o))for(var a=0;a<o.length;a++)r(o[a]);else{for((typeof o.id!="string"||typeof o.id=="string"&&o.id.indexOf("split")==-1&&o.id.indexOf("mirror")==-1)&&(i.push(o.id),o.min==1&&n.push(o.id)),a=0;a<o.stChildren.length;a++)r(o.stChildren[a]);for(a=0;a<o.children.length;a++)r(o.children[a])}})(t.roots),FamilyTree.state._put(t.config.roots,t.width(),t.height(),t.response.viewBox,i,n,t.response.adjustify,t.config.state)}}),FamilyTree.state={},FamilyTree.state._buildStateNames=function(t){return{paramScale:t+"-scale",paramX:t+"-x",paramY:t+"-y",paramExp:t+"-exp",paramMin:t+"-min",paramRoots:t+"-roots",paramAdjustify:t+"-adjustify"}},FamilyTree.state._put=function(t,e,i,n,r,o,a,l){if(l&&!FamilyTree.isNEU(r)&&r.length!=0){var s=FamilyTree.state._buildStateNames(l.name),c={roots:t,scale:Math.min(e/n[2],i/n[3]),x:n[0],y:n[1],exp:r,min:o,adjustify:a};if(l.writeToUrlParams){var d=new URLSearchParams(window.location.search);d.has(s.paramScale)?d.set(s.paramScale,c.scale):d.append(s.paramScale,c.scale),d.has(s.paramX)?d.set(s.paramX,c.x):d.append(s.paramX,c.x),d.has(s.paramY)?d.set(s.paramY,c.y):d.append(s.paramY,c.y),d.has(s.paramExp)?d.set(s.paramExp,c.exp.join("*")):d.append(s.paramExp,c.exp.join("*")),d.has(s.paramRoots)&&Array.isArray(c.roots)?d.set(s.paramRoots,c.roots.join("*")):Array.isArray(c.roots)&&d.append(s.paramRoots,c.roots.join("*")),d.has(s.paramMin)?d.set(s.paramMin,c.min.join("*")):d.append(s.paramMin,c.min.join("*")),d.has(s.paramAdjustify)?d.set(s.paramAdjustify,c.adjustify.x+"*"+c.adjustify.y):d.append(s.paramAdjustify,c.adjustify.x+"*"+c.adjustify.y),window.history.replaceState(null,null,"?"+d)}l.writeToIndexedDB&&(c.id=l.name,FamilyTree.idb.put(c,function(p){p==0&&console.error("Cannot write row - "+l.name)})),l.writeToLocalStorage&&FamilyTree.localStorage.setItem(l.name,JSON.stringify(c))}},FamilyTree.state._get=function(t,e,i,n){if(t){var r=FamilyTree.state._buildStateNames(t.name);if(t.readFromUrlParams){var o=new URLSearchParams(window.location.search);if(o.has(r.paramScale)&&o.has(r.paramX)&&o.has(r.paramY)&&o.has(r.paramExp)&&o.has(r.paramMin)&&o.has(r.paramAdjustify)){var a={},l=parseFloat(o.get(r.paramScale)),s=parseFloat(o.get(r.paramX)),c=parseFloat(o.get(r.paramY));(p=[])[0]=s,p[1]=c,p[2]=e/l,p[3]=i/l,a.vb=p,a.scale=l,a.x=s,a.y=c,a.roots=null,o.has(r.paramRoots)&&(a.roots=o.get(r.paramRoots).split("*")),a.exp=o.get(r.paramExp).split("*"),a.min=o.get(r.paramMin).split("*");var d=o.get(r.paramAdjustify).split("*");return a.adjustify={x:parseFloat(d[0]),y:parseFloat(d[1])},void n(a)}if(!t.readFromIndexedDB&&!t.readFromLocalStorage)return void n(null)}if(t.readFromLocalStorage){var p;if((a=FamilyTree.localStorage.getItem(t.name))!=null)return a=JSON.parse(a),(p=[])[0]=a.x,p[1]=a.y,p[2]=e/a.scale,p[3]=i/a.scale,a.vb=p,void n(a);if(!t.readFromIndexedDB)return void n(null)}t.readFromIndexedDB&&FamilyTree.idb.read(t.name,function(h,f){if(h==0)console.error("Cannot read from - "+t.name),n(null);else if(h==null)n(null);else{var m=[];m[0]=f.x,m[1]=f.y,m[2]=e/f.scale,m[3]=i/f.scale,f.vb=m,n(f)}})}else n(null)},FamilyTree.state.clear=function(t){if(!t)return!1;try{localStorage.removeItem(t);var e=FamilyTree.state._buildStateNames(t),i=new URLSearchParams(window.location.search);i.has(e.paramScale)&&i.delete(e.paramScale),i.has(e.paramX)&&i.delete(e.paramX),i.has(e.paramY)&&i.delete(e.paramY),i.has(e.paramExp)&&i.delete(e.paramExp),i.has(e.paramRoots)&&i.delete(e.paramRoots),i.has(e.paramMin)&&i.delete(e.paramMin),i.has(e.paramAdjustify)&&i.delete(e.paramAdjustify),window.history.replaceState(null,null,"?"+i),FamilyTree.idb.delete(t,function(n){n==0&&console.error("Cannot delete row - "+t)})}catch{}},FamilyTree._magnify={},FamilyTree.prototype.magnify=function(t,e,i,n,r){n||(n=this.config.anim);var o=this.getNode(t),a=this.getNodeElement(t);if(o||a){var l=FamilyTree._magnify[t];l&&(l.timer!=null&&clearInterval(l.timer),l.timerBack!=null&&clearInterval(l.timerBack),a.setAttribute("transform","matrix("+l.transformStart.toString()+")"),FamilyTree._magnify[t]=null),i&&(a=a.cloneNode(!0),this.getSvg().appendChild(a));var s=FamilyTree._getTransform(a),c=JSON.parse(JSON.stringify(s));c[0]=e,c[3]=e;var d=o.w+o.w*(e-1),p=o.h+o.h*(e-1);c[4]+=(o.w-d)/2,c[5]+=(o.h-p)/2;var h=FamilyTree.animate(a,{transform:s},{transform:c},n.duration,n.func);FamilyTree._magnify[t]={timer:h,transformStart:s,nodeElement:a,front:i},r&&r(a)}},FamilyTree.prototype.magnifyBack=function(t,e,i){e||(e=this.config.anim);var n=FamilyTree._magnify[t];if(n){n.timer!=null&&clearInterval(n.timer),n.timerBack!=null&&clearInterval(n.timerBack);var r=FamilyTree._getTransform(n.nodeElement);n.timerBack=FamilyTree.animate(n.nodeElement,{transform:r},{transform:n.transformStart},e.duration,e.func,function(o){var a=o[0].getAttribute(FamilyTree.attr.node_id);FamilyTree._magnify[a]&&FamilyTree._magnify[a].front&&(o[0].parentNode.removeChild(o[0]),FamilyTree._magnify[a]=null),i&&i(o[0])})}},FamilyTree===void 0&&(FamilyTree={}),FamilyTree.events.on("init",function(t,e){if(t.config.keyNavigation&&(t._addEvent(window,"keydown",t._windowKeyDownHandler),FamilyTree.isNEU(t._keyNavigationActiveNodeId)&&t.roots&&t.roots.length)){var i=t.roots[0].id;FamilyTree.isNEU(t.config.keyNavigation.focusId)||(i=t.config.keyNavigation.focusId),t._keyNavigationActiveNodeId=i,t.center(t._keyNavigationActiveNodeId)}}),FamilyTree.prototype._windowKeyDownHandler=function(t,e){for(var i=e.target,n=null;i&&i!=this.element;){if(i.hasAttribute&&i.hasAttribute(FamilyTree.attr.node_id)){n=i.getAttribute(FamilyTree.attr.node_id);break}i=i.parentNode}if(i){var r=n?this.getNode(n):null,o={node:r,data:n?this.get(n):null,event:e};if(FamilyTree.events.publish("key-down",[this,o])!==!1&&r){if(e.code=="KeyF")this.searchUI.find("");else if(e.code=="ArrowRight"||r.isAssistant&&e.code=="ArrowDown"||r.isPartner&&e.code=="ArrowDown"){if(s=this.getNode(r.pid)){var a=s.childrenIds.indexOf(r.id);if(++a<s.childrenIds.length){var l=s.childrenIds[a];this._keyNavigationActiveNodeId=l,this.center(l)}}}else if(e.code=="ArrowLeft")(s=this.getNode(r.pid))&&(a=s.childrenIds.indexOf(r.id),--a>=0&&(l=s.childrenIds[a],this._keyNavigationActiveNodeId=l,this.center(l)));else if(e.code=="ArrowUp"){var s;(s=this.getNode(r.pid))&&(l=s.id,(r.isAssistant||s.hasAssistants||r.isPartner||s.hasPartners)&&(a=s.childrenIds.indexOf(r.id),--a>=0&&(l=s.childrenIds[a])),this._keyNavigationActiveNodeId=l,this.center(l))}else if(e.code=="ArrowDown")r.childrenIds.length&&(this._keyNavigationActiveNodeId=r.childrenIds[0],this.center(r.childrenIds[0]));else if(e.code=="Space"){var c=i.getAttribute(FamilyTree.attr.node_id);return void this.toggleExpandCollapse(c,e)}}}},FamilyTree.events.on("redraw",function(t,e){t.config.keyNavigation&&FamilyTree._keyNavigation(t)}),FamilyTree.events.on("click",function(t,e){t.config&&t.config.keyNavigation&&(t._keyNavigationActiveNodeId=e.node.id,t.center(e.node.id))}),FamilyTree._keyNavigation=function(t){var e=t.element.querySelector(":focus");if(e&&e.parentElement&&e.parentElement.hasAttribute(FamilyTree.attr.node_id)){var i=e.parentElement;(r=(n=e).querySelector("title"))&&r.parentNode.removeChild(r),n.removeAttribute("tabindex")}if(!FamilyTree.isNEU(t._keyNavigationActiveNodeId)&&(i=t.getNodeElement(t._keyNavigationActiveNodeId))&&i.children.length){var n;(n=i.children[0]).setAttribute("tabindex",2);var r,o={text:"",id:t._keyNavigationActiveNodeId};FamilyTree.events.publish("screen-reader-text",[t,o]),!FamilyTree.isNEU(o.text)&&((r=document.createElementNS("http://www.w3.org/2000/svg","title")).innerHTML=o.text,n.appendChild(r)),FamilyTree.SEARCH_CLOSE_RESULT_ON_ESCAPE_OR_CLICKOUTSIDE&&t.searchUI.hide(),n.focus()}},FamilyTree.elements={},FamilyTree.elements.textbox=function(t,e,i,n){var r=FamilyTree.elements._vidrf(t,e,n);if(r.doNotRender)return{html:""};var o="";return e.btn&&(o=`<a href="#" data-input-btn="" class="bft-link bft-link-bft-button">${e.btn}</a>`),{html:`<div class="bft-form-field" style="min-width: ${i};">
                    <div class="bft-input" data-bft-input="" ${r.disabledAttribute} ${r.vlidators}>
                        <label for="${r.id}">${FamilyTree._escapeGreaterLessSign(r.label)}</label>
                        <input ${r.readOnlyAttribute} data-binding="${FamilyTree._escapeDoubleQuotes(r.binding)}" maxlength="256" id="${r.id}" name="${r.id}" type="text" value="${FamilyTree._escapeDoubleQuotes(r.value)}" autocomplete="off">
                        ${o}
                    </div>
                </div>`,id:r.id,value:r.value}},FamilyTree.elements.checkbox=function(t,e,i,n){var r=FamilyTree.elements._vidrf(t,e,n);if(r.doNotRender)return{html:""};var o=r.value?"checked":"",a=n?'onclick="return false;"':"";return{html:`<div class="bft-form-field"  style="min-width: ${i};" >
                        <label class="bft-checkbox" data-bft-input="" ${r.disabledAttribute}>
                            <input ${o} ${a} data-binding="${FamilyTree._escapeDoubleQuotes(r.binding)}" type="checkbox"><span class="bft-checkbox-checkmark" type="checkbox"></span>${FamilyTree._escapeGreaterLessSign(r.label)}
                        </label>
                    </div>`,id:r.id,value:o}},FamilyTree.elements.select=function(t,e,i,n){if(n)return FamilyTree.elements.textbox(t,e,i,n);var r=FamilyTree.elements._vidrf(t,e,n);return r.doNotRender?{html:""}:{html:`<div class="bft-form-field" style="min-width: ${i};">
                    <div class="bft-input" data-bft-input="" ${r.disabledAttribute} ${r.vlidators}>
                        <label for="${r.id}">${FamilyTree._escapeGreaterLessSign(r.label)}</label>
                        <select data-binding="${FamilyTree._escapeDoubleQuotes(r.binding)}" ${r.readOnlyAttribute} id="${r.id}" name="${r.id}">
                            ${function(){for(var o="",a=0;a<r.options.length;a++){var l=r.options[a];o+=`<option ${l.value==r.value?"selected":""} value="${FamilyTree._escapeDoubleQuotes(l.value)}">${FamilyTree._escapeGreaterLessSign(l.text)}</option>`}return o}()}                           
                        </select>
                    </div>
                </div>`,id:r.id,value:r.value}},FamilyTree.elements.multiSelect=function(t,e,i,n){if(n)return FamilyTree.elements.textbox(t,e,i,n);var r=FamilyTree.elements._vidrf(t,e,n);return r.doNotRender?{html:""}:{html:`<div class="bft-form-field" style="min-width: ${i};">
                    <div class="bft-input" data-bft-input="" ${r.disabledAttribute} ${r.vlidators}>
                        <label for="${r.id}">${FamilyTree._escapeGreaterLessSign(r.label)}</label>
                        <select class="multiple" data-binding="${FamilyTree._escapeDoubleQuotes(r.binding)}" ${r.readOnlyAttribute} id="${r.id}" name="${r.id}" multiple>
                            ${function(){for(var o="",a=0;a<r.options.length;a++){var l=r.options[a];o+=`<option ${r.value.includes(l.value)?"selected":""} value="${FamilyTree._escapeDoubleQuotes(l.value)}">${FamilyTree._escapeGreaterLessSign(l.text)}</option>`}return o}()}                           
                        </select>
                    </div>
                </div>`,id:r.id,value:r.value}},FamilyTree.elements.date=function(t,e,i,n){var r=FamilyTree.elements._vidrf(t,e,n);return r.doNotRender?{html:""}:{html:`<div class="bft-form-field" style="min-width: ${i};">
                    <div class="bft-input" data-bft-input="" ${r.disabledAttribute} ${r.vlidators}>
                        <label for="${r.id}" class="hasval">${FamilyTree._escapeGreaterLessSign(r.label)}</label>
                        <input data-binding="${FamilyTree._escapeDoubleQuotes(r.binding)}" ${r.readOnlyAttribute} maxlength="256" id="${r.id}" name="${r.id}" type="date" value="${FamilyTree._escapeDoubleQuotes(r.value)}" autocomplete="off">
                    </div>
                </div>`,id:r.id,value:r.value}},FamilyTree.elements._vidrf=function(t,e,i){var n={};if(e.binding||(e.binding=""),e.label||(e.label=""),e.type!="select"||Array.isArray(e.options)?n.options=e.options:n.options=[],n.value=t&&!FamilyTree.isNEU(t[e.binding])?t[e.binding]:"",i&&n.options){for(var r=0;r<n.options.length;r++)if(n.options[r].value==n.value){n.value=n.options[r].text;break}}if(n.id=FamilyTree.elements.generateId(),n.disabledAttribute=i?"data-bft-input-disabled":"",n.readOnlyAttribute=i?"readonly":"",n.id=n.id,i&&FamilyTree.isNEU(n.value)&&(n.doNotRender=!0),i&&e.binding=="photo"&&(n.id=null,n.doNotRender=!0),n.binding=e.binding,n.label=e.label,n.vlidators="",e.vlidators)for(var o in e.vlidators)n.vlidators+=`data-v-${o}="${e.vlidators[o]}" `;return n},FamilyTree.elements.ids=[],FamilyTree.elements.generateId=function(){for(;;){var t="_"+("0000"+(Math.random()*Math.pow(36,4)|0).toString(36)).slice(-4);if(!FamilyTree.elements.ids.has(t))return FamilyTree.elements.ids.push(t),t}},FamilyTree.input={},FamilyTree.input._timeout=null,FamilyTree.input.initWithTimeout=function(){FamilyTree.input._timeout&&(clearTimeout(FamilyTree.input._timeout),FamilyTree.input._timeout=null),FamilyTree.input._timeout=setTimeout(FamilyTree.input.init,200)},FamilyTree.input.init=function(t){var e;e=t?t.querySelectorAll("[data-bft-input]"):document.querySelectorAll("[data-bft-input]");for(var i=0;i<e.length;i++){var n=e[i],r=null;n.type&&n.type.toLowerCase()=="hidden"&&(r=n),r||(r=n.querySelector("input")),r||(r=n.querySelector("select"));var o=n.querySelector("label");o&&(r.value||r.type=="select-one"&&r.selectedOptions&&r.selectedOptions.length&&r.selectedOptions[0].value==""&&r.selectedOptions[0].innerHTML)&&o.classList.add("hasval"),r.type.toLowerCase()!="checkbox"&&r.addEventListener("focus",function(){this.classList.remove("bft-validation-error");var a=this.parentNode.querySelector("label");a.classList.add("focused");var l=a.querySelector(".bft-validation-error-message");l&&l.parentNode.removeChild(l)}),r.type.toLowerCase()!="checkbox"&&r.addEventListener("blur",function(){FamilyTree.input.blurHandler(this)})}},FamilyTree.input.blurHandler=function(t){var e=t.parentNode.querySelector("label");e.classList.remove("focused"),t.value||t.type=="date"?e.classList.add("hasval"):e.classList.remove("hasval")},FamilyTree.input.validate=function(t){var e=null;t.type&&t.type.toLowerCase()=="hidden"&&(e=t),e||(e=t.querySelector("input")),e||(e=t.querySelector("select"));var i=t.querySelector("label");if(e.classList.remove("bft-validation-error"),i){var n=i.querySelector(".bft-validation-error-message");n&&n.parentNode.removeChild(n)}!e.selectedOptions&&e.value&&(e.value=e.value.trim());var r=t.getAttribute("data-v-required"),o=t.getAttribute("data-v-password"),a=t.getAttribute("data-v-email"),l=t.getAttribute("data-v-emails");return r&&e.value==""?(i.innerHTML+='<span class="bft-validation-error-message">&nbsp;'+r+"</span>",e.classList.add("bft-validation-error"),!1):o&&!FamilyTree.input.validatePassword(e.value)?(i.innerHTML+='<span class="bft-validation-error-message">&nbsp;'+o+"</span>",e.classList.add("bft-validation-error"),!1):a&&!FamilyTree.input.isValidEmail(e.value)?(i.innerHTML+='<span class="bft-validation-error-message">&nbsp;'+a+"</span>",e.classList.add("bft-validation-error"),!1):!(l&&!FamilyTree.input.isValidEmails(e.value))||(i.innerHTML+='<span class="bft-validation-error-message">&nbsp;'+l+"</span>",e.classList.add("bft-validation-error"),!1)},FamilyTree.input.validateAndGetData=function(t){for(var e=t.querySelectorAll("[data-bft-input]"),i=!0,n=0;n<e.length;n++){var r=e[n];FamilyTree.input.validate(r)||(i=!1)}if(!i)return!1;var o=t.querySelectorAll("[data-binding]"),a={};for(n=0;n<o.length;n++){var l=o[n],s=l.getAttribute("data-binding");if(l.type.toLowerCase()=="checkbox")a[s]=l.checked;else if(l.selectedOptions&&l.hasAttribute("multiple")){var c=l.selectedOptions;a[s]=Array.from(c).map(({value:d})=>d)}else a[s]=l.value}return a},FamilyTree.input.validatePassword=function(t){return t&&(t=t.trim()),!(t.length<5)&&!(t.length>18)&&t.indexOf(" ")==-1},FamilyTree.input.isValidEmails=function(t){if(t)for(var e=t.split(","),i=0;i<e.length;i++){var n=e[i].trim();if(!FamilyTree.input.isValidEmail(n))return!1}return!0},FamilyTree.input.isValidEmail=function(t){return t&&(t=t.trim()),/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(t).toLowerCase())},FamilyTree.prototype.hideTreeMenu=function(t,e){if(this._tree_menu_temp){var i=this._tree_menu_temp;if(this.manager.oldNodes=this.nodes,this.nodes=i.nodes,this.manager.maxX=i.maxX,this.manager.maxY=i.maxY,this.manager.minX=i.minX,this.manager.minY=i.minY,this.manager.roots=i.roots,this.manager.nodes=i.nodes,this.manager.rootList=i.rootList,this.manager.visibleNodeIds=i.visibleNodeIds,this.manager.bordersByRootIdAndLevel=i.bordersByRootIdAndLevel,this.config.roots=i.config.roots,this.config.nodes=i.config.nodes,this._tree_menu_temp=null,t){var n={id:i.id,animFromClickedNode:!1};this._draw(!0,FamilyTree.action.update,n,function(){e&&e()})}}},FamilyTree.prototype.showTreeMenu=function(t){this.editUI.hide(),t==null&&console.error("Call addNode without id");var e=this.getNode(t);e||console.error("Cannot get node id: "+t);var i=this.getNode(e.fid),n=this.getNode(e.mid),r=null,o=null,a=[],l=[];i&&(r=this.get(i.id)),n&&(o=this.get(n.id));for(var s=0;s<e.pids.length;s++){var c=this.get(e.pids[s]);c&&a.push(c)}for(s=0;s<e.ftChildrenIds.length;s++)l.push(this.get(e.ftChildrenIds[s]));var d=this.get(t);this._tree_menu_temp={maxX:this.manager.maxX,maxY:this.manager.maxY,minX:this.manager.minX,minY:this.manager.minY,roots:this.manager.roots,nodes:this.manager.nodes,rootList:this.manager.rootList,visibleNodeIds:this.manager.visibleNodeIds,bordersByRootIdAndLevel:this.manager.bordersByRootIdAndLevel,id:t,config:{roots:this.config.roots,nodes:this.config.nodes}},this.config.nodes=[];var p=[];if(o)p.push(o);else{var h={id:"_ft_mother",templateName:"mother",_ft_method:"addParentNode",_ft_childId:t,_ft_type:"mid",_ft_data:{gender:"female"}};d.mid=h.id,r?(r.pids=[h.id],h.pids=[r.id],h._ft_data.pids=[r.id]):h.pids=["_ft_father"],p.push(h)}if(r)p.push(r);else{var f={id:"_ft_father",templateName:"father",_ft_method:"addParentNode",_ft_childId:t,_ft_type:"fid",_ft_data:{gender:"male"}};d.fid=f.id,o?(o.pids=[f.id],f.pids=[o.id],f._ft_data.pids=[o.id]):f.pids=["_ft_mother"],p.push(f)}for(s=0;s<a.length;s++)p.push(a[s]);d.pids||(d.pids=[]);var m={id:"_ft_partner",pids:[t],templateName:"partner",_ft_method:"addPartnerNode",_ft_data:{pids:[t]}};if(d.gender=="male"?(m.templateName="wife",m._ft_data.gender="female"):d.gender=="female"&&(m.templateName="husband",m._ft_data.gender="male"),d.pids.push(m.id),p.push(m),d.pids)for(s=0;s<d.pids.length;s++){if(p.push({id:"_ft_child_group_"+s,mid:t,fid:d.pids[s],tags:["children-group"]}),d.pids[s]=="_ft_partner"){var y={id:"_ft_son_"+s,stpid:"_ft_child_group_"+s,templateName:"son",_ft_method:"addChildAndPartnerNodes",_ft_childData:{mid:e.id,fid:m.id,gender:"male"},_ft_partnerData:{pids:[t]},_ft_id:t},x={id:"_ft_daughter_"+s,stpid:"_ft_child_group_"+s,templateName:"daughter",_ft_method:"addChildAndPartnerNodes",_ft_childData:{mid:e.id,fid:m.id,gender:"female"},_ft_partnerData:{pids:[t]},_ft_id:t};d.gender=="male"&&m._ft_data.gender=="female"?(y._ft_childData.mid=m.id,y._ft_childData.fid=d.id,y._ft_partnerData.gender=m._ft_data.gender,x._ft_childData.mid=m.id,x._ft_childData.fid=d.id,x._ft_partnerData.gender=m._ft_data.gender):d.gender=="female"&&m._ft_data.gender=="male"&&(y._ft_childData.mid=d.id,y._ft_childData.fid=m.id,y._ft_partnerData.gender=m._ft_data.gender,x._ft_childData.mid=d.id,x._ft_childData.fid=m.id,x._ft_partnerData.gender=m._ft_data.gender),p.push(y),p.push(x)}else p.push({id:"_ft_son_"+s,stpid:"_ft_child_group_"+s,templateName:"son",_ft_method:"addChildNode",_ft_data:{mid:t,fid:d.pids[s],gender:"male"}}),p.push({id:"_ft_daughter_"+s,stpid:"_ft_child_group_"+s,templateName:"daughter",_ft_method:"addChildNode",_ft_data:{mid:t,fid:d.pids[s],gender:"female"}});for(var u=0;u<l.length;u++)l[u].mid!=d.pids[s]&&l[u].fid!=d.pids[s]||(l[u].mid=void 0,l[u].fid=void 0,l[u].stpid="_ft_child_group_"+s,p.push(l[u]))}var b=[];for(u=0;u<l.length;u++)(l[u].fid==d.id&&FamilyTree.isNEU(l[u].mid)||l[u].mid==d.id&&FamilyTree.isNEU(l[u].fid))&&(l[u].fid==d.id?l[u].mid="_ft_partner_for_single_child":l[u].mid==d.id&&(l[u].fid="_ft_partner_for_single_child"),p.push(l[u]),b.push(l[u].id));if(b.length){var v={id:"_ft_partner_for_single_child",pids:[t],templateName:"partner",_ft_method:"addPartnerAndParentNodes",_ft_childIds:b,_ft_partnerData:{pids:[t]},_ft_id:t};d.gender=="male"?(v.templateName="wife",v._ft_partnerData.gender="female"):d.gender=="female"&&(v.templateName="husband",v._ft_partnerData.gender="male"),d.pids.push(v.id),p.push(v)}var g={nodes:p,node:d};FamilyTree.events.publish("node-tree-menu-show",[this,g]),g.nodes.push(g.node),this.config.nodes=g.nodes,d=this.get(t);var _=this;FamilyTree.isNEU(d.mid)?FamilyTree.isNEU(d.fid)||(this.config.roots=[d.fid]):this.config.roots=[d.mid];var k={id:t,treeMenuMode:!0};this._draw(!1,FamilyTree.action.update,k,function(){FamilyTree._moveToBoundaryArea(_.getSvg(),_.getViewBox(),_.response.boundary)})},FamilyTree.ui.css=function(){return'<style data-bft-styles>.bft-button{background-color:#039be5;cursor:pointer;width:calc(100%);height:50px;color:#fff;padding-top:5px;padding-left:7px;padding-right:7px;text-align:center;text-transform:uppercase;border:1px solid #3fc0ff;display:inline-block;border-radius:5px}.bft-button.orange{background-color:#f57c00;border:1px solid #ffa03e}.bft-button.yellow{background-color:#ffca28;border:1px solid #ffdf7c}.bft-button.lower{text-transform:unset}.bft-button.transparent{background-color:transparent}.bft-button:hover{background-color:#35afea}.bft-button.orange:hover{background-color:#f79632}.bft-button.yellow:hover{background-color:#ffd452}.bft-button:active{transform:matrix(.98,0,0,.98,0,0)}.bft-button-icon{text-align:initial;cursor:pointer;margin-bottom:15px;color:#039be5}.bft-dark .bft-button-icon:hover{background-color:#2d2d2d}.bft-light .bft-button-icon:hover{background-color:#ececec}.bft-button-icon>img{height:24px;width:24px;vertical-align:middle;padding:7px}.bft-button:focus{outline:0}.bft-button-icon>img{filter:invert(46%) sepia(66%) saturate(2530%) hue-rotate(171deg) brightness(95%) contrast(98%)}.bft-light .bft-button.transparent{color:#039be5}.bft-light .bft-button.transparent:hover{color:#fff}.bft-button-loading{background-color:transparent;cursor:pointer;width:calc(100% - 2px);height:50px;color:#fff;text-align:center;text-transform:uppercase;border:1px solid #027cb7;display:inline-block;display:flex;justify-content:center;align-items:center;display:none}.bft-button-loading .bft-loading-dots div{margin:0 10px}.bft-link-bft-button{position:absolute;right:10px;top:-1px}@media screen and (max-width:1000px){.bft-link-bft-button{right:50px}}[data-bft-input-disabled] .bft-link-bft-button{display:none}[dir=rtl] .bft-link-bft-button{left:10px;right:unset}.bft-img-button{width:48px;height:48px;cursor:pointer;border-radius:50%;background-color:#039be5;background-repeat:no-repeat;background-size:24px 24px;background-position:center center;margin:3px;display:inline-block}.bft-img-button:hover{background-color:#f57c00}.bft-checkbox{display:block;position:relative;padding-left:35px;margin-bottom:12px;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;white-space:nowrap}.bft-checkbox input{position:absolute;opacity:0;cursor:pointer;height:0;width:0}.bft-checkbox-checkmark{position:absolute;top:0;left:0;height:25px;width:25px;border-radius:5px}.bft-dark [data-bft-input-disabled] .bft-checkbox-checkmark,.bft-dark [data-bft-input-disabled].bft-checkbox input:checked~.bft-checkbox-checkmark,.bft-light [data-bft-input-disabled] .bft-checkbox-checkmark,.bft-light [data-bft-input-disabled].bft-checkbox input:checked~.bft-checkbox-checkmark{background-color:#aeaeae!important}[data-bft-input-disabled].bft-checkbox{cursor:default}[dir=rtl] .bft-checkbox-checkmark{right:0}[dir=rtl] .bft-checkbox{padding-left:unset;padding-right:35px}.bft-dark .bft-checkbox-checkmark{background-color:#333;border:1px solid #5b5b5b}.bft-light .bft-checkbox-checkmark{background-color:#fff;border:1px solid #c7c7c7}.bft-dark .bft-checkbox:hover input~.bft-checkbox-checkmark{background-color:#3c3c3c}.bft-light .bft-checkbox:hover input~.bft-checkbox-checkmark{background-color:#f8f9f9}.bft-dark .bft-checkbox input:checked~.bft-checkbox-checkmark{background-color:#039be5}.bft-light .bft-checkbox input:checked~.bft-checkbox-checkmark{background-color:#039be5}.bft-checkbox-checkmark:after{content:"";position:absolute;display:none}.bft-checkbox input:checked~.bft-checkbox-checkmark:after{display:block}.bft-checkbox .bft-checkbox-checkmark:after{left:9px;top:5px;width:5px;height:10px;border:solid #fff;border-width:0 3px 3px 0;-webkit-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg)}.bft-filter{user-select:none}.bft-light .bft-filter{color:#757575}.bft-dark .bft-filter{color:#ccc}.bft-filter>div>div{display:inline-block;padding:3px 10px;cursor:pointer}.bft-filter-menu fieldset,.bft-filter>div,.filter-field-selected{border-radius:5px}.bft-filter-menu fieldset{overflow-y:auto;max-height:300px}.bft-filter>div.bft-filter-menu{padding:10px}.bft-light .bft-filter>div.bft-filter-menu,.bft-light .filter-field-selected{background-color:#f8f9f9}.bft-dark .bft-filter>div.bft-filter-menu,.bft-dark .filter-field-selected{background-color:#3c3c3c}.bft-light .bft-filter>div{background-color:#eee}.bft-dark .bft-filter>div{background-color:#333}.bft-form-perspective{transform-style:preserve-3d;perspective:500px;position:absolute;top:32px}.bft-form{box-shadow:rgba(0,0,0,.2) 0 6px 6px 0,rgba(0,0,0,.19) 0 13px 20px 0;padding:14px;transform-origin:top center;user-select:none;display:none;position:relative;max-height:calc(100vh - 100px);overflow-y:auto;border-bottom-left-radius:5px;border-bottom-right-radius:5px}.bft-form-bottom{border-bottom-left-radius:unset;border-bottom-right-radius:unset;border-top-left-radius:5px;border-top-right-radius:5px}.bft-form .separator{margin:0 10px}@media screen and (max-width:1000px){.bft-form-perspective{min-width:100%;max-height:calc(100% - 32px);left:unset!important;right:unset!important;transform:none!important}.bft-form .set{max-height:calc(100vh - 74px)}.bft-form-fieldset{max-width:unset!important}}.bft-light .bft-form .separator{border-bottom:1px solid #c7c7c7}.bft-dark .bft-form .separator{border-bottom:1px solid #5b5b5b}.bft-light .bft-form{background-color:#fff}.bft-dark .bft-form{background-color:#252526}.bft-item{padding:6px 12px 6px 12px;display:flex;flex-direction:row}.bft-light .bft-form .bft-item.selected,.bft-light .bft-form .bft-item:hover{background-color:#0074e8;color:#fff}.bft-dark .bft-form .bft-item.selected,.bft-dark .bft-form .bft-item:hover{background-color:#094771;color:#fff}.bft-item.selected img,.bft-item:hover img{filter:invert(100%)}.bft-item.selected img{visibility:visible!important}.bft-form-fieldset{display:flex;flex-wrap:wrap;margin:0!important}.bft-form-field{flex:1 0 21%;margin:3px;min-width:200px}.bft-form-field-100{flex:1 0 96%;margin:3px;min-width:200px}.bft-input{position:relative}.bft-input>input,.bft-input>select{height:50px;padding:18px 10px 2px 9px;width:100%;box-sizing:border-box;border-style:solid;border-width:1px}.bft-input select{height:50px;padding:20px 5px 4px 5px}[data-bft-input-disabled].bft-input>input,[data-bft-input-disabled].bft-input>select{border-color:transparent!important}.bft-light [data-bft-input-disabled]>input,.bft-light [data-bft-input-disabled]>select{background-color:#fff!important}.bft-dark [data-bft-input-disabled]>input,.bft-dark [data-bft-input-disabled]>select{background-color:#252526!important}[data-bft-input-disabled]>select{appearance:none;padding-left:8px}.bft-input>label{display:inline-block;position:absolute;padding-left:10px;padding-right:10px;color:#acacac;cursor:text;-webkit-transition:all .1s ease-out;-moz-transition:all .1s ease-out;-ms-transition:all .1s ease-out;-o-transition:all .1s ease-out;transition:all .1 ease-out;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:initial;text-align:initial;white-space:nowrap}.bft-input>label{top:12px;overflow:hidden;text-overflow:ellipsis;max-width:calc(100% - 14px)}.bft-input>label.focused,.bft-input>label.hasval{top:-1px}.bft-input>input,.bft-input>select{outline:0;border-radius:5px}.bft-dark .bft-input>label.focused,.bft-light .bft-input>label.focused{color:#039be5}.bft-dark .bft-input>input,.bft-dark .bft-input>select{color:#ccc;background-color:#333;border-color:#5b5b5b}.bft-light .bft-input>input,.bft-light .bft-input>select{color:#757575;background-color:#fff;border-color:#c7c7c7}.bft-light .bft-input>input:focus,.bft-light .bft-input>select:focus{border-color:#039be5;background-color:#f8f9f9}.bft-dark .bft-input>input:focus,.bft-dark .bft-input>select:focus{border-color:#039be5;background-color:#3c3c3c}.bft-dark .bft-input>input.bft-validation-error,.bft-dark .bft-input>select.bft-validation-error,.bft-light .bft-input>input.bft-validation-error,.bft-light .bft-input>select.bft-validation-error{border-color:#ca2a2a}.bft-dark .bft-validation-error-message,.bft-light .bft-validation-error-message{color:#ca2a2a}.bft-input select.multiple{height:initial}.bft-link{color:#039be5;cursor:pointer;text-decoration:underline}.bft-link:hover{color:#f57c00}.bft-dark ::-webkit-scrollbar,.bft-light ::-webkit-scrollbar{width:15px;height:15px}.bft-dark ::-webkit-scrollbar-corner{background:#1e1e1e}.bft-dark ::-webkit-scrollbar-track{background:#1e1e1e;border-left:1px solid #333;border-top:1px solid #333}.bft-dark ::-webkit-scrollbar-thumb{background:#424242}.bft-dark ::-webkit-scrollbar-thumb:hover{background:#4f4f4f}.bft-dark ::-webkit-scrollbar-thumb:active{background:#5e5e5e}.bft-light ::-webkit-scrollbar-corner{background:#fff}.bft-light ::-webkit-scrollbar-track{background:#fff;border-left:1px solid #ddd;border-top:1px solid #ddd}.bft-light ::-webkit-scrollbar-thumb{background:#c1c1c1}.bft-light ::-webkit-scrollbar-thumb:hover{background:#929292}.bft-light ::-webkit-scrollbar-thumb:active{background:#666}.bft-edit-form{position:fixed;top:0;right:0;height:100%;width:100%;box-shadow:rgba(0,0,0,.2) 0 6px 6px 0,rgba(0,0,0,.19) 0 13px 20px 0;display:flex;flex-direction:column;height:100%;width:400px}@media screen and (max-width:1000px){.bft-edit-form{width:100%}}.bft-dark .bft-edit-form{background-color:#252526}.bft-light .bft-edit-form{background-color:#fff}.bft-edit-form-header{height:200px;text-align:center;border-radius:10px}.export-service .bft-edit-form-header{border-radius:unset}.bft-edit-form-title{color:#fff;margin:0;padding:14px 17px 7px 17px}.bft-edit-form-avatar{border-radius:50%;width:150px;height:150px;position:absolute;top:75px;border:5px solid #fff;left:50%;transform:translateX(-50%);background-color:#cacaca;box-shadow:rgba(0,0,0,.2) 0 6px 6px 0,rgba(0,0,0,.19) 0 13px 20px 0}.bft-edit-form-close{position:absolute;right:14px;top:14px;width:34px;height:34px;cursor:pointer}.bft-edit-form-fields{flex-grow:1;overflow-y:auto;overflow-x:hidden}.bft-edit-form-fields-inner{margin:0 7px 20px 7px}.bft-family-menu{opacity:0;display:inline-block;position:absolute;text-align:left;user-select:none;min-width:270px;box-shadow:rgba(0,0,0,.2) 0 4px 8px 0,rgba(0,0,0,.19) 0 6px 20px 0;font:13px/28px Helvetica,"Segoe UI",Arial,sans-serif;border-radius:10px}.bft-family-menu>div:hover img{filter:invert(100%)}.bft-family-menu [data-item]{text-align:start;padding:7px 10px}.bft-dark .bft-family-menu [data-item]{background-color:#252526;color:#acacac;border-bottom:1px solid #333}.bft-dark .bft-family-menu [data-item]:hover{background-color:#094771!important;color:#fff!important}.bft-dark .bft-family-menu [data-item]:hover svg{filter:brightness(0) invert(1)}.bft-light .bft-family-menu [data-item]{background-color:#fff;color:#333;border-bottom:1px solid #c7c7c7}.bft-light .bft-family-menu [data-item]:hover{background-color:#0074e8!important;color:#fff!important}.bft-light .bft-family-menu [data-item]:hover svg{filter:brightness(0) invert(1)}.bft-family-menu [data-item] svg{vertical-align:middle}.bft-family-menu [data-item]:first-child{border-top-left-radius:7px;border-top-right-radius:7px}.bft-family-menu [data-item]:last-child{border-bottom-width:0;border-bottom-style:none;border-bottom-left-radius:7px;border-bottom-right-radius:7px}.bft-search{position:absolute}@media screen and (max-width:500px){.bft-search{width:calc(100% - 30px);left:15px}}.bft-search .bft-input{margin-bottom:0}.bft-search-input{color:#7a7a7a;width:100%;border:none;outline:0;padding-top:10px;padding-right:47px}.bft-search-image-td{width:43px}.bft-search-text-td{padding-inline-end:7px;line-height:15px;text-align:start}.bft-search table{box-shadow:rgba(0,0,0,.2) 0 4px 8px 0,rgba(0,0,0,.19) 0 6px 20px 0;margin:0 3.5px 0 3.5px;width:calc(100% - 7px);border-radius:7px}.bft-search table tr:first-child td:first-child{border-top-left-radius:7px}.bft-search table tr:first-child td:last-child{border-top-right-radius:7px}[dir=rtl] .bft-search table tr:first-child td:first-child{border-top-left-radius:unset;border-top-right-radius:7px}[dir=rtl] .bft-search table tr:first-child td:last-child{border-top-right-radius:unset;border-top-left-radius:7px}.bft-search table tr:last-child td:first-child{border-bottom-left-radius:7px}.bft-search table tr:last-child td:last-child{border-bottom-right-radius:7px}[dir=rtl] .bft-search table tr:last-child td:first-child{border-bottom-left-radius:unset;border-bottom-right-radius:7px}[dir=rtl] .bft-search table tr:last-child td:last-child{border-bottom-right-radius:unset;border-bottom-left-radius:7px}.bft-dark .bft-search table{background-color:#252526;color:#acacac}.bft-search [data-search-item-id]{cursor:pointer}.bft-search-photo{margin:7px 7px 0 7px;width:32px;height:32px;background-size:cover;background-position:top center;border-radius:50%;display:inline-block;border:1px solid #8c8c8c}.bft-search [data-search-item-id]:hover .bft-link{color:#ffca28}.bft-search [data-search-item-id]:hover .bft-link:hover{color:#f57c00}.bft-dark .bft-search [data-search-item-id] td{border-top:1px solid #333}.bft-dark .bft-search [data-search-item-id]:hover,.bft-dark .bft-search [data-selected=yes]{background-color:#094771;color:#fff}.bft-light .bft-search table{background-color:#fff;color:#333}.bft-light .bft-search [data-search-item-id] td{border-top:1px solid #c7c7c7}.bft-light .bft-search [data-search-item-id]:hover,.bft-light .bft-search [data-selected=yes]{background-color:#0074e8;color:#fff}.bft-search [data-search-item-id]:first-child td{border-top:unset}.bft-ripple-container{position:absolute;top:0;right:0;bottom:0;left:0}.bft-drag-over rect{opacity:.5}.bft-ripple-container span{transform:scale(0);border-radius:100%;position:absolute;opacity:.75;background-color:#fff;animation:bft-ripple 1s}@-moz-keyframes bft-ripple{to{opacity:0;transform:scale(2)}}@-webkit-keyframes bft-ripple{to{opacity:0;transform:scale(2)}}@-o-keyframes bft-ripple{to{opacity:0;transform:scale(2)}}@keyframes bft-ripple{to{opacity:0;transform:scale(2)}}.bft-slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;-webkit-transition:.4s;transition:.4s}.bft-slider:before{position:absolute;content:"";height:16px;width:16px;left:4px;bottom:4px;background-color:#fff;-webkit-transition:.4s;transition:.4s}.bft-slider.round{border-radius:24px}.bft-slider.round:before{border-radius:50%}svg text:hover{cursor:default}svg.bft-cursor-grab,svg.bft-cursor-grab text:hover{cursor:grab}svg.bft-cursor-nodrop,svg.bft-cursor-nodrop text:hover{cursor:no-drop}svg.bft-cursor-copy,svg.bft-cursor-copy text:hover{cursor:copy}svg.bft-cursor-move,svg.bft-cursor-move text:hover{cursor:move}#bft-close-btn:focus,#bft-close-btn:hover{color:#000;text-decoration:none;cursor:pointer}#bft-id-select:focus{outline:.5px solid #aeaeae}#bft-sampleDialog #title:hover{cursor:default;background:gray}.bft-light{background-color:#fff;font:13px/28px Helvetica,"Segoe UI",Arial,sans-serif}.bft-dark{background-color:#1e1e1e;font:13px/28px Helvetica,"Segoe UI",Arial,sans-serif}.bft-light .bft-fill{fill:#fff}.bft-dark .bft-fill{fill:#1e1e1e}.bft-dark input,.bft-dark select,.bft-light input,.bft-light select{font:16px Helvetica,"Segoe UI",Arial,sans-serif}.bft-dark h1,.bft-light h1{font-size:30px;line-height:1}.bft-edit-form{position:absolute;border-radius:10px}.export-service .bft-edit-form{border-radius:unset}.bft-dark .bft-edit-form{color:#acacac}.bft-light .bft-edit-form{color:#333}.bft-dark ::-webkit-calendar-picker-indicator{filter:invert(70%)}.bft-light ::-webkit-calendar-picker-indicator{filter:invert(50%)}.bft-edit-form-instruments{margin:42px 10px 0 10px;text-align:center;min-height:70px}.bft-img-button svg{position:relative;top:12px}.bft-light .bft-toolbar-container svg circle,.bft-light .bft-toolbar-container svg line,.bft-light .bft-toolbar-container svg path{stroke:#8c8c8c!important}.bft-dark .bft-toolbar-container svg circle,.bft-dark .bft-toolbar-container svg line,.bft-dark .bft-toolbar-container svg path{stroke:#8c8c8c!important}.bft-dark .bft-toolbar-container svg rect{fill:#252526!important}.bft-dark .bft-toolbar-container [data-tlbr=minus] svg{border-left:1px solid #5b5b5b!important;border-right:1px solid #5b5b5b!important;border-bottom:1px solid #5b5b5b!important}.bft-dark .bft-toolbar-container [data-tlbr=plus] svg{border-left:1px solid #5b5b5b!important;border-right:1px solid #5b5b5b!important;border-top:1px solid #5b5b5b!important}.bft-dark .bft-toolbar-container [data-tlbr]>svg{border:1px solid #5b5b5b!important;background-color:#252526!important}.bft-toolbar-layout{height:123px;padding-top:20px;position:absolute;width:100%;left:"0";bottom:"-145px"}.bft-light .bft-toolbar-layout{border-top:1px solid #c7c7c7;background-color:#f9f9f9}.bft-dark .bft-toolbar-layout{border-top:1px solid #5b5b5b;background-color:#2b2b2b}.bft-dotted-connector path{stroke-dasharray:7}.bft-undo-redo{position:absolute;top:23px;left:23px}@media screen and (max-width:500px){.bft-undo-redo{position:absolute;top:83px;left:23px}}.bft-light .bft-undo-redo path{fill:#cacaca}.bft-dark .bft-undo-redo path{fill:#5b5b5b}.bft-light .bft-undo-redo .bft-ur-clickable path{fill:#9c9c9c}.bft-dark .bft-undo-redo .bft-ur-clickable path{fill:#8c8c8c}.bft-undo-redo .bft-ur-clickable rect{cursor:pointer}.bft-undo-redo>span{position:relative;display:inline-block;user-select:none}.bft-undo-redo .bft-undo-i{left:-6px;top:-6px}.bft-undo-redo .bft-redo-i{right:-6px;bottom:6px}.bft-undo-redo>span>span{color:#fff;position:absolute;display:inline-block;min-width:20px;min-height:20px;border-radius:50%;line-height:20px;text-align:center;padding:1px;user-select:none;cursor:pointer}.bft-light .bft-undo-redo>span>span{background-color:#9c9c9c}.bft-dark .bft-undo-redo>span>span{background-color:#8c8c8c}</style>'},FamilyTree.events.on("render",function(t,e){if(t.recentRoots||(t.recentRoots=[]),t.config.roots)for(var i=0;i<t.config.roots.length;i++){var n=t.recentRoots.indexOf(t.config.roots[i]);n!=-1&&t.recentRoots.splice(n,1),t.recentRoots.unshift(t.config.roots[i])}}),FamilyTree.events.on("show",function(t,e){if(t instanceof FamilyTree.editUI&&t.obj._tree_menu_temp)return!1}),FamilyTree.events.on("render-link",function(t,e){e.cnode.ppid!=null&&e.cnode.layout!=FamilyTree.mixed&&(e.html+='<use xlink:href="#dot" x="'+e.p.xa+'" y="'+e.p.ya+'"/>')}),FamilyTree.events.on("click",function(t,e){if(t instanceof FamilyTree){var i=t._get(e.node.id);if(i._ft_method)return i._ft_method=="addParentNode"?t[i._ft_method](i._ft_childId,i._ft_type,i._ft_data,null,!0):i._ft_method=="addChildAndPartnerNodes"?t[i._ft_method](i._ft_id,i._ft_childData,i._ft_partnerData,null,!0):i._ft_method=="addPartnerAndParentNodes"?t[i._ft_method](i._ft_id,i._ft_childIds,i._ft_partnerData,null,!0):t[i._ft_method](i._ft_data,null,!0),!1;for(var n=e.event.target;n;){if(n.getAttribute&&(n.hasAttribute("data-ctrl-n-t-menu-id")||n.hasAttribute("data-ctrl-n-t-menu-c"))){var r=n.getAttribute("data-ctrl-n-t-menu-id");return FamilyTree.isNEU(r)?t.hideTreeMenu(!0):t.showTreeMenu(r),e.event.stopPropagation(),e.event.preventDefault(),!1}n=n.parentNode}}}),FamilyTree===void 0&&(FamilyTree={}),FamilyTree.prototype.onField=function(t){return this.on("field",function(e,i){return t.call(e,i)})},FamilyTree.prototype.onInit=function(t){return this.on("init",function(e){return t.call(e)})},FamilyTree.prototype.onRedraw=function(t){return this.on("redraw",function(e){return t.call(e)})},FamilyTree.prototype.onUpdateNode=function(t){return this.on("update",function(e,i,n){var r={oldData:i,newData:n};return t.call(e,r)})},FamilyTree.prototype.onUpdated=function(t){return this.on("updated",function(e){return t.call(e)})},FamilyTree.prototype.onRemoveNode=function(t){return this.on("remove",function(e,i,n){var r={id:i,newPidsAndStpidsForIds:n};return t.call(e,r)})},FamilyTree.prototype.onAddNode=function(t){return this.on("add",function(e,i){var n={data:i};return t.call(e,n)})},FamilyTree.prototype.onDrop=function(t){return this.on("drop",function(e,i,n,r,o){var a={dragId:i,dropId:n,dragNodeElement:r,event:o};return t.call(e,a)})},FamilyTree.prototype.onDrag=function(t){return this.on("drag",function(e,i,n,r){var o={dragId:i,event:n,nodeIds:r};return t.call(e,o)})},FamilyTree.prototype.onExpandCollpaseButtonClick=function(t){return this.on("expcollclick",function(e,i,n,r){var o={collapsing:i,id:n,ids:r};return t.call(e,o)})},FamilyTree.prototype.onExportStart=function(t){return this.on("exportstart",function(e,i){return t.call(e,i)})},FamilyTree.prototype.onExportEnd=function(t){return this.on("exportend",function(e,i){return t.call(e,i)})},FamilyTree.prototype.onNodeClick=function(t){return this.on("click",function(e,i){return t.call(e,i)})},FamilyTree.prototype.onNodeDoubleClick=function(t){return this.on("dbclick",function(e,i){var n={data:i};return t.call(e,n)})},FamilyTree.prototype.onUpdateNode=function(t){return this.on("update",function(e,i){return t.call(e,i)})},FamilyTree.prototype.onNodeTreeMenuShow=function(t){return this.on("node-tree-menu-show",function(e,i){return t.call(e,i)})},FamilyTree.prototype.onRemoveNode=null,FamilyTree.prototype.onAddNode=null,FamilyTree.filterUI=function(){},FamilyTree.filterUI.prototype.init=function(t){this.instance=t,this.element=null,this.filterBy=null,this._event_id=FamilyTree._guid()},FamilyTree.filterUI.prototype.addFilterTag=function(t){if(!this.instance.config.filterBy||FamilyTree.isNEU(t))return!1;if(this.filterBy!==null||typeof this.instance.config.filterBy!="object"||Array.isArray(this.instance.config.filterBy)||(this.filterBy=JSON.parse(JSON.stringify(this.instance.config.filterBy))),this.filterBy!=null)for(var e in this.filterBy){var i=t[e];if(i!=null){var n=this.filterBy[e];if(n!=null){var r=n[i];if(r!=null&&r.checked===!1)return!0}}}return!1},FamilyTree.filterUI.prototype.show=function(t){var e=this.element.querySelector('[data-filter-field="'+t+'"]');e&&e.click()},FamilyTree.filterUI.prototype.hide=function(){var t=this.instance.element.querySelector("[data-filter-close]");t&&t.click()},FamilyTree.filterUI.prototype.update=function(){if(this.instance.config.filterBy){var t={};if(this.instance.config.filterBy=="all")for(var e=FamilyTree.manager.getAllFields(this.instance.config),i=0;i<e.length;i++){var n=e[i];n!="tags"&&n!="id"&&n!="pid"&&n!="ppid"&&n!="stpid"&&(t[n]={})}else if(Array.isArray(this.instance.config.filterBy))for(i=0;i<this.instance.config.filterBy.length;i++)t[this.instance.config.filterBy[i]]={};else if(typeof this.instance.config.filterBy=="object")for(var r in this.instance.config.filterBy)t[r]={};for(var o in t){var a=t[o];for(i=0;i<this.instance.config.nodes.length;i++){var l=this.instance.config.nodes[i][o];l!=null&&(a[l]||(a[l]={checked:!0,text:l}))}}if(this.filterBy!=null){for(var s in t)if(this.filterBy[s])for(var c in t[s])this.filterBy[s][c]&&(t[s][c]=this.filterBy[s][c])}if(FamilyTree.FILTER_ALPHABETICALLY){var d=Object.keys(t).sort(),p=t;for(t={},i=0;i<d.length;i++)t[h=d[i]]=p[h];for(var o in t)for(a=t[o],t[o]={},d=Object.keys(a).sort(),i=0;i<d.length;i++){var h=d[i];t[o][h]=a[h]}}this.filterBy=t;var f=this;this.element=this.instance.element.querySelector("[data-filter]"),this.element&&this.element.parentNode.removeChild(this.element),this.element=document.createElement("div"),this.element.setAttribute("data-filter",""),this.element.style.position="absolute",this.element.setAttribute("class","bft-filter"),this.instance.config.undoRedoStorageName?(this.element.style.top=0,this.element.style.left="50%",this.element.style.transform="translate(-50%)"):(this.element.style.top=this.instance.config.padding+"px",this.element.style.left=this.instance.config.padding+"px");var m="";for(var s in this.filterBy){var y={name:s,html:`<div data-filter-field="${s}">${s}</div>`};FamilyTree.events.publish("add-filter",[f,y]),m+=y.html}this.element.innerHTML=`<div>${m}</div>`,this.element.addEventListener("click",function(x){if(x.target.hasAttribute("data-filter-close")||x.target.hasAttribute("data-filter-field")){for(var u=x.target.getAttribute("data-filter-field"),b=f.instance.element.querySelectorAll("[data-filter-menu]"),v=0;v<b.length;v++)b[v].style.display="none";var g=f.instance.element.querySelectorAll(".filter-field-selected");for(v=0;v<g.length;v++)g[v].classList.remove("filter-field-selected");var _=f.instance.element.querySelector("[data-filter-close]");if(_&&_.parentNode.removeChild(_),x.target.hasAttribute("data-filter-close")||!x.target.hasAttribute("data-filter-field"))return;var k=f.instance.element.querySelector(`[data-filter-menu="${u}"]`);if(!k){var w={name:u,text:FamilyTree.filterUI.all,value:u,checked:!0,html:`<div>
                        <input data-all type="checkbox" id="${u}" name="${u}" checked>
                        <label for="${u}">${FamilyTree.filterUI.all}</label>
                    </div>`};FamilyTree.events.publish("add-item",[f,w]);var S=w.html;for(var I in f.filterBy[u]){var M=f.filterBy[u][I],N=M.text;N==null&&(N=I),w={name:u,text:N,value:I,checked:M.checked,html:`<div>
                            <input  type="checkbox" id="${u}_${I}" name="${I}" ${M.checked?"checked":""}>
                            <label for="${u}_${I}">${N}</label>
                        </div>`},FamilyTree.events.publish("add-item",[f,w]),S+=w.html}k=document.createElement("div");var A=FamilyTree.filterUI.textFilterBy;k.innerHTML=`<fieldset>
                                                    <legend>${A} ${u}:</legend>
                                                    ${S}
                                                </fieldset>`,k.setAttribute("data-filter-menu",u),k.classList.add("bft-filter-menu"),x.target.parentNode.parentNode.appendChild(k);var B=k.querySelectorAll("input");for(v=0;v<B.length;v++)B[v].addEventListener("change",function(P){for(var T=P.target;T&&!T.hasAttribute("data-filter-menu");)T=T.parentNode;if(T){var O=T.getAttribute("data-filter-menu");if(P.target.hasAttribute("data-all")){for(var L=P.target.parentNode.parentNode.querySelectorAll("input"),U=0;U<L.length;U++)if(L[U]!=P.target)for(var D in L[U].checked=P.target.checked,f.filterBy[O])f.filterBy[O][D].checked=P.target.checked}else if(f.filterBy[O][this.name]!=null&&(f.filterBy[O][this.name].checked=this.checked),this.checked){for(var R=f.instance.config.nodes,H=0;H<R.length;H++)if(R[H][O]==this.name){for(var Y=R[H];Y;)if(FamilyTree.isNEU(Y.stpid))Y=FamilyTree.isNEU(Y.pid)?null:f.instance._get(Y.pid);else if((Y=f.instance._get(Y.stpid))[O]){var C=P.target.parentNode.parentNode.querySelector('[name="'+Y[O]+'"]');C?(C.checked=this.checked,f.filterBy[O][Y[O]].checked=this.checked):console.error('Cannot find element with selector: [name="'+Y[O]+'"]')}}}f.instance.draw()}})}k.style.display="block",x.target.classList.add("filter-field-selected"),(_=document.createElement("div")).classList.add("close"),_.innerHTML="x",_.setAttribute("data-filter-close",""),x.target.parentNode.appendChild(_),FamilyTree.events.publish("show-items",[f,{name:u}])}}),this.instance.element.appendChild(this.element),FamilyTree.events.publish("update",[this,{}])}},FamilyTree.filterUI.prototype.on=function(t,e){return FamilyTree.events.on(t,e,this._event_id),this},FamilyTree.filterUI.textFilterBy="Filter by",FamilyTree.filterUI.all="[All]",FamilyTree===void 0&&(FamilyTree={}),FamilyTree.remote===void 0&&(FamilyTree.remote={}),FamilyTree.LIMIT_NODES=!0,FamilyTree.remote._fromResDTO=function(t,e,i,n,r){var o=e[t.id];t.x=o.p[0],t.y=o.p[1],t.w=o.p[2],t.h=o.p[3],o.ln!=null&&(t.leftNeighbor=r[o.ln]),o.rn!=null&&(t.rightNeighbor=r[o.rn]);for(var a=0;a<t.stChildren.length;a++)FamilyTree.remote._fromResDTO(t.stChildren[a],e,i,n,r);for(a=0;a<t.children.length;a++)FamilyTree.remote._fromResDTO(t.children[a],e,i,n,r)},FamilyTree.remote._toReqDTO=function(t,e){var i={p:[t.id,t.parent!=null?t.parent.id:null,t.stParent!=null?t.stParent.id:null,t.w,t.h]};t.children.length>0&&(i.c=FamilyTree.remote._convertToIdArray(t.children)),t.stChildren.length>0&&(i.v=FamilyTree.remote._convertToIdArray(t.stChildren)),t.layout!=null&&t.layout!=0&&(i.l=t.layout),t.isAssistant&&(i.a=1),t.isSplit&&(i.s=t.isSplit),t.isMirror&&(i.im=t.isMirror),t.padding&&(i.q=t.padding),t.lcn&&(i.k=t.lcn),t.stContainerNodes&&(i.b=FamilyTree.remote._convertToIdArray(t.stContainerNodes)),t.isPartner&&(i.i=t.isPartner),t.hasPartners&&(i.g=t.hasPartners),t.partnerSeparation&&(i.e=t.partnerSeparation),e.push(i);for(var n=0;n<t.stChildren.length;n++)FamilyTree.remote._toReqDTO(t.stChildren[n],e);for(n=0;n<t.children.length;n++)FamilyTree.remote._toReqDTO(t.children[n],e)},FamilyTree.remote._toReqLayoutConfigsDTO=function(t){var e={};for(var i in t){var n=t[i];e[i]||(e[i]=[]),e[i][0]=n.orientation,e[i][1]=n.levelSeparation,e[i][2]=n.mixedHierarchyNodesSeparation,e[i][3]=n.subtreeSeparation,e[i][4]=n.siblingSeparation,e[i][5]=n.layout,e[i][6]=n.columns,e[i][7]=n.collapse,e[i][8]=n.assistantSeparation,e[i][9]=n.partnerNodeSeparation}return e},FamilyTree.remote._convertToIdArray=function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].id);return e},FamilyTree.remote._setPositions=function(t,e,i,n){for(var r=[],o=[],a=FamilyTree.remote._toReqLayoutConfigsDTO(e),l=0;l<t.length;l++)o.push(t[l].id),FamilyTree.remote._toReqDTO(t[l],r);var s={n:r,c:a,r:o,v:"8.14.00"};if(FamilyTree.LIMIT_NODES||(s.l=!0),FamilyTree.remote._fromReqDTO!=null)FamilyTree.remote._fromReqDTO(s.n,s.r,s.c,function(d){for(var p=0;p<t.length;p++)FamilyTree.remote._fromResDTO(t[p],d,0,t,n);i()});else{s=JSON.stringify(s);var c=FamilyTree.localStorage.getItem(s);c&&(c=JSON.parse(c)),c&&!c.limit?FamilyTree.remote._proceed(t,c,n,i):FamilyTree.remote._findRegion(function(d){FamilyTree._ajax(d,"post",s,"json",function(p){p.error?i(2):(FamilyTree.remote._proceed(t,p,n,i),FamilyTree.localStorage.setItem(s,JSON.stringify(p)))})})}},FamilyTree.remote._proceed=function(t,e,i,n){if(typeof e=="string"&&(e=JSON.parse(e)),e.limit&&e.limit==1)n(e.limit);else{for(var r=0;r<t.length;r++)FamilyTree.remote._fromResDTO(t[r],e,0,t,i);n()}},FamilyTree.remote._findRegion=function(t){var e=FamilyTree.localStorage.getItem(FamilyTree.FUNC_URL_NAME);if(e)t(e);else{for(var i=["defunc2","cusfunc2","bsfunc2","acfunc2","kcfunc2","safunc2","wifunc2"],n=[],r=0;r<i.length;r++)n.push(new XMLHttpRequest);for(r=0;r<i.length;r++)(function(){var o="https://"+i[r]+FamilyTree.SERVER_PREFIX,a=n[r];a.onreadystatechange=function(){if(this.readyState==4&&this.status==200){FamilyTree.localStorage.setItem(FamilyTree.FUNC_URL_NAME,o),t(o);for(var l=0;l<n.length;l++)n[l].abort()}},a.open("GET",o,!0),a.send()})()}};
